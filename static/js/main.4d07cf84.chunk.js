(this.webpackJsonpui=this.webpackJsonpui||[]).push([[1],[,,,,,function(e,t,n){"use strict";n.d(t,"c",(function(){return s})),n.d(t,"b",(function(){return o})),n.d(t,"a",(function(){return i}));var a,r,c=n(10),s={USERNAME:"username",PROFILES:"profiles",PREFERENCE:"preference",P2PMESSAGE:"p2pmessage",CONTACTS:"contacts",GROUP:"group",AGGREGATOR:"aggregator"},o=(a={},Object(c.a)(a,s.GROUP,{ADDED_TO_GROUP:"ADDED_TO_GROUP",GROUP_MESSAGE_DATA:"GROUP_MESSAGE_DATA",GROUP_TYPING_DETAIL:"GROUP_TYPING_DETAIL",GROUP_MESSAGE_READ:"GROUP_MESSAGE_READ",PIN_MESSAGE_DATA:"PIN_MESSAGE_DATA"}),Object(c.a)(a,s.P2PMESSAGE,{RECEIVE_P2P_MESSAGE:"RECEIVE_P2P_MESSAGE",RECEIVE_P2P_RECEIPT:"RECEIVE_P2P_RECEIPT",SYNC_P2P_PINS:"SYNC_P2P_PINS",TYPING_P2P:"TYPING_P2P",POST_COMMIT_ERROR_COMMIT_MESSAGE:"POST_COMMIT_ERROR_COMMIT_MESSAGE",POST_COMMIT_ERROR_COMMIT_RECEIPT:"POST_COMMIT_ERROR_COMMIT_RECEIPT"}),a),i=(r={},Object(c.a)(r,s.USERNAME,{SET_USERNAME:"set_username",GET_USERNAMES:"get_usernames",GET_ALL_USERNAMES:"get_all_usernames",GET_AGENT_PUBKEY_FROM_USERNAME:"get_agent_pubkey_from_username",GET_MY_USERNAME:"get_my_username"}),Object(c.a)(r,s.PROFILES,{CREATE_PROFILE:"create_profile",SEARCH_PROFILES:"search_profiles",GET_AGENT_PROFILE:"get_agent_profile",GET_AGENTS_PROFILES:"get_agents_profile",GET_MY_PROFILE:"get_my_profile",GET_ALL_PROFILES:"get_all_profiles",UPDATE_PROFILE:"update_profile"}),Object(c.a)(r,s.CONTACTS,{ADD_CONTACTS:"add_contacts",REMOVE_CONTACTS:"remove_contacts",BLOCK_CONTACTS:"block_contacts",UNBLOCK_CONTACTS:"unblock_contacts",LIST_ADDED:"list_added",LIST_BLOCKED:"list_blocked",IN_CONTACTS:"in_contacts",IN_BLOCKED:"in_blocked"}),Object(c.a)(r,s.PREFERENCE,{GET_PREFERENCE:"get_preference",SET_PREFERENCE:"set_preference",SET_PER_AGENT_PREFERENCE:"set_per_agent_preference",GET_PER_AGENT_PREFERENCE:"get_per_agent_preference",SET_PER_GROUP_PREFERENCE:"set_per_group_preference",GET_PER_GROUP_PREFERENCE:"get_per_group_preference"}),Object(c.a)(r,s.GROUP,{CREATE_GROUP:"create_group",ADD_MEMBERS:"add_members",REMOVE_MEMBERS:"remove_members",UPDATE_GROUP_NAME:"update_group_name",UPDATE_GROUP_AVATAR:"update_group_avatar",SEND_MESSAGE:"send_message",GET_ALL_MY_GROUPS:"get_all_my_groups",GET_PREVIOUS_GROUP_MESSAGES:"get_previous_group_messages",GET_SUBSEQUENT_GROUP_MESSAGES:"get_subsequent_group_messages",GET_ADJACENT_GROUP_MESSAGES:"get_adjacent_group_messages",GET_MESSAGES_BY_GROUP_BY_TIMESTAMP:"get_messages_by_group_by_timestamp",GET_GROUP_LATEST_VERSION:"get_group_latest_version",INDICATE_GROUP_TYPING:"indicate_group_typing",READ_GROUP_MESSAGE:"read_group_message",GET_FILES_BYTES:"get_files_bytes",PIN_MESSAGE:"pin_message",UNPIN_MESSAGE:"unpin_message",FETCH_PINNED_MESSAGES:"get_pinned_messages"}),Object(c.a)(r,s.AGGREGATOR,{RETRIEVE_LATEST_DATA:"retrieve_latest_data"}),Object(c.a)(r,s.P2PMESSAGE,{SEND_MESSAGE:"send_message",SEND_MESSAGE_WITH_TIMESTAMP:"send_message_with_timestamp",COMMIT_MESSAGE_TO_RECEIVER:"commit_message_to_receiver_chain",GET_LATEST_MESSAGES:"get_latest_messages",GET_MESSAGES_BY_AGENT_BY_TIMESTAMP:"get_messages_by_agent_by_timestamp",GET_PREVIOUS_MESSAGES:"get_previous_messages",GET_ALL_MESSAGES:"get_all_messages",READ_MESSAGE:"read_message",GET_FILE_BYTES:"get_file_bytes",TYPING:"typing",PIN_MESSAGE:"pin_message",GET_PINNED_MESSAGES:"get_pinned_messages",GET_NEXT_MESSAGES:"get_next_messages",GET_ADJACENT_MESSAGES:"get_adjacent_messages"}),r)},,,,,,function(e,t,n){"use strict";n.d(t,"a",(function(){return c})),n.d(t,"b",(function(){return s}));var a=n(18),r=n(79),c=function(e,t,n){return function(a){"TOAST"===e&&a({type:r.a,error:{type:"TOAST",options:t,intl:n}})}},s=function(){return function(e,t){var n=Object(a.a)(t().error.errors);n.length>0&&(n.shift(),e({type:r.b,errors:n}))}}},,,,function(e,t,n){"use strict";n.d(t,"a",(function(){return a})),n.d(t,"n",(function(){return r})),n.d(t,"m",(function(){return c})),n.d(t,"c",(function(){return s})),n.d(t,"b",(function(){return o})),n.d(t,"g",(function(){return i})),n.d(t,"h",(function(){return u})),n.d(t,"e",(function(){return l})),n.d(t,"k",(function(){return d})),n.d(t,"f",(function(){return p})),n.d(t,"j",(function(){return b})),n.d(t,"i",(function(){return j})),n.d(t,"l",(function(){return m})),n.d(t,"d",(function(){return f}));var a="ADD_GROUP",r="UPDATE_GROUP_NAME",c="UPDATE_GROUP_AVATAR",s="REMOVE_MEMBERS",o="ADD_MEMBERS",i="SET_GROUP_MESSAGE",u="SET_GROUP_MESSAGES",l="SET_ERR_GROUP_MESSAGE",d="SET_LATEST_GROUP_STATE",p="SET_FILES_BYTES",b="SET_GROUP_TYPING_INDICATOR",j="SET_GROUP_READ_MESSAGE",m="SET_PINNNED_MESSAGES",f="SET_CONVERSATIONS"},function(e,t,n){"use strict";n.d(t,"c",(function(){return r})),n.d(t,"a",(function(){return c})),n.d(t,"d",(function(){return s})),n.d(t,"e",(function(){return o})),n.d(t,"b",(function(){return i}));var a=n(7),r=function(e,t){switch(e){case 0:return t.formatMessage({id:"app.group-chat.media.month.1"});case 1:return t.formatMessage({id:"app.group-chat.media.month.2"});case 2:return t.formatMessage({id:"app.group-chat.media.month.3"});case 3:return t.formatMessage({id:"app.group-chat.media.month.4"});case 4:return t.formatMessage({id:"app.group-chat.media.month.5"});case 5:return t.formatMessage({id:"app.group-chat.media.month.6"});case 6:return t.formatMessage({id:"app.group-chat.media.month.7"});case 7:return t.formatMessage({id:"app.group-chat.media.month.8"});case 8:return t.formatMessage({id:"app.group-chat.media.month.9"});case 9:return t.formatMessage({id:"app.group-chat.media.month.10"});case 10:return t.formatMessage({id:"app.group-chat.media.month.11"});case 11:return t.formatMessage({id:"app.group-chat.media.month.12"})}},c=function(e){var t=e.getUTCFullYear(),n=e.getMonth()+1,a=e.getDate(),r=n<10?"0".concat(n):n,c=a<10?"0".concat(a):a;return"".concat(t,"-").concat(r,"-").concat(c)},s=function(e){var t=e.split("-"),n=Object(a.a)(t,3),r=n[0],c=n[1],s=n[2],o=c,i=s;return"0"===c.charAt(0)&&(o=c.substring(1)),"0"===s.charAt(0)&&(i=s.substring(1)),new Date(Date.UTC(parseInt(r),parseInt(o)-1,parseInt(i)))},o=function(e){return new Date(.001*e)},i=function(e){return 1e3*e.getTime()}},function(e,t,n){"use strict";(function(e){n.d(t,"f",(function(){return r})),n.d(t,"d",(function(){return c})),n.d(t,"c",(function(){return s})),n.d(t,"b",(function(){return o})),n.d(t,"e",(function(){return i})),n.d(t,"a",(function(){return u}));var a=n(6),r=function(e,t,n){return Object.keys(e).reduce((function(a,r){var c;return n&&(c=n(r)),c?a[c]=t(e[r]):a[r]=t(e[r]),a}),{})},c=function(e){var t={},n=e.sort((function(e,t){return e.username.toLocaleLowerCase().localeCompare(t.username.toLocaleLowerCase())}));return n.length>0&&n.forEach((function(e){var n=e.username.charAt(0).toLocaleLowerCase(),a=t[n];void 0===a&&(t[n]=[],a=t[n]),a.push(e)})),t},s=function(t){return e.from(Object(a.a)(t).buffer)},o=function(e){return e/1024/1024>=1?"".concat((e/1024/1024).toFixed(2),"mb"):"".concat((e/1024).toFixed(2),"kb")},i=function(e){return"TEXT"===e.type},u=function(e){return URL.createObjectURL(new Blob([Object(a.a)(e)],{type:"image/jpeg"}))}}).call(this,n(59).Buffer)},,,,,,,,,function(e,t,n){"use strict";function a(e){return"TEXT"===e.type}function r(e){return"OTHER"===e.type}function c(e){return"IMAGE"===e.type}function s(e){return"VIDEO"===e.type}function o(e){return void 0!==e.p2pMessageEntryHash}n.d(t,"d",(function(){return a})),n.d(t,"b",(function(){return r})),n.d(t,"a",(function(){return c})),n.d(t,"e",(function(){return s})),n.d(t,"c",(function(){return o}))},,,,function(e,t,n){"use strict";n.d(t,"d",(function(){return a})),n.d(t,"f",(function(){return r})),n.d(t,"b",(function(){return c})),n.d(t,"c",(function(){return s})),n.d(t,"g",(function(){return o})),n.d(t,"a",(function(){return i})),n.d(t,"h",(function(){return u})),n.d(t,"e",(function(){return l}));var a="SET_MESSAGES",r="SET_RECEIPTS",c="SET_ERR_MESSAGE",s="SET_FILES",o="SET_TYPING",i="PIN_MESSAGE",u="UNPIN_MESSAGE",l="SET_PINNED"},,function(e,t,n){e.exports={read:"style_read__3GeUO",bubble:"style_bubble__b3vlV",text:"style_text__3mW4k","message-text":"style_message-text__3Cz2E",file:"style_file__2E9_r",space:"style_space__1IgoE","author-name":"style_author-name__2wbPZ",picture:"style_picture__2lzdL","avatar-container":"style_avatar-container__3X-qJ","me-container":"style_me-container__1SA7U",me:"style_me__dv2Iw","max-file":"style_max-file__20l-d","others-container":"style_others-container__19SEV",others:"style_others__QcKpe",avatar:"style_avatar__3eiPZ","not-delivered":"style_not-delivered__3sCqu","not-delivered-container":"style_not-delivered-container__gnnKW"}},function(e,t,n){"use strict";n.d(t,"b",(function(){return a})),n.d(t,"a",(function(){return r}));var a="SET_CONTACTS",r="SET_BLOCKED"},,,,,,function(e,t,n){e.exports={header:"style_header__3FlxA",groupname:"style_groupname__olSXj","avatar-container":"style_avatar-container__3UHmQ",avatar:"style_avatar__3oYjI","avatar-content":"style_avatar-content__3VzBc","image-container":"style_image-container__354iC","image-container-set":"style_image-container-set__1FfEa","icon-overlay":"style_icon-overlay__1pR_g",overlay:"style_overlay__rLSbi",img:"style_img__1ZRr5"}},,,,,,,,,function(e,t,n){e.exports={reply:"style_reply__1alfg",row:"style_row__2lZL5",column:"style_column__2fUOQ",author:"style_author__3RrBq",text:"style_text__-M__Q",thumbnail:"style_thumbnail__2NKmm"}},function(e,t,n){e.exports={header:"style_header__1GbNk","toolbar-container":"style_toolbar-container__trETb","profile-picture":"style_profile-picture__Ylhcn","profile-picture-toolbar":"style_profile-picture-toolbar__2IRI-",nickname:"style_nickname__36IXj","profile-toolbar":"style_profile-toolbar__3bqXt","content-icon":"style_content-icon__2luvw",content:"style_content__2vCA9","avatar-content":"style_avatar-content__223UZ",avatar:"style_avatar__390jA","image-container":"style_image-container__1u6CD",img:"style_img__2XYuw",overlay:"style_overlay__2KoGd","icon-overlay":"style_icon-overlay__1utzD"}},,,,,,function(e,t,n){"use strict";n.d(t,"b",(function(){return a})),n.d(t,"a",(function(){return r}));var a="SET_USERNAME",r="SET_PROFILE"},function(e,t,n){e.exports={mediarow:"style_mediarow__2Kl-B",month:"style_month__G0kAs",mediacard:"style_mediacard__tGTBA"}},,function(e,t,n){e.exports={"content-container":"style_content-container__1pYC1",header:"style_header__3oN7M",author:"style_author__1no5c",date:"style_date__3fX4m",thumbnail:"style_thumbnail__2jeYz",video:"style_video__2c8Ip",other:"style_other__3Q1FT","file-details":"style_file-details__14BgG","file-size":"style_file-size__2Qbcp"}},,,,function(e,t,n){"use strict";(function(e){n.d(t,"a",(function(){return j}));var a=n(8),r=n(10),c=n(3),s=n(7),o=n(4),i=n.n(o),u=n(6),l=n(5),d=n(16),p=n(93),b=function(e,t,n){var a,o=Object(s.a)(e,2),i=o[0],l=o[1],p=Object(u.b)(i);switch(l.payload.type){case"TEXT":a=l.payload;break;case"FILE":a={type:"FILE",fileName:l.payload.payload.metadata.fileName,fileSize:l.payload.payload.metadata.fileSize,fileType:l.payload.payload.fileType.type,fileHash:Object(u.b)(l.payload.payload.metadata.fileHash),thumbnail:"OTHER"!==l.payload.payload.fileType.type?l.payload.payload.fileType.payload.thumbnail:null}}var b=Object(c.a)(Object(c.a)({},t),{},Object(r.a)({},n.id,{id:n.id,username:n.username})),j=void 0,m=void 0;if(null!==l.replyTo){switch(l.replyTo.payload.type){case"TEXT":m=l.replyTo.payload;break;case"FILE":m={type:"FILE",fileName:l.replyTo.payload.payload.metadata.fileName,fileSize:l.replyTo.payload.payload.metadata.fileSize,fileType:l.replyTo.payload.payload.fileType.type,fileHash:Object(u.b)(l.replyTo.payload.payload.metadata.fileHash),thumbnail:"OTHER"!==l.replyTo.payload.payload.fileType.type?l.replyTo.payload.payload.fileType.payload.thumbnail:null}}j={p2pMessageEntryHash:Object(u.b)(l.replyTo.hash),author:b[Object(u.b)(l.replyTo.author)],receiver:b[Object(u.b)(l.replyTo.receiver)],payload:m||l.replyTo.payload,timestamp:Object(d.e)(l.replyTo.timeSent),receipts:[]}}return{message:{p2pMessageEntryHash:p,author:b[Object(u.b)(l.author)],receiver:b[Object(u.b)(l.receiver)],payload:a,timestamp:Object(d.e)(l.timeSent),replyTo:j||void 0,receipts:[]},receipt:void 0,file:void 0}},j=function(t,n,r,s,o){return function(){var d=Object(a.a)(i.a.mark((function a(d,j,m){var f,O,g,h,v,y,x,_,E,T,S,N,w,I,M,k,R;return i.a.wrap((function(a){for(;;)switch(a.prev=a.next){case 0:return f=m.callZome,O=m.retry,"TEXT"===r?(h={type:"TEXT",payload:{payload:n.trim()}},g=h):(v={type:o.fileType.type,payload:"OTHER"!==o.fileType.type?{thumbnail:o.fileType.payload.thumbnail}:null},y={type:"FILE",payload:{metadata:o.metadata,fileType:v,fileBytes:o.fileBytes}},g=y),x={receiver:e.from(Object(u.a)(t)),payload:g,reply_to:s?e.from(Object(u.a)(s)):void 0},a.prev=3,a.next=6,f({zomeName:l.c.P2PMESSAGE,fnName:l.a[l.c.P2PMESSAGE].SEND_MESSAGE,payload:x});case 6:if("error"===(null===(_=a.sent)||void 0===_?void 0:_.type)){a.next=15;break}return E=Object(c.a)({},j().contacts.contacts),T=Object(c.a)({},j().profile),S=b(_,E,T),N="FILE"===r?{fileHash:S.message.payload.fileHash,fileBytes:o.fileBytes}:void 0,S.file=N,d(Object(p.a)(S)),a.abrupt("return",!0);case 15:a.next=39;break;case 17:if(a.prev=17,a.t0=a.catch(3),a.prev=19,a.t0.message.includes("Timed out")){a.next=32;break}return a.next=23,O({zomeName:l.c.P2PMESSAGE,fnName:l.a[l.c.P2PMESSAGE].SEND_MESSAGE,payload:x});case 23:if("error"===(null===(w=a.sent)||void 0===w?void 0:w.type)){a.next=32;break}return I=Object(c.a)({},j().contacts.contacts),M=Object(c.a)({},j().profile),k=b(w,I,M),R="FILE"===r?{fileHash:k.message.payload.fileHash,fileBytes:o.fileBytes}:void 0,k.file=R,d(Object(p.a)(k)),a.abrupt("return",!0);case 32:return a.abrupt("return",!1);case 35:return a.prev=35,a.t1=a.catch(19),console.log("sending automatically retried message has failed",a.t1),a.abrupt("return",!1);case 39:case"end":return a.stop()}}),a,null,[[3,17],[19,35]])})));return function(e,t,n){return d.apply(this,arguments)}}()}}).call(this,n(59).Buffer)},function(e,t,n){e.exports={keyboardcontainer:"style_keyboardcontainer__ZpjcC",header:"style_header__2EBYq",gifcontainer:"style_gifcontainer__2VZOA",gifcontainerexpanded:"style_gifcontainerexpanded__1GDDQ",categorypreview:"style_categorypreview__1XAxP",gifpreview:"style_gifpreview__1bGYg",textholder:"style_textholder__21szk",categorytext:"style_categorytext__2_4qV",images:"style_images__2xttS"}},function(e,t,n){e.exports={"profile-picture-content":"style_profile-picture-content__SgIy8","avatar-container":"style_avatar-container__3uQZ1",avatar:"style_avatar__2FXG7","button-label":"style_button-label__18iwi",label:"style_label__1IYVS",default:"style_default__H5jkI"}},,,function(e,t,n){"use strict";n.d(t,"a",(function(){return s}));var a=n(7),r=n(6),c=n(16),s=function(e,t){for(var n=Object.values(e),s=n[0],o=n[1],i=n[2],u={},l=0,d=Object.entries(s);l<d.length;l++){var p=Object(a.a)(d[l],2),b=p[0],j={messages:p[1],pinned:s[b]?s[b].pinned:[]};u[b]=j}for(var m={},f=0,O=Object.entries(o);f<O.length;f++){var g=Object(a.a)(O[f],2),h=g[0],v=g[1],y=Object(v),x=y[0],_=y[1],E=void 0;switch(x.payload.type){case"TEXT":E=x.payload;break;case"FILE":E={type:"FILE",fileName:x.payload.payload.metadata.fileName,fileSize:x.payload.payload.metadata.fileSize,fileType:x.payload.payload.fileType.type,fileHash:Object(r.b)(x.payload.payload.metadata.fileHash),thumbnail:"OTHER"!==x.payload.payload.fileType.type?x.payload.payload.fileType.payload.thumbnail:null}}var T=t[Object(r.b)(x.author)],S=void 0,N=void 0;if(null!==x.replyTo){switch(x.replyTo.payload.type){case"TEXT":S=x.replyTo.payload;break;case"FILE":S={type:"FILE",fileName:x.replyTo.payload.payload.metadata.fileName,fileSize:x.replyTo.payload.payload.metadata.fileSize,fileType:x.replyTo.payload.payload.fileType.type,fileHash:Object(r.b)(x.replyTo.payload.payload.metadata.fileHash),thumbnail:"OTHER"!==x.replyTo.payload.payload.fileType.type?x.replyTo.payload.payload.fileType.payload.thumbnail:null}}N={p2pMessageEntryHash:Object(r.b)(x.replyTo.hash),author:t[Object(r.b)(x.replyTo.author)],receiver:t[Object(r.b)(x.replyTo.receiver)],payload:S||x.replyTo.payload,timestamp:Object(c.e)(x.replyTo.timeSent),replyTo:x.replyTo,receipts:x.replyTo.receipts}}var w={p2pMessageEntryHash:h,author:T,receiver:t[Object(r.b)(x.receiver)],payload:E,timestamp:Object(c.e)(x.timeSent),replyTo:N||void 0,receipts:_};m[h]=w}for(var I={},M=0,k=Object.entries(i);M<k.length;M++){var R=Object(a.a)(k[M],2),P=R[0],A=R[1],C=Object(A),G=C.id,L=C.status,D=L.status,H=L.timestamp,U={p2pMessageReceiptEntryHash:P,p2pMessageEntryHashes:G,timestamp:Object(c.e)(H),status:D};I[P]=U}return{conversations:u,messages:m,receipts:I,files:{},typing:{},pinned:{},errMsgs:{}}}},function(e,t,n){"use strict";n.d(t,"a",(function(){return a}));var a="SET_PREFERENCE"},,function(e,t,n){e.exports={"reply-to":"style_reply-to__1ZpXG","content-me":"style_content-me__14mTi","content-others":"style_content-others__2kxSL",thumbnail:"style_thumbnail__2u4oc","vertical-divider-me":"style_vertical-divider-me__3eT7d","vertical-divider-others":"style_vertical-divider-others__dj7Rl"}},,,,function(e,t,n){e.exports={content:"style_content__U_pdz","play-pause":"style_play-pause__1sBQt","modal-control":"style_modal-control__2LLvX","slider-volume":"style_slider-volume__37ujv",toolbar:"style_toolbar__3aY0h",footer:"style_footer__YbR3E"}},function(e,t,n){e.exports={page:"style_page__22EBt","language-container":"style_language-container__2begU",language:"style_language__28kvF",selected:"style_selected__3wGAX"}},,,function(e,t,n){"use strict";n.d(t,"b",(function(){return a})),n.d(t,"a",(function(){return r}));var a="SET_GIFS",r="SET_CATEGORIES"},function(e,t,n){"use strict";n.d(t,"a",(function(){return a})),n.d(t,"b",(function(){return r}));var a="PUSH_ERROR",r="SHIFT_ERROR"},function(e,t,n){"use strict";(function(e){n.d(t,"a",(function(){return j}));var a=n(10),r=n(3),c=n(8),s=n(4),o=n.n(s),i=n(6),u=n(5),l=n(11),d=n(16),p=n(67),b=n(103),j=function(t,n,s,j,m){return function(){var f=Object(c.a)(o.a.mark((function c(f,O,g){var h,v,y,x,_,E,T;return o.a.wrap((function(c){for(;;)switch(c.prev=c.next){case 0:return h=g.callZome,v={conversant:e.from(Object(i.a)(t)),batch_size:n,payload_type:s,last_fetched_timestamp:j?Object(d.b)(j):void 0,last_fetched_message_id:m?e.from(Object(i.a)(m)):void 0},c.prev=2,c.next=5,h({zomeName:u.c.P2PMESSAGE,fnName:u.a[u.c.P2PMESSAGE].GET_PREVIOUS_MESSAGES,payload:v});case 5:if("error"===(null===(y=c.sent)||void 0===y?void 0:y.type)){c.next=13;break}return x=Object(r.a)({},O().contacts.contacts),_=Object(r.a)({},O().profile),E=Object(r.a)(Object(r.a)({},x),{},Object(a.a)({},_.id,{id:_.id,username:_.username,fields:_.fields})),T=Object(p.a)(y,E),Object.values(y[1]).length>0&&f(Object(b.a)(T)),c.abrupt("return",y);case 13:c.next=18;break;case 15:c.prev=15,c.t0=c.catch(2),f(Object(l.a)("TOAST",{},{id:"redux.err.generic"}));case 18:case"end":return c.stop()}}),c,null,[[2,15]])})));return function(e,t,n){return f.apply(this,arguments)}}()}}).call(this,n(59).Buffer)},function(e,t,n){e.exports={list:"style_list__N7t6V","contacts-list":"style_contacts-list__20Yc_",warning:"style_warning__3mGhB","warning-icon":"style_warning-icon__3lrr_"}},,function(e,t,n){"use strict";n.d(t,"b",(function(){return a}));n(2);var a,r=n(13),c=n(3),s=n(95),o=n(184),i=n(87),u=n(33),l={contacts:{},blocked:{}},d=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:l,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case u.b:return Object(c.a)(Object(c.a)({},e),{},{contacts:t.contacts});case u.a:return Object(c.a)(Object(c.a)({},e),{},{blocked:t.blocked});default:return e}},p=n(15),b={conversations:{},messages:{},groupFiles:{},members:{},typing:{},pinnedMessages:{},errMsgs:{}},j=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:b,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case p.a:case p.b:case p.c:return Object(c.a)(Object(c.a)({},e),{},{conversations:t.conversations,members:t.members});case p.n:case p.m:return Object(c.a)(Object(c.a)({},e),{},{conversations:t.conversations});case p.g:return Object(c.a)(Object(c.a)({},e),{},{conversations:t.conversations,messages:t.messages,groupFiles:t.groupFiles});case p.e:return Object(c.a)(Object(c.a)({},e),{},{errMsgs:t.errMsgs});case p.f:return Object(c.a)(Object(c.a)({},e),{},{groupFiles:t.filesBytes});case p.h:return Object(c.a)(Object(c.a)({},e),{},{messages:t.messages,conversations:t.conversations});case p.k:return Object(c.a)(Object(c.a)({},e),{},{conversations:t.conversations,messages:t.messages,members:t.members});case p.j:return Object(c.a)(Object(c.a)({},e),{},{typing:t.typing});case p.i:return Object(c.a)(Object(c.a)({},e),{},{messages:Object(c.a)({},t.messages)});case p.l:var n=Object(c.a)({},t),a=n.conversations,r=n.pinnedMessages;return Object(c.a)(Object(c.a)({},e),{},{conversations:a,pinnedMessages:r});case p.d:var s=t.conversations;return Object(c.a)(Object(c.a)({},e),{},{conversations:s});default:return e}},m=n(68),f={readReceipt:!1,typingIndicator:!1,agentReadReceipt:{},agentTypingIndicator:{},groupReadReceipt:{},groupTypingIndicator:{}},O=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:f,t=arguments.length>1?arguments[1]:void 0;return t.type===m.a?Object(c.a)(Object(c.a)({},e),t.preference):e},g=n(55),h={id:null,username:null,fields:{}},v=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:h,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case g.b:return Object(c.a)(Object(c.a)({},e),{},{username:t.username,id:t.id});case g.a:return Object(c.a)(Object(c.a)({},e),{},{username:t.nickname,id:t.id,fields:t.fields});default:return e}},y=n(30),x={conversations:{},messages:{},receipts:{},files:{},typing:{},pinned:{},errMsgs:{}},_=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:x,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case y.d:return Object(c.a)(Object(c.a)({},e),{},{conversations:t.state.conversations,messages:t.state.messages,receipts:t.state.receipts});case y.b:return Object(c.a)(Object(c.a)({},e),{},{errMsgs:t.state.errMsgs});case y.f:return Object(c.a)(Object(c.a)({},e),{},{receipts:t.state});case y.c:return Object(c.a)(Object(c.a)({},e),{},{files:t.state});case y.g:return Object(c.a)(Object(c.a)({},e),{},{typing:t.state});case y.e:return Object(c.a)(Object(c.a)({},e),{},{conversations:t.state.conversations,pinned:t.state.pinned});default:return e}},E=n(106),T={language:null},S=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:T,t=arguments.length>1?arguments[1]:void 0;return t.type===E.a?(localStorage.setItem("language",t.language),Object(c.a)(Object(c.a)({},e),{},{language:t.language})):e},N=n(18),w=n(79),I={errors:[]},M=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:I,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case w.a:var n=[].concat(Object(N.a)(e.errors),[t.error]);return Object(c.a)(Object(c.a)({},e),{},{errors:n});case w.b:return Object(c.a)(Object(c.a)({},e),{},{errors:t.errors});default:return e}},k=n(78),R={gifs:{},categories:{}},P=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:R,t=arguments.length>1?arguments[1]:void 0;if(t.type===k.b){var n=e;return n.gifs=t.state,n}return e},A=Object(s.b)({profile:v,contacts:d,preference:O,groups:j,p2pmessages:_,language:S,error:M,gif:P}),C=function(e){var t=o.a.withExtraArgument(Object(c.a)({callZome:i.a,getAgentId:i.c,retry:i.e,client:i.b,init:i.d},e));return Object(s.c)(A,Object(s.a)(t))},G=n(0);a=C();t.a=function(e){var t=e.children;return Object(G.jsx)(r.a,{store:a,children:t})}},function(e,t,n){e.exports={controls:"style_controls__2gscS","play-pause":"style_play-pause__2Bgys","range-slider-expand":"style_range-slider-expand__1y37Y","range-slider":"style_range-slider__1leiI","slider-volume":"style_slider-volume__1u5c4"}},function(e,t,n){e.exports={"member-page":"style_member-page__2gB0m",icon:"style_icon__7xzbp","member-title":"style_member-title__2-_Xp","member-name":"style_member-name__1hzQW"}},function(e,t,n){e.exports={register:"style_register__1IRba",form:"style_form__2MPyA",label:"style_label__2XMD-",toolbar:"style_toolbar__jcPVP",buttons:"style_buttons__2MT9g",icon:"style_icon__ZLy0M","avatar-button":"style_avatar-button__28t1v",modal:"style_modal__1pMpC","modal-wrapper":"style_modal-wrapper__3BLWX"}},function(e,t,n){"use strict";(function(e){n.d(t,"b",(function(){return d})),n.d(t,"d",(function(){return j})),n.d(t,"c",(function(){return m})),n.d(t,"e",(function(){return O})),n.d(t,"a",(function(){return g}));var a=n(3),r=n(8),c=n(4),s=n.n(c),o=n(138),i=n(83),u=n(186);e.COMB=void 0,window.COMB=n(232).COMB;var l="HOLO",d=null,p=function(e){return null===i.b||void 0===i.b?void 0:i.b.dispatch(Object(u.a)(e.data.payload.name,e.data.payload.payload))},b=function(){var e=Object(r.a)(s.a.mark((function e(t){var n,a,r;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:e.t0=t,e.next="HOLO"===e.t0||"HCC"===e.t0?3:"HCDEV"===e.t0||"HC"===e.t0?11:16;break;case 3:return n={logo_url:"assets/icon/kizuna_logo.png",app_name:"Kizuna Messaging App",skip_registration:!0},e.next=6,o.a.connect("https://devnet-chaperone.holo.host",void 0,n);case 6:return(a=e.sent).addSignalHandler(p),e.next=10,a.signIn();case 10:return e.abrupt("return",a);case 11:return e.next=13,o.b.connect("https://devnet-chaperone.holo.host",void 0);case 13:return(r=e.sent).addSignalHandler(p),e.abrupt("return",r);case 16:return e.abrupt("return",null);case 17:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),j=function(){var e=Object(r.a)(s.a.mark((function e(){return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!d){e.next=2;break}return e.abrupt("return",d);case 2:return e.prev=2,e.next=5,b(l);case 5:return d=e.sent,e.abrupt("return",d);case 9:throw e.prev=9,e.t0=e.catch(2),Object.values(e.t0).forEach((function(e){return console.error(e)})),console.error(e.t0),e.t0;case 14:case"end":return e.stop()}}),e,null,[[2,9]])})));return function(){return e.apply(this,arguments)}}(),m=function(){var e=Object(r.a)(s.a.mark((function e(){var t,n;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:e.next=2;break;case 2:return e.next=4,j();case 4:return e.prev=4,e.next=7,null===(t=d)||void 0===t?void 0:t.appInfo.cell_data[0].cell_id[1];case 7:if(!(n=e.sent)){e.next=10;break}return e.abrupt("return",n);case 10:return e.abrupt("return",null);case 13:e.prev=13,e.t0=e.catch(4),console.warn(e.t0);case 16:return e.abrupt("return",null);case 17:case"end":return e.stop()}}),e,null,[[4,13]])})));return function(){return e.apply(this,arguments)}}(),f=function(e){var t=1e3*(Math.pow(2,e)+Math.random());return console.log("Retrying after ",t),new Promise((function(e){return setTimeout(e,t)}))},O=function(){var e=Object(r.a)(s.a.mark((function e(t){var n,r,c,o,i,u,l,p,b,m,O,g,v,y,x,_;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("entering backoff"),e.next=3,j();case 3:if(void 0!==(n=t.cellId)){e.next=10;break}return e.next=7,h();case 7:e.t0=e.sent,e.next=11;break;case 10:e.t0=n;case 11:r=e.t0,c=t.zomeName,o=t.fnName,i=t.payload,u=void 0===i?null:i,l=5,p=0,b=!0;case 19:if(!(b&&p<l)){e.next=67;break}return e.prev=20,e.next=23,null===(m=d)||void 0===m?void 0:m.callZome(r,c,o,u,void 0);case 23:return e.abrupt("return",e.sent);case 26:if(e.prev=26,e.t1=e.catch(20),console.warn(e.t1),O=Object(a.a)({},e.t1),g=O.type,v=void 0===g?null:g,y=O.data,x=void 0===y?null:y,"error"!==v){e.next=65;break}e.t2=null===x||void 0===x?void 0:x.type,e.next="ribosome_error"===e.t2?34:"internal_error"===e.t2?48:57;break;case 34:if(console.log("ribsosome error",e.t1),null===/Network error/.exec(x.data)){e.next=43;break}return e.next=40,f(p);case 40:p+=1,e.next=47;break;case 43:throw b=!1,_=/Guest\("([\s\S]*?)"\)/.exec(x.data),{type:"error",function:o,message:_?_[1]:"Something went wrong"};case 47:return e.abrupt("break",65);case 48:if(console.log("internal error",e.t1),!(p>l)){e.next=53;break}throw{type:"error",function:o,message:"An internal error occured. This is likely a bug in holochain."};case 53:return e.next=55,f(p);case 55:p+=1;case 56:return e.abrupt("break",65);case 57:if(console.log("default error",e.t1),!(p>l)){e.next=62;break}throw e.t1;case 62:return e.next=64,f(p);case 64:p+=1;case 65:e.next=19;break;case 67:case"end":return e.stop()}}),e,null,[[20,26]])})));return function(t){return e.apply(this,arguments)}}(),g=function(){var e=Object(r.a)(s.a.mark((function e(t){var n,r,c,o,i,u,l,p,b,m,f,O,g;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,j();case 2:if(void 0!==(n=t.cellId)){e.next=9;break}return e.next=6,h();case 6:e.t0=e.sent,e.next=10;break;case 9:e.t0=n;case 10:return r=e.t0,c=t.zomeName,o=t.fnName,i=t.payload,u=void 0===i?null:i,e.prev=15,e.next=18,null===(l=d)||void 0===l?void 0:l.callZome(r,c,o,u,void 0);case 18:return e.abrupt("return",e.sent);case 21:if(e.prev=21,e.t1=e.catch(15),console.log("zome call has failed in zome: ",c," with call ",o,". Error: ",e.t1),p=Object(a.a)({},e.t1),b=p.type,m=void 0===b?null:b,f=p.data,O=void 0===f?null:f,"error"!==m){e.next=34;break}e.t2=null===O||void 0===O?void 0:O.type,e.next="ribosome_error"===e.t2?29:"internal_error"===e.t2?32:33;break;case 29:throw g=/Guest\("([\s\S]*?)"\)/.exec(O.data),{type:"error",function:o,message:g?g[1]:"Something went wrong"};case 32:throw{type:"error",function:o,message:O.data};case 33:case 34:throw e.t1;case 35:case"end":return e.stop()}}),e,null,[[15,21]])})));return function(t){return e.apply(this,arguments)}}(),h=function(){var e=Object(r.a)(s.a.mark((function e(){var t,n;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,j();case 2:return e.abrupt("return",null===(t=d)||void 0===t||null===(n=t.cellDataByRoleId("kizuna-lobby"))||void 0===n?void 0:n.cell_id);case 3:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}()}).call(this,n(71))},,,,,function(e,t,n){"use strict";(function(e){n.d(t,"a",(function(){return j}));var a=n(7),r=n(10),c=n(3),s=n(8),o=n(4),i=n.n(o),u=n(6),l=n(5),d=n(11),p=n(30),b=n(67),j=function(t){return function(){var n=Object(s.a)(i.a.mark((function n(s,o,j){var m,f,O,g,h,v,y,x,_,E,T,S,N,w,I,M,k,R,P,A,C,G;return i.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return m=j.callZome,n.prev=1,n.next=4,m({zomeName:l.c.P2PMESSAGE,fnName:l.a[l.c.P2PMESSAGE].GET_PINNED_MESSAGES,payload:e.from(Object(u.a)(t))});case 4:if("error"===(null===(f=n.sent)||void 0===f?void 0:f.type)){n.next=57;break}if(O=Object(c.a)({},o().contacts.contacts),g=Object(c.a)({},o().profile),h=Object(c.a)(Object(c.a)({},O),{},Object(r.a)({},g.id,{id:g.id,username:g.username,fields:g.fields})),v=Object(b.a)(f,h),void 0!==(y=Object(c.a)({},o().p2pmessages)).conversations[t]){n.next=27;break}y.conversations[t]={messages:[],pinned:[]},x=0,_=Object.entries(v.messages);case 14:if(!(x<_.length)){n.next=25;break}if(E=Object(a.a)(_[x],2),T=E[0],S=E[1],y.conversations[t].pinned.includes(T)||y.conversations[t].pinned.push(T),void 0!==y.pinned[T]){n.next=21;break}y.pinned[T]=S,n.next=22;break;case 21:return n.abrupt("continue",22);case 22:x++,n.next=14;break;case 25:n.next=55;break;case 27:if(void 0!==y.conversations[t].pinned){n.next=43;break}y.conversations[t].pinned=[],N=0,w=Object.entries(v.messages);case 30:if(!(N<w.length)){n.next=41;break}if(I=Object(a.a)(w[N],2),M=I[0],k=I[1],y.conversations[t].pinned.includes(M)||y.conversations[t].pinned.push(M),void 0!==y.pinned[M]){n.next=37;break}y.pinned[M]=k,n.next=38;break;case 37:return n.abrupt("continue",38);case 38:N++,n.next=30;break;case 41:n.next=55;break;case 43:R=0,P=Object.entries(v.messages);case 44:if(!(R<P.length)){n.next=55;break}if(A=Object(a.a)(P[R],2),C=A[0],G=A[1],y.conversations[t].pinned.includes(C)||y.conversations[t].pinned.push(C),void 0!==y.pinned[C]){n.next=51;break}y.pinned[C]=G,n.next=52;break;case 51:return n.abrupt("continue",52);case 52:R++,n.next=44;break;case 55:return s({type:p.e,state:y}),n.abrupt("return",v);case 57:n.next=62;break;case 59:n.prev=59,n.t0=n.catch(1),s(Object(d.a)("TOAST",{},{id:"redux.err.generic"}));case 62:case"end":return n.stop()}}),n,null,[[1,59]])})));return function(e,t,a){return n.apply(this,arguments)}}()}}).call(this,n(59).Buffer)},function(e,t,n){"use strict";n.d(t,"a",(function(){return l}));var a=n(10),r=n(18),c=n(3),s=n(8),o=n(4),i=n.n(o),u=n(30),l=function(e){return function(){var t=Object(s.a)(i.a.mark((function t(n,s){var o,l,d,p;return i.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return o=Object(c.a)({},s().p2pmessages),l=e.key?e.key:e.message.receiver.id,d=e.message.p2pMessageEntryHash,p=e.receipt?e.receipt.p2pMessageReceiptEntryHash:void 0,o.conversations[l]?o.conversations[l]={pinned:Object(r.a)(o.conversations[l].pinned),messages:[d].concat(Object(r.a)(o.conversations[l].messages))}:o.conversations[l]={messages:[d],pinned:[]},e.file&&(o.files[e.file.fileHash]=e.file.fileBytes),o.messages=Object(c.a)(Object(c.a)({},o.messages),{},Object(a.a)({},d,e.message)),p&&(o.receipts[p]=e.receipt),n({type:u.d,state:o}),t.abrupt("return",!0);case 10:case"end":return t.stop()}}),t)})));return function(e,n){return t.apply(this,arguments)}}()}},,,function(e,t,n){e.exports={label:"style_label__2yePJ",avatar:"style_avatar__2AEM3",container:"style_container__3rZpB"}},function(e,t,n){e.exports={file:"style_file__27RDJ","file-name":"style_file-name__3vGib","file-size":"style_file-size__2GKYG","file-icon-dark":"style_file-icon-dark__2I31W","file-icon-light":"style_file-icon-light__1U9Kf"}},function(e,t,n){e.exports={content:"style_content__aLpb2","image-cropper":"style_image-cropper__3Bzfw",header:"style_header__2qiAP",footer:"style_footer__yyGe5","react-crop":"style_react-crop__2ourV"}},function(e,t,n){e.exports={login:"style_login__1hf3N",form:"style_form__1gyhK",label:"style_label__1PI6L",toolbar:"style_toolbar__17MVN"}},function(e,t,n){e.exports={input:"style_input__2l0cM","error-input":"style_error-input__2EDgX","error-container":"style_error-container__2w9sT",error:"style_error__3-HlZ"}},,,function(e,t,n){"use strict";n.d(t,"a",(function(){return o}));var a=n(18),r=n(7),c=n(3),s=n(30),o=function(e){return function(t,n){for(var o=Object(c.a)({},n().p2pmessages),i=e.conversations,u=e.messages,l=e.receipts,d=0,p=Object.entries(i);d<p.length;d++){var b=Object(r.a)(p[d],2),j=b[0],m=b[1],f=o.conversations[j];o.conversations[j]=void 0===f?{messages:m.messages,pinned:[]}:{messages:Object(a.a)(new Set(f.messages.concat(m.messages))),pinned:[]}}return o.messages=Object(c.a)(Object(c.a)({},o.messages),u),o.receipts=Object(c.a)(Object(c.a)({},o.receipts),l),t({type:s.d,state:o}),!0}}},function(e,t,n){"use strict";n.d(t,"a",(function(){return u}));var a=n(10),r=n(3),c=n(8),s=n(4),o=n.n(s),i=n(30),u=function(e){return function(){var t=Object(c.a)(o.a.mark((function t(n,c){var s,u,l;return o.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return s=Object(r.a)({},c().p2pmessages),u=e,l=e.p2pMessageReceiptEntryHash,u.p2pMessageEntryHashes.forEach((function(e){void 0!==s.messages[e]&&s.messages[e].receipts.push(l)})),s.receipts=Object(r.a)(Object(r.a)({},s.receipts),{},Object(a.a)({},l,u)),n({type:i.f,state:s.receipts}),t.abrupt("return",!0);case 7:case"end":return t.stop()}}),t)})));return function(e,n){return t.apply(this,arguments)}}()}},function(e,t,n){"use strict";(function(e){var a=n(8),r=n(4),c=n.n(r),s=n(5),o=n(11),i=n(6);t.a=function(t){return function(){var n=Object(a.a)(c.a.mark((function n(a,r,u){var l,d;return c.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return l=u.callZome,d=t,n.prev=2,n.next=5,l({zomeName:s.c.P2PMESSAGE,fnName:s.a[s.c.P2PMESSAGE].COMMIT_MESSAGE_TO_RECEIVER,payload:e.from(Object(i.a)(d.p2pMessageEntryHash))});case 5:return n.abrupt("return",!0);case 8:n.prev=8,n.t0=n.catch(2),a(Object(o.a)("TOAST",{},{id:"redux.err.generic"}));case 11:case"end":return n.stop()}}),n,null,[[2,8]])})));return function(e,t,a){return n.apply(this,arguments)}}()}}).call(this,n(59).Buffer)},function(e,t,n){"use strict";n.d(t,"a",(function(){return a}));var a="SET_LANGUAGE"},,,,,,function(e,t,n){e.exports={menu:"style_menu__C0WwI",container:"style_container__3CTeu",identicon:"style_identicon__1z4iW",avatar:"style_avatar__2ofpZ",version:"style_version__2tuEY"}},function(e,t,n){e.exports={icon:"style_icon__-mJ3j"}},function(e,t,n){e.exports={toolbar:"style_toolbar__2dB4u",content:"style_content__1CXxF"}},function(e,t,n){e.exports={chat:"style_chat__3kLZ6","title-container":"style_title-container__E-R-r",avatar:"style_avatar__1SPMS",title:"style_title__1l1FZ"}},function(e,t,n){e.exports={chatdetails:"style_chatdetails__1PZL-",titlebar:"style_titlebar__3OOiT",title:"style_title__3P2qo",month:"style_month__1RYcT",mediarow:"style_mediarow__1VBzj",mediacard:"style_mediacard__3gdyr",mediadiv:"style_mediadiv__2fS_a",filelist:"style_filelist__1FxpQ",filecard:"style_filecard__29HIk"}},function(e,t,n){e.exports={title:"style_title__37T1W","title-container":"style_title-container__nJyXL",avatar:"style_avatar__I9T18"}},function(e,t,n){e.exports={contacts:"style_contacts__3Y8Wl","close-label":"style_close-label__1yiho","close-button":"style_close-button__3-eYH"}},function(e,t,n){e.exports={landing:"style_landing__1AJBK",logo:"style_logo__1i6xk",landingImage:"style_landingImage__3JKn5",actions:"style_actions__2DAvl","register-label":"style_register-label__3U74A"}},,,,,,,function(e,t,n){e.exports={"video-player":"style_video-player__pxhnt",video:"style_video__10sA-",content:"style_content__3iRlb","modal-control":"style_modal-control__1fdb7","slider-volume":"style_slider-volume__6jcJU"}},function(e,t,n){e.exports={video:"style_video__2ufHy"}},function(e,t,n){e.exports={typing:"style_typing__203NC",dot:"style_dot__1YRwn"}},function(e,t,n){e.exports={row:"style_row__RQQHj",chip:"style_chip__3-Ro1"}},function(e,t,n){e.exports={toolbar:"style_toolbar__3sSyu","file-view":"style_file-view__2lYJo",col:"style_col__3sOY-","close-button":"style_close-button__2AE8Y",textarea:"style_textarea___6FLN",card:"style_card__3Bl2A",blackborder:"style_blackborder__1GH8W"}},function(e,t,n){"use strict";(function(e){n.d(t,"a",(function(){return c}));var a=n(6),r=n(5),c=function(t,n){return function(c,s,o){var i=o.callZome,u={agent:e.from(Object(a.a)(t)),isTyping:n};return i({zomeName:r.c.P2PMESSAGE,fnName:r.a[r.c.P2PMESSAGE].TYPING,payload:u}),null}}}).call(this,n(59).Buffer)},function(e,t,n){"use strict";(function(e){n.d(t,"a",(function(){return b}));var a=n(35),r=n(43),c=n(3),s=n(8),o=n(4),i=n.n(o),u=n(6),l=n(5),d=n(16),p=n(30),b=function(t){return function(){var n=Object(s.a)(i.a.mark((function n(s,o,b){var j,m,f,O,g,h,v,y,x,_;return i.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return j=b.callZome,m=Object(d.b)(new Date),f=Object(c.a)({},o().p2pmessages),O=[],t.map((function(e){return O.push(Object(u.a)(e.p2pMessageEntryHash))})),g=[e.from(Object(u.a)(t[0].author.id)),e.from(Object(u.a)(t[0].receiver.id))],h={message_hashes:O,conversants:g,timestamp:m,status:f.pinned[t[0].p2pMessageEntryHash]?"Unpinned":"Pinned"},n.prev=7,n.next=10,j({zomeName:l.c.P2PMESSAGE,fnName:l.a[l.c.P2PMESSAGE].PIN_MESSAGE,payload:h});case 10:return v=n.sent,y=Object.values(v)[0],x=y.status,_=o().profile.id===y.conversants[0]?Object(u.b)(y.conversants[0]):Object(u.b)(y.conversants[1]),y.id.forEach((function(e){var t=Object(u.b)(e),n=f.messages[t];if(f.conversations[_]&&(f.conversations[_].pinned||(f.conversations[_].pinned=[]),"pinned"===x&&(f.conversations[_].pinned.includes(t)||f.conversations[_].pinned.push(t),f.pinned[t]||(f.pinned[t]=n)),"unpined"===x)){if(f.conversations[_].pinned.includes(t)){var s=f.conversations[_].pinned.indexOf(t);s>-1&&f.conversations[_].pinned.splice(s,1)}if(f.pinned[t]){var o=f.pinned,i=(o[t],Object(a.a)(o,[t].map(r.a)));f.pinned=Object(c.a)({},i)}}})),s({type:p.e,state:f}),n.abrupt("return",!0);case 19:n.prev=19,n.t0=n.catch(7);case 21:return n.abrupt("return",!1);case 22:case"end":return n.stop()}}),n,null,[[7,19]])})));return function(e,t,a){return n.apply(this,arguments)}}()}}).call(this,n(59).Buffer)},function(e,t,n){e.exports={icon:"style_icon__2nRa9",avatar:"style_avatar__3dQuS"}},function(e,t,n){e.exports={search:"style_search__1P1Jo"}},function(e,t,n){e.exports={"contacts-list":"style_contacts-list__2633z","add-label":"style_add-label__3UjKf","my-custom-modal-css":"style_my-custom-modal-css__2_5sM","modal-wrapper":"style_modal-wrapper__1uXqE",modal:"style_modal__3XaVG"}},function(e,t,n){e.exports={identifier:"style_identifier__3vwzh",avatar:"style_avatar__1CVEO"}},function(e,t,n){e.exports={recipients:"style_recipients__3Tz9O",to:"style_to__3Gtm8"}},,,,,,,,,,,,,,,,,,function(e,t,n){e.exports={spinner:"style_spinner__1BA-o"}},,,function(e,t,n){e.exports={"contacts-list":"style_contacts-list__1o7GN"}},function(e,t,n){e.exports={"empty-contacts":"style_empty-contacts__qKKye"}},function(e,t,n){e.exports={chat:"style_chat__2rr5Z","item-inner":"style_item-inner__3Pzc7"}},function(e,t,n){e.exports={image:"style_image__1PE4_"}},function(e,t,n){e.exports={me:"style_me__3fhVY",others:"style_others__1jm3i"}},function(e,t,n){e.exports={"message-text":"style_message-text__MzgzV"}},,function(e,t,n){"use strict";(function(e){n.d(t,"a",(function(){return d}));var a=n(7),r=n(8),c=n(4),s=n.n(c),o=n(6),i=n(5),u=n(16),l=n(104),d=function(t){return function(){var n=Object(r.a)(s.a.mark((function n(r,c,d){var p,b,j,m,f,O,g,h,v,y,x,_;return s.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return p=d.callZome,b=new Date,j=Object(u.b)(b),m=[],t.map((function(e){return m.push(Object(o.a)(e.p2pMessageEntryHash))})),f=e.from(Object(o.a)(t[0].author.id)),O={message_hashes:m,sender:f,timestamp:j},n.next=9,p({zomeName:i.c.P2PMESSAGE,fnName:i.a[i.c.P2PMESSAGE].READ_MESSAGE,payload:O});case 9:if("error"===(null===(g=n.sent)||void 0===g?void 0:g.type)){n.next=17;break}return h=Object.keys(g),v=Object(a.a)(h,1),y=v[0],x=[],g[y].id.forEach((function(e){x.push(Object(o.b)(e))})),_={p2pMessageReceiptEntryHash:y,p2pMessageEntryHashes:x,timestamp:Object(u.e)(g[y].status.timestamp),status:g[y].status.status},r(Object(l.a)(_)),n.abrupt("return",!0);case 17:return n.abrupt("return",!1);case 18:case"end":return n.stop()}}),n)})));return function(e,t,a){return n.apply(this,arguments)}}()}}).call(this,n(59).Buffer)},,function(e,t,n){e.exports={container:"style_container__3nacn"}},,function(e,t,n){e.exports={"avatar-container":"style_avatar-container__2Qls7","contacts-list":"style_contacts-list__3gSNv"}},function(e,t,n){e.exports={"empty-contacts":"style_empty-contacts__JmFbZ"}},function(e,t,n){e.exports={"empty-conversations":"style_empty-conversations__2L30A"}},function(e,t,n){e.exports={conversation:"style_conversation__28KWI","empty-conversations":"style_empty-conversations__1_1Ss"}},function(e,t,n){e.exports={"home-tab-bar":"style_home-tab-bar__2vOP6"}},function(e,t,n){e.exports={header:"style_header__3PkRv"}},function(e,t,n){e.exports={"popover-list":"style_popover-list__14lHb"}},function(e,t,n){e.exports={"settings-list":"style_settings-list__i3vNl"}},function(e,t,n){e.exports={err:"style_err__1GKMd"}},function(e){e.exports=JSON.parse('{"app.auth.err":"We\'re sorry. We failed to get your profile. Please try restarting your Holochain Launcher, or access Kizuna from a new browser if you are in Holo hosting network.","app.blocked.empty-blocked-list":"You have not blocked anybody yet","app.chat.chat-details.files":"FILES","app.chat.chat-details.info":"INFO","app.chat.chat-details.media":"MEDIA","app.chat.header-details":"Details","app.chat.header-pinned-messages":"Pinned Messages","app.chat.header-search":"Search","app.chat.pinned-message-title":"Pinned Messages","app.contacts.add":"Add to contacts","app.contacts.add-message":"{name} has been added to your contacts","app.contacts.block":"Block profile","app.contacts.empty-contact-list":"Your contact list is empty as of the moment","app.contacts.remove":"Remove from contacts","app.contacts.search":"Search with minimum 3 characters...","app.contacts.search-nickname-warning":"The minimum length for search is 3 characters","app.contacts.unblock":"Unblock profile","app.conversations.empty-conversations":"You have no conversations yet...","app.conversations.no-group-messages":"No message has been sent yet...","app.group-chat.add-member":"Add","app.group-chat.add-member-close":"Close","app.group-chat.add-member-contacts":"Contacts","app.group-chat.add-members":"Add Members","app.group-chat.admin-role":"admin","app.group-chat.fetching":"Fetching...","app.group-chat.files.fetching":"Fetching files...","app.group-chat.files.no-files":"There is no file sent in the chat yet...","app.group-chat.header-details":"Details","app.group-chat.header-pinned-message":"Pinned Messages","app.group-chat.header-search":"Search","app.group-chat.label-files":"FILES","app.group-chat.label-info":"INFO","app.group-chat.label-media":"MEDIA","app.group-chat.media.fetching":"Fetching media...","app.group-chat.media.month.1":"January","app.group-chat.media.month.2":"February","app.group-chat.media.month.3":"March","app.group-chat.media.month.4":"April","app.group-chat.media.month.5":"May","app.group-chat.media.month.6":"June","app.group-chat.media.month.7":"July","app.group-chat.media.month.8":"August","app.group-chat.media.month.9":"Septmember","app.group-chat.media.month.10":"October","app.group-chat.media.month.11":"November","app.group-chat.media.month.12":"December","app.group-chat.media.no-media":"There is no media sent in the chat yet...","app.group-chat.member-role":"member","app.group-chat.members":"{length} members","app.group-chat.change-avatar":"Upload Avatar","app.group-chat.members-label":"Members","app.group-chat.minimum-member-required-reached":"The group must at leaset have 3 members","app.group-chat.no-member-to-add":"You have no one to add right now...","app.group-chat.oldest-message-fetched":"You have already fetched the oldest message","app.group-chat.pinned-message-title":"Pinned Messages","app.group-chat.remove-member":"REMOVE","app.group-chat.sending":"Sending...","app.group-chat.update-group-name-cancel":"Cancel","app.group-chat.update-group-name-placeholder":"Group Name","app.group-chat.update-group-name-save":"Save","app.group-chat.update-group-name-title":"Edit Group","app.home.contacts-tab-bar":"Contacts","app.home.messaging-tab-bar":"Messaging","app.landing.login":"Start Messaging","app.landing.register":"Register Nickname","app.login.login":"Login","app.login.username-label":"Username","app.login.username-placeholder":"Please enter your username...","app.menu.blocked-label":"Blocked","app.menu.logout-label":"Logout","app.menu.report-label":"Report an issue","app.menu.settings-label":"Settings","app.menu.version":"version","app.new-conversation.header-title":"New Message","app.new-conversation.message-placeholder":"Compose message...","app.new-conversation.no-contacts-toast":"Please select a contact...","app.new-conversation.problem-occured-toast":"A problem occurred...","app.new-conversation.search-placeholder":"Search contacts...","app.new-conversation.to":"To","app.profile.to-be-implemented":"Page under construction","app.profile.to-be-implemented-header":"Oops!","app.register.error-existing-username":"Sorry! That username is already taken","app.register.error-invalid-username":"Nickname must be at least 3 characters and contain 1 alphanumeric character","app.register.error-username-with-space":"Nickname must not contain any spaces","app.register.error-no-image":"No image selected","app.register.register":"Register nickname","app.register.username-label":"Nickname","app.register.avatar-label":"Avatar","app.register.username-placeholder":"Type your nickname here...","app.register.button-avatar-label":"Change Avatar","app.settings.language-label":"Language","app.settings.preference-label":"Preference","app.settings.read-receipt-label":"Read Receipt","app.settings.typing-indicator-label":"Typing Indicator","components.chat.chat-list.today":"Today","components.chat.chat-modal-delete":"Delete","components.chat.chat-modal-pin":"Pin","components.chat.chat-modal-reply":"Reply","components.chat.chat-modal-copy":"Copy","components.chat.chat-modal-resend":"Resend","components.chat.chat-modal-unpin":"Unpin","components.chat.media-modal-download":"Download","components.conversation.me-file-string":"You sent {fileName}","components.conversation.other-file-string":"{name} has sent {fileName}","components.message-input.over-size-limit":"{fileName} exceeds the 15mb file limit","components.profile-info.id":"ID","components.profile-info.identicon":"Identicon","components.profile-info.nickname":"Nickname","components.typing.is-typing":"{user} is typing","components.image-cropper.label":"Crop image","components.image-cropper.cancel":"Cancel","components.image-cropper.confirm":"Confirm","redux.err.commons-get-latest-data":"Failed to get the latest data","redux.err.conductor-time-out":"Sorry, the conductor timed out","redux.err.contacts.add-contact.1":"{username} has already been added","redux.err.contacts.add-contact.2":"{username} is blocked","redux.err.contacts.block-contact.1":"{username} is already blocked","redux.err.contacts.fetch-blocked.1":"Unable to fetch username of this user","redux.err.contacts.fetch-blocked.2":"This user don\'t have a username","redux.err.contacts.fetch-my-contacts.1":"Unable to fetch username of this user","redux.err.generic":"Sorry, something went wrong...","redux.err.group.add-members.1":"Oops, you tried to add members without providing who should be added","redux.err.group.add-members.2":"Oops, you won\'t be able to add agents you blocked","redux.err.group.add-members.3":"Sorry, member/s were not added due to failure in getting group id","redux.err.group.add-members.4":"Oops, only admins can add members","redux.err.group.add-members.5":"Oops, you cannot add admins as a member","redux.err.group.create-group.1":"Oops, you cannot create a group with agents you blocked","redux.err.group.create-group.2":"Oops, groups cannot be created with less than 3 members","redux.err.group.create-group.3":"Oops, you cannot create groups including yourself as a member","redux.err.group.create-group.4":"Oops, group name must be at least more than 1 and less than 50 characters","redux.err.group.get-latest-group-version.1":"Sorry, failed to get the latest version of the group","redux.err.group.pin-message":"Sorry, failed to pin the message. Please try again shortly.","redux.err.group.remove-members.1":"Oops, you tried to remove members without providing who should be removed","redux.err.group.remove-members.2":"Sorry, member/s were not removed due to failure in getting group id","redux.err.group.remove-members.3":"Oops, a group must at leaset have 3 members","redux.err.group.remove-members.4":"Oops, only admins can remove members","redux.err.group.send-group-message.1":"Sorry, \\"{payload}\\" was not sent due to failure in getting group id","redux.err.group.send-group-message.2":"message being replied has not yet propagated in network. Please try again shortly.","redux.err.group.set-files-bytes.1":"Sorry, failed to get the file/media bytes","redux.err.group.update-group-name.1":"Oops, you can\'t update group name with same name","redux.err.group.update-group-name.2":"Sorry, failed updating the group name due to failure in getting group id","redux.err.group.update-group-name.3":"Oops, group name must be at least more than 1 and less than 50 characters","redux.err.group.update-group-name.4":"Oops, only the admin can update the group name","redux.err.profile.fetch-profile-from-username.1":"This username does not exist","redux.err.profile.set-username.1":"This username has already been taken","redux.err.profile.set-username.2":"You already have a username"}')},function(e){e.exports=JSON.parse('{"app.auth.err":"\u30d7\u30ed\u30d5\u30a3\u30fc\u30eb\u306e\u53d6\u5f97\u306b\u5931\u6557\u3057\u307e\u3057\u305f\u3002Holochain Launcher\u3092\u518d\u8d77\u52d5\u3057\u3066\u4e0b\u3055\u3044\u3002Holo\u30db\u30b9\u30c6\u30a3\u30f3\u30b0\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u4f7f\u7528\u306e\u5834\u5408\u306f\u3001\u65b0\u3057\u3044\u30d6\u30e9\u30a6\u30b6\u304b\u3089Kizuna\u3092\u30a2\u30af\u30bb\u30b9\u3057\u3066\u4e0b\u3055\u3044","app.blocked.empty-blocked-list":"\u307e\u3060\u3001\u8ab0\u3082\u30d6\u30ed\u30c3\u30af\u3055\u308c\u3066\u3044\u307e\u305b\u3093","app.chat.chat-details.files":"\u30d5\u30a1\u30a4\u30eb","app.chat.chat-details.info":"\u30c1\u30e3\u30c3\u30c8\u60c5\u5831","app.chat.chat-details.media":"\u30e1\u30c7\u30a3\u30a2","app.chat.header-details":"\u30c1\u30e3\u30c3\u30c8\u60c5\u5831","app.chat.header-pinned-messages":"\u63b2\u793a\u677f","app.chat.header-search":"\u691c\u7d22","app.chat.pinned-message-title":"\u63b2\u793a\u677f","app.contacts.add":"\u9023\u7d61\u5148\u306b\u8ffd\u52a0","app.contacts.add-message":"{name}\u304c\u9023\u7d61\u5148\u306b\u8ffd\u52a0\u3055\u308c\u307e\u3057\u305f","app.contacts.block":"\u9023\u7d61\u5148\u3092\u30d6\u30ed\u30c3\u30af","app.contacts.empty-contact-list":"\u9023\u7d61\u5148\u306f\u307e\u3060\u3042\u308a\u307e\u305b\u3093","app.contacts.remove":"\u9023\u7d61\u5148\u304b\u3089\u524a\u9664","app.contacts.search":"3\u6587\u5b57\u4ee5\u4e0a\u3067\u691c\u7d22","app.contacts.search-nickname-warning":"\u691c\u7d22\u306f\uff13\u6587\u5b57\u4ee5\u4e0a\u3067\u53ef\u80fd\u3067\u3059","app.contacts.unblock":"\u9023\u7d61\u5148\u306e\u30d6\u30ed\u30c3\u30af\u3092\u89e3\u9664","app.conversations.empty-conversations":"\u307e\u3060\u4f1a\u8a71\u304c\u306a\u3044\u3088\u3046\u3067\u3059...","app.conversations.no-group-messages":"\u307e\u3060\u30e1\u30c3\u30bb\u30fc\u30b8\u304c\u9001\u4fe1\u3055\u308c\u3066\u3044\u307e\u305b\u3093...","app.group-chat.add-member":"\u8ffd\u52a0","app.group-chat.add-member-close":"\u9589\u3058\u308b","app.group-chat.add-member-contacts":"\u9023\u7d61\u5148","app.group-chat.add-members":"\u30e1\u30f3\u30d0\u30fc\u8ffd\u52a0","app.group-chat.admin-role":"\u7ba1\u7406\u8005","app.group-chat.change-avatar":"\u30a2\u30d0\u30bf\u30fc\u3092\u5909\u66f4\u3059\u308b","app.group-chat.fetching":"\u53d6\u5f97\u4e2d...","app.group-chat.files.fetching":"\u30d5\u30a1\u30a4\u30eb\u53d6\u5f97\u4e2d...","app.group-chat.files.no-files":"\u30d5\u30a1\u30a4\u30eb\u306f\u3053\u306e\u30c1\u30e3\u30c3\u30c8\u3067\u306f\u307e\u3060\u5171\u6709\u3055\u308c\u3066\u3044\u307e\u305b\u3093","app.group-chat.header-details":"\u30c1\u30e3\u30c3\u30c8\u60c5\u5831","app.group-chat.header-pinned-message":"\u63b2\u793a\u677f","app.group-chat.header-search":"\u691c\u7d22","app.group-chat.label-files":"\u30d5\u30a1\u30a4\u30eb","app.group-chat.label-info":"\u30b0\u30eb\u30fc\u30d7\u60c5\u5831","app.group-chat.label-media":"\u30e1\u30c7\u30a3\u30a2","app.group-chat.media.fetching":"\u30e1\u30c7\u30a3\u30a2\u53d6\u5f97\u4e2d...","app.group-chat.media.month.1":"1\u6708","app.group-chat.media.month.2":"2\u6708","app.group-chat.media.month.3":"3\u6708","app.group-chat.media.month.4":"4\u6708","app.group-chat.media.month.5":"5\u6708","app.group-chat.media.month.6":"6\u6708","app.group-chat.media.month.7":"7\u6708","app.group-chat.media.month.8":"8\u6708","app.group-chat.media.month.9":"9\u6708","app.group-chat.media.month.10":"10\u6708","app.group-chat.media.month.11":"11\u6708","app.group-chat.media.month.12":"12\u6708","app.group-chat.media.no-media":"\u30e1\u30c7\u30a3\u30a2\u30d5\u30a1\u30a4\u30eb\u306f\u3053\u306e\u30c1\u30e3\u30c3\u30c8\u3067\u306f\u307e\u3060\u5171\u6709\u3055\u308c\u3066\u3044\u307e\u305b\u3093","app.group-chat.member-role":"\u30e1\u30f3\u30d0\u30fc","app.group-chat.members":"{length}\u4eba","app.group-chat.members-label":"\u30e1\u30f3\u30d0\u30fc","app.group-chat.minimum-member-required-reached":"\u30b0\u30eb\u30fc\u30d7\u306e\u30e1\u30f3\u30d0\u30fc\u306f\u6700\u4f4e\uff13\u540d\u3067\u3059","app.group-chat.no-member-to-add":"\u8ffd\u52a0\u3067\u304d\u308b\u30e6\u30fc\u30b6\u30fc\u304c\u3044\u307e\u305b\u3093","app.group-chat.oldest-message-fetched":"\u5168\u3066\u306e\u30e1\u30c3\u30bb\u30fc\u30b8\u3092\u53d6\u5f97\u3057\u307e\u3057\u305f","app.group-chat.pinned-message-title":"\u63b2\u793a\u677f","app.group-chat.remove-member":"\u30b0\u30eb\u30fc\u30d7\u9000\u4f1a","app.group-chat.sending":"\u9001\u4fe1\u4e2d...","app.group-chat.update-group-name-cancel":"\u30ad\u30e3\u30f3\u30bb\u30eb","app.group-chat.update-group-name-placeholder":"\u30b0\u30eb\u30fc\u30d7\u540d","app.group-chat.update-group-name-save":"\u4fdd\u5b58","app.group-chat.update-group-name-title":"\u30b0\u30eb\u30fc\u30d7\u540d\u5909\u66f4","app.home.contacts-tab-bar":"\u9023\u7d61\u5148","app.home.messaging-tab-bar":"\u30c1\u30e3\u30c3\u30c8","app.landing.login":"\u30c1\u30e3\u30c3\u30c8\u3092\u958b\u59cb\u3059\u308b","app.landing.register":"\u30cb\u30c3\u30af\u30cd\u30fc\u30e0\u3092\u767b\u9332","app.login.login":"\u30ed\u30b0\u30a4\u30f3","app.login.username-label":"\u30e6\u30fc\u30b6\u30fc\u540d","app.login.username-placeholder":"\u30e6\u30fc\u30b6\u30fc\u540d\u3092\u5165\u529b\u3057\u3066\u304f\u3060\u3055\u3044...","app.menu.blocked-label":"\u30d6\u30ed\u30c3\u30af","app.menu.logout-label":"\u30ed\u30b0\u30a2\u30a6\u30c8","app.menu.report-label":"\u554f\u984c\u3092\u5831\u544a\u3059\u308b","app.menu.settings-label":"\u8a2d\u5b9a","app.menu.version":"\u30d0\u30fc\u30b8\u30e7\u30f3","app.new-conversation.header-title":"\u65b0\u3057\u3044\u30e1\u30c3\u30bb\u30fc\u30b8","app.new-conversation.message-placeholder":"\u30e1\u30c3\u30bb\u30fc\u30b8\u3092\u5165\u529b\u3057\u3066\u304f\u3060\u3055\u3044...","app.new-conversation.no-contacts-toast":"\u9023\u7d61\u5148\u3092\u9078\u629e\u3057\u3066\u304f\u3060\u3055\u3044...","app.new-conversation.problem-occured-toast":"\u554f\u984c\u304c\u767a\u751f\u3057\u307e\u3057\u305f...","app.new-conversation.search-placeholder":"\u9023\u7d61\u5148\u304b\u3089\u9078\u3093\u3067\u304f\u3060\u3055\u3044","app.new-conversation.to":"\u53d7\u4fe1\u8005","app.profile.to-be-implemented":"\u5de5\u4e8b\u4e2d...","app.profile.to-be-implemented-header":"\u304a\u3063\u3068!","app.register.avatar-label":"\u30d7\u30ed\u30d5\u30a3\u30fc\u30eb\u5199\u771f","app.register.button-avatar-label":"\u753b\u50cf\u30a2\u30c3\u30d7\u30ed\u30fc\u30c9","app.register.error-existing-username":"\u3053\u306e\u30e6\u30fc\u30b6\u30fc\u540d\u306f\u3059\u3067\u306b\u767b\u9332\u3055\u308c\u3066\u3044\u307e\u3059","app.register.error-invalid-username":"\u30cb\u30c3\u30af\u30cd\u30fc\u30e0\u306f3\u82f1\u6570\u5b57\u4ee5\u4e0a\u3067\u3001\u6700\u4f4e1\u82f1\u5b57\u3092\u542b\u3081\u308b\u5fc5\u8981\u304c\u3042\u308a\u307e\u3059","app.register.error-no-image":"\u753b\u50cf\u304c\u9078\u629e\u3055\u308c\u3066\u3044\u307e\u305b\u3093","app.register.error-username-with-space":"\u30cb\u30c3\u30af\u30cd\u30fc\u30e0\u306b\u30b9\u30da\u30fc\u30b9\u306f\u4f7f\u3048\u307e\u305b\u3093","app.register.register":"\u30d7\u30ed\u30d5\u30a3\u30fc\u30eb\u3092\u767b\u9332\u3059\u308b","app.register.username-label":"\u30cb\u30c3\u30af\u30cd\u30fc\u30e0","app.register.username-placeholder":"\u30cb\u30c3\u30af\u30cd\u30fc\u30e0\u3092\u5165\u529b\u3057\u3066\u304f\u3060\u3055\u3044...","app.settings.language-label":"\u8a00\u8a9e","app.settings.preference-label":"\u74b0\u5883\u8a2d\u5b9a","app.settings.read-receipt-label":"\u65e2\u8aad\u901a\u77e5","app.settings.typing-indicator-label":"\u5165\u529b\u4e2d\u901a\u77e5","components.chat.chat-list.today":"\u4eca\u65e5","components.chat.chat-modal-delete":"\u524a\u9664","components.chat.chat-modal-pin":"\u30d4\u30f3\u7559\u3081","components.chat.chat-modal-reply":"\u8fd4\u4fe1","components.chat.chat-modal-copy":"\u30b3\u30d4\u30fc","components.chat.chat-modal-resend":"\u518d\u9001\u4fe1","components.chat.chat-modal-unpin":"\u30d4\u30f3\u7559\u3081\u89e3\u9664","components.chat.media-modal-download":"\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9","components.conversation.me-file-string":"\u3042\u306a\u305f\u306f{fileName}\u3092\u9001\u308a\u307e\u3057\u305f","components.conversation.other-file-string":"{name}\u304c{fileName}\u3092\u9001\u4fe1\u3057\u307e\u3057\u305f","components.image-cropper.cancel":"\u30ad\u30e3\u30f3\u30bb\u30eb","components.image-cropper.confirm":"\u78ba\u8a8d","components.image-cropper.label":"\u5199\u771f\u306e\u5207\u308a\u53d6\u308a","components.message-input.over-size-limit":"{fileName}\u306f15MB\u306e\u30d5\u30a1\u30a4\u30eb\u5236\u9650\u3092\u8d85\u3048\u3066\u3044\u307e\u3059","components.profile-info.id":"ID","components.profile-info.identicon":"\u30a2\u30a4\u30c7\u30f3\u30c6\u30a3\u30b3\u30f3","components.profile-info.nickname":"\u30cb\u30c3\u30af\u30cd\u30fc\u30e0","components.typing.is-typing":"{user}\u304c\u5165\u529b\u3057\u3066\u3044\u307e\u3059","redux.err.commons-get-latest-data":"\u6700\u65b0\u30c7\u30fc\u30bf\u306e\u53d6\u5f97\u306b\u5931\u6557\u3057\u307e\u3057\u305f","redux.err.conductor-time-out":"\u30bf\u30a4\u30e0\u30a2\u30a6\u30c8\u304c\u767a\u751f\u3057\u307e\u3057\u305f","redux.err.contacts.add-contact.1":"{username}\u306f\u3059\u3067\u306b\u9023\u7d61\u5148\u306b\u8ffd\u52a0\u3055\u308c\u3066\u3044\u307e\u3059","redux.err.contacts.add-contact.2":"{username}\u306f\u30d6\u30ed\u30c3\u30af\u3055\u308c\u3066\u3044\u307e\u3059","redux.err.contacts.block-contact.1":"{username}\u306f\u3059\u3067\u306b\u30d6\u30ed\u30c3\u30af\u3055\u308c\u3066\u3044\u307e\u3059","redux.err.contacts.fetch-blocked.1":"\u3053\u306e\u30e6\u30fc\u30b6\u30fc\u306e\u30e6\u30fc\u30b6\u30fc\u30cd\u30fc\u30e0\u306e\u53d6\u5f97\u306b\u5931\u6557\u3057\u307e\u3057\u305f","redux.err.contacts.fetch-blocked.2":"\u3053\u306e\u30e6\u30fc\u30b6\u30fc\u306f\u30e6\u30fc\u30b6\u30fc\u30cd\u30fc\u30e0\u304c\u3042\u308a\u307e\u305b\u3093","redux.err.contacts.fetch-my-contacts.1":"\u3053\u306e\u30e6\u30fc\u30b6\u30fc\u306e\u30e6\u30fc\u30b6\u30fc\u30cd\u30fc\u30e0\u306e\u53d6\u5f97\u306b\u5931\u6557\u3057\u307e\u3057\u305f","redux.err.generic":"\u30a8\u30e9\u30fc\u304c\u767a\u751f\u3057\u307e\u3057\u305f","redux.err.group.add-members.1":"\u304a\u3063\u3068, \u8ffd\u52a0\u3059\u308b\u30e1\u30f3\u30d0\u30fc\u3092\u6307\u5b9a\u305b\u305a\u306b\u30e1\u30f3\u30d0\u30fc\u3092\u8ffd\u52a0\u3057\u3088\u3046\u3068\u3057\u3066\u3044\u307e\u3059","redux.err.group.add-members.2":"\u304a\u3063\u3068, \u30d6\u30ed\u30c3\u30af\u3055\u308c\u305f\u30e6\u30fc\u30b6\u30fc\u306f\u30b0\u30eb\u30fc\u30d7\u306b\u8ffd\u52a0\u3067\u304d\u307e\u305b\u3093","redux.err.group.add-members.3":"\u30b0\u30eb\u30fc\u30d7ID\u306e\u53d6\u5f97\u306b\u5931\u6557\u3057\u305f\u305f\u3081\u3001\u30e1\u30f3\u30d0\u30fc\u306e\u8ffd\u52a0\u306b\u5931\u6557\u3057\u307e\u3057\u305f","redux.err.group.add-members.4":"\u30b0\u30eb\u30fc\u30d7\u7ba1\u7406\u8005\u306e\u307f\u30b0\u30eb\u30fc\u30d7\u30e1\u30f3\u30d0\u30fc\u3092\u8ffd\u52a0\u3067\u304d\u307e\u3059","redux.err.group.add-members.5":"\u30b0\u30eb\u30fc\u30d7\u7ba1\u7406\u8005\u3092\u30e1\u30f3\u30d0\u30fc\u3068\u3057\u3066\u306f\u8ffd\u52a0\u3067\u304d\u307e\u305b\u3093","redux.err.group.create-group.1":"\u30d6\u30ed\u30c3\u30af\u3055\u308c\u305f\u30e6\u30fc\u30b6\u30fc\u3068\u306f\u30b0\u30eb\u30fc\u30d7\u306f\u4f5c\u6210\u3067\u304d\u307e\u305b\u3093","redux.err.group.create-group.2":"\u30b0\u30eb\u30fc\u30d7\u306f\u6700\u4f4e3\u4eba\u3067\u30e1\u30f3\u30d0\u30fc\u304c\u5fc5\u8981\u3067\u3059","redux.err.group.create-group.3":"\u81ea\u5206\u3092\u30e1\u30f3\u30d0\u30fc\u306b\u52a0\u3048\u308b\u3053\u3068\u306f\u3067\u304d\u307e\u305b\u3093","redux.err.group.create-group.4":"\u30b0\u30eb\u30fc\u30d7\u540d\u306f\u6700\u4f4e\uff11\u6587\u5b57\u6700\u5927\uff15\uff10\u6587\u5b57\u3067\u3059","redux.err.group.get-latest-group-version.1":"\u30b0\u30eb\u30fc\u30d7\u306e\u6700\u65b0\u60c5\u5831\u306e\u53d6\u5f97\u306b\u5931\u6557\u3057\u307e\u3057\u305f","redux.err.group.pin-message":"\u30d4\u30f3\u7559\u3081\u306b\u5931\u6557\u3057\u307e\u3057\u305f\u3002\u518d\u5ea6\u304a\u8a66\u3057\u304f\u3060\u3055\u3044","redux.err.group.remove-members.1":"\u304a\u3063\u3068, \u524a\u9664\u3059\u308b\u30e1\u30f3\u30d0\u30fc\u3092\u6307\u5b9a\u305b\u305a\u306b\u30e1\u30f3\u30d0\u30fc\u524a\u9664\u3092\u3057\u3088\u3046\u3068\u3057\u3066\u3044\u307e\u3059","redux.err.group.remove-members.2":"\u30b0\u30eb\u30fc\u30d7ID\u306e\u53d6\u5f97\u306b\u5931\u6557\u3057\u305f\u305f\u3081\u3001\u30e1\u30f3\u30d0\u30fc\u306e\u524a\u9664\u306b\u5931\u6557\u3057\u307e\u3057\u305f","redux.err.group.remove-members.3":"\u30b0\u30eb\u30fc\u30d7\u30e1\u30f3\u30d0\u30fc\u306f\u6700\u4f4e3\u4eba\u5fc5\u8981\u3067\u3059","redux.err.group.remove-members.4":"\u30b0\u30eb\u30fc\u30d7\u7ba1\u7406\u8005\u306e\u307f\u30b0\u30eb\u30fc\u30d7\u30e1\u30f3\u30d0\u30fc\u306e\u5909\u66f4\u304c\u53ef\u80fd\u3067\u3059","redux.err.group.send-group-message.1":"\u30b0\u30eb\u30fc\u30d7ID\u306e\u53d6\u5f97\u306b\u5931\u6557\u3057\u305f\u305f\u3081\u3001\\"{payload}\\"\u306f\u9001\u4fe1\u3055\u308c\u307e\u305b\u3093\u3067\u3057\u305f","redux.err.group.send-group-message.2":"\u8fd4\u4fe1\u3057\u305f\u3044\u30e1\u30c3\u30bb\u30fc\u30b8\u306e\u53d6\u5f97\u306b\u5931\u6557\u3057\u305f\u305f\u3081\u3001\u30e1\u30c3\u30bb\u30fc\u30b8\u304c\u9001\u4fe1\u3055\u308c\u307e\u305b\u3093\u3067\u3057\u305f\u3002\u518d\u5ea6\u304a\u8a66\u3057\u304f\u3060\u3055\u3044","redux.err.group.set-files-bytes.1":"\u30d5\u30a1\u30a4\u30eb/\u30e1\u30c7\u30a3\u30a2\u306e\u53d6\u5f97\u306b\u5931\u6557\u3057\u307e\u3057\u305f","redux.err.group.update-group-name.1":"\u304a\u3063\u3068\u3001\u540c\u3058\u540d\u524d\u3067\u306f\u30b0\u30eb\u30fc\u30d7\u540d\u306f\u66f4\u65b0\u3067\u304d\u307e\u305b\u3093","redux.err.group.update-group-name.2":"\u30b0\u30eb\u30fc\u30d7ID\u306e\u53d6\u5f97\u306b\u5931\u6557\u3057\u305f\u305f\u3081\u3001\u30b0\u30eb\u30fc\u30d7\u540d\u306e\u66f4\u65b0\u306b\u5931\u6557\u3057\u307e\u3057\u305f","redux.err.group.update-group-name.3":"\u30b0\u30eb\u30fc\u30d7\u540d\u306f\u6700\u4f4e\uff11\u6587\u5b57\u6700\u5927\uff15\uff10\u6587\u5b57\u3067\u3059","redux.err.group.update-group-name.4":"\u30b0\u30eb\u30fc\u30d7\u7ba1\u7406\u8005\u306e\u307f\u30b0\u30eb\u30fc\u30d7\u540d\u3092\u66f4\u65b0\u3067\u304d\u307e\u3059","redux.err.profile.fetch-profile-from-username.1":"\u3053\u306e\u30e6\u30fc\u30b6\u30fc\u30cd\u30fc\u30e0\u306f\u5b58\u5728\u3057\u307e\u305b\u3093","redux.err.profile.set-username.1":"\u3053\u306e\u30e6\u30fc\u30b6\u30fc\u30cd\u30fc\u30e0\u306f\u3059\u3067\u306b\u4f7f\u7528\u3055\u308c\u3066\u3044\u307e\u3059","redux.err.profile.set-username.2":"\u3042\u306a\u305f\u306f\u3059\u3067\u306b\u30e6\u30fc\u30b6\u30fc\u30cd\u30fc\u30e0\u3092\u304a\u6301\u3061\u3067\u3059"}')},,,,,,,function(e,t,n){"use strict";n.d(t,"a",(function(){return R}));var a=n(8),r=n(4),c=n.n(r),s=n(5),o=n(3),i=n(10),u=n(18),l=n(6),d=n(17),p=n(16),b=n(15),j=function(e){return function(){var t=Object(a.a)(c.a.mark((function t(n,a,r){var j,m,f,O,g,h,v,y,x,_,E,T,S,N,w,I,M;return c.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(j=r.callZome,r.getAgentId,m=e.payload,f=a(),O=f.contacts.contacts,g=f.profile,h=g.username,v=g.fields,y=a().profile.id,x={originalGroupId:Object(l.b)(m.groupId),originalGroupRevisionId:Object(l.b)(m.groupRevisionId),name:m.latestName,members:m.members.map((function(e){return Object(l.b)(e)})),createdAt:Object(p.e)(m.created),creator:Object(l.b)(m.creator),messages:[],pinnedMessages:[],avatar:m.avatar},_=[].concat(Object(u.a)(x.members),[x.creator]),E={},null===(T=_.reduce((function(e,t){var n=O[t]?O[t]:t===y?{id:y,username:h,fields:v}:null;if(n)E[t]=n;else{var a=Object(d.c)(t);e.push(a)}return e}),[]))||void 0===T||!T.length){t.next=16;break}return S=T.map((function(e){return Object(l.b)(e)})),t.next=14,j({zomeName:s.c.PROFILES,fnName:s.a[s.c.PROFILES].GET_AGENTS_PROFILES,payload:S});case 14:t.sent.forEach((function(e){var t=e.agentPubKey;E[t]={id:t,username:e.profile.nickname,fields:e.profile.fields.avatar?{avatar:e.profile.fields.avatar}:{}}}));case 16:N=x.originalGroupId,w=Object(i.a)({},N,x),I=f.groups.conversations,I=Object(o.a)(Object(o.a)({},I),w),M=f.groups.members,M=Object(o.a)(Object(o.a)({},M),E),n({type:b.a,conversations:I,members:M});case 23:case"end":return t.stop()}}),t)})));return function(e,n,a){return t.apply(this,arguments)}}()},m=n(26),f=function(e){return Object(m.d)(e)?e:{type:"FILE",fileName:e.payload.metadata.fileName,fileSize:e.payload.metadata.fileSize,fileType:Object(m.b)(e.payload.fileType)?"OTHER":Object(m.a)(e.payload.fileType)?"IMAGE":"VIDEO",fileHash:Object(l.b)(e.payload.metadata.fileHash),thumbnail:Object(m.b)(e.payload.fileType)?void 0:e.payload.fileType.payload.thumbnail}},O=function(e){return function(){var t=Object(a.a)(c.a.mark((function t(n,a){var r,s,d,j,m,O,g,h,v,y,x,_;return c.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:r=e.payload,s=a(),d={groupMessageId:Object(l.b)(r.messageId),groupId:Object(l.b)(r.groupHash),author:Object(l.b)(r.sender),payload:f(r.payload),timestamp:Object(p.e)(r.created),replyTo:r.replyTo?{groupId:Object(l.b)(r.replyTo.content.groupHash),author:Object(l.b)(r.replyTo.content.sender),payload:f(r.replyTo.content.payload),timestamp:Object(p.e)(r.replyTo.content.created),replyTo:void 0,readList:{}}:void 0,readList:{}},j=d.groupId,m=d.groupMessageId,O=s.groups.conversations[j],g=O?O.messages:[],h=[d.groupMessageId].concat(Object(u.a)(g)),v=Object(i.a)({},m,d),y=s.groups.messages,y=Object(o.a)(Object(o.a)({},y),v),x=s.groups.groupFiles,_=Object(o.a)(Object(o.a)({},s.groups.conversations),{},Object(i.a)({},j,Object(o.a)(Object(o.a)({},O),{},{messages:h}))),n({type:b.g,conversations:_,messages:y,groupFiles:x});case 14:case"end":return t.stop()}}),t)})));return function(e,n){return t.apply(this,arguments)}}()},g=function(e){return function(){var t=Object(a.a)(c.a.mark((function t(n,a){var r,s,u,d,j,m;return c.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:r=e.payload,s=a(),u=r.messageIds.map((function(e){return Object(l.b)(e)})).filter((function(e){return s.groups.messages[e]})),d=Object(l.b)(r.reader),j=Object(p.e)(r.timestamp),m=Object(o.a)({},a().groups.messages),u.forEach((function(e){m[e].readList=Object(o.a)(Object(o.a)({},m[e].readList),{},Object(i.a)({},d,j))})),n({type:b.i,messages:m});case 8:case"end":return t.stop()}}),t)})));return function(e,n){return t.apply(this,arguments)}}()},h=function(e){return function(){var t=Object(a.a)(c.a.mark((function t(n,a,r){var s,u,d,p,j,m,f,O,g,h,v;return c.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:r.callZome,s=e.payload,u=Object(l.b)(s.groupId),d=a(),p=d.groups.typing[u]?d.groups.typing[u]:[],j=Object(l.b)(s.indicatedBy),m=p.map((function(e){return e.id})),(s.isTyping&&!m.includes(j)||!s.isTyping&&m.includes(j))&&(f=a().groups.members[j],O={groupId:u,indicatedBy:f,isTyping:s.isTyping},g=d.groups.typing,h=g[O.groupId]?g[O.groupId]:[],v=h.map((function(e){return e.id})),O.isTyping?O.indicatedBy.id&&!v.includes(O.indicatedBy.id)&&h.push(O.indicatedBy):h=h.filter((function(e){return e.id!==O.indicatedBy.id})),g=Object(o.a)(Object(o.a)({},g),{},Object(i.a)({},O.groupId,h)),n({type:b.j,typing:g}));case 8:case"end":return t.stop()}}),t)})));return function(e,n,a){return t.apply(this,arguments)}}()},v=n(7),y=n(93),x=function(e){return function(){var t=Object(a.a)(c.a.mark((function t(n,a,r){var s,u,d,b,j,m,f,O,g,h,x,_,E,T,S,N,w,I,M;return c.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(r.callZome,s=e.message,u=Object(o.a)({},a().contacts.contacts),d=Object(o.a)({},a().profile),b=Object(o.a)(Object(o.a)({},u),{},Object(i.a)({},d.id,{id:d.id,username:d.username,fields:d.fields})),j=Object(v.a)(s,2),m=j[0],f=j[1],O=Object(v.a)(m,2),g=O[0],h=O[1],x=f,_=Object(v.a)(x,2),E=_[0],T=_[1],Object.keys(u).includes(Object(l.b)(h.author))){t.next=10;break}return t.abrupt("return");case 10:t.t0=h.payload.type,t.next="TEXT"===t.t0?13:"FILE"===t.t0?15:17;break;case 13:return S=h.payload,t.abrupt("break",18);case 15:return S={type:"FILE",fileName:h.payload.payload.metadata.fileName,fileSize:h.payload.payload.metadata.fileSize,fileType:h.payload.payload.fileType.type,fileHash:Object(l.b)(h.payload.payload.metadata.fileHash),thumbnail:"OTHER"!==h.payload.payload.fileType.type?h.payload.payload.fileType.payload.thumbnail:null},t.abrupt("break",18);case 17:return t.abrupt("break",18);case 18:if(N=void 0,w=void 0,null===h.replyTo){t.next=30;break}t.t1=h.replyTo.payload.type,t.next="TEXT"===t.t1?24:"FILE"===t.t1?26:28;break;case 24:return w=h.replyTo.payload,t.abrupt("break",29);case 26:return w={type:"FILE",fileName:h.replyTo.payload.payload.metadata.fileName,fileSize:h.replyTo.payload.payload.metadata.fileSize,fileType:h.replyTo.payload.payload.fileType.type,fileHash:Object(l.b)(h.replyTo.payload.payload.metadata.fileHash),thumbnail:"OTHER"!==h.replyTo.payload.payload.fileType.type?h.replyTo.payload.payload.fileType.payload.thumbnail:null},t.abrupt("break",29);case 28:return t.abrupt("break",29);case 29:N={p2pMessageEntryHash:Object(l.b)(h.replyTo.hash),author:b[Object(l.b)(h.replyTo.author)],receiver:b[Object(l.b)(h.replyTo.receiver)],payload:w||h.replyTo.payload,timestamp:Object(p.e)(h.replyTo.timeSent),receipts:[]};case 30:I={p2pMessageEntryHash:Object(l.b)(g),author:b[Object(l.b)(h.author)],receiver:b[Object(l.b)(h.receiver)],payload:S,timestamp:Object(p.e)(h.timeSent),replyTo:N||void 0,receipts:[Object(l.b)(E)]},M={p2pMessageReceiptEntryHash:Object(l.b)(E),p2pMessageEntryHashes:[Object(l.b)(T.id[0])],timestamp:Object(p.e)(T.status.timestamp),status:T.status.status},n(Object(y.a)({message:I,receipt:M,key:I.author.id}));case 33:case"end":return t.stop()}}),t)})));return function(e,n,a){return t.apply(this,arguments)}}()},_=n(104),E=function(e){return function(){var t=Object(a.a)(c.a.mark((function t(n,a,r){var s,o,i;return c.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:r.callZome,s=Object.keys(e.receipt)[0],o=[],e.receipt[s].id.forEach((function(e){o.push(Object(l.b)(e))})),i={p2pMessageReceiptEntryHash:s,p2pMessageEntryHashes:o,timestamp:Object(p.e)(e.receipt[s].status.timestamp),status:e.receipt[s].status.status},n(Object(_.a)(i));case 6:case"end":return t.stop()}}),t)})));return function(e,n,a){return t.apply(this,arguments)}}()},T=n(30),S=function(e){return function(){var t=Object(a.a)(c.a.mark((function t(n,a,r){var s,o,i,u,d,p,b;return c.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:r.callZome,s=Object.keys(e.pin)[0],o=e.pin[s],i=o.status,u=o.conversants,d=a().p2pmessages.messages,p={},o.id.forEach((function(e){var t=Object(l.b)(e),n=d[t];p[t]=n})),b=a().profile.id,"pinned"===i.pinstatus?n({type:T.a,state:{conversant:Object(l.b)(u[0])===b?Object(l.b)(u[1]):Object(l.b)(u[0]),messages:p}}):n({type:T.h,state:{conversant:Object(l.b)(u[0])===b?Object(l.b)(u[1]):Object(l.b)(u[0]),messages:p}});case 10:case"end":return t.stop()}}),t)})));return function(e,n,a){return t.apply(this,arguments)}}()},N=n(35),w=n(43),I=function(e){return function(){var t=Object(a.a)(c.a.mark((function t(n,a){var r,s,i,u,d,p,b;return c.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(r=a().contacts.contacts,s=Object(l.b)(e.agent),!!!r[s]){t.next=9;break}return i=Object(o.a)({},a().p2pmessages.typing),u=r[s],!i[u.id]&&e.is_typing?i[u.id]=u:e.is_typing||(d=i,p=u.id,d[p],b=Object(N.a)(d,[p].map(w.a)),i=Object(o.a)({},b)),n({type:T.g,state:i}),t.abrupt("return",!0);case 9:case"end":return t.stop()}}),t)})));return function(e,n){return t.apply(this,arguments)}}()},M=n(105),k=function(e){return function(){var t=Object(a.a)(c.a.mark((function t(n,a,r){var s,u,d,p,j,m,f,O;return c.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:r.callZome,r.getAgentId,s=e.payload,u=Object(l.b)(s.groupHash),d=Object(l.b)(s.groupMessageHash),p=Object(o.a)({},{pinnedMessages:a().groups.pinnedMessages,message:a().groups.messages[d],conversations:a().groups.conversations}),j=p.conversations,m=p.pinnedMessages,f=p.message,O=j[u],m[d]=f,O.pinnedMessages?O.pinnedMessages.push(d):O.pinnedMessages=[d],n({type:b.l,conversations:Object(o.a)(Object(o.a)({},j),{},Object(i.a)({},u,O)),pinnedMessages:Object(o.a)(Object(o.a)({},a().groups.pinnedMessages),m)});case 9:case"end":return t.stop()}}),t)})));return function(e,n,a){return t.apply(this,arguments)}}()},R=function(e,t){return function(){var n=Object(a.a)(c.a.mark((function n(a){return c.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:n.t0=e,n.next=n.t0===s.b[s.c.GROUP].ADDED_TO_GROUP?3:n.t0===s.b[s.c.GROUP].GROUP_MESSAGE_DATA?5:n.t0===s.b[s.c.GROUP].GROUP_TYPING_DETAIL?7:n.t0===s.b[s.c.GROUP].GROUP_MESSAGE_READ?9:n.t0===s.b[s.c.GROUP].PIN_MESSAGE_DATA?11:n.t0===s.b[s.c.P2PMESSAGE].RECEIVE_P2P_MESSAGE?13:n.t0===s.b[s.c.P2PMESSAGE].RECEIVE_P2P_RECEIPT?15:n.t0===s.b[s.c.P2PMESSAGE].TYPING_P2P?17:n.t0===s.b[s.c.P2PMESSAGE].SYNC_P2P_PINS?19:n.t0===s.b[s.c.P2PMESSAGE].POST_COMMIT_ERROR_COMMIT_MESSAGE?21:23;break;case 3:return a(j(t)),n.abrupt("break",23);case 5:return a(O(t)),n.abrupt("break",23);case 7:return a(h(t)),n.abrupt("break",23);case 9:return a(g(t)),n.abrupt("break",23);case 11:return a(k(t)),n.abrupt("break",23);case 13:return a(x(t)),n.abrupt("break",23);case 15:return a(E(t)),n.abrupt("break",23);case 17:return a(I(t)),n.abrupt("break",23);case 19:return a(S(t)),n.abrupt("break",23);case 21:return a(Object(M.a)(t)),n.abrupt("break",23);case 23:case"end":return n.stop()}}),n)})));return function(e){return n.apply(this,arguments)}}()}},,,,,,,,,,,function(e,t,n){var a={"./ion-action-sheet.entry.js":[239,5],"./ion-alert.entry.js":[240,6],"./ion-app_8.entry.js":[241,7],"./ion-avatar_3.entry.js":[242,17],"./ion-back-button.entry.js":[243,18],"./ion-backdrop.entry.js":[244,43],"./ion-button_2.entry.js":[245,19],"./ion-card_5.entry.js":[246,20],"./ion-checkbox.entry.js":[247,21],"./ion-chip.entry.js":[248,22],"./ion-col_3.entry.js":[249,44],"./ion-datetime_3.entry.js":[250,10],"./ion-fab_3.entry.js":[251,23],"./ion-img.entry.js":[252,45],"./ion-infinite-scroll_2.entry.js":[253,46],"./ion-input.entry.js":[254,24],"./ion-item-option_3.entry.js":[255,25],"./ion-item_8.entry.js":[256,26],"./ion-loading.entry.js":[257,27],"./ion-menu_3.entry.js":[258,28],"./ion-modal.entry.js":[259,8],"./ion-nav_2.entry.js":[260,14],"./ion-popover.entry.js":[261,9],"./ion-progress-bar.entry.js":[262,29],"./ion-radio_2.entry.js":[263,30],"./ion-range.entry.js":[264,31],"./ion-refresher_2.entry.js":[265,11],"./ion-reorder_2.entry.js":[266,16],"./ion-ripple-effect.entry.js":[267,47],"./ion-route_4.entry.js":[268,32],"./ion-searchbar.entry.js":[269,33],"./ion-segment_2.entry.js":[270,34],"./ion-select_3.entry.js":[271,35],"./ion-slide_2.entry.js":[272,48],"./ion-spinner.entry.js":[273,13],"./ion-split-pane.entry.js":[274,49],"./ion-tab-bar_2.entry.js":[275,36],"./ion-tab_2.entry.js":[276,15],"./ion-text.entry.js":[277,37],"./ion-textarea.entry.js":[278,38],"./ion-toast.entry.js":[279,39],"./ion-toggle.entry.js":[280,12],"./ion-virtual-scroll.entry.js":[281,50]};function r(e){if(!n.o(a,e))return Promise.resolve().then((function(){var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}));var t=a[e],r=t[0];return n.e(t[1]).then((function(){return n(r)}))}r.keys=function(){return Object.keys(a)},r.id=197,e.exports=r},,function(e,t,n){var a={"./ion-icon.entry.js":[282,57]};function r(e){if(!n.o(a,e))return Promise.resolve().then((function(){var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}));var t=a[e],r=t[0];return n.e(t[1]).then((function(){return n(r)}))}r.keys=function(){return Object.keys(a)},r.id=199,e.exports=r},,,,,,,,,,,function(e,t,n){},,,,,,,,,,,,,,,,,,,,,,,,function(e,t,n){},function(e,t,n){"use strict";n.r(t);var a=n(2),r=n.n(a),c=n(66),s=n.n(c),o=n(1),i=(n(200),n(201),n(202),n(203),n(204),n(205),n(206),n(207),n(208),n(209),n(210),n(7)),u=n(9),l=n(157),d=n(13),p=n(3),b=n(155),j=n.n(b),m=n(0),f=function(e){return Object(m.jsx)("div",{className:j.a.spinner,children:Object(m.jsx)(o.U,Object(p.a)({},e))})},O=n(8),g=n(4),h=n.n(g),v=n(6),y=n(17),x=n(5),_=n(11),E=n(55),T=function(e,t){return function(){var n=Object(O.a)(h.a.mark((function n(a,r,c){var s,o,i,u;return h.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return s=c.callZome,c.getAgentId,n.prev=1,o=r().profile.id,i=t?{nickname:e,fields:{avatar:Object(v.b)(t)}}:{nickname:e,fields:{}},n.next=6,s({zomeName:x.c.PROFILES,fnName:x.a[x.c.PROFILES].CREATE_PROFILE,payload:i});case 6:return u=n.sent,a({type:E.a,id:o,nickname:u.profile.nickname,fields:t?{avatar:Object(y.a)(Object(v.b)(t))}:{}}),n.abrupt("return",u);case 11:n.prev=11,n.t0=n.catch(1),a(Object(_.a)("TOAST",{},{id:"redux.err.generic"}));case 14:case"end":return n.stop()}}),n,null,[[1,11]])})));return function(e,t,a){return n.apply(this,arguments)}}()},S=function(){return function(){var e=Object(O.a)(h.a.mark((function e(t,n,a){var r,c,s;return h.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=a.callZome,a.getAgentId,e.prev=1,e.next=4,r({zomeName:x.c.PROFILES,fnName:x.a[x.c.PROFILES].GET_MY_PROFILE});case 4:return c=e.sent,s=n().profile.id,c&&t({type:E.a,nickname:c.profile.nickname,id:s,fields:c.profile.fields.avatar?{avatar:Object(y.a)(c.profile.fields.avatar)}:{}}),e.abrupt("return",!0);case 10:e.prev=10,e.t0=e.catch(1);case 12:return e.abrupt("return",!1);case 13:case"end":return e.stop()}}),e,null,[[1,10]])})));return function(t,n,a){return e.apply(this,arguments)}}()},N=function(e){return function(){var t=Object(O.a)(h.a.mark((function t(n,a,r){var c,s,o,i,u,l;return h.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return c=r.callZome,s=a(),o=Object(p.a)({},s.contacts.contacts),i=s.profile.id,t.prev=4,t.next=7,c({zomeName:x.c.PROFILES,fnName:x.a[x.c.PROFILES].SEARCH_PROFILES,payload:{nicknamePrefix:e}});case 7:return u=t.sent,l=u.filter((function(e){return!Object.keys(o).includes(e.agentPubKey)&&e.agentPubKey!==i})).map((function(e){return{id:e.agentPubKey,username:e.profile.nickname,fields:e.profile.fields.avatar?{avatar:Object(y.a)(e.profile.fields.avatar)}:{}}})),t.abrupt("return",l);case 12:t.prev=12,t.t0=t.catch(4);case 14:return t.abrupt("return",!1);case 15:case"end":return t.stop()}}),t,null,[[4,12]])})));return function(e,n,a){return t.apply(this,arguments)}}()},w=function(){return function(){var e=Object(O.a)(h.a.mark((function e(t,n,a){var r,c,s;return h.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=a.client,c=a.init,!r){e.next=5;break}e.t0=r,e.next=8;break;case 5:return e.next=7,c();case 7:e.t0=e.sent;case 8:return s=e.t0,e.next=11,s.connection.connection.signOut();case 11:window.location.reload();case 12:case"end":return e.stop()}}),e)})));return function(t,n,a){return e.apply(this,arguments)}}()},I=function(){return Object(d.b)()},M=n(12),k=n(112),R=n.n(k),P=function(){var e=Object(M.f)(),t=Object(d.c)((function(e){return Object(p.a)({},e.profile)})),n=t.username,r=t.id,c=t.fields,s=Object(l.a)(),i=I(),b=Object(a.useRef)(null),j=[{onClick:function(){e.push("/settings")},label:s.formatMessage({id:"app.menu.settings-label"}),icon:u.w},{onClick:function(){e.push("/blocked")},label:s.formatMessage({id:"app.menu.blocked-label"}),icon:u.h},{onClick:function(){return window.open("https://github.com/hc-institute-japan/kizuna/issues/new?assignees=&labels=bug&template=bug_report.md&title=")},label:s.formatMessage({id:"app.menu.report-label"}),icon:u.fb},{onClick:function(){i(w())},label:s.formatMessage({id:"app.menu.logout-label"}),icon:u.I,disabled:"HCC"!==Object({NODE_ENV:"production",PUBLIC_URL:"",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,FAST_REFRESH:!0,REACT_APP_ENV:"HOLO",REACT_APP_DNA_INTERFACE_URL:"ws://127.0.0.1:8888/"}).REACT_APP_ENVENV&&"HOLO"!==Object({NODE_ENV:"production",PUBLIC_URL:"",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,FAST_REFRESH:!0,REACT_APP_ENV:"HOLO",REACT_APP_DNA_INTERFACE_URL:"ws://127.0.0.1:8888/"}).REACT_APP_ENVENV}],f=function(){var t;null===b||void 0===b||null===(t=b.current)||void 0===t||t.close(),e.push({pathname:"/p/".concat(r),state:{profile:{username:n,id:r,fields:c},prev:"/home"}})};return Object(m.jsxs)(o.D,{ref:b,contentId:"main",type:"overlay",children:[Object(m.jsx)(o.k,{className:"".concat(R.a.menu," ion-padding-top"),children:Object(m.jsxs)(o.A,{id:"inbox-list",lines:"none",children:[Object(m.jsxs)(o.y,{className:"ion-no-margin",children:[Object(m.jsx)("div",{onClick:f,className:"".concat(R.a.container," ion-padding"),children:c.avatar?Object(m.jsx)(o.b,{children:Object(m.jsx)("img",{src:c.avatar,alt:"avatar"})}):Object(m.jsx)(o.b,{children:Object(m.jsx)("img",{src:"assets/icon/person-circle-outline.png",alt:"avatar"})})}),Object(m.jsx)(o.w,{onClick:f,lines:"none",children:Object(m.jsx)(o.z,{children:n})})]}),j.map((function(e){var t=e.onClick,n=e.label,a=e.icon,r=e.disabled,c=void 0!==r&&r;return Object(m.jsxs)(o.w,{onClick:function(e){function t(){return e.apply(this,arguments)}return t.toString=function(){return e.toString()},t}((function(){var e;null===b||void 0===b||null===(e=b.current)||void 0===e||e.close(),t()})),disabled:c,children:[Object(m.jsx)(o.r,{className:"ion-margin-end",icon:a}),Object(m.jsx)(o.z,{children:n})]},n)}))]})}),Object(m.jsx)(o.o,{className:"ion-no-border",children:Object(m.jsx)(o.fb,{children:Object(m.jsxs)(o.Z,{className:"ion-padding ".concat(R.a.version),children:[s.formatMessage({id:"app.menu.version"})," 0.2.4"]})})})]})},A=n(10),C=n(16),G=n(33),L=n(26),D=function(e){return{messagesByGroup:Object(y.f)(e.messagesByGroup,(function(e){return e.map((function(e){return Object(v.b)(e)}))})),groupMessagesContents:Object(y.f)(e.groupMessagesContents,(function(e){var t=Object(y.f)(e.readList,(function(e){return Object(C.e)(e)}));return{groupMessageId:Object(v.b)(e.groupMessageElement.signedHeader.hashed.content.entry_hash),groupId:Object(v.b)(e.groupMessageElement.entry.groupHash),author:Object(v.b)(e.groupMessageElement.entry.sender),payload:H(e.groupMessageElement.entry.payload),timestamp:Object(C.e)(e.groupMessageElement.entry.created),replyTo:e.groupMessageElement.entry.replyTo?{groupId:Object(v.b)(e.groupMessageElement.entry.replyTo.content.groupHash),author:Object(v.b)(e.groupMessageElement.entry.replyTo.content.sender),payload:H(e.groupMessageElement.entry.replyTo.content.payload),timestamp:Object(C.e)(e.groupMessageElement.entry.replyTo.content.created),replyTo:e.groupMessageElement.entry.replyTo?Object(v.b)(e.groupMessageElement.entry.replyTo):void 0,readList:{}}:void 0,readList:t}}))}},H=function(e){return Object(L.d)(e)?e:Object(L.b)(e.payload.fileType)?{type:"FILE",fileName:e.payload.metadata.fileName,fileSize:e.payload.metadata.fileSize,fileType:e.payload.metadata.fileType,fileHash:Object(v.b)(e.payload.metadata.fileHash)}:{type:"FILE",fileName:e.payload.metadata.fileName,fileSize:e.payload.metadata.fileSize,fileType:e.payload.metadata.fileType,fileHash:Object(v.b)(e.payload.metadata.fileHash),thumbnail:e.payload.fileType.payload.thumbnail}},U=function(){var e=Object(O.a)(h.a.mark((function e(t,n,a,r){var c,s,o,i,u;return h.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(c=t.contacts.contacts,s=t.profile,o=[],i={},n.forEach((function(e){c[e]?i[e]=c[e]:e===r?i[r]={id:r,username:s.username,fields:s.fields}:o.push(Object(y.c)(e))})),null===o||void 0===o||!o.length){e.next=11;break}return u=o.map((function(e){return Object(v.b)(e)})),e.next=9,a({zomeName:x.c.PROFILES,fnName:x.a[x.c.PROFILES].GET_AGENTS_PROFILES,payload:u});case 9:e.sent.forEach((function(e){var t=e.agentPubKey;i[t]={id:t,username:e.profile.nickname,fields:e.profile.fields.avatar?{avatar:e.profile.fields.avatar}:{}}}));case 11:return e.abrupt("return",i);case 12:case"end":return e.stop()}}),e)})));return function(t,n,a,r){return e.apply(this,arguments)}}(),z=n(15),F=n(67),B=n(103),Z=n(68),V=n(96),Y=n.n(V),X=function(e){var t=e.nickname,n=e.id,a=e.charToShow,r=(e.avatar,e.displayId),c=void 0===r||r,s=e.displayAvatar,i=void 0!==s&&s,u=e.displayNickname,l=void 0===u||u,d=e.noSpace,p=void 0!==d&&d,b=n.slice(5);return Object(m.jsxs)("div",{className:p?Y.a[""]:Y.a.container,children:[i?Object(m.jsx)("div",{className:Y.a.avatar,children:Object(m.jsx)(o.b,{children:Object(m.jsx)("img",{src:"assets/icon/person-circle-outline.png",alt:"avatar"})})}):null,l?t:null,c?function(e,t){return Object(m.jsx)("span",{className:Y.a.label,children:t?e.slice(0,t).concat("..."):e})}(b,a):null]})},K=function(e){var t=e.contact,n=e.displayMsgBtn,a=void 0!==n&&n,r=Object(M.f)();return Object(m.jsxs)(o.w,{children:[Object(m.jsx)(X,{displayAvatar:!0,avatar:t.fields.avatar,nickname:t.username,id:t.id}),Object(m.jsxs)(o.f,{slot:"end",children:[a?Object(m.jsx)(o.e,{onClick:function(){r.push({pathname:"/u/".concat(t.id),state:{username:t.username}})},children:Object(m.jsx)(o.r,{icon:u.l})}):null,Object(m.jsx)(o.e,{onClick:function(){return r.push({pathname:"/p/".concat(t.id),state:{profile:t}})},children:Object(m.jsx)(o.r,{icon:u.H})})]})]},JSON.stringify(t))},q=function(e){var t=e.char,n=e.contacts,a=e.displayMsgBtn,c=void 0!==a&&a;return Object(m.jsxs)(r.a.Fragment,{children:[Object(m.jsx)(o.x,{children:Object(m.jsx)(o.z,{children:t})}),n.map((function(e){return Object(m.jsx)(K,{displayMsgBtn:c,contact:e},JSON.stringify(e))}))]},t)},W=n(158),J=n.n(W),Q=function(e){var t=e.contacts,n=e.displayMsgBtn,a=void 0!==n&&n;return Object(m.jsx)(o.A,{className:J.a["contacts-list"],children:Object.keys(t).map((function(e){var n=t[e];return Object(m.jsx)(q,{displayMsgBtn:a,char:e,contacts:n},e)}))})},$=n(159),ee=n.n($),te=function(){var e=Object(l.a)();return Object(m.jsxs)("div",{className:ee.a["empty-contacts"],children:[Object(m.jsx)(o.r,{icon:u.F}),Object(m.jsx)(o.Z,{className:"ion-padding ion-margin-bottom",children:e.formatMessage({id:"app.blocked.empty-blocked-list"})})]})},ne=function(){var e=Object(M.f)(),t=Object(d.c)((function(e){return Object.values(e.contacts.blocked)})),n=Object(y.d)(Object.values(t));return Object(m.jsxs)(o.H,{children:[Object(m.jsx)(o.q,{children:Object(m.jsx)(o.fb,{children:Object(m.jsx)(o.f,{slot:"start",children:Object(m.jsx)(o.e,{onClick:function(){return e.push({pathname:"/home"})},className:"ion-no-padding",children:Object(m.jsx)(o.r,{slot:"icon-only",icon:u.e})})})})}),Object(m.jsx)(o.k,{children:0!==Object.values(t).length?Object(m.jsx)(Q,{contacts:n||{}}):Object(m.jsx)(te,{})})]})},ae=n(18),re=n(160),ce=n.n(re),se=function(e,t){var n=e.children,c=e.type,s=void 0===c?"p2p":c,i=e.onScrollTop,u=e.disabled,d=e.onScrollBottom,p=r.a.Children.toArray(n),b=Object(l.a)(),j=Object(a.useRef)(null),f=Object(a.useRef)(null),O=Object(a.useRef)(null),g=r.a.Children.map(p,(function(e,t){if(r.a.isValidElement(e)){var n=function(e,t,n){var a,r,c,o=!1,i=!1,u=!1,l=0===n,d=0!==(null===(a=Object.values(null===(r=t[n])||void 0===r||null===(c=r.props)||void 0===c?void 0:c.readList))||void 0===a?void 0:a.length);0===n&&(o=!0);var p=t[n-1],b=null===e||void 0===e?void 0:e.props,j=null===p||void 0===p?void 0:p.props;(null===b||void 0===b?void 0:b.profile.id)!==(null===j||void 0===j?void 0:j.profile.id)&&(o=!0,i=!0);var m=null===b||void 0===b?void 0:b.timestamp,f=null===j||void 0===j?void 0:j.timestamp;return m&&f&&(l=!(m.getDate()===f.getDate()&&m.getMonth()===f.getMonth()&&m.getFullYear()===f.getFullYear()))&&(o=!0),"group"===s&&(u=o),{showProfilePicture:o,space:i,showName:u,showDate:l,hasRead:d}}(e,p,t),c=n.showProfilePicture,i=n.showName,u=n.showDate,l=n.hasRead;return Object(m.jsxs)(a.Fragment,{children:[u?Object(m.jsx)(o.Z,{className:"ion-text-center",children:e.props.timestamp.toDateString()===(new Date).toDateString()?b.formatMessage({id:"components.chat.chat-list.today"}):b.formatDate(e.props.timestamp,{year:"numeric",month:"numeric",day:"numeric"})}):null,r.a.cloneElement(e,{isSeen:l,type:s,showProfilePicture:c,showName:i})]},t)}return e}));Object(a.useEffect)((function(){j.current&&setTimeout((function(){var e;null===(e=j.current)||void 0===e||e.scrollIntoView({behavior:"smooth"})}),500)}),[j]);var h=function(){var e;return null===(e=f.current)||void 0===e?void 0:e.complete()},v=function(){var e;return null===(e=O.current)||void 0===e?void 0:e.complete()};Object(a.useImperativeHandle)(t,(function(){return{scrollToBottom:function(){setTimeout((function(){var e;return null===(e=j.current)||void 0===e?void 0:e.scrollIntoView({behavior:"smooth"})}),500)}}}));var y=Object(a.useRef)(null);return Object(a.useEffect)((function(){setTimeout((function(){y.current&&y.current.getBoundingClientRect().height<=y.current.parentNode.getBoundingClientRect().height&&i&&i(h,{})}),500)}),[n]),Object(m.jsxs)(o.A,{ref:y,className:"".concat(ce.a.chat," chat-list"),children:[i?Object(m.jsx)(o.t,{disabled:!!u,threshold:"0",ref:f,position:"top",onIonInfinite:function(e){return setTimeout((function(){return i(h,e)}),1e3)},children:Object(m.jsx)(o.u,{loadingSpinner:"crescent"})}):null,g,Object(m.jsx)("div",{ref:j}),d?Object(m.jsx)(o.t,{disabled:!!u,threshold:"0px",ref:O,position:"bottom",onIonInfinite:function(e){return setTimeout((function(){return d(v,e)}),1e3)},children:Object(m.jsx)(o.u,{loadingSpinner:"crescent"})}):null]})},oe=Object(a.forwardRef)(se),ie=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r=n.shouldPreventDefault,c=void 0===r||r,s=n.delay,o=void 0===s?300:s,u=Object(a.useState)(!1),l=Object(i.a)(u,2),d=l[0],p=l[1],b=Object(a.useRef)(),j=Object(a.useRef)(),m=Object(a.useCallback)((function(t){c&&t.target&&(t.target.addEventListener("touchend",ue,{passive:!1}),j.current=t.target),t.persist(),b.current=setTimeout((function(){e(t),p(!0)}),o)}),[e,o,c]),f=Object(a.useCallback)((function(e){var n=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];b.current&&clearTimeout(b.current),n&&!d&&t(e),p(!1),c&&j.current&&j.current.removeEventListener("touchend",ue)}),[c,t,d]);return{onMouseDown:function(e){return m(e)},onTouchStart:function(e){return m(e)},onMouseUp:function(e){return f(e)},onMouseLeave:function(e){return f(e,!1)},onTouchEnd:function(e){return f(e)}}},ue=function(e){(function(e){return"touches"in e})(e)&&e.touches.length<2&&e.preventDefault&&e.preventDefault()},le=n(113),de=n.n(le),pe=function(e){var t=e.onPin,n=e.onReply,a=e.onDelete,r=e.isPinned,c=e.isText,s=e.intl,i=e.onRetry,l=e.onHide,d=e.onCopy;return e.err?Object(m.jsxs)(o.A,{children:[Object(m.jsxs)(o.w,{button:!0,lines:"none",onClick:function(){i(),l()},children:[Object(m.jsx)(o.z,{children:s.formatMessage({id:"components.chat.chat-modal-resend"})}),Object(m.jsx)(o.r,{icon:u.E,className:de.a.icon})]}),Object(m.jsxs)(o.w,{onClick:function(){a(),l()},button:!0,lines:"none",children:[Object(m.jsx)(o.z,{children:s.formatMessage({id:"components.chat.chat-modal-delete"})}),Object(m.jsx)(o.r,{icon:u.u,slot:"end"})]})]}):Object(m.jsxs)(o.A,{children:[Object(m.jsxs)(o.w,{button:!0,lines:"none",onClick:function(){n(),l()},children:[Object(m.jsx)(o.z,{children:s.formatMessage({id:"components.chat.chat-modal-reply"})}),Object(m.jsx)(o.r,{icon:u.f,className:de.a.icon})]}),Object(m.jsxs)(o.w,{onClick:function(){t(),l()},button:!0,lines:"none",children:[Object(m.jsx)(o.z,{children:r?s.formatMessage({id:"components.chat.chat-modal-unpin"}):s.formatMessage({id:"components.chat.chat-modal-pin"})}),Object(m.jsx)(o.r,{icon:u.T,slot:"end"})]}),c?Object(m.jsxs)(o.w,{button:!0,lines:"none",onClick:function(){d(),l()},children:[Object(m.jsx)(o.z,{children:s.formatMessage({id:"components.chat.chat-modal-copy"})}),Object(m.jsx)(o.r,{icon:u.x,className:de.a.icon})]}):null]})},be=function(e){return function(){var t=Object(O.a)(h.a.mark((function t(n,a,r){var c,s,o,i,u,l,d,b,j,m,f,O;return h.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return c=r.callZome,r.getAgentId,s=a(),o=a().profile.id,i={members:e.members.filter((function(t,n){return e.members.indexOf(t)===n})).map((function(e){return Object(y.c)(e)})),groupId:Object(v.a)(e.groupId),groupRevisionId:Object(v.a)(e.groupRevisionId)},t.prev=4,t.next=7,c({zomeName:x.c.GROUP,fnName:x.a[x.c.GROUP].ADD_MEMBERS,payload:i});case 7:return u=t.sent,l=u.members.map((function(e){return Object(v.b)(e)})),d={members:l,groupId:Object(v.b)(u.groupId),groupRevisionId:Object(v.b)(u.groupRevisionId)},t.next=12,U(s,l,c,o);case 12:return b=t.sent,j=d.groupId,(m=s.groups.conversations[j]).members=m.members.concat(d.members),f=s.groups.conversations,f=Object(p.a)(Object(p.a)({},f),{},Object(A.a)({},j,m)),O=s.groups.members,O=Object(p.a)(Object(p.a)({},O),b),n({type:z.b,conversations:f,members:O}),t.abrupt("return",e);case 24:t.prev=24,t.t0=t.catch(4),t.t1=!0,t.next=t.t1===t.t0.message.includes("members field is empty")?29:t.t1===t.t0.message.includes("cannot create group with blocked agents")?31:t.t1===t.t0.message.includes("failed to get the given group id")?33:t.t1===t.t0.message.includes("cannot update a group entry if you are not the group creator (admin)")?35:t.t1===t.t0.message.includes("creator AgentPubKey cannot be included in the group members list")?37:39;break;case 29:return n(Object(_.a)("TOAST",{},{id:"redux.err.group.add-members.1"})),t.abrupt("return",!1);case 31:return n(Object(_.a)("TOAST",{},{id:"redux.err.group.add-members.2"})),t.abrupt("return",!1);case 33:return n(Object(_.a)("TOAST",{},{id:"redux.err.group.add-members.3"})),t.abrupt("return",!1);case 35:return n(Object(_.a)("TOAST",{},{id:"redux.err.group.add-members.4"})),t.abrupt("return",!1);case 37:return n(Object(_.a)("TOAST",{},{id:"redux.err.group.add-members.5"})),t.abrupt("return",!1);case 39:return n(Object(_.a)("TOAST",{},{id:"redux.err.generic"})),t.abrupt("return",!1);case 41:case"end":return t.stop()}}),t,null,[[4,24]])})));return function(e,n,a){return t.apply(this,arguments)}}()},je=function(e){return function(){var t=Object(O.a)(h.a.mark((function t(n,a,r){var c,s,o,i,u,l,d,b,j,m,f,O;return h.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return c=r.callZome,r.getAgentId,s=a(),o=a().profile.id,i={name:e.name,members:e.members.map((function(e){return Object(y.c)(e)}))},t.prev=4,t.next=7,c({zomeName:x.c.GROUP,fnName:x.a[x.c.GROUP].CREATE_GROUP,payload:i});case 7:return u=t.sent,l={originalGroupId:Object(v.b)(u.groupId),originalGroupRevisionId:Object(v.b)(u.groupRevisionId),name:u.content.name,members:u.content.members.map((function(e){return Object(v.b)(e)})),createdAt:u.content.created,creator:Object(v.b)(u.content.creator),messages:[],pinnedMessages:[],avatar:null},d=[].concat(Object(ae.a)(l.members),[l.creator]),t.next=12,U(s,d,c,o);case 12:return b=t.sent,j=l.originalGroupId,m=Object(A.a)({},j,l),f=s.groups.conversations,f=Object(p.a)(Object(p.a)({},f),m),O=s.groups.members,O=Object(p.a)(Object(p.a)({},O),b),n({type:z.a,conversations:f,members:O}),t.abrupt("return",l);case 23:throw t.prev=23,t.t0=t.catch(4),t.t0;case 26:case"end":return t.stop()}}),t,null,[[4,23]])})));return function(e,n,a){return t.apply(this,arguments)}}()},me=function(e){return function(t,n){var a=n(),r=a.profile.id,c=a.groups.conversations[e],s=a.groups.messages;return c.messages.filter((function(e){return s[e].author!==r})).map((function(e){return s[e].readList})).filter((function(e){return void 0===e[r]})).length}},fe=function(e){return function(){var t=Object(O.a)(h.a.mark((function t(n,a,r){var c,s,o,i,u,l,d,b,j,m,f,O,g,y;return h.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return c=r.callZome,r.getAgentId,s=a().profile.id,o=a(),t.prev=3,t.next=6,c({zomeName:x.c.GROUP,fnName:x.a[x.c.GROUP].GET_GROUP_LATEST_VERSION,payload:Object(v.a)(e)});case 6:return i=t.sent,u={groupId:Object(v.a)(e),batchSize:10,payloadType:{type:"ALL",payload:null}},t.next=10,c({zomeName:x.c.GROUP,fnName:x.a[x.c.GROUP].GET_PREVIOUS_GROUP_MESSAGES,payload:u});case 10:return l=t.sent,t.next=13,c({zomeName:x.c.GROUP,fnName:x.a[x.c.GROUP].FETCH_PINNED_MESSAGES,payload:e});case 13:return d=t.sent,b=D(l),j={originalGroupId:Object(v.b)(i.groupId),originalGroupRevisionId:Object(v.b)(i.groupRevisionId),name:i.latestName,members:i.members.map((function(e){return Object(v.b)(e)})),createdAt:Object(C.e)(i.created),creator:Object(v.b)(i.creator),messages:b.messagesByGroup[Object(v.b)(i.groupId)],pinnedMessages:Object.values(d).map((function(e){return Object(v.b)(e.entry.messageId)})),avatar:i.avatar},t.next=18,U(a(),j.members,c,s);case 18:return m=t.sent,f=o.groups.conversations,f=Object(p.a)(Object(p.a)({},f),{},Object(A.a)({},j.originalGroupId,j)),O=o.groups.messages,O=Object(p.a)(Object(p.a)({},O),b.groupMessagesContents),g=o.groups.members,Object.keys(m).forEach((function(e){g[e]=m[e]})),n({type:z.k,conversations:f,messages:O,members:g}),t.abrupt("return",j);case 29:if(t.prev=29,t.t0=t.catch(3),null===t.t0||void 0===t.t0||null===(y=t.t0.message)||void 0===y||!y.includes("failed to get the given group id")){t.next=35;break}return t.abrupt("return",n(Object(_.a)("TOAST",{},{id:"redux.err.group.get-latest-group-version.1"})));case 35:return t.abrupt("return",n(Object(_.a)("TOAST",{},{id:"redux.err.generic"})));case 36:case"end":return t.stop()}}),t,null,[[3,29]])})));return function(e,n,a){return t.apply(this,arguments)}}()},Oe=function(e){return function(){var t=Object(O.a)(h.a.mark((function t(n,a,r){var c,s,o,i,u,l,d,b,j,m;return h.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return c=r.callZome,s=a(),o={groupId:Object(v.a)(e.groupId),lastFetched:e.lastFetched?Object(v.a)(e.lastFetched):void 0,lastMessageTimestamp:e.lastMessageTimestamp?Object(C.b)(e.lastMessageTimestamp):void 0,batchSize:e.batchSize,payloadType:e.payloadType},t.prev=3,t.next=6,c({zomeName:x.c.GROUP,fnName:x.a[x.c.GROUP].GET_PREVIOUS_GROUP_MESSAGES,payload:o});case 6:return i=t.sent,u=D(i),l=s.groups.conversations,(d=l[e.groupId])&&(b=d.messages?Array.from(new Set(d.messages.concat(u.messagesByGroup[e.groupId]))):u.messagesByGroup[e.groupId],l=Object(p.a)(Object(p.a)({},l),{},Object(A.a)({},e.groupId,d)),j=s.groups.messages,j=Object(p.a)(Object(p.a)({},j),u.groupMessagesContents),m=Object(p.a)(Object(p.a)({},l),{},Object(A.a)({},e.groupId,Object(p.a)(Object(p.a)({},d),{},{messages:b}))),n({type:z.h,conversations:m,messages:j})),t.abrupt("return",u);case 14:return t.prev=14,t.t0=t.catch(3),t.abrupt("return",n(Object(_.a)("TOAST",{},{id:"redux.err.generic"})));case 17:case"end":return t.stop()}}),t,null,[[3,14]])})));return function(e,n,a){return t.apply(this,arguments)}}()},ge=function(e){return function(){var t=Object(O.a)(h.a.mark((function t(n,a,r){var c,s,o,i,u,l,d,b,j,m;return h.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return c=r.callZome,s=a(),o={groupId:Object(v.a)(e.groupId),date:Object(C.b)(e.date),payloadType:e.payloadType},t.next=5,c({zomeName:x.c.GROUP,fnName:x.a[x.c.GROUP].GET_MESSAGES_BY_GROUP_BY_TIMESTAMP,payload:o});case 5:return i=t.sent,u=D(i),l=s.groups.conversations,(d=l[e.groupId])&&(b=d.messages?Array.from(new Set(d.messages.concat(u.messagesByGroup[e.groupId]))):l[e.groupId].messages,l=Object(p.a)(Object(p.a)({},l),{},Object(A.a)({},e.groupId,d)),j=s.groups.messages,j=Object(p.a)(Object(p.a)({},j),u.groupMessagesContents),m=Object(p.a)(Object(p.a)({},l),{},Object(A.a)({},e.groupId,Object(p.a)(Object(p.a)({},d),{},{messages:b}))),n({type:z.h,conversations:m,messages:j})),t.abrupt("return",u);case 11:case"end":return t.stop()}}),t)})));return function(e,n,a){return t.apply(this,arguments)}}()},he=function(e,t){return function(n,a){var r=a().groups,c=r.messages,s=r.members,o=r.errMsgs,i=a().profile,u=e.map((function(e){var t=c[e],n=s[t.author];return Object(p.a)(Object(p.a)({},t),{},{author:n||{username:i.username,id:t.author,fields:i.fields}})}));return console.log("these are the group messages",u),o[t]&&(u=u.concat(o[t])),u.sort((function(e,t){return e.timestamp.getTime()-t.timestamp.getTime()})),u}},ve=function(e){return function(t,n,a){var r=a.callZome,c={groupId:Object(v.a)(e.groupId),indicatedBy:Object(y.c)(e.indicatedBy),members:e.members.map((function(e){return Object(y.c)(e)})),isTyping:e.isTyping};return r({zomeName:x.c.GROUP,fnName:x.a[x.c.GROUP].INDICATE_GROUP_TYPING,payload:c}),null}},ye=function(e){return function(){var t=Object(O.a)(h.a.mark((function t(n,a,r){var c,s;return h.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return c=r.callZome,s={groupId:Object(v.a)(e.groupId),messageIds:e.messageIds.map((function(e){return Object(v.a)(e)})),reader:e.reader,timestamp:Object(C.b)(e.timestamp),members:e.members},t.prev=2,t.next=5,c({zomeName:x.c.GROUP,fnName:x.a[x.c.GROUP].READ_GROUP_MESSAGE,payload:s});case 5:t.next=9;break;case 7:t.prev=7,t.t0=t.catch(2);case 9:return t.abrupt("return",null);case 10:case"end":return t.stop()}}),t,null,[[2,7]])})));return function(e,n,a){return t.apply(this,arguments)}}()},xe=n(35),_e=n(43),Ee=function(e){return function(){var t=Object(O.a)(h.a.mark((function t(n,a,r){var c,s,o,i,u,l,d,b,j,m,f;return h.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return c=r.callZome,s={members:e.members.map((function(e){return Object(y.c)(e)})),groupId:Object(v.a)(e.groupId),groupRevisionId:Object(v.a)(e.groupRevisionId)},o=a(),t.prev=3,t.next=6,c({zomeName:x.c.GROUP,fnName:x.a[x.c.GROUP].REMOVE_MEMBERS,payload:s});case 6:return i=t.sent,u={members:i.members.map((function(e){return Object(v.b)(e)})),groupId:Object(v.b)(i.groupId),groupRevisionId:Object(v.b)(i.groupRevisionId)},l=u.groupId,d=u.members,(b=o.groups.conversations[l]).members=b.members.filter((function(e){return!d.includes(e)})),j=o.groups.conversations,j=Object(p.a)(Object(p.a)({},j),{},Object(A.a)({},l,b)),m=o.groups.members,f=Object.assign({},m),d.forEach((function(e){var t=f,n=(t[e],Object(xe.a)(t,[e].map(_e.a)));f=Object(p.a)({},n)})),n({type:z.c,conversations:j,members:m}),t.abrupt("return",e);case 21:t.prev=21,t.t0=t.catch(3),t.t1=!0,t.next=t.t1===t.t0.message.includes("members field is empty")?26:t.t1===t.t0.message.includes("failed to get the given group id")?28:t.t1===t.t0.message.includes("groups cannot be created with less than 3 members")?30:t.t1===t.t0.message.includes("cannot update a group entry if you are not the group creator (admin)")?32:34;break;case 26:return n(Object(_.a)("TOAST",{},{id:"redux.err.group.remove-members.1"})),t.abrupt("return",!1);case 28:return n(Object(_.a)("TOAST",{},{id:"redux.err.group.remove-members.2"})),t.abrupt("return",!1);case 30:return n(Object(_.a)("TOAST",{},{id:"redux.err.group.remove-members.3"})),t.abrupt("return",!1);case 32:return n(Object(_.a)("TOAST",{},{id:"redux.err.group.remove-members.4"})),t.abrupt("return",!1);case 34:return n(Object(_.a)("TOAST",{},{id:"redux.err.generic"})),t.abrupt("return",!1);case 36:case"end":return t.stop()}}),t,null,[[3,21]])})));return function(e,n,a){return t.apply(this,arguments)}}()},Te=function(){var e=Object(O.a)(h.a.mark((function e(t,n,a,r,c){var s,o,i,u,l,d,b,j,m,f,O,g,y,_,E,T,S;return h.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!Object(L.d)(n.payloadInput)){e.next=4;break}s=t.content.payload,e.next=14;break;case 4:if(i=t.content.payload.payload.fileType,u=Object(L.b)(i)?void 0:Object(L.a)(i)||Object(L.e)(i)?i.payload.thumbnail:void 0,o=n.payloadInput.payload.fileBytes,"VIDEO"!==i.type){e.next=12;break}return e.next=10,a({zomeName:x.c.GROUP,fnName:x.a[x.c.GROUP].GET_FILES_BYTES,payload:[t.content.payload.payload.metadata.fileHash]});case 10:"error"!==(null===(l=e.sent)||void 0===l?void 0:l.type)&&c(Re(Object(p.a)({},l)));case 12:d={type:"FILE",fileName:t.content.payload.payload.metadata.fileName,fileSize:t.content.payload.payload.metadata.fileSize,fileType:t.content.payload.payload.metadata.fileType,fileHash:Object(v.b)(t.content.payload.payload.metadata.fileHash),thumbnail:u},s=d;case 14:return b=t.content.replyTo?r().groups.messages[Object(v.b)(t.content.replyTo)]:null,j={groupMessageId:Object(v.b)(t.id),groupId:Object(v.b)(t.content.groupHash),author:Object(v.b)(t.content.sender),payload:s,timestamp:Object(C.e)(t.content.created),replyTo:b?{groupId:b.groupId,author:b.author,payload:b.payload,timestamp:b.timestamp,replyTo:void 0,readList:{}}:void 0,readList:{}},m=j.groupId,f=j.groupMessageId,O=r().groups.conversations[m],g=[j.groupMessageId].concat(Object(ae.a)(O.messages)),y=Object(A.a)({},f,j),_=r().groups.messages,_=Object(p.a)(Object(p.a)({},_),y),E=r().groups.groupFiles,Object(L.d)(j.payload)||(T=Object(A.a)({},j.payload.fileHash,o),E=Object(p.a)(Object(p.a)({},E),T)),S=Object(p.a)(Object(p.a)({},r().groups.conversations),{},Object(A.a)({},m,Object(p.a)(Object(p.a)({},O),{},{messages:g}))),c({type:z.g,conversations:S,messages:_,groupFiles:E}),e.abrupt("return",j);case 28:case"end":return e.stop()}}),e)})));return function(t,n,a,r,c){return e.apply(this,arguments)}}(),Se=function(e,t,n){switch(!0){case e.message.includes("failed to get the given group id"):t(Object(_.a)("TOAST",{},{id:"redux.err.group.send-group-message.1",value:{payload:Object(L.d)(n.payloadInput)?n.payloadInput.payload:n.payloadInput.payload.metadata.fileName}}));break;case e.message.includes("failed to get the replied message from DHT"):t(Object(_.a)("TOAST",{},{id:"redux.err.group.send-group-message.2"}))}},Ne=function(e){return function(){var t=Object(O.a)(h.a.mark((function t(n,a,r){var c,s,o,i,u,l;return h.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return c=r.callZome,s=r.retry,Object(L.d)(e.payloadInput)&&(o=e.payloadInput.payload.payload,e.payloadInput.payload={payload:o.trim()}),i={groupHash:Object(v.a)(e.groupId),payloadInput:e.payloadInput,sender:Object(v.a)(e.sender),replyTo:e.replyTo?Object(v.a)(e.replyTo):void 0},t.prev=3,t.next=6,c({zomeName:x.c.GROUP,fnName:x.a[x.c.GROUP].SEND_MESSAGE,payload:i});case 6:return u=t.sent,t.next=9,Te(u,e,c,a,n);case 9:case 19:return t.abrupt("return",t.sent);case 12:if(t.prev=12,t.t0=t.catch(3),t.prev=14,t.t0.message.includes("Timed out")){t.next=22;break}return l=s({zomeName:x.c.GROUP,fnName:x.a[x.c.GROUP].SEND_MESSAGE,payload:i}),t.next=19,Te(l,e,c,a,n);case 22:return t.abrupt("return",n(Object(_.a)("TOAST",{},{id:"redux.err.conductor-time-out"})));case 23:t.next=29;break;case 25:return t.prev=25,t.t1=t.catch(14),Se(t.t1,n,e),t.abrupt("return",!1);case 29:case"end":return t.stop()}}),t,null,[[3,12],[14,25]])})));return function(e,n,a){return t.apply(this,arguments)}}()},we=function(e){return function(){var t=Object(O.a)(h.a.mark((function t(n,a){var r,c,s,o,i,u,l,d,b,j;return h.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:r=a().profile,c=r.id,s=r.username,o=r.fields,i=a().groups,u=Object(L.d)(e.payloadInput)?{type:"TEXT",payload:{payload:e.payloadInput.payload.payload}}:{type:"FILE",fileName:e.payloadInput.payload.metadata.fileName,fileSize:e.payloadInput.payload.metadata.fileSize,fileType:e.payloadInput.payload.fileType.type,fileBytes:e.payloadInput.payload.fileBytes,thumbnail:null===(l=e.payloadInput.payload.fileType.payload)||void 0===l?void 0:l.thumbnail},d={groupMessageId:"error message",groupId:e.groupId,author:{username:s,id:c,fields:o},payload:u,timestamp:new Date,replyTo:e.replyTo&&i.messages[e.replyTo]?{groupId:i.messages[e.replyTo].groupId,author:i.messages[e.replyTo].author,payload:i.messages[e.replyTo].payload,timestamp:i.messages[e.replyTo].timestamp,replyTo:void 0,readList:i.messages[e.replyTo].readList}:void 0,replyToId:e.replyTo?e.replyTo:void 0,readList:{},err:!0},b=i.errMsgs,j=b[d.groupId]?i.errMsgs[d.groupId]:[],b=Object(p.a)(Object(p.a)({},b),{},Object(A.a)({},d.groupId,[d].concat(Object(ae.a)(j)))),n({type:z.e,errMsgs:b});case 8:case"end":return t.stop()}}),t)})));return function(e,n){return t.apply(this,arguments)}}()},Ie=function(e,t,n){return function(){var a=Object(O.a)(h.a.mark((function a(r,c){var s,o,i,u;return h.a.wrap((function(a){for(;;)switch(a.prev=a.next){case 0:return(s=e.map((function(e){return e.username}))).push(c().profile.username),a.prev=2,a.next=5,r(je({name:s.join(","),members:e.map((function(e){return e.id}))}));case 5:return o=a.sent,i=[],n.forEach((function(e){var t={type:"FILE",payload:{metadata:{fileName:e.payload.metadata.fileName,fileSize:e.payload.metadata.fileSize,fileType:e.payload.metadata.fileType},fileType:e.payload.fileType,fileBytes:e.payload.fileBytes}},n={groupId:o.originalGroupId,payloadInput:t,sender:o.creator,replyTo:void 0};i.push(n)})),t.length&&i.push({groupId:o.originalGroupId,payloadInput:{type:"TEXT",payload:{payload:t}},sender:o.creator,replyTo:void 0}),u=[],i.forEach(function(){var e=Object(O.a)(h.a.mark((function e(t){return h.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,r(Ne(t)).then((function(e){!1===e?r(we(t)):u.push(e)}));case 2:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),a.abrupt("return",{groupResult:o,messageResults:u});case 14:a.prev=14,a.t0=a.catch(2),a.t1=!0,a.next=a.t1===a.t0.message.includes("cannot create group with blocked agents")?19:a.t1===a.t0.message.includes("groups cannot be created with less than 3 members")?21:a.t1===a.t0.message.includes("creator AgentPubKey cannot be included in the group members list")?23:a.t1===a.t0.message.includes("the group name must at least contain 1 character and maximun 50 characters")?25:27;break;case 19:return r(Object(_.a)("TOAST",{},{id:"redux.err.group.create-group.1"})),a.abrupt("break",29);case 21:return r(Object(_.a)("TOAST",{},{id:"redux.err.group.create-group.2"})),a.abrupt("break",29);case 23:return r(Object(_.a)("TOAST",{},{id:"redux.err.group.create-group.3"})),a.abrupt("break",29);case 25:return r(Object(_.a)("TOAST",{},{id:"redux.err.group.create-group.4"})),a.abrupt("break",29);case 27:return r(Object(_.a)("TOAST",{},{id:"redux.err.generic"})),a.abrupt("return",!1);case 29:return a.abrupt("return",!1);case 30:case"end":return a.stop()}}),a,null,[[2,14]])})));return function(e,t){return a.apply(this,arguments)}}()},Me=function(e){return function(){var t=Object(O.a)(h.a.mark((function t(n,a){var r,c,s,o;return h.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:e.err&&(r=a().groups,c=r.errMsgs[e.groupId]?r.errMsgs[e.groupId]:[],s=c.map((function(e){return JSON.stringify(e)})),(o=s.indexOf(JSON.stringify(e)))>-1&&c.splice(o,1),n({type:z.e,errMsgs:Object(p.a)(Object(p.a)({},r.errMsgs),{},Object(A.a)({},e.groupId,c))}));case 1:case"end":return t.stop()}}),t)})));return function(e,n){return t.apply(this,arguments)}}()},ke=function(e){return function(){var t=Object(O.a)(h.a.mark((function t(n,a,r){var c,s,o,i;return h.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return c=r.callZome,s=e.map((function(e){return Object(v.a)(e)})),t.prev=2,t.next=5,c({zomeName:x.c.GROUP,fnName:x.a[x.c.GROUP].GET_FILES_BYTES,payload:s});case 5:return o=t.sent,i=a().groups.groupFiles,n(Re(Object(p.a)(Object(p.a)({},i),o))),t.abrupt("return",o);case 11:if(t.prev=11,t.t0=t.catch(2),!t.t0.message.includes("The file bytes were not found")){t.next=17;break}return t.abrupt("return",n(Object(_.a)("TOAST",{},{id:"redux.err.group.set-files-bytes.1"})));case 17:return t.abrupt("return",n(Object(_.a)("TOAST",{},{id:"redux.err.generic"})));case 18:case"end":return t.stop()}}),t,null,[[2,11]])})));return function(e,n,a){return t.apply(this,arguments)}}()},Re=function(e){return function(){var t=Object(O.a)(h.a.mark((function t(n,a){var r;return h.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:r=a().groups.groupFiles,n({type:z.f,filesBytes:Object(p.a)(Object(p.a)({},r),e)});case 2:case"end":return t.stop()}}),t)})));return function(e,n){return t.apply(this,arguments)}}()},Pe=function(e){return function(){var t=Object(O.a)(h.a.mark((function t(n,a,r){var c,s,o,i,u,l,d,b;return h.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(c=r.callZome,s=a(),s.groups.conversations[e.groupId].name!==e.name){t.next=5;break}return t.abrupt("return",n(Object(_.a)("TOAST",{},{id:"redux.err.group.update-group-name.1"})));case 5:return o={name:e.name,groupId:Object(v.a)(e.groupId),groupRevisionId:Object(v.a)(e.groupRevisionId)},t.prev=6,t.next=9,c({zomeName:x.c.GROUP,fnName:x.a[x.c.GROUP].UPDATE_GROUP_NAME,payload:o});case 9:return i=t.sent,u={name:i.name,groupId:Object(v.b)(i.groupId),groupRevisionId:Object(v.b)(i.groupRevisionId)},l=u.groupId,(d=s.groups.conversations[l]).name=u.name,b=s.groups.conversations,b=Object(p.a)(Object(p.a)({},b),{},Object(A.a)({},l,d)),n({type:z.n,conversations:b}),t.abrupt("return",e);case 20:t.prev=20,t.t0=t.catch(6),t.t1=!0,t.next=t.t1===t.t0.message.includes("failed to get the given group id")?25:t.t1===t.t0.message.includes("the group name must be 1 to 50 characters length")?26:t.t1===t.t0.message.includes("cannot update a group entry if you are not the group creator (admin)")?27:28;break;case 25:return t.abrupt("return",n(Object(_.a)("TOAST",{},{id:"redux.err.group.update-group-name.2"})));case 26:return t.abrupt("return",n(Object(_.a)("TOAST",{},{id:"redux.err.group.update-group-name.3"})));case 27:return t.abrupt("return",n(Object(_.a)("TOAST",{},{id:"redux.err.group.update-group-name.4"})));case 28:return t.abrupt("return",n(Object(_.a)("TOAST",{},{id:"redux.err.generic"})));case 29:case"end":return t.stop()}}),t,null,[[6,20]])})));return function(e,n,a){return t.apply(this,arguments)}}()},Ae=function(e){return function(){var t=Object(O.a)(h.a.mark((function t(n,a,r){var c,s,o,i,u,l,d,b;return h.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(c=r.callZome,s=a(),s.groups.conversations[e.groupId].avatar!==e.avatar){t.next=5;break}return t.abrupt("return",n(Object(_.a)("TOAST",{},{id:"redux.err.group.update-group-name.1"})));case 5:return o={avatar:e.avatar,groupId:Object(v.a)(e.groupId),groupRevisionId:Object(v.a)(e.groupRevisionId)},t.prev=6,t.next=9,c({zomeName:x.c.GROUP,fnName:x.a[x.c.GROUP].UPDATE_GROUP_AVATAR,payload:o});case 9:return i=t.sent,u={avatar:i.avatar,groupId:Object(v.b)(i.groupId),groupRevisionId:Object(v.b)(i.groupRevisionId)},l=u.groupId,(d=s.groups.conversations[l]).avatar=u.avatar,b=s.groups.conversations,b=Object(p.a)(Object(p.a)({},b),{},Object(A.a)({},l,d)),n({type:z.m,conversations:b}),t.abrupt("return",e);case 20:t.prev=20,t.t0=t.catch(6),t.t1=!0,t.next=t.t1===t.t0.message.includes("failed to get the given group id")?25:t.t1===t.t0.message.includes("the group name must be 1 to 50 characters length")?26:t.t1===t.t0.message.includes("cannot update a group entry if you are not the group creator (admin)")?27:28;break;case 25:return t.abrupt("return",n(Object(_.a)("TOAST",{},{id:"redux.err.group.update-group-name.2"})));case 26:return t.abrupt("return",n(Object(_.a)("TOAST",{},{id:"redux.err.group.update-group-name.3"})));case 27:return t.abrupt("return",n(Object(_.a)("TOAST",{},{id:"redux.err.group.update-group-name.4"})));case 28:return t.abrupt("return",n(Object(_.a)("TOAST",{},{id:"redux.err.generic"})));case 29:case"end":return t.stop()}}),t,null,[[6,20]])})));return function(e,n,a){return t.apply(this,arguments)}}()},Ce=n(30),Ge=function(e){return function(){var t=Object(O.a)(h.a.mark((function t(n,a,r){var c,s,o,i;return h.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return c=r.callZome,s=e.map((function(e){return Object(v.a)(e)})),t.prev=2,t.next=5,c({zomeName:x.c.P2PMESSAGE,fnName:x.a[x.c.P2PMESSAGE].GET_FILE_BYTES,payload:s});case 5:if(o=t.sent,i={},"error"===(null===o||void 0===o?void 0:o.type)){t.next=11;break}return Object.keys(o).forEach((function(e){i[e]=o[e]})),Object.entries(i).length>0&&n({type:Ce.c,state:i}),t.abrupt("return",i);case 11:t.next=16;break;case 13:t.prev=13,t.t0=t.catch(2),n(Object(_.a)("TOAST",{},{id:"redux.err.generic"}));case 16:case"end":return t.stop()}}),t,null,[[2,13]])})));return function(e,n,a){return t.apply(this,arguments)}}()},Le=n(97),De=n.n(Le),He=function(e){var t=e.file,n=e.onDownload,a=e.darken,r=void 0!==a&&a,c=e.err,s=t.fileName,i=t.fileSize,l=Object(d.c)((function(e){return Object.assign({},e.groups.groupFiles,e.p2pmessages.files)[t.fileHash]}));return Object(m.jsx)(o.p,{children:Object(m.jsxs)(o.M,{onClick:c?function(){return null}:n?function(){return n(t)}:function(){if(l){var e=new Blob([l]),n=document.createElement("a");n.href=window.URL.createObjectURL(e),n.download=t.fileName,n.click()}},className:"ion-align-items-center ".concat(De.a.file),children:[Object(m.jsx)("div",{className:"ion-padding-end",children:Object(m.jsx)(o.r,{className:De.a[r?"file-icon-dark":"file-icon-light"],size:"small",icon:u.y})}),Object(m.jsxs)("div",{className:"ion-align-items-center",children:[Object(m.jsx)(o.M,{children:Object(m.jsx)(o.z,{className:"".concat(De.a["file-name"]),children:Object(m.jsx)("p",{className:"ion-no-margin ion-text-wrap",children:s})})}),Object(m.jsx)(o.M,{children:Object(m.jsx)(o.Z,{className:De.a["file-size"],children:Object(m.jsx)("span",{children:Object(y.b)(i)})})})]})]})})},Ue=n(114),ze=n.n(Ue),Fe=function(e){var t=e.onDismiss,n=e.src,r=e.file,c=e.onDownload,s=e.intl,l=e.fileBytes,d=Object(a.useRef)(null),p=Object(a.useRef)(null),b=Object(a.useState)("0px"),j=Object(i.a)(b,2),f=j[0],O=j[1],g=Object(a.useState)({isOpen:!1,event:void 0}),h=Object(i.a)(g,2),v=h[0],y=h[1];Object(a.useEffect)((function(){O(d.current&&p.current?"calc(100vh - ".concat(d.current.getBoundingClientRect().height,"px - ").concat(p.current.getBoundingClientRect().height,"px)"):"0px")}),[]);return Object(m.jsxs)(o.H,{children:[Object(m.jsx)(o.q,{children:Object(m.jsxs)(o.fb,{className:ze.a.toolbar,ref:p,children:[Object(m.jsx)(o.f,{children:Object(m.jsx)(o.e,{onClick:function(){return t()},children:Object(m.jsx)(o.r,{icon:u.c})})}),Object(m.jsx)(o.f,{slot:"end",children:Object(m.jsx)(o.e,{onClick:function(e){e.persist(),y({isOpen:!0,event:e})},children:Object(m.jsx)(o.r,{icon:u.C})})})]})}),Object(m.jsx)("div",{className:ze.a.content,style:{height:f},children:Object(m.jsx)("img",{style:Object(A.a)({},window.innerWidth>window.innerHeight?"height":"width","100%"),alt:"Message content",src:n})}),Object(m.jsx)(o.I,{event:v.event,isOpen:v.isOpen,onDidDismiss:function(){return y({isOpen:!1,event:void 0})},children:Object(m.jsx)(o.A,{children:Object(m.jsx)(o.w,{lines:"none",button:!0,onClick:c?function(){return c(r)}:function(){if(l){var e=new Blob([l]),t=document.createElement("a");t.href=window.URL.createObjectURL(e),t.download=r.fileName,t.click(),y({isOpen:!1,event:void 0})}},children:Object(m.jsx)(o.z,{children:s.formatMessage({id:"components.chat.media-modal-download"})})})})}),Object(m.jsx)(o.o,{children:Object(m.jsx)(o.fb,{className:ze.a.toolbar,ref:d})})]})},Be=n(161),Ze=n.n(Be),Ve=function(e){var t=e.src,n=e.file,r=e.className,c=e.onDownload,s=e.err,u=Object(l.a)(),p=Object(d.c)((function(e){return Object.assign({},e.groups.groupFiles,e.p2pmessages.files)[n.fileHash]})),b=Object(o.qb)(Fe,{onDownload:c,onDismiss:function(){return O()},src:t,file:n,fileBytes:p,intl:u}),j=Object(i.a)(b,2),f=j[0],O=j[1],g=Object(a.useRef)(null),h=Object(a.useState)("auto"),v=Object(i.a)(h,2),y=v[0],x=v[1];return Object(m.jsx)(m.Fragment,{children:Object(m.jsx)("div",{ref:g,className:"".concat(Ze.a.image," ").concat(r||""),style:{maxHeight:y},children:Object(m.jsx)(o.s,{onIonImgDidLoad:function(){return x("".concat(1.25*g.current.getBoundingClientRect().width,"px"))},onClick:function(){s||f({cssClass:"image-view"})},src:t})})})},Ye=n(27),Xe=n(84),Ke=n.n(Xe),qe=function(e){var t=e.video,n=e.present,r=e.isPlaying,c=e.duration,s=e.hasError,l=e.onPlayPauseErrorHandler,d=Object(a.useState)(Object(Ye.e)("mobile")),p=Object(i.a)(d,2),b=p[0],j=p[1],f=Object(a.useRef)(),O=Object(a.useState)(!1),g=Object(i.a)(O,2),h=g[0],v=g[1];Object(a.useEffect)((function(){s||v(!1)}),[s]);var y=function(){f.current&&clearTimeout(f.current),f.current=setTimeout((function(){j(!1)}),1e3)},x=function(){n({cssClass:"video-view"})},_=function(){var e,n;s?(v(!0),l&&l()):r?null===(n=t.current)||void 0===n||n.pause():null===(e=t.current)||void 0===e||e.play()};return Object(m.jsxs)("div",{onMouseEnter:function(){j(!0),f.current&&clearTimeout(f.current)},onMouseLeave:y,onClick:function(){j(!0),y()},className:Ke.a.controls,style:{opacity:b?1:0},children:[Object(m.jsx)("div",{className:Ke.a["play-pause"],onClick:_,onTouchEnd:_,children:h?Object(m.jsx)(o.U,{}):Object(m.jsx)(o.r,{icon:s?r?u.L:u.A:r?u.L:u.V})}),Object(m.jsxs)("div",{className:Ke.a["range-slider-expand"],children:[Object(m.jsx)("div",{className:Ke.a["range-slider"],children:Object(m.jsx)("input",{type:"range",onChange:function(){},value:100*c,min:0,max:100})}),Object(m.jsx)("div",{className:Ke.a.expand,children:Object(m.jsx)(o.r,{onClick:x,onTouchEnd:x,icon:u.D})})]})]})},We=n(126),Je=n.n(We),Qe=n(74),$e=n.n(Qe),et=function(e){var t=e.src,n=e.download,r=e.onPlayPauseErrorHandler,c=e.onDismiss,s=e.intl,l=Object(a.useState)({isOpen:!1,event:void 0}),d=Object(i.a)(l,2),p=d[0],b=d[1],j=Object(a.useRef)(null),f=Object(a.useRef)(null),O=Object(a.useState)("0px"),g=Object(i.a)(O,2),h=g[0],v=g[1],y=Object(a.useState)(0),x=Object(i.a)(y,2),_=x[0],E=x[1],T=Object(a.useState)(!1),S=Object(i.a)(T,2),N=S[0],w=S[1],I=Object(a.useState)(!1),M=Object(i.a)(I,2),k=M[0],R=M[1],P=Object(a.useRef)(),C=Object(a.useState)(!1),G=Object(i.a)(C,2),L=G[0],D=G[1],H=Object(a.useRef)(null),U=Object(a.useState)(!1),z=Object(i.a)(U,2),F=z[0],B=z[1];Object(a.useEffect)((function(){v(j.current&&f.current?"calc(100vh - ".concat(j.current.getBoundingClientRect().height,"px - ").concat(f.current.getBoundingClientRect().height,"px)"):"0px")}),[]),Object(a.useEffect)((function(){L||B(!1)}),[L]);var Z=function(){r&&r(D)};return Object(m.jsxs)(o.H,{children:[Object(m.jsx)(o.q,{children:Object(m.jsxs)(o.fb,{ref:f,className:$e.a.toolbar,children:[Object(m.jsx)(o.f,{children:Object(m.jsx)(o.e,{onTouchEnd:function(){R(!1),c()},onClick:function(){R(!1),c()},children:Object(m.jsx)(o.r,{icon:u.c})})}),Object(m.jsx)(o.f,{slot:"end",children:Object(m.jsx)(o.e,{onTouchEnd:function(e){e.persist(),b({isOpen:!0,event:e})},onClick:function(e){e.persist(),b({isOpen:!0,event:e})},children:Object(m.jsx)(o.r,{icon:u.C})})})]})}),Object(m.jsxs)("div",{className:$e.a.content,style:{height:h},onClick:function(){w(!0),P.current&&clearTimeout(P.current),P.current=setTimeout((function(){w(!1)}),3e3)},children:[Object(m.jsx)("video",{ref:H,style:Object(A.a)({},window.innerWidth>window.innerHeight?"height":"width","100%"),onError:function(){D(!0)},autoPlay:!1,controls:!1,onTimeUpdate:function(){return E(H.current.currentTime/H.current.duration)},onPlay:function(){R(!0)},onPause:function(){R(!1)},loop:!1,src:t}),H.current?Object(m.jsx)("div",{style:{opacity:N?1:0},className:$e.a["modal-control"],children:F?Object(m.jsx)(o.U,{}):Object(m.jsx)("div",{className:$e.a["play-pause"],onClick:function(){var e,t;L?(B(!0),r&&Z()):k?null===(t=H.current)||void 0===t||t.pause():null===(e=H.current)||void 0===e||e.play()},children:Object(m.jsx)(o.r,{icon:k?u.L:u.V})})}):null]}),Object(m.jsx)(o.o,{children:Object(m.jsx)(o.fb,{ref:j,className:$e.a.footer,children:Object(m.jsx)("div",{className:$e.a["slider-volume"],children:Object(m.jsx)("input",{step:100*_,value:100*_,onChange:function(){},min:0,max:100,type:"range"})})})}),Object(m.jsx)(o.I,{event:p.event,isOpen:p.isOpen,onDidDismiss:function(){return b({isOpen:!1,event:void 0})},children:Object(m.jsx)(o.A,{children:n?Object(m.jsx)(o.w,{lines:"none",button:!0,onClick:function(){n(),b({isOpen:!1,event:void 0})},children:Object(m.jsx)(o.z,{children:s.formatMessage({id:"components.chat.media-modal-download"})})}):null})})]})},tt=function(e){var t=e.src,n=e.className,r=e.thumbnail,c=e.download,s=e.onPlayPauseErrorHandler,u=e.err,d=[Je.a["video-player"]];n&&d.push(n);var p=Object(a.useRef)(null),b=Object(a.useState)(!1),j=Object(i.a)(b,2),f=j[0],O=j[1],g=Object(a.useState)(0),h=Object(i.a)(g,2),v=h[0],y=h[1],x=Object(a.useState)(!1),_=Object(i.a)(x,2),E=_[0],T=_[1],S=Object(a.useRef)(null),N=Object(l.a)(),w=Object(o.qb)(et,{download:c,onPlayPauseErrorHandler:s,src:t,intl:N,onDismiss:function(){return k()}}),I=Object(i.a)(w,2),M=I[0],k=I[1];return Object(m.jsxs)("div",{ref:S,className:d.join(" "),onDoubleClick:function(){O(!1),M({cssClass:"video-view"})},children:[Object(m.jsx)("video",{className:Je.a.video,onTimeUpdate:function(){return y(isNaN(p.current.currentTime/p.current.duration)?0:p.current.currentTime/p.current.duration)},poster:r,onPlay:function(){O(!0)},onPause:function(){O(!1)},ref:p,controls:!1,loop:!1,autoPlay:!1,src:t,onError:function(e){return T(!0)}}),u?null:Object(m.jsx)(qe,{isPlaying:f,hasError:E,onPlayPauseErrorHandler:function(){s&&s(T)},duration:v,video:p,present:M})]})},nt=n(127),at=n.n(nt),rt=function(e){var t=e.file,n=e.onDownload,r=e.onPlayPauseErrorHandler,c=e.err,s=Object(d.c)((function(e){return Object.assign({},e.groups.groupFiles,e.p2pmessages.files)[t.fileHash]})),o=function(){if(s){var e=new Blob([s]),n=document.createElement("a");n.href=window.URL.createObjectURL(e),n.download=t.fileName,n.click()}},i=Object(a.useMemo)((function(){return Object(m.jsx)(tt,{download:c?function(){return null}:n?function(){return n(t)}:o,src:URL.createObjectURL(new Blob([s],{type:"video/mp4"})),className:at.a.video,thumbnail:URL.createObjectURL(new Blob([t.thumbnail],{type:"image/jpeg"})),onPlayPauseErrorHandler:r,err:c})}),[s]);return Object(m.jsx)("div",{className:at.a.video,children:i})},ct=function(e){e.timestamp;var t=e.file,n=(e.type,e.onDownload),a=e.chatType,r=e.err,c=new TextDecoder("utf-8"),s=I();return function(){switch(null===t||void 0===t?void 0:t.fileType){case"IMAGE":return Object(m.jsx)(Ve,{onDownload:n,file:t,src:c.decode(t.thumbnail),err:r});case"OTHER":return Object(m.jsx)(He,{onDownload:n,file:t,err:r});case"VIDEO":return Object(m.jsx)(rt,{onDownload:n,file:t,onPlayPauseErrorHandler:function(e){"p2p"===a?s(Ge([t.fileHash])).then((function(t){t&&e(!1)})):s(ke([t.fileHash])).then((function(t){t&&e(!1)}))},err:r});default:return null}}()},st=n(70),ot=n.n(st),it=function(e){var t,n,a,r,c,s,i,l=e.me,d=e.message,p=Object(y.e)(null===d||void 0===d?void 0:d.payload),b=new TextDecoder,j=["".concat(ot.a["reply-to"])];return Object(m.jsxs)("div",{className:j.join(" "),children:[Object(m.jsx)("div",{className:"".concat(l?ot.a["vertical-divider-me"]:ot.a["vertical-divider-others"]," ion-margin-end")}),p?null:"OTHER"===(null===(t=d.payload)||void 0===t?void 0:t.fileType)?Object(m.jsx)(o.r,{className:"ion-margin-end",icon:u.y}):Object(m.jsx)(o.bb,{className:"".concat(ot.a.thumbnail," ion-margin-end"),children:Object(m.jsx)("img",{alt:"Thumbnail",src:"VIDEO"===(null===d||void 0===d||null===(n=d.payload)||void 0===n?void 0:n.fileType)?URL.createObjectURL(new Blob([null===(a=d.payload)||void 0===a?void 0:a.thumbnail])):b.decode(null===d||void 0===d||null===(r=d.payload)||void 0===r?void 0:r.thumbnail)})}),Object(m.jsxs)("div",{className:"".concat(l?ot.a["content-me"]:ot.a["content-others"]),children:[Object(m.jsx)(o.z,{children:null===d||void 0===d?void 0:d.author.username}),Object(m.jsx)("p",{className:ot.a["sub-label"],children:p?null===d||void 0===d||null===(c=d.payload)||void 0===c||null===(s=c.payload)||void 0===s?void 0:s.payload:null===d||void 0===d||null===(i=d.payload)||void 0===i?void 0:i.fileName})]})]})},ut=n(32),lt=n.n(ut),dt=n(162),pt=n.n(dt),bt=function(e){var t=e.message,n=e.type;return new RegExp("https://media.tenor.com/images/.*/tenor.gif").test(t.payload.payload)?Object(m.jsx)(o.s,{src:t.payload.payload}):Object(m.jsx)(o.Z,{className:pt.a["me"===n?"me":"others"],children:t.payload.payload})},jt=function(e){var t=e.id,n=e.profile,r=e.payload,c=e.timestamp,s=e.replyTo,d=e.onReply,b=e.onDelete,j=e.onPinMessage,O=e.isPinned,g=e.type,h=e.showProfilePicture,v=e.isSeen,y=void 0!==v&&v,x=e.onDownload,_=e.onRetry,E=e.err,T=Object(l.a)(),S=Object(a.useState)(!1),N=Object(i.a)(S,2),w=N[0],I=N[1],M=Object(L.d)(r),k=function(e){return A({event:e.nativeEvent})},R=Object(o.rb)(pe,{onHide:function(){return C()},onPin:j,onReply:function(){d&&d({author:n.username,payload:r,id:t})},onDelete:function(){b&&b()},onRetry:function(){_&&_(I)},onCopy:function(){M&&G(r.payload.payload)},isPinned:O,isText:M,intl:T,err:E}),P=Object(i.a)(R,2),A=P[0],C=P[1],G=function(e){navigator.clipboard.writeText(e)},D=ie(k,(function(){})),H="p2p"===g,U=M?"":Object(o.ob)("desktop")?lt.a["max-file"]:"";return Object(m.jsxs)(m.Fragment,{children:[Object(m.jsxs)(o.w,Object(p.a)(Object(p.a)({lines:"none",className:"".concat(lt.a["me-container"]," ").concat(U),onClick:function(e){E&&k(e)}},D),{},{children:[Object(m.jsxs)("div",{className:"".concat(lt.a.me," ").concat(lt.a[M?"text":"file"]," ").concat(lt.a.bubble),children:[s?Object(m.jsx)(it,{me:!0,message:s}):null,M?Object(m.jsx)(bt,{type:"me",message:r}):Object(m.jsx)(ct,{chatType:H?"p2p":"group",onDownload:x,type:"me",timestamp:c,file:r,err:E}),Object(m.jsx)(o.Z,{children:Object(m.jsxs)("h6",{className:"ion-no-margin ion-text-end ".concat(lt.a["message-text"]),children:[T.formatTime(c),Object(m.jsx)(o.r,{size:"medium",icon:y?u.n:E&&"error message"!==t?u.W:u.m})]})})]}),E&&"error message"===t?w?Object(m.jsx)("div",{className:lt.a.picture,children:Object(m.jsx)(f,{})}):Object(m.jsx)(o.r,{color:"danger",className:lt.a.picture,style:{marginLeft:"0.5rem"},icon:u.b}):H?null:Object(m.jsx)("div",{className:lt.a.picture,style:{marginLeft:"0.5rem"},children:h?n.fields.avatar?Object(m.jsx)(o.b,{className:lt.a["avatar-container"],children:Object(m.jsx)("img",{src:n.fields.avatar,alt:"avatar"})}):Object(m.jsx)(o.b,{className:lt.a["avatar-container"],children:Object(m.jsx)("img",{src:"assets/icon/person-circle-outline.png",alt:"avatar"})}):null})]})),E&&"error message"===t?w?null:Object(m.jsx)(o.w,{lines:"none",className:lt.a["not-delivered-container"],children:Object(m.jsx)(o.Z,{className:lt.a["not-delivered"],color:"danger",children:"Not delivered"})}):null]})},mt=n(163),ft=n.n(mt),Ot=function(e){var t=e.timestamp,n=e.onSeen,r=Object(l.a)(),c=Object(a.useRef)(),s=Object(a.useRef)(null),u={root:document.querySelector(".chat-list"),rootMargin:"0px",threshold:1},d=Object(a.useState)(!1),p=Object(i.a)(d,2),b=p[0],j=p[1];Object(a.useEffect)((function(){var e,t;null===(e=c.current)||void 0===e||e.disconnect(),c.current=new IntersectionObserver((function(){n&&(b||(j(!0),n(f)))}),u),s.current&&(null===(t=c.current)||void 0===t||t.observe(s.current))}),[b,s.current]);var f=function(){b&&j(!1)};return Object(m.jsx)(o.Z,{ref:s,children:Object(m.jsx)("h6",{className:"ion-no-margin ion-text-end ".concat(ft.a["message-text"]),children:r.formatTime(t)})})},gt=function(e){var t=e.id,n=e.profile,a=e.type,r=e.timestamp,c=e.payload,s=(e.readList,e.onSeen),u=e.showProfilePicture,d=e.showName,b=e.onReply,j=e.isPinned,f=e.onPinMessage,O=e.replyTo,g=(e.isSeen,e.onDownload),h=Object(l.a)(),v=Object(L.d)(c),y=Object(o.rb)(pe,{onHide:function(){return E()},onPin:f,onReply:function(){b&&b({author:n.username,payload:c,id:t})},onCopy:function(){v&&T(c.payload.payload)},isText:v,isPinned:j,intl:h}),x=Object(i.a)(y,2),_=x[0],E=x[1],T=function(e){navigator.clipboard.writeText(e)},S=ie((function(e){_({event:e.nativeEvent})}),(function(){})),N="p2p"===a,w=v?"":Object(o.ob)("desktop")?lt.a["max-file"]:"";return Object(m.jsxs)(m.Fragment,{children:[N?null:d?Object(m.jsx)(o.w,{lines:"none",className:"".concat(lt.a["author-name"]),children:Object(m.jsx)(o.Z,{color:"medium",children:n.username})}):null,Object(m.jsxs)(o.w,Object(p.a)(Object(p.a)({lines:"none",className:"".concat(lt.a["others-container"]," ").concat(w)},S),{},{children:[N?null:Object(m.jsx)("div",{className:lt.a.picture,style:{marginRight:"0.5rem"},children:u?n.fields.avatar?Object(m.jsx)(o.b,{className:lt.a["avatar-container"],children:Object(m.jsx)("img",{src:n.fields.avatar,alt:"avatar"})}):Object(m.jsx)(o.b,{className:lt.a["avatar-container"],children:Object(m.jsx)("img",{src:"assets/icon/person-circle-outline.png",alt:"avatar"})}):null}),Object(m.jsxs)("div",{className:"".concat(lt.a.others," ").concat(lt.a[v?"text":"file"]," ").concat(lt.a.bubble),children:[O?Object(m.jsx)(it,{me:!1,message:O}):null,v?Object(m.jsx)(bt,{type:"others",message:c}):Object(m.jsx)(ct,{chatType:N?"p2p":"group",onDownload:g,type:"others",file:c,timestamp:r}),Object(m.jsx)(Ot,{onSeen:s,timestamp:r})]})]}))]})},ht={ChatList:oe,Me:jt,Others:gt},vt=ht,yt=n(128),xt=n.n(yt),_t=function(e){var t=e.profiles,n=(e.disabled,Object(l.a)()),a=function(e){switch(e.length){case 0:return null;case 1:return", ".concat(e[0].username);default:return Object(m.jsxs)("span",{children:[", ",e.length," others "]})}};return t.length>0?Object(m.jsxs)("div",{className:"".concat(xt.a.typing," ion-padding-start"),children:[function(e){if(1===e.length)return Object(m.jsx)("span",{children:n.formatMessage({id:"components.typing.is-typing"},{user:e[0].username})});var t="".concat(e.slice(0,2).map((function(e){return e.username})).join(", ")),r=e.slice(2,e.length);return Object(m.jsxs)("span",{children:[t,a(r)," are typing"]})}(t),[".",".","."].map((function(e,t){return Object(m.jsx)("span",{style:{animationDelay:"".concat(.3*t,"s")},className:xt.a.dot,children:e},t)}))]}):null},Et=Object(a.createContext)({showToast:function(){},dismissToast:function(){},showErrorToast:function(){}}),Tt=function(){var e=Object(a.useContext)(Et);if(!e)throw new Error("Cannot get toast context :(");return e},St=function(e){var t=e.message,n=e.files,a=e.onSend,r=e.loading;return Object(m.jsx)(o.f,{slot:"end",children:Object(m.jsx)(o.e,{type:"submit",onClick:a,disabled:0===t.length&&0===n.length,children:r?Object(m.jsx)(f,{}):Object(m.jsx)(o.r,{color:"medium",icon:u.eb})})})},Nt=n(129),wt=n.n(Nt),It=function(e){var t=e.file,n=e.files,r=e.setFiles,c=function(e){t.value="",r((function(t){return t.splice(e,1),Object(ae.a)(t)}))},s=new TextDecoder;return Object(m.jsx)(o.M,{className:wt.a.row,children:n.map((function(e,t){return Object(a.createElement)(o.i,Object(p.a)(Object(p.a)({},"IMAGE"===e.fileType.type||"VIDEO"===e.fileType.type?{style:{backgroundImage:"url(".concat((n=e.fileType.type,r=e.fileType.payload.thumbnail,"IMAGE"===n?s.decode(r):URL.createObjectURL(new Blob([r],{type:"image/jpeg"}))),")"),backgroundRepeat:"no-repeat",backgroundPosition:"center",backgroundSize:"cover"}}:{}),{},{className:wt.a.chip,key:t}),"IMAGE"===e.fileType.type||"VIDEO"===e.fileType.type?null:Object(m.jsx)(o.z,{children:e.metadata.fileName}),Object(m.jsx)(o.r,{icon:u.t,onClick:function(){return c(t)}}));var n,r}))})},Mt=n(48),kt=n.n(Mt),Rt=function(e){var t=e.messageState,n=Object(i.a)(t,2),a=n[0],r=n[1];return Object(m.jsxs)("div",{className:"ion-padding-start ion-padding-end ".concat(kt.a.row," ").concat(kt.a.reply),children:[Object(m.jsx)(o.r,{icon:u.u,onClick:function(){r(null)}}),function(){if("TEXT"===a.payload.type)return Object(m.jsxs)("div",{className:"".concat(kt.a.column," ion-padding-start"),children:[Object(m.jsx)("span",{className:kt.a.author,children:a.author}),Object(m.jsx)("span",{className:kt.a.text,children:a.payload.payload.payload})]});switch(a.payload.fileType){case"OTHER":return Object(m.jsxs)("div",{className:"".concat(kt.a.row," ion-padding-start"),children:[Object(m.jsx)(o.r,{icon:u.z}),Object(m.jsxs)("div",{className:"".concat(kt.a.column," ion-padding-start"),children:[Object(m.jsx)("span",{className:kt.a.author,children:a.author}),Object(m.jsx)("span",{className:kt.a.text,children:a.payload.fileName})]})]});case"IMAGE":case"VIDEO":var e,t=new TextDecoder;return Object(m.jsx)("div",{children:Object(m.jsxs)("div",{className:"".concat(kt.a.row," ion-padding-start"),children:[Object(m.jsx)(o.bb,{className:kt.a.thumbnail,children:Object(m.jsx)("img",{alt:"Thumbnail",src:"VIDEO"===(null===(e=a.payload)||void 0===e?void 0:e.fileType)?URL.createObjectURL(new Blob([a.payload.thumbnail])):t.decode(a.payload.thumbnail)})}),Object(m.jsxs)("div",{className:"".concat(kt.a.column," ion-padding-start"),children:[Object(m.jsx)("span",{className:kt.a.author,children:a.author}),Object(m.jsx)("span",{className:kt.a.text,children:a.payload.fileName})]})]})});default:return null}}()]})},Pt=n(78),At=function(e,t){return function(n,a){var r="en"===a().language.language?"en_US":"ja_JP";return new Promise((function(a,c){var s="https://g.tenor.com/v1"+(void 0===e?"/trending?":"/search?q="+e+"&")+"key=9QL1R5ZGUNGM&locale="+r+"&limit=20";t&&(s=s+"&pos="+t);var o=new XMLHttpRequest;o.open("GET",s,!0),o.onload=function(){if(4===o.readyState&&200===o.status){var e=JSON.parse(o.responseText),t=e.results,r={gifs:t,next:e.next};n((s=t,function(){var e=Object(O.a)(h.a.mark((function e(t,n){return h.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t({type:Pt.b,state:s}),e.abrupt("return");case 2:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}())),a(r)}else c({});var s},o.onerror=function(){c({})},o.send(null)}))}},Ct=function(){return function(e,t){var n="en"===t().language.language?"en_US":"ja_JP";return new Promise((function(t,a){var r="https://g.tenor.com/v1/categories?key=9QL1R5ZGUNGM&locale="+n,c=new XMLHttpRequest;c.open("GET",r,!0),c.onload=function(){if(4===c.readyState&&200===c.status){var n=JSON.parse(c.responseText).tags,r={top:n};e((s=n,function(){var e=Object(O.a)(h.a.mark((function e(t,n){return h.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t({type:Pt.a,state:s}),e.abrupt("return");case 2:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}())),t(r)}else a({});var s},c.onerror=function(){a({})},c.send(null)}))}},Gt=n(63),Lt=n.n(Gt),Dt=function(e){e.onSend,e.onChange;var t=e.onSelect,n=I(),r=Object(a.useState)(""),c=Object(i.a)(r,2),s=c[0],l=c[1],d=Object(a.useState)(""),b=Object(i.a)(d,2),j=b[0],g=b[1],v=Object(a.useState)([]),y=Object(i.a)(v,2),x=y[0],_=y[1],E=Object(a.useState)(!0),T=Object(i.a)(E,2),S=T[0],N=T[1],w=Object(a.useState)([]),M=Object(i.a)(w,2),k=M[0],R=M[1],P=Object(a.useState)(void 0),A=Object(i.a)(P,2),C=A[0],G=A[1],L=Object(a.useState)(!1),D=Object(i.a)(L,2),H=D[0],U=D[1],z=function(){return l("")},F=Object(a.useCallback)((function(){t&&t(j)}),[j]);Object(a.useEffect)((function(){n(Ct()).then((function(e){_(e.top)})),n(At(s)).then((function(e){R(e.gifs),G(e.next)})),n(function(){var e=Object(O.a)(h.a.mark((function e(t,n){var a;return h.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=Object(p.a)({},n().gif.gifs),e.abrupt("return",a);case 2:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}()).then((function(e){return R(e)}))}),[s]),Object(a.useEffect)((function(){return F()}),[j,F]);var B=Object(a.useRef)(null),Z=function(){var e;return null===(e=B.current)||void 0===e?void 0:e.complete()};return Object(m.jsxs)(o.g,{className:Lt.a.keyboardcontainer,children:[Object(m.jsxs)(o.h,{className:Lt.a.header,children:[S?null:Object(m.jsx)(o.e,{onClick:function(){N(!0),z()},fill:"clear",children:Object(m.jsx)(o.r,{icon:u.c})}),Object(m.jsx)(o.N,{value:s,onIonChange:function(e){return l(e.detail.value)},debounce:2e3}),Object(m.jsx)(o.e,{onClick:function(){U(!H)},fill:"clear",children:Object(m.jsx)(o.r,{icon:H?u.p:u.r})})]}),Object(m.jsx)(o.k,{className:H?Lt.a.gifcontainerexpanded:Lt.a.gifcontainer,children:k&&Object.values(k).length>0?Object(m.jsxs)("div",{className:Lt.a.images,children:[S&&""===s?Object.values(x).map((function(e){return Object(m.jsxs)("div",{children:[Object(m.jsx)("div",{className:Lt.a.textholder,onClick:function(){return t=e.searchterm,l(t),n(At(s)).then((function(e){R(e.gifs),G(e.next)})),void N(!1);var t},children:Object(m.jsx)(o.Z,{className:Lt.a.categorytext,children:e.name.replace("#","").toUpperCase()})}),Object(m.jsx)("img",{alt:e.name,className:Lt.a.categorypreview,src:e.image})]},e.name)})):Object.values(k).map((function(e){return Object(m.jsx)("div",{children:Object(m.jsx)("img",{className:Lt.a.gifpreview,onClick:function(){return t=e.media[0].gif.url,g(t),void z();var t},alt:e.title,src:e.media[0].tinygif.preview?e.media[0].nanogif.url:e.media[0].gif.preview})},e.media[0].nanogif.url)})),Object(m.jsx)(o.t,{ref:B,position:"bottom",threshold:"0px",onIonInfinite:function(e){return function(e){n(At(s,C)).then((function(e){R(k?[].concat(Object(ae.a)(k),Object(ae.a)(e.gifs)):e.gifs),G(e.next)})),e()}(Z)},children:Object(m.jsx)(o.u,{loadingSpinner:"circles"})})]}):Object(m.jsx)(f,{})})]})},Ht=n(164),Ut=n.n(Ht),zt=function(e){var t=e.onSelect;return Object(m.jsx)(Ut.a,{native:!0,pickerStyle:{width:"auto"},onEmojiClick:function(e,n){t(n)},preload:!0})},Ft=n(130),Bt=n.n(Ft),Zt=function(e,t){var n=e.onChange,r=e.onSend,c=e.onFileSelect,s=Object(a.useState)(""),d=Object(i.a)(s,2),p=d[0],b=d[1],j=Object(l.a)(),f=Object(a.useState)(void 0),O=Object(i.a)(f,2),g=O[0],h=O[1],v=Object(a.useState)(!1),y=Object(i.a)(v,2),x=y[0],_=y[1],E=Object(a.useState)(!1),T=Object(i.a)(E,2),S=T[0],N=T[1],w=Object(a.useRef)(null),I=Object(a.useState)([]),M=Object(i.a)(I,2),k=M[0],R=M[1],P=Object(a.useState)(""),A=Object(i.a)(P,2),C=A[0],G=A[1],L=Object(a.useState)({}),D=Object(i.a)(L,2),H=(D[0],D[1]),U=Object(a.useState)(!1),z=Object(i.a)(U,2),F=z[0],B=z[1],Z=Object(a.useState)(!1),V=Object(i.a)(Z,2),Y=V[0],X=V[1],K=Object(a.useCallback)((function(){c&&c(k)}),[k]);Object(a.useImperativeHandle)(t,(function(){return{reply:function(e){h(e)}}}));var q=Object(a.useCallback)((function(){n&&n(p)}),[p]),W=Object(a.useCallback)((function(){r&&""!==C&&(r({message:C,setIsLoading:_}),B(!F),J())}),[C]),J=function(){h(void 0),b(""),R([]),w.current&&(w.current.value="")},Q=function(e){console.log(e),H(e),b(p+e.emoji)},$=function(e){"compositionstart"===e.type&&N(!0),"compositionend"===e.type&&N(!1)},ee=function(e){!r||"Enter"!==e.key||e.shiftKey||S||(0!==p.trim().length||k.length>0)&&(r({files:k,message:p,reply:null===g||void 0===g?void 0:g.id,setIsLoading:_}),J())};Object(a.useEffect)((function(){return document.addEventListener("keydown",ee),function(){document.removeEventListener("keydown",ee)}}),[r,J]),Object(a.useEffect)((function(){return K()}),[k,K]),Object(a.useEffect)((function(){return q()}),[p,q]),Object(a.useEffect)((function(){return W()}),[C,W]);var te=Tt().showToast,ne=Object(a.useMemo)((function(){return k.length>0?Object(m.jsx)(It,{file:w.current,files:k,setFiles:R}):null}),[k]),re=Object(o.rb)(Object(m.jsx)(zt,{onSelect:Q}),{onHide:function(){return oe}}),ce=Object(i.a)(re,2),se=ce[0],oe=ce[1];return Object(m.jsxs)(m.Fragment,{children:[Object(m.jsxs)(o.o,{children:[F?Object(m.jsx)(Dt,{onSelect:function(e){G(e)}}):null,Y?Object(m.jsxs)(o.I,{isOpen:Y,children:[Object(m.jsx)(zt,{onSelect:Q})," "]}):null,g?Object(m.jsx)(Rt,{messageState:[g,h]}):null,ne,Object(m.jsxs)(o.fb,{className:Bt.a.toolbar,children:[Object(m.jsxs)(o.f,{slot:"start",children:[k.length>0?null:Object(m.jsx)(o.e,{onClick:function(){var e;return null===w||void 0===w||null===(e=w.current)||void 0===e?void 0:e.click()},children:Object(m.jsx)(o.r,{color:"medium",icon:u.g})}),Object(m.jsx)(o.e,{onClick:function(){B(!F),!0===!F&&!0===Y&&X(!Y)},children:Object(m.jsx)(o.r,{color:"medium",icon:"assets/icon/gif.svg"})}),Object(m.jsx)(o.e,{onClick:function(e){return se({event:e.nativeEvent})},children:Object(m.jsx)(o.r,{color:"medium",icon:u.F})})]}),Object(m.jsx)(o.ab,{value:p,onKeyDown:function(e){if("Enter"===e.key&&!e.shiftKey)return e.preventDefault(),!1},className:Bt.a.textarea,onIonChange:function(e){return b(e.detail.value)},autoGrow:!0,placeholder:j.formatMessage({id:"app.new-conversation.message-placeholder"}),ref:function(e){e&&(e.addEventListener("compositionstart",$),e.addEventListener("compositionend",$))}}),Object(m.jsx)(St,{files:k,onSend:function(){r&&r({files:k,message:p,reply:null===g||void 0===g?void 0:g.id,setIsLoading:_}),J()},message:p,loading:x})]})]}),Object(m.jsx)("input",{ref:w,type:"file",hidden:!0,onChange:function(){Array.from(w.current?w.current.files:new FileList).forEach((function(e){e.arrayBuffer().then((function(t){var n=e.size,a=e.name;if(n<15728640){var r=new Uint8Array(t),c=function(e){switch(e){case"video/mpeg":case"video/mp4":return"VIDEO";case"image/png":case"image/jpeg":return"IMAGE";default:return"OTHER"}}(e.type);if("IMAGE"===c){var s=new TextEncoder,o=new FileReader;o.readAsDataURL(e),o.onload=function(e){var t,o=s.encode(null===(t=e.target)||void 0===t?void 0:t.result),i={metadata:{fileName:a,fileType:c,fileSize:n},fileType:{type:c,payload:{thumbnail:o}},fileBytes:r};R((function(e){return e.push(i),Object(ae.a)(e)}))}}else if("VIDEO"===c){var i=document.createElement("video"),u=URL.createObjectURL(new Blob([r],{type:"video/mp4"})),l=";base64,",d=function(){var e,t=document.createElement("canvas");t.width=i.videoWidth,t.height=i.videoHeight,null===(e=t.getContext("2d"))||void 0===e||e.drawImage(i,0,0,t.width,t.height);var s=t.toDataURL("image/jpeg"),o=s.length>10;if(o){var d,p=document.createElement("img");if(document.getElementsByTagName("div")[0].appendChild(p),URL.revokeObjectURL(u),null===(d=s.split(l)[1])||void 0===d?void 0:d.trim()){for(var b,j=window.atob(null===(b=s.split(l)[1])||void 0===b?void 0:b.trim()),m=new Array(j.length),f=0;f<j.length;f++)m[f]=j.charCodeAt(f);var O=new Uint8Array(m),g={metadata:{fileName:a,fileType:c,fileSize:n},fileType:{type:c,payload:{thumbnail:O}},fileBytes:r};R((function(e){return e.push(g),Object(ae.a)(e)}))}}return o};i.src=u,i.addEventListener("timeupdate",(function e(){d()&&(i.removeEventListener("timeupdate",e),i.pause())})),i.preload="metadata",i.muted=!0,i.play()}else{var p={metadata:{fileName:a,fileType:c,fileSize:n},fileType:{type:c},fileBytes:r};R((function(e){return e.push(p),Object(ae.a)(e)}))}}else te({message:j.formatMessage({id:"components.message-input.over-size-limit"},{fileName:a}),color:"danger",duration:2500})}))}))}})]})},Vt=Object(a.forwardRef)(Zt),Yt=n(80),Xt=n(92),Kt=n(131),qt=n(132),Wt=n(165),Jt=function(e){return function(){var t=Object(O.a)(h.a.mark((function t(n,a){var r,c,s,o;return h.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:e.err&&(r=a().p2pmessages.errMsgs,c=r[e.receiver.id]?r[e.receiver.id]:[],s=c.map((function(e){return JSON.stringify(e)})),(o=s.indexOf(JSON.stringify(e)))>-1&&c.splice(o,1),n({type:Ce.b,state:{errMsgs:Object(p.a)(Object(p.a)({},r),{},Object(A.a)({},e.receiver.id,c))}}));case 1:case"end":return t.stop()}}),t)})));return function(e,n){return t.apply(this,arguments)}}()},Qt=n(62),$t=function(e,t,n,a,r){return function(c,s){var o,i,u=s().profile,l=u.id,d=u.username,b=u.fields,j=s().contacts.contacts,m=s().p2pmessages.messages;"TEXT"===n?o={type:"TEXT",payload:{payload:t.trim()}}:o={type:"FILE",fileName:r.metadata.fileName,fileSize:r.metadata.fileSize,fileType:r.fileType.type,fileBytes:r.fileBytes,thumbnail:null===(i=r.fileType.payload)||void 0===i?void 0:i.thumbnail};var f={p2pMessageEntryHash:"error message",author:{id:l,username:d,fields:b},receiver:{id:e,username:j[e].username,fields:j[e].fields},payload:o,timestamp:new Date,replyTo:a&&m[a]?{p2pMessageEntryHash:m[a].p2pMessageEntryHash,author:m[a].author,receiver:m[a].receiver,payload:m[a].payload,timestamp:m[a].timestamp,replyTo:void 0,receipts:[]}:void 0,receipts:[],replyToId:a,err:!0},O=s().p2pmessages.errMsgs,g=s().p2pmessages.errMsgs[e]?s().p2pmessages.errMsgs[e]:[];return O=Object(p.a)(Object(p.a)({},O),{},Object(A.a)({},e,[f].concat(Object(ae.a)(g)))),c({type:Ce.b,state:{errMsgs:O}}),!0}},en=n(166),tn=n(133),nn=n.n(tn),an=function(e){var t=e.hash,n=e.size,r=void 0===n?32:n,c=e.className,s=void 0===c?"":c,i=e.avatar,u=void 0===i?void 0:i,l=Object(a.useRef)(null),d={hash:Object(v.a)(t),size:r};return Object(a.useEffect)((function(){l.current&&Object(en.a)(d,l.current)})),Object(m.jsx)("div",{children:u?Object(m.jsx)(o.b,{className:nn.a.avatar,children:Object(m.jsx)("img",{src:u,alt:"avatar"})}):Object(m.jsx)(o.s,{src:"assets/icon/person-circle-outline.svg",alt:"avatar",className:"".concat(nn.a.icon," ").concat(s)})})},rn=n(115),cn=n.n(rn),sn=function(e){var t=e.history,n=e.conversant,a=e.onHide,r=e.pathname,c=e.intl;return Object(m.jsxs)(o.A,{children:[Object(m.jsxs)(o.w,{button:!0,onClick:function(){a(),t.push({pathname:"".concat(r,"/details"),state:{conversant:n}})},children:[Object(m.jsx)(o.r,{slot:"start",icon:u.H}),Object(m.jsx)(o.z,{children:c.formatMessage({id:"app.chat.header-details"})})]}),Object(m.jsxs)(o.w,{button:!0,onClick:function(){t.push({pathname:"/u/".concat(n.id,"/search")}),a()},children:[Object(m.jsx)(o.r,{slot:"start",icon:u.bb}),Object(m.jsx)(o.z,{children:c.formatMessage({id:"app.chat.header-search"})})]}),Object(m.jsxs)(o.w,{button:!0,onClick:function(){t.push({pathname:"/u/".concat(n.id,"/pinned")}),a()},children:[Object(m.jsx)(o.r,{slot:"start",icon:u.T}),Object(m.jsx)(o.z,{children:c.formatMessage({id:"app.chat.header-pinned-messages"})})]})]})},on=function(e){var t=e.id,n=e.username,a=e.pathname,r=e.conversant,c=Object(M.f)(),s=Object(l.a)(),d=Object(o.rb)(sn,{onHide:function(){return j()},history:c,conversant:r,pathname:a,intl:s}),p=Object(i.a)(d,2),b=p[0],j=p[1];return Object(m.jsx)(o.q,{children:Object(m.jsxs)(o.fb,{children:[Object(m.jsx)(o.f,{slot:"start",children:Object(m.jsx)(o.e,{onClick:function(){return c.push({pathname:"/home/messaging"})},className:"ion-no-padding",children:Object(m.jsx)(o.r,{slot:"icon-only",icon:u.e})})}),Object(m.jsxs)("div",{className:cn.a["title-container"],children:[Object(m.jsx)(o.b,{className:"".concat(cn.a.avatar," ion-padding"),children:Object(m.jsx)(an,{hash:t,avatar:r.fields.avatar,size:50})}),Object(m.jsx)(o.cb,{className:cn.a.title,onClick:function(){return c.push({pathname:"/p/".concat(r.id),state:{profile:{username:r.username,id:r.id,fields:r.fields},prev:"/u/".concat(r.id)}})},children:Object(m.jsx)(X,{nickname:n,id:t})})]}),Object(m.jsx)(o.f,{slot:"end",children:Object(m.jsx)(o.e,{onClick:function(e){return b({event:e.nativeEvent})},children:Object(m.jsx)(o.r,{icon:u.C})})})]})})},un=n(105),ln=function(){var e=I(),t=Object(M.h)().id,n=Object(a.useState)(""),r=Object(i.a)(n,2),c=r[0],s=r[1],u=Object(a.useState)([]),l=Object(i.a)(u,2),b=l[0],j=l[1],f=Object(a.useState)(""),g=Object(i.a)(f,2),v=g[0],y=g[1],x=Object(a.useState)([]),_=Object(i.a)(x,2),E=_[0],T=_[1],S=Object(a.useState)([]),N=Object(i.a)(S,2),w=N[0],k=N[1],R=Object(a.useState)(!1),P=Object(i.a)(R,2),A=P[0],C=P[1],G=Object(d.c)((function(e){return e.p2pmessages})),L=G.conversations,D=G.messages,H=G.receipts,U=G.errMsgs,z=G.files,F=G.pinned,B=Object(d.c)((function(e){var n=e.p2pmessages.typing;return Object.values(n).filter((function(e){return e.id===t}))})),Z=Object(d.c)((function(e){var n=e.contacts.contacts;console.log("contacts state is ",n);var a=Object.values(n).filter((function(e){return e.id===t}));return console.log("conversant from state is ",a),a[0]})),V=Object(d.c)((function(e){return e.preference})),Y=V.readReceipt,X=V.typingIndicator,K=Object(M.g)(),q=K.pathname,W=K.state,J=Object(d.c)((function(e){var n,a,r,c;return null!==W&&void 0!==W&&W.username?null===W||void 0===W?void 0:W.username:null!==(n=e.contacts)&&void 0!==n&&null!==(a=n.contacts[t])&&void 0!==a&&a.username?null===(r=e.contacts)||void 0===r||null===(c=r.contacts[t])||void 0===c?void 0:c.username:""})),Q=Object(a.useRef)(null),$=Object(a.useRef)(!1),ee=Object(a.useRef)(),te=Object(a.useRef)(),ne=Object(a.useRef)(null);Object(a.useEffect)((function(){Q.current.scrollToBottom()}),[]),Object(a.useEffect)((function(){Q.current.scrollToBottom()}),[Z]),Object(a.useEffect)((function(){void 0!==Z&&e(function(e){return function(){var t=Object(O.a)(h.a.mark((function t(n,a){var r,c,s,o;return h.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return r=Object(p.a)({},a().p2pmessages),c=r.conversations[e.id],s=r.errMsgs[e.id]?r.errMsgs[e.id]:[],o=c?c.messages.map((function(e){var t=r.messages[e];if(t.receipts.length>0){var n=t.receipts.map((function(e){return r.receipts[e]}));return n.sort((function(e,t){var n=e.timestamp.getTime(),a=t.timestamp.getTime();return n>a?-1:n<a?1:0})),t.err=!1,{message:t,receipt:n[0]}}return t.err=!0,{message:t,receipt:void 0}})):[],s.forEach((function(e){var t={message:e};o.push(t)})),o.sort((function(e,t){return e.message.timestamp.getTime()-t.message.timestamp.getTime()})),t.abrupt("return",o);case 7:case"end":return t.stop()}}),t)})));return function(e,n){return t.apply(this,arguments)}}()}(Z)).then((function(e){return T(e)}))}),[L,D,H,Z,U]),Object(a.useEffect)((function(){e(Object(Xt.a)(t))}),[]),Object(a.useEffect)((function(){w.length>0&&(ee.current&&clearTimeout(ee.current),ee.current=setTimeout((function(){e(Object(Wt.a)(w)),k([])}),1e3))}),[w]);var re=function(t){void 0!==z[t.fileHash]?ce(z[t.fileHash],t.fileName):e(Ge([t.fileHash])).then((function(e){e&&Object.keys(e).length>0&&ce(e[t.fileHash],t.fileName)}))},ce=function(e,t){var n=new Blob([e]),a=document.createElement("a");a.href=window.URL.createObjectURL(n),a.download=t,a.click()},se=function(t){var n=t.message.p2pMessageEntryHash,a=t.message.author,r=t.message.payload,c=t.message.replyTo?{payload:t.message.replyTo.payload,author:t.message.replyTo.author,id:t.message.replyTo.p2pMessageEntryHash}:null,s=void 0===t.message.err&&t.receipt?t.receipt.timestamp:t.message.timestamp,o=t.message.err?void 0:t.receipt&&"read"===t.receipt.status?{key:s}:void 0;return"FILE"===r.type&&"VIDEO"===r.fileType&&void 0===z[r.fileHash]&&void 0===t.message.err&&e(Ge([r.fileHash])),console.log("p2p conversant is ",Z,"and author is ",a),Z.id!==a.id?Object(m.jsx)(jt,{id:t.message.p2pMessageEntryHash,profile:t.message.author,type:"p2p",timestamp:s,onRetry:function(n){return function(t,n){if(t(!0),"error message"===n.p2pMessageEntryHash)if("TEXT"===n.payload.type)e(Object(Qt.a)(Z.id,n.payload.payload.payload,"TEXT",n.replyToId)).then((function(a){if(t(!1),!a)return null;e(Jt(n))}));else{var a={metadata:{fileName:n.payload.fileName,fileType:n.payload.fileType,fileSize:n.payload.fileSize},fileType:{type:n.payload.fileType,payload:"OTHER"===n.payload.fileType?void 0:{thumbnail:n.payload.thumbnail}},fileBytes:n.payload.fileBytes};e(Object(Qt.a)(Z.id,"","FILE",""!==v?v:void 0,a)).then((function(a){if(t(!1),!a)return null;e(Jt(n))}))}else e(Object(un.a)(n)).then((function(e){return t(!1)}))}(n,t.message)},onDelete:function(){return e(Jt(t.message))},payload:r,readList:o||{},showProfilePicture:!0,showName:!0,onDownload:function(e){return re(e)},replyTo:c||void 0,onReply:function(e){var t;ne.current&&(null===ne||void 0===ne||null===(t=ne.current)||void 0===t||t.reply(e)),y(e.id)},onPinMessage:function(){e(Object(qt.a)([t.message]))},isPinned:!!F[t.message.p2pMessageEntryHash],err:t.message.err},n):Object(m.jsx)(gt,{id:t.message.p2pMessageEntryHash,profile:t.message.author,type:"p2p",timestamp:s,payload:r,readList:o||{},showProfilePicture:!0,onPinMessage:function(){return e(Object(qt.a)([t.message]))},showName:!0,onSeen:function(e){return function(e){"read"!==e.receipt.status&&Y&&k((function(t){return[].concat(Object(ae.a)(t),[e.message])}))}(t)},onDownload:function(e){return re(e)},replyTo:c||void 0,onReply:function(e){var t;ne.current&&(null===ne||void 0===ne||null===(t=ne.current)||void 0===t||t.reply(e)),y(e.id)},isPinned:!!F[t.message.p2pMessageEntryHash]},n)};return Object(m.jsxs)(o.H,{children:[Object(m.jsx)(on,{id:t,pathname:q,conversant:Z,username:J}),Object(m.jsx)(o.k,{children:Object(m.jsx)(oe,{type:"p2p",onScrollTop:function(t){return function(t){if(!1===A){var n=E[0]?E[0].message:null;n&&!n.err&&e(Object(Yt.a)(Z.id,5,"All",n.timestamp,n.p2pMessageEntryHash)).then((function(e){return e&&Object.values(e)[0][Z.id].length<=0&&C(!0),t()}))}return t()}(t)},ref:Q,disabled:A,children:E.map((function(e){return se(e)}))})}),Object(m.jsx)(_t,{profiles:Object.values(B)}),Object(m.jsx)(Vt,{ref:ne,onSend:function(t){var n=Object(p.a)({},t),a=n.message,r=n.setIsLoading;r(!0),a&&""!==a&&e(Object(Qt.a)(Z.id,a,"TEXT",""!==v?v:void 0)).then((function(t){return t||e($t(Z.id,c,"TEXT",""!==v?v:void 0)),b.length?b.forEach((function(t){return e(Object(Qt.a)(Z.id,c,"FILE",""!==v?v:void 0,t)).then((function(n){n||e($t(Z.id,c,"FILE",""!==v?v:void 0,t)),r(!1)}))})):r(!1)})),""===a&&b.length&&b.forEach((function(t){return e(Object(Qt.a)(Z.id,c,"FILE",""!==v?v:void 0,t)).then((function(n){n||e($t(Z.id,c,"FILE",""!==v?v:void 0,t)),r(!1)}))})),Q.current.scrollToBottom(),y("")},onChange:function(t){return function(t,n){!0===$.current?(X&&(e(Object(Kt.a)(n.id,!(!t||0===t.length))),te.current&&clearTimeout(te.current),te.current=setTimeout((function(){return e(Object(Kt.a)(n.id,!1))}),500)),s(t)):$.current=!0}(t,Z)},onFileSelect:function(e){return j(e)}})]})},dn=n(116),pn=n.n(dn),bn=function(e){var t=e.profile,n=Object(M.f)();return Object(m.jsxs)("div",{children:[Object(m.jsx)(o.fb,{className:pn.a.controls,children:Object(m.jsx)("span",{children:Object(m.jsx)(o.f,{slot:"start",children:Object(m.jsx)(o.e,{onClick:function(){return n.push({pathname:"/u/".concat(t.id)})},className:"ion-no-padding",children:Object(m.jsx)(o.r,{slot:"icon-only",icon:u.e})})})})}),Object(m.jsx)("div",{className:pn.a.titlebar,children:Object(m.jsx)("p",{className:pn.a.title,children:Object(m.jsx)(X,{displayId:!1,nickname:t.username,id:t.id})})})]})},jn=function(e){var t=e.onSegmentChange,n=e.value,a=Object(l.a)();return Object(m.jsx)(o.fb,{children:Object(m.jsxs)(o.O,{value:n,onIonChange:function(e){return t(e.detail.value)},children:[Object(m.jsx)(o.P,{value:"Info",children:Object(m.jsx)(o.z,{children:a.formatMessage({id:"app.chat.chat-details.info"})})}),Object(m.jsx)(o.P,{value:"Media",children:Object(m.jsx)(o.z,{children:a.formatMessage({id:"app.chat.chat-details.media"})})}),Object(m.jsx)(o.P,{value:"Files",children:Object(m.jsx)(o.z,{children:a.formatMessage({id:"app.chat.chat-details.files"})})})]})})},mn=n(56),fn=n.n(mn),On=function(e){var t=e.orderedMediaMessages,n=e.onDownload,c=e.onScrollBottom,s=I(),i=Object(d.c)((function(e){return Object.assign({},e.groups.groupFiles,e.p2pmessages.files)})),u=Object(l.a)(),p=Object(a.useRef)(null),b=function(){var e;return null===(e=p.current)||void 0===e?void 0:e.complete()},j=new TextDecoder,f=-1,O=function(e){return e!==f?(f=e,Object(m.jsx)(o.j,{size:"12",children:Object(m.jsx)("h2",{className:fn.a.month,children:Object(C.c)(e,u)})})):null},g=function(e){return"VIDEO"===e.payload.fileType?Object(m.jsx)("div",{className:fn.a.mediadiv,children:Object(m.jsx)(tt,{download:function(){return n(e.payload)},src:URL.createObjectURL(new Blob([i[e.payload.fileHash]],{type:"video/mp4"})),className:fn.a.video,thumbnail:URL.createObjectURL(new Blob([e.payload.thumbnail],{type:"image/jpeg"})),onPlayPauseErrorHandler:function(t){Object(L.c)(e)?s(Ge([e.payload.fileHash])).then((function(e){e&&t(!1)})):s(ke([e.payload.fileHash])).then((function(e){e&&t(!1)}))}})}):Object(m.jsx)("div",{className:fn.a.mediadiv,children:Object(m.jsx)(Ve,{file:e.payload,src:j.decode(e.payload.thumbnail),onDownload:n})})};return Object(m.jsx)(o.S,{children:Object(m.jsxs)(o.p,{children:[Object(m.jsx)(o.M,{className:fn.a.mediarow,children:t.map((function(e,t){var n=e.timestamp.getMonth();return Object(m.jsxs)(r.a.Fragment,{children:[O(n),Object(m.jsx)(o.j,{size:"3",children:Object(m.jsx)(o.g,{className:fn.a.mediacard,children:g(e)})})]},t)}))}),Object(m.jsx)(o.M,{children:Object(m.jsx)(o.t,{ref:p,position:"bottom",onIonInfinite:function(e){return c(b,t[t.length-1])},children:Object(m.jsx)(o.u,{})})})]})})},gn=function(e){var t=e.orderedFileMessages,n=e.onDownload,c=e.onScrollBottom,s=Object(l.a)(),i=Object(a.useRef)(null),u=function(){var e;return null===(e=i.current)||void 0===e?void 0:e.complete()},d=-1,p=function(e){return e!==d?(d=e,Object(m.jsx)(o.j,{size:"12",children:Object(m.jsx)("h2",{className:fn.a.month,children:Object(C.c)(e,s)})})):null};return Object(m.jsx)(o.S,{children:Object(m.jsxs)(o.p,{children:[Object(m.jsx)(o.M,{className:fn.a.mediarow,children:t.map((function(e){var t=e.timestamp.getMonth();return Object(m.jsxs)(r.a.Fragment,{children:[p(t),Object(m.jsx)(o.j,{size:"12",children:Object(m.jsx)(o.g,{className:fn.a.mediacard,children:Object(m.jsx)(He,{file:e.payload,onDownload:n,darken:!0})})})]})}))}),Object(m.jsx)(o.M,{children:Object(m.jsx)(o.t,{ref:i,position:"bottom",onIonInfinite:function(e){return c(u,t[t.length-1])},children:Object(m.jsx)(o.u,{})})})]})})},hn=n(167),vn=n.n(hn),yn=function(e){var t=e.nickname,n=e.id;console.log("this is profile info",t,n);var a=Object(l.a)(),r=n.slice(5);return Object(m.jsx)(m.Fragment,{children:Object(m.jsxs)(o.y,{className:vn.a.container,children:[Object(m.jsx)(o.w,{lines:"none",children:Object(m.jsx)("h3",{children:a.formatMessage({id:"components.profile-info.nickname"})})}),Object(m.jsx)(o.w,{lines:"none",children:Object(m.jsx)(o.Z,{children:t})}),Object(m.jsx)(o.w,{lines:"none",children:Object(m.jsx)("h3",{children:a.formatMessage({id:"components.profile-info.id"})})}),Object(m.jsx)(o.w,{lines:"none",children:Object(m.jsx)(o.Z,{children:r})})]})})},xn=function(e){var t=e.location,n=Object(p.a)({},t).state,r=Object(d.c)((function(e){return e.p2pmessages})),c=r.conversations,s=r.messages,u=Object(d.c)((function(e){return e.p2pmessages.files})),l=Object(a.useState)(!1),b=Object(i.a)(l,2),j=b[0],f=b[1],O=Object(a.useState)([]),g=Object(i.a)(O,1)[0],h=Object(a.useState)([]),v=Object(i.a)(h,1)[0],y=Object(a.useState)({}),x=Object(i.a)(y,1)[0],_=Object(a.useState)("Info"),E=Object(i.a)(_,2),T=E[0],S=E[1],N=I(),w=Object(a.useRef)(null);Object(a.useEffect)((function(){N(Object(Yt.a)(n.conversant.id,40,"Other",void 0,void 0)),N(Object(Yt.a)(n.conversant.id,40,"Media",void 0,void 0))}),[]),Object(a.useEffect)((function(){void 0!==n.conversant&&void 0!==c[n.conversant.id]&&c[n.conversant.id].messages.forEach((function(e){var t=s[e];if("FILE"===t.payload.type){var n=t.payload.fileType;if(!x[e])switch(n){case"IMAGE":case"VIDEO":g.push(t),x[e]=!0;break;case"OTHER":v.push(t),x[e]=!0}}}))}),[c,s]);var M=function(e){void 0!==u[e.fileHash]?k(u[e.fileHash],e.fileName):N(Ge([e.fileHash])).then((function(t){t&&Object.keys(t).length>0&&k(t[e.fileHash],e.fileName)}))},k=function(e,t){var n=new Blob([e]),a=document.createElement("a");a.href=window.URL.createObjectURL(n),a.download=t,a.click()},R=function(e,t){if(!j){var a=t;void 0!==a&&N(Object(Yt.a)(n.conversant.id,10,"IMAGE"===a.payload.fileType||"VIDEO"===a.payload.fileType?"Media":"Other",void 0!==a?a.timestamp:void 0,void 0!==a?a.p2pMessageEntryHash:void 0)).then((function(t){Object.values(t)[0][n.conversant.id].length<=0&&f(!0),e()}))}e()};return Object(m.jsxs)(o.H,{children:[Object(m.jsxs)(o.q,{children:[Object(m.jsx)(bn,{profile:n.conversant}),Object(m.jsx)(jn,{value:T,onSegmentChange:function(e){var t;null===(t=w.current)||void 0===t||t.slideTo(["Info","Media","Files"].indexOf(e))}})]}),Object(m.jsx)(o.k,{children:Object(m.jsxs)(o.T,{ref:w,className:"slides",pager:!1,options:{initialSlide:0,speed:400},onIonSlideDidChange:function(){var e,t=["Info","Media","Files"];null===(e=w.current)||void 0===e||e.getActiveIndex().then((function(e){return S(t[e])}))},children:[Object(m.jsx)(o.S,{children:Object(m.jsx)(yn,{nickname:n.conversant.username,id:n.conversant.id})}),Object(m.jsx)(On,{orderedMediaMessages:g,onDownload:function(e){return M(e)},onScrollBottom:function(e,t){return R(e,t)}}),Object(m.jsx)(gn,{orderedFileMessages:v,onDownload:function(e){return M(e)},onScrollBottom:function(e,t){return R(e,t)}})]})})]})},_n=function(e,t){var n=e.isVisible,r=void 0===n||n,c=e.onChange,s=Object(a.useState)(new Date((new Date).setDate((new Date).getDate()+1))),u=Object(i.a)(s,2),l=u[0],d=u[1],p=Object(a.useRef)(null);return Object(a.useImperativeHandle)(t,(function(){return{open:function(){var e;null===p||void 0===p||null===(e=p.current)||void 0===e||e.open()}}})),Object(m.jsx)(o.l,{ref:p,value:Object(C.a)(l),style:{display:r?"block":"none"},max:Object(C.a)(new Date((new Date).setDate((new Date).getDate()))),onIonChange:function(e){if(e.detail.value){var t=Object(C.d)(e.detail.value);d(t),c&&c(t)}}})},En=Object(a.forwardRef)(_n),Tn=n(134),Sn=n.n(Tn),Nn=function(e){var t=e.type,n=e.prevHref,r=e.onDateSelect,c=e.messages,s=Object(a.useRef)(null),l=Object(a.useState)(null),p=Object(i.a)(l,2),b=p[0],j=p[1],f=Object(M.f)();Object(a.useEffect)((function(){c&&j(c)}),[c]);var O=Object(d.c)((function(e){return e.profile})),g=function(){var e;null===(e=s.current)||void 0===e||e.open()},h=function(){};return Object(m.jsx)(o.H,{children:b?Object(m.jsxs)(m.Fragment,{children:[Object(m.jsx)(o.q,{children:Object(m.jsx)(o.fb,{children:Object(m.jsx)(o.f,{children:Object(m.jsx)(o.e,{onClick:function(){return j(null)},children:Object(m.jsx)(o.r,{icon:u.d})})})})}),Object(m.jsx)(o.k,{children:b?Object(m.jsx)(oe,{type:t,children:b.map((function(e,t){return e.author.id===O.id?Object(m.jsx)(jt,{id:e.id,onDownload:h,profile:e.author,timestamp:e.timestamp,payload:e.payload,readList:e.readList,replyTo:e.replyTo,type:"group",isPinned:!1,showName:!0,showProfilePicture:!0},t):Object(m.jsx)(gt,{id:e.id,onDownload:h,profile:e.author,timestamp:e.timestamp,isPinned:!1,payload:e.payload,readList:e.readList,replyTo:e.replyTo,type:"group",showName:!0,showProfilePicture:!0},t)}))}):Object(m.jsxs)(o.A,{className:Sn.a.search,children:[Object(m.jsxs)(o.w,{lines:"full",button:!0,onClick:g,children:[Object(m.jsx)(o.r,{slot:"start",icon:u.i}),Object(m.jsx)(o.z,{children:"Search by date"})]}),Object(m.jsx)(En,{ref:s,isVisible:!1,onChange:r})]})})]}):Object(m.jsxs)(m.Fragment,{children:[Object(m.jsx)(o.q,{children:Object(m.jsx)(o.fb,{children:Object(m.jsx)(o.f,{children:Object(m.jsx)(o.e,{onClick:function(){return f.push({pathname:n})},className:"ion-no-padding",children:Object(m.jsx)(o.r,{slot:"icon-only",icon:u.e})})})})}),Object(m.jsx)(o.k,{children:Object(m.jsxs)(o.A,{className:Sn.a.search,children:[Object(m.jsxs)(o.w,{lines:"full",button:!0,onClick:g,children:[Object(m.jsx)(o.r,{slot:"start",icon:u.i}),Object(m.jsx)(o.z,{children:"Search by date"})]}),Object(m.jsx)(En,{ref:s,isVisible:!1,onChange:function(e){r&&r(e)}})]})})]})})},wn=function(){var e=Object(a.useState)(),t=Object(i.a)(e,2),n=t[0],r=t[1],c=Object(M.h)().id,s=I();return Object(m.jsx)(Nn,{type:"p2p",messages:n,onDateSelect:function(e){s(function(e,t,n){return function(){var a=Object(O.a)(h.a.mark((function a(r,c,s){var o,i,u,l,d,b,j;return h.a.wrap((function(a){for(;;)switch(a.prev=a.next){case 0:return o=s.callZome,i={conversant:Object(v.a)(e),date:t,payload_type:n},a.prev=2,a.next=5,o({zomeName:x.c.P2PMESSAGE,fnName:x.a[x.c.P2PMESSAGE].GET_MESSAGES_BY_AGENT_BY_TIMESTAMP,payload:i});case 5:if("error"===(null===(u=a.sent)||void 0===u?void 0:u.type)){a.next=12;break}return l=Object(p.a)({},c().contacts.contacts),d=Object(p.a)({},c().profile),b=Object(p.a)(Object(p.a)({},l),{},Object(A.a)({},d.id,{id:d.id,username:d.username,fields:d.fields})),j=Object(F.a)(u,b),a.abrupt("return",j);case 12:a.next=17;break;case 14:a.prev=14,a.t0=a.catch(2),r(Object(_.a)("TOAST",{},{id:"redux.err.generic"}));case 17:case"end":return a.stop()}}),a,null,[[2,14]])})));return function(e,t,n){return a.apply(this,arguments)}}()}(c,e,"All")).then((function(e){var t=Object.values(e.messages).map((function(t){var n=t.receipts.map((function(t){return e.receipts[t]}));n.sort((function(e,t){var n=e.timestamp.getTime(),a=t.timestamp.getTime();return n>a?-1:n<a?1:0}));var a=n[0],r="read"===a.status?{key:a.timestamp}:{};return{id:t.p2pMessageEntryHash,author:t.author,payload:t.payload,timestamp:t.timestamp,readList:r}}));r(t.reverse())}))},prevHref:"/u/".concat(c)})},In=n(58),Mn=n.n(In),kn=function(e){var t=e.messages,n=e.onMessageClick,a=e.type,r=void 0===a?"group":a,c=new TextDecoder,s=I(),i=Object(d.c)((function(e){return Object.assign({},e.groups.groupFiles,e.p2pmessages.files)})),l=function(e){switch(e.fileType){case"OTHER":return Object(m.jsxs)("div",{className:"".concat(Mn.a.other," ion-padding"),children:[Object(m.jsx)(o.r,{className:"ion-margin-end",icon:u.y}),Object(m.jsxs)("div",{className:Mn.a["file-details"],children:[Object(m.jsx)(o.Z,{className:Mn.a["file-name"],children:e.fileName}),Object(m.jsx)(o.Z,{className:Mn.a["file-size"],children:Object(y.b)(e.fileSize)})]})]});case"IMAGE":return Object(m.jsx)(o.s,{className:"".concat(Mn.a.thumbnail," ion-margin-end"),src:c.decode(null===e||void 0===e?void 0:e.thumbnail)});case"VIDEO":var t=i[e.fileHash];return Object(m.jsx)(tt,{className:Mn.a.video,thumbnail:URL.createObjectURL(new Blob([e.thumbnail],{type:"image/jpeg"})),onPlayPauseErrorHandler:function(t){"p2p"===r?s(Ge([e.fileHash])).then((function(e){e&&t(!1)})):s(ke([e.fileHash])).then((function(e){e&&t(!1)}))},src:URL.createObjectURL(new Blob([t],{type:"video/mp4"})),download:function(){if(t){var n=new Blob([t]),a=document.createElement("a");a.href=window.URL.createObjectURL(n),a.download=e.fileName,a.click()}}})}};return Object(m.jsx)(o.A,{children:t.sort((function(e,t){return e.date>t.date?-1:1})).map((function(e,t){var a=Object(y.e)(e.payload);return Object(m.jsx)(o.w,{button:!0,onClick:function(){n&&n(e)},children:Object(m.jsxs)("div",{className:Mn.a["content-container"],children:[Object(m.jsxs)("div",{className:Mn.a.header,children:[Object(m.jsx)(o.z,{className:Mn.a.author,children:e.author}),Object(m.jsx)(o.G,{className:"".concat(Mn.a.date," ion-padding-start"),children:e.date.toDateString()})]}),a?Object(m.jsx)(o.Z,{children:e.payload.payload.payload}):l(e.payload)]})},t)}))})},Rn=function(){var e=Object(M.h)().id,t=Object(l.a)(),n=Object(M.f)(),r=I();Object(a.useEffect)((function(){r(Object(Xt.a)(e))}),[]);var c=Object(d.c)((function(t){var n=t.p2pmessages.conversations[e];if(n){if(n.pinned&&!(n.pinned.filter((function(e){return!t.p2pmessages.pinned})).length>0))return n.pinned.map((function(e){var n=t.p2pmessages.pinned[e];return{id:n.p2pMessageEntryHash,payload:n.payload,author:n.author.username,date:n.timestamp}}));r(Object(Xt.a)(e))}return[]}));return Object(m.jsxs)(o.H,{children:[Object(m.jsx)(o.q,{children:Object(m.jsx)(o.fb,{children:Object(m.jsxs)(o.f,{children:[Object(m.jsx)(o.e,{onClick:function(){return n.push({pathname:"/u/".concat(e)})},className:"ion-no-padding",children:Object(m.jsx)(o.r,{slot:"icon-only",icon:u.e})}),Object(m.jsx)(o.cb,{children:t.formatMessage({id:"app.chat.pinned-message-title"})})]})})}),Object(m.jsx)(o.k,{children:Object(m.jsx)(kn,{onMessageClick:function(e){},messages:Object.values(c)})})]})},Pn=function(){return Object(m.jsxs)(M.d,{children:[Object(m.jsx)(M.b,{path:"/u/:id",exact:!0,children:Object(m.jsx)(ln,{})}),Object(m.jsx)(M.b,{path:"/u/:id/details",exact:!0,component:xn}),Object(m.jsx)(M.b,{path:"/u/:id/search",exact:!0,component:wn}),Object(m.jsx)(M.b,{path:"/u/:id/pinned",exact:!0,component:Rn})]})},An=function(e){return function(){var t=Object(O.a)(h.a.mark((function t(n,a,r){var c,s,o,i,u,l,d;return h.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return c=r.callZome,r.getAgentId,t.prev=1,t.next=4,c({zomeName:x.c.GROUP,fnName:x.a[x.c.GROUP].FETCH_PINNED_MESSAGES,payload:e});case 4:if(s=t.sent,o=a().groups.conversations[e]){t.next=10;break}n(fe(e)),t.next=17;break;case 10:return i=Object.values(s),u={},l=a().profile.id,d=i.map(function(){var t=Object(O.a)(h.a.mark((function t(n){var r,s,o,i,d,p;return h.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return s=n.entry,o=Object(v.b)(s.messageId),t.t0=Object,t.next=5,U(a(),[Object(v.b)(s.sender)],c,l);case 5:return t.t1=t.sent,i=t.t0.values.call(t.t0,t.t1)[0].username,d="TEXT"===s.payload.type?s.payload:{type:"FILE",fileType:s.payload.payload.fileType.type,fileHash:Object(v.b)(s.payload.payload.metadata.fileHash),fileName:s.payload.payload.metadata.fileName,fileSize:s.payload.payload.metadata.fileSize,thumbnail:null===(r=s.payload.payload.fileType.payload)||void 0===r?void 0:r.thumbnail},p={groupId:e,groupMessageId:o,author:i,payload:d,timestamp:Object(C.e)(s.created),readList:{}},u[o]=p,t.abrupt("return",o);case 11:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()),t.next=16,Promise.all(d).then((function(e){return o.pinnedMessages=e}));case 16:n({type:z.l,pinnedMessages:Object(p.a)(Object(p.a)({},a().groups.pinnedMessages),u),conversations:Object(p.a)(Object(p.a)({},a().groups.conversations),{},Object(A.a)({},e,o))});case 17:t.next=22;break;case 19:return t.prev=19,t.t0=t.catch(1),t.abrupt("return",n(Object(_.a)("TOAST",{},{id:"redux.err.generic"})));case 22:case"end":return t.stop()}}),t,null,[[1,19]])})));return function(e,n,a){return t.apply(this,arguments)}}()},Cn=function(e,t){return function(){var n=Object(O.a)(h.a.mark((function n(a,r,c){var s,o,i,u,l,d;return h.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return s=c.callZome,n.prev=1,n.next=4,s({zomeName:x.c.GROUP,fnName:x.a[x.c.GROUP].PIN_MESSAGE,payload:{groupHash:e,groupMessageHash:t}});case 4:o=Object(p.a)({},{pinnedMessages:r().groups.pinnedMessages,message:r().groups.messages[t],conversations:r().groups.conversations}),i=o.conversations,u=o.pinnedMessages,l=o.message,d=i[e],u[t]=l,d.pinnedMessages?d.pinnedMessages.push(t):d.pinnedMessages=[t],a({type:z.l,conversations:Object(p.a)(Object(p.a)({},i),{},Object(A.a)({},e,d)),pinnedMessages:Object(p.a)(Object(p.a)({},r().groups.pinnedMessages),u)}),n.next=18;break;case 11:if(n.prev=11,n.t0=n.catch(1),!n.t0.message.includes("failed to get the message being pinned")){n.next=17;break}a(Object(_.a)("TOAST",{},{id:"redux.err.group.pin-message"})),n.next=18;break;case 17:return n.abrupt("return",a(Object(_.a)("TOAST",{},{id:"redux.err.generic"})));case 18:case"end":return n.stop()}}),n,null,[[1,11]])})));return function(e,t,a){return n.apply(this,arguments)}}()},Gn=function(e,t){return function(){var n=Object(O.a)(h.a.mark((function n(a,r,c){var s,o,i,u,l,d;return h.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return s=c.callZome,n.prev=1,n.next=4,s({zomeName:x.c.GROUP,fnName:x.a[x.c.GROUP].UNPIN_MESSAGE,payload:{groupHash:e,groupMessageHash:t}});case 4:o=Object(p.a)({},{conversations:r().groups.conversations,pinnedMessages:r().groups.pinnedMessages}),i=o.conversations,u=o.pinnedMessages,l=i[e],u[t],d=Object(xe.a)(u,[t].map(_e.a)),l.pinnedMessages=l.pinnedMessages?l.pinnedMessages.filter((function(e){return e!==t})):[],a({type:z.l,conversations:Object(p.a)(Object(p.a)({},i),{},Object(A.a)({},e,l)),pinnedMessages:d}),n.next=14;break;case 11:return n.prev=11,n.t0=n.catch(1),n.abrupt("return",a(Object(_.a)("TOAST",{},{id:"redux.err.generic"})));case 14:case"end":return n.stop()}}),n,null,[[1,11]])})));return function(e,t,a){return n.apply(this,arguments)}}()},Ln=function(e){var t=e.messageIds,n=e.members,r=e.onReply,c=e.chatList,s=e.groupId,o=e.readReceipt,u=I(),l=Object(d.c)((function(e){return e.groups.groupFiles})),b=Object(d.c)((function(e){return e.groups})),j=b.messages,f=b.errMsgs,O=b.pinnedMessages,g=Object(d.c)((function(e){return console.log("members from state ",e.groups.members),e.groups.members})),h=Object(d.c)((function(e){return console.log("profile from state ",e.profile),e.profile})),v=Object(a.useState)([]),y=Object(i.a)(v,2),x=y[0],_=y[1],E=Object(a.useState)([]),T=Object(i.a)(E,2),S=T[0],N=T[1],w=Object(a.useState)(!1),M=Object(i.a)(w,2),k=M[0],R=M[1],P=Object(a.useRef)(),A=function(e){var t=l[e.fileHash];if(t){var n=new Blob([t]),a=document.createElement("a");a.href=window.URL.createObjectURL(n),a.download=e.fileName,a.click()}else u(ke([e.fileHash])).then((function(t){if(t&&Object.keys(t).length>0){var n=t[e.fileHash],a=new Blob([n]),r=document.createElement("a");r.href=window.URL.createObjectURL(a),r.download=e.fileName,r.click()}}))},C=Object(a.useState)([]),G=Object(i.a)(C,2),D=G[0],H=G[1];Object(a.useEffect)((function(){D.length>0&&(P.current&&clearTimeout(P.current),P.current=setTimeout((function(){var e=D[0],t=Object(p.a)(Object(p.a)({},e),{},{messageIds:D.map((function(e){return e.messageIds})).flat()});u(ye(t)),H([])}),1500))}),[D]);return Object(a.useEffect)((function(){var e=u(he(t,s));e.sort((function(e,t){return e.timestamp.getTime()-t.timestamp.getTime()})),_(e)}),[t,j,f]),Object(a.useEffect)((function(){S.length>0&&(P.current&&clearTimeout(P.current),P.current=setTimeout((function(){var e={groupId:s,messageIds:S,reader:h.id,timestamp:new Date,members:n};u(ye(e)).then((function(e){N([])}))}),1e3))}),[S]),Object(m.jsx)(m.Fragment,{children:Object(m.jsx)(vt.ChatList,{disabled:k,onScrollTop:function(e){return function(e){var t=x[0];k||!t||t.err||u(Oe({groupId:s,lastFetched:t.groupMessageId,lastMessageTimestamp:t.timestamp,batchSize:10,payloadType:{type:"ALL",payload:null}})).then((function(t){t&&Object.keys(t.groupMessagesContents).length<=0&&R(!0),e()})),e()}(e)},ref:c,type:"group",children:x.map((function(e,t){return console.log("group message ",e.payload,"\nself ",h,"\nand message author is ",e.author),e.author.id===h.id?Object(m.jsx)(vt.Me,{id:e.groupMessageId,profile:e.author,onDownload:A,onDelete:function(){return u(Me(e))},onRetry:function(t){return function(e,t){var n={groupId:t.groupId,payloadInput:Object(L.d)(t.payload)?{type:"TEXT",payload:{payload:t.payload.payload.payload}}:{type:"FILE",payload:{metadata:{fileName:t.payload.fileName,fileSize:t.payload.fileSize,fileType:t.payload.fileType},fileType:"IMAGE"===t.payload.fileType?{type:"IMAGE",payload:{thumbnail:t.payload.thumbnail}}:"VIDEO"===t.payload.fileType?{type:"VIDEO",payload:{thumbnail:t.payload.thumbnail}}:{type:"OTHER"},fileBytes:t.payload.fileBytes}},sender:t.author.id,replyTo:t.replyToId};e(!0),u(Ne(n)).then((function(n){if(e(!1),!n)return null;u(Me(t))}))}(t,e)},isPinned:!!O[e.groupMessageId],timestamp:e.timestamp,payload:e.payload,readList:e.readList,onPinMessage:function(){O[e.groupMessageId]?u(Gn(s,e.groupMessageId)):u(Cn(s,e.groupMessageId))},replyTo:e.replyTo?{payload:e.replyTo.payload,author:{id:g[e.replyTo.author].id,username:g[e.replyTo.author].username,fields:g[e.replyTo.author].fields},id:"".concat(t)}:void 0,type:"group",showName:!0,showProfilePicture:!0,onReply:function(e){function t(t){return e.apply(this,arguments)}return t.toString=function(){return e.toString()},t}((function(e){return r(e)})),err:e.err},t):Object(m.jsx)(vt.Others,{id:e.groupMessageId,profile:e.author,onDownload:A,isPinned:!!O[e.groupMessageId],onPinMessage:function(){O[e.groupMessageId]?u(Gn(s,e.groupMessageId)):u(Cn(s,e.groupMessageId))},timestamp:e.timestamp,payload:e.payload,readList:e.readList,type:"group",replyTo:e.replyTo?{payload:e.replyTo.payload,author:{id:g[e.replyTo.author].id,username:g[e.replyTo.author].username,fields:g[e.replyTo.author].fields},id:"".concat(t)}:void 0,showName:!0,onSeen:function(t){return function(e,t){if(o&&!Object.keys(t.readList).includes(h.id)){var a={groupId:s,messageIds:[t.groupMessageId],reader:h.id,timestamp:t.timestamp,members:n};H((function(e){return[].concat(Object(ae.a)(e),[a])})),e()}}(t,e)},onReply:function(e){function t(t){return e.apply(this,arguments)}return t.toString=function(){return e.toString()},t}((function(e){return r(e)})),showProfilePicture:!0},t)}))})})},Dn=n(117),Hn=n.n(Dn),Un=function(e){var t=e.groupData,n=e.history,a=e.onHide,r=e.intl;return Object(m.jsxs)(o.A,{children:[Object(m.jsxs)(o.w,{button:!0,onClick:function(){a(),n.push("/g/".concat(t.originalGroupId,"/details"))},children:[Object(m.jsx)(o.r,{slot:"start",icon:u.H}),Object(m.jsx)(o.z,{children:r.formatMessage({id:"app.group-chat.header-details"})})]}),Object(m.jsxs)(o.w,{onClick:function(){n.push({pathname:"/g/".concat(t.originalGroupId,"/search")}),a()},button:!0,children:[Object(m.jsx)(o.r,{slot:"start",icon:u.bb}),Object(m.jsx)(o.z,{children:r.formatMessage({id:"app.group-chat.header-search"})})]}),Object(m.jsxs)(o.w,{onClick:function(){n.push({pathname:"/g/".concat(t.originalGroupId,"/pinned")}),a()},button:!0,children:[Object(m.jsx)(o.r,{slot:"start",icon:u.U}),Object(m.jsx)(o.z,{children:r.formatMessage({id:"app.group-chat.header-pinned-message"})})]})]})},zn=function(e){var t=e.groupData,n=Object(M.f)(),a=Object(l.a)(),r=Object(o.rb)(Un,{onHide:function(){return d()},groupData:t,history:n,intl:a}),c=Object(i.a)(r,2),s=c[0],d=c[1];return Object(m.jsx)(o.q,{children:Object(m.jsxs)(o.fb,{children:[Object(m.jsx)(o.f,{slot:"start",children:Object(m.jsx)(o.e,{onClick:function(){return n.push({pathname:"/home"})},className:"ion-no-padding",children:Object(m.jsx)(o.r,{slot:"icon-only",icon:u.e})})}),Object(m.jsxs)("div",{className:Hn.a["title-container"],children:[Object(m.jsx)(o.b,{className:"ion-padding",children:t.avatar?Object(m.jsx)("img",{src:Object(y.a)(t.avatar),alt:t.name}):Object(m.jsx)("img",{className:Hn.a.avatar,src:u.N,alt:t.name})}),Object(m.jsx)(o.cb,{className:Hn.a.title,children:t.name})]}),Object(m.jsx)(o.f,{slot:"end",children:Object(m.jsx)(o.e,{onClick:function(e){return s({event:e.nativeEvent})},children:Object(m.jsx)(o.r,{icon:u.C})})})]})})},Fn=function(){var e=I(),t=Object(M.h)().group,n=Object(a.useState)(!1),r=Object(i.a)(n,2),c=r[0],s=r[1],u=Object(a.useState)([]),l=Object(i.a)(u,2),b=l[0],j=l[1],f=Object(a.useState)(""),O=Object(i.a)(f,2),g=O[0],h=O[1],v=Object(a.useRef)(null),y=Object(a.useRef)(),x=Object(a.useRef)(null),_=Object(d.c)((function(e){return e.groups.conversations[t]})),E=Object(d.c)((function(e){return e.profile})),T=Object(d.c)((function(e){return e.groups.typing})),S=Object(d.c)((function(e){return e.preference})),N=S.readReceipt,w=S.typingIndicator;Object(a.useEffect)((function(){_&&e(An(null===_||void 0===_?void 0:_.originalGroupId))}),[_,e]);return Object(a.useEffect)((function(){var t=[].concat(Object(ae.a)(_.members),[_.creator]).filter((function(e){return e!==E.id}));console.log("dispatching group typing action"),e(ve({groupId:_.originalGroupId,indicatedBy:E.id,members:t,isTyping:c}))}),[c]),Object(a.useEffect)((function(){w&&(c!==(0!==g.length)&&s(0!==g.length),y.current&&clearTimeout(y.current),y.current=setTimeout((function(){return s(!1)}),2500))}),[g]),_?Object(m.jsxs)(o.H,{children:[Object(m.jsx)(zn,{groupData:_}),Object(m.jsx)(o.k,{children:Object(m.jsx)(Ln,{onReply:function(e){var t;x.current&&(null===x||void 0===x||null===(t=x.current)||void 0===t||t.reply(e))},groupId:_.originalGroupId,members:[].concat(Object(ae.a)(_.members),[_.creator]),messageIds:_.messages,chatList:v,readReceipt:N})}),Object(m.jsx)(_t,{profiles:T[_.originalGroupId]?T[_.originalGroupId]:[]}),Object(m.jsx)(Vt,{ref:x,onSend:function(t){var n=Object(p.a)({},t),a=n.message,r=n.reply,c=n.setIsLoading,s=null,o=null;if(c(!0),a.length&&(s={groupId:_.originalGroupId,payloadInput:{type:"TEXT",payload:{payload:a}},sender:E.id,replyTo:r}),b.length){var i=b[0],u={type:"FILE",payload:{metadata:{fileName:i.metadata.fileName,fileSize:i.metadata.fileSize,fileType:i.metadata.fileType},fileType:i.fileType,fileBytes:i.fileBytes}};o={groupId:_.originalGroupId,payloadInput:u,sender:E.id,replyTo:r}}s?e(Ne(s)).then((function(t){!1===t&&e(we(s)),o&&e(Ne(o)).then((function(t){t||e(we(o)),c(!1),v.current.scrollToBottom()})),c(!1),v.current.scrollToBottom()})):o&&e(Ne(o)).then((function(t){t||e(we(o)),c(!1),v.current.scrollToBottom()}))},onChange:function(e){return h(e)},onFileSelect:function(e){return j(e)}})]}):null},Bn=n(168),Zn=n.n(Bn),Vn=(n(231),[{label:"Original",value:0},{label:"Square",value:1},{label:"16 / 9",value:16/9}]),Yn=function(e){var t=e.label,n=e.value,a=e.onChange,r=e.dismiss;return Object(m.jsx)(o.w,{onClick:function(){a(n),r()},children:Object(m.jsx)(o.z,{children:t})})},Xn=function(e){var t=e.onChange,n=e.dismiss;return Object(m.jsx)(o.A,{children:Vn.map((function(e){return Object(m.jsx)(Yn,{onChange:t,label:e.label,value:e.value,dismiss:n},e.label)}))})},Kn=n(98),qn=n.n(Kn),Wn=["aspect"],Jn=function(e){var t=e.src,n=e.prevPath,r=e.dismiss,c=e.onComplete,s=e.intl,u=Object(a.useState)({x:0,y:0,aspect:1}),l=Object(i.a)(u,2),d=l[0],b=l[1],j=Object(a.useState)(null),f=Object(i.a)(j,2),O=f[0],g=f[1],h=Object(a.useRef)(null),v=Object(a.useState)({}),y=Object(i.a)(v,2),x=y[0],_=y[1];Object(a.useEffect)((function(){var e=new Image;e.onload=function(){setTimeout((function(){if(window.innerHeight>=window.innerWidth){var t,n,a=h.current.getBoundingClientRect().width/e.naturalWidth;e.naturalWidth*a>=e.naturalHeight*a?b((function(t){return Object(p.a)(Object(p.a)({},t),{},{width:a*e.naturalHeight,height:a*e.naturalHeight})})):b((function(t){return Object(p.a)(Object(p.a)({},t),{},{width:a*e.naturalWidth,height:a*e.naturalWidth})})),e.naturalHeight*a<=h.current.getBoundingClientRect().height?_({width:"100vw"}):_({height:"calc(100vh - ".concat(null===(t=E.current)||void 0===t?void 0:t.getBoundingClientRect().height,"px - ").concat(null===(n=T.current)||void 0===n?void 0:n.getBoundingClientRect().height,"px)"),width:h.current.getBoundingClientRect().height/e.naturalHeight*e.naturalWidth})}else{var r,c,s=h.current.getBoundingClientRect().height/e.naturalHeight;e.naturalWidth*s>=e.naturalHeight*s?b((function(t){return Object(p.a)(Object(p.a)({},t),{},{width:s*e.naturalHeight,height:s*e.naturalHeight})})):b((function(t){return Object(p.a)(Object(p.a)({},t),{},{width:s*e.naturalWidth,height:s*e.naturalWidth})})),e.naturalWidth*s<=h.current.getBoundingClientRect().width?_({height:"calc(100vh - ".concat(null===(r=E.current)||void 0===r?void 0:r.getBoundingClientRect().height,"px - ").concat(null===(c=T.current)||void 0===c?void 0:c.getBoundingClientRect().height,"px)")}):_({width:"100vw",height:h.current.getBoundingClientRect().width/e.naturalWidth*e.naturalHeight})}}),500)},e.src=t}),[]);var E=Object(a.useRef)(null),T=Object(a.useRef)(null),S=Object(o.rb)(Xn,{onChange:function(e){b((function(t){Object(p.a)({},t);if(0===e){t.aspect;return Object(xe.a)(t,Wn)}return Object(p.a)({aspect:e},t)}))},dismiss:function(){return w()}}),N=Object(i.a)(S,2),w=(N[0],N[1]);Object(a.useEffect)((function(){O&&(c(O),g(null))}),[O]);var I=Object(a.useRef)(null);return Object(m.jsxs)(o.H,{children:[Object(m.jsxs)("div",{className:qn.a.content,children:[Object(m.jsx)("div",{className:qn.a.header,ref:E,children:Object(m.jsx)(o.cb,{children:s.formatMessage({id:"components.image-cropper.label"})})}),Object(m.jsx)("div",{className:qn.a["image-cropper"],ref:h,children:Object.keys(x).length>0?Object(m.jsx)(Zn.a,{circularCrop:!0,ref:I,imageStyle:Object(p.a)(Object(p.a)({},x),{},{objectFit:"contain"}),src:t,onChange:function(e){return b(e)},keepSelection:!0,crop:d}):Object(m.jsx)(o.U,{})})]}),Object(m.jsx)("div",{className:qn.a.footer,ref:T,children:Object(m.jsxs)(o.f,{children:[Object(m.jsx)(o.e,{href:n,fill:"outline",color:"danger",children:Object(m.jsx)(o.z,{children:s.formatMessage({id:"components.image-cropper.cancel"})})}),Object(m.jsx)(o.e,{onClick:function(){!function(){var e,t,n=document.createElement("canvas"),a=null===I||void 0===I||null===(e=I.current)||void 0===e||null===(t=e.imageRef)||void 0===t?void 0:t.current,r=a?a.naturalWidth/a.width:0,c=a?a.naturalHeight/a.height:0;n.width=d.width,n.height=d.height;var s=n.getContext("2d"),o=window.devicePixelRatio;n.width=d.width*o,n.height=d.height*o,s.setTransform(o,0,0,o,0,0),s.imageSmoothingQuality="high",a&&s.drawImage(a,d.x*r,d.y*c,d.width*r,d.height*c,0,0,d.width,d.height),n.toBlob((function(e){null===e||void 0===e||e.arrayBuffer().then((function(e){var t=new Uint8Array(e);g(t)}))}),"image/jpeg",1)}(),r()},fill:"solid",color:"success",children:Object(m.jsx)(o.z,{children:s.formatMessage({id:"components.image-cropper.confirm"})})})]})})]})},Qn=function(e){var t=e.onClickEdit,n=(e.onClickNotif,e.disabled);return Object(m.jsx)(o.f,{slot:"end",children:Object(m.jsx)(m.Fragment,{children:Object(m.jsx)(o.e,{onClick:t,disabled:!!n,children:Object(m.jsx)(o.r,{color:"medium",icon:u.M})})})})},$n=n(118),ea=n.n($n),ta=function(e){var t=e.onChange,n=e.onCancel,a=Object(l.a)();return Object(m.jsxs)(o.q,{children:[Object(m.jsx)(o.fb,{children:Object(m.jsxs)(o.f,{children:[Object(m.jsx)(o.cb,{className:ea.a.contacts,children:a.formatMessage({id:"app.group-chat.add-member-contacts"})}),Object(m.jsx)(o.e,{className:ea.a["close-button"],onClick:n,slot:"end",children:Object(m.jsx)(o.z,{className:ea.a["close-label"],children:a.formatMessage({id:"app.group-chat.add-member-close"})})})]})}),Object(m.jsx)(o.fb,{children:Object(m.jsx)(o.N,{onIonChange:t})})]})},na=function(e){var t=e.contact,n=e.selected,a=e.onSelected;return Object(m.jsx)(o.w,{button:!0,onClick:function(){return a(t)},lines:"none",color:n?"primary":"",children:Object(m.jsx)(X,{displayAvatar:!0,avatar:t.fields.avatar,nickname:t.username,id:t.id})},JSON.stringify(t.id))},aa=function(e){var t=e.index,n=e.contacts,a=e.onSelected,c=e.selected;return Object(m.jsxs)(r.a.Fragment,{children:[Object(m.jsx)(o.x,{children:Object(m.jsx)(o.z,{children:t})}),n.map((function(e){return Object(m.jsx)(na,{onSelected:a,selected:!!c.includes(e),contact:e},JSON.stringify(e.id))}))]},t)},ra=n(135),ca=n.n(ra),sa=function(e){var t=e.isOpen,n=e.onCancel,r=e.contacts,c=e.groupId,s=e.groupRevisionId,u=e.setLoading,d=e.members,p=e.setMembers,b=Object(l.a)(),j=I(),f=Object(a.useState)(""),O=Object(i.a)(f,2),g=O[0],h=O[1],v=Object(a.useState)([]),x=Object(i.a)(v,2),_=x[0],E=x[1],T=Object(y.d)(function(e){return Object.keys(e).filter((function(e){return-1===d.map((function(e){return e.id})).indexOf(e)}))}(r).map((function(e){return r[e]})).filter((function(e){return e.username.toLowerCase().includes(g.toLowerCase())}))),S=function(e){return E(_.includes(e)?_.filter((function(t){return t.id!==e.id})):[].concat(Object(ae.a)(_),[e]))};return Object(m.jsxs)(o.F,{isOpen:t,children:[Object(m.jsx)(ta,{onChange:function(e){return h(e.detail.value)},onCancel:n}),Object(m.jsxs)(o.k,{children:[Object(m.jsx)(o.A,{className:ca.a["contacts-list"],children:Object.keys(T).map((function(e){var t=T[e];return Object(m.jsx)(aa,{onSelected:S,index:e,contacts:t,selected:_},e)}))}),Object(m.jsx)(o.fb,{children:Object(m.jsx)(o.f,{slot:"end",children:Object(m.jsx)(o.e,{disabled:0===_.length,onClick:function(){u(!0);var e={members:_.map((function(e){return e.id})),groupId:c,groupRevisionId:s};j(be(e)).then((function(e){if(!1!==e){var t=d.concat(_);p(t),E([]),u(!1)}else E([]),u(!1)}))},children:Object(m.jsx)(o.z,{className:ca.a["add-label"],children:b.formatMessage({id:"app.group-chat.add-member"})})})})})]})]})},oa=n(85),ia=n.n(oa),ua=function(e){var t=e.groupId,n=e.groupRevisionId,r=I(),c=Object(l.a)(),s=Tt().showErrorToast,p=Object(a.useState)(!1),b=Object(i.a)(p,2),j=b[0],f=b[1],O=Object(a.useState)(!0),g=Object(i.a)(O,2),h=g[0],v=g[1],y=Object(a.useState)([]),x=Object(i.a)(y,2),_=x[0],E=x[1],T=Object(d.c)((function(e){return e.contacts.contacts})),S=Object(d.c)((function(e){return e.profile})),N=Object(d.c)((function(e){return e.groups.members})),w=Object(d.c)((function(e){return e.groups.conversations[t]}));Object(a.useEffect)((function(){var e=[];[].concat(Object(ae.a)(w.members),[w.creator]).forEach((function(t){N[t]&&e.push(N[t])})),E(e),v(!1)}),[w,N]);var M=function(e){return S.id===w.creator&&e.id!==w.creator?Object(m.jsx)(o.w,{lines:"none",slot:"end",button:!0,onClick:function(){return function(e){if(v(!0),w.members.length<=2)return v(!1),s({message:c.formatMessage({id:"app.group-chat.minimum-member-required-reached"})}),null;var t={members:[e.id],groupId:w.originalGroupId,groupRevisionId:w.originalGroupRevisionId};r(Ee(t)).then((function(e){if(!1!==e){var t=_.filter((function(t){return!e.members.includes(t.id)}));E(t)}v(!1)}))}(e)},children:Object(m.jsx)(o.r,{color:"danger",icon:u.X})}):null};return Object(m.jsxs)(m.Fragment,{children:[h?Object(m.jsx)(o.C,{isOpen:h}):Object(m.jsx)(m.Fragment,{children:Object(m.jsxs)(o.y,{className:ia.a["member-page"],children:[Object(m.jsxs)(o.w,{lines:"none",children:[Object(m.jsx)(o.r,{className:ia.a.icon,icon:u.O}),Object(m.jsx)(o.z,{children:c.formatMessage({id:"app.group-chat.members"},{length:_.length})})]}),function(e){return S.id===e.creator?Object(m.jsxs)(o.w,{lines:"none",button:!0,onClick:function(){return f(!0)},children:[Object(m.jsx)(o.r,{className:ia.a.icon,icon:u.Q}),Object(m.jsx)(o.z,{children:c.formatMessage({id:"app.group-chat.add-members"})})]}):null}(w),Object(m.jsx)(o.w,{lines:"none",className:ia.a["member-title"],children:Object(m.jsx)("h3",{children:c.formatMessage({id:"app.group-chat.members-label"})})}),function(e){return e.map((function(e){var t=e.id===w.creator;return Object(m.jsxs)(o.w,{lines:"none",children:[Object(m.jsxs)(o.z,{className:ia.a["member-name"],children:[e.username,Object(m.jsx)("br",{}),t?c.formatMessage({id:"app.group-chat.admin-role"}):c.formatMessage({id:"app.group-chat.member-role"})]}),M(e)]},e.id)}))}(_)]})}),Object(m.jsx)(sa,{contacts:T,members:_,setMembers:E,isOpen:j,onCancel:function(){return f(!1)},groupId:t,groupRevisionId:n,setLoading:v})]})},la=function(e){var t=e.onSegmentChange,n=e.value,a=Object(l.a)();return Object(m.jsx)(o.fb,{children:Object(m.jsxs)(o.O,{value:n,onIonChange:function(e){return t(e.detail.value)},children:[Object(m.jsx)(o.P,{value:"Info",children:Object(m.jsx)(o.z,{children:a.formatMessage({id:"app.group-chat.label-info"})})}),Object(m.jsx)(o.P,{value:"Media",children:Object(m.jsx)(o.z,{children:a.formatMessage({id:"app.group-chat.label-media"})})}),Object(m.jsx)(o.P,{value:"Files",children:Object(m.jsx)(o.z,{children:a.formatMessage({id:"app.group-chat.label-files"})})})]})})},da=n(39),pa=n.n(da),ba=function(e){var t=e.onCancel,n=e.onSave,a=e.setName,r=e.name,c=Object(l.a)();return Object(m.jsxs)("div",{className:pa.a.modal,children:[Object(m.jsx)(o.fb,{children:Object(m.jsx)(o.cb,{children:c.formatMessage({id:"app.group-chat.update-group-name-title"})})}),Object(m.jsxs)(o.w,{className:"input",children:[Object(m.jsx)(o.z,{color:"medium",position:"floating",children:c.formatMessage({id:"app.group-chat.update-group-name-placeholder"})}),Object(m.jsx)(o.v,{clearInput:!0,className:pa.a["ion-input"],value:r,onIonChange:function(e){return a(e.detail.value)}})]}),Object(m.jsxs)(o.f,{slot:"end",className:"input",children:[Object(m.jsx)(o.e,{slot:"end",onClick:t,children:Object(m.jsx)(o.z,{children:c.formatMessage({id:"app.group-chat.update-group-name-cancel"})})}),Object(m.jsx)(o.e,{disabled:!r.length,slot:"end",onClick:function(){n(r)},children:Object(m.jsx)(o.z,{children:c.formatMessage({id:"app.group-chat.update-group-name-save"})})})]})]})},ja=function(){var e=Object(l.a)(),t=Object(M.f)(),n=Object(M.h)().group,r=I(),c=Object(d.c)((function(e){return e.groups.conversations[n]})),s=Object(d.c)((function(e){return e.profile})),p=Object(d.c)((function(e){return e.groups})),b=p.conversations,j=p.messages,f=Object(d.c)((function(e){return e.groups.groupFiles})),O=Object(a.useState)(!1),g=Object(i.a)(O,2),h=g[0],x=g[1],_=Object(a.useState)(!1),E=Object(i.a)(_,2),T=E[0],S=E[1],N=Object(a.useState)({}),w=Object(i.a)(N,1)[0],k=Object(a.useState)({}),R=Object(i.a)(k,1)[0],P=Object(a.useState)([]),A=Object(i.a)(P,1)[0],C=Object(a.useState)([]),G=Object(i.a)(C,1)[0],L=Object(a.useState)("Info"),D=Object(i.a)(L,2),H=D[0],U=D[1],z=Object(a.useState)(""),F=Object(i.a)(z,2),B=F[0],Z=F[1],V=Object(a.useRef)(null),Y=function(e){void 0!==f[e.fileHash]?X(f[e.fileHash],e.fileName):r(ke([e.fileHash])).then((function(t){t&&Object.keys(t).length>0&&X(t[e.fileHash],e.fileName)}))},X=function(e,t){var n=new Blob([e]),a=document.createElement("a");a.href=window.URL.createObjectURL(n),a.download=t,a.click()},K=function(e,t,a){var c=t;void 0!==c&&r(Oe({groupId:n,lastFetched:c.groupMessageId,lastMessageTimestamp:c.timestamp,batchSize:5,payloadType:a})).then((function(t){e()}))};Object(a.useEffect)((function(){void 0!==b[n]&&b[n].messages.forEach((function(e){var t=j[e];if(t&&"FILE"===t.payload.type)switch(t.payload.fileType){case"IMAGE":case"VIDEO":w[t.groupMessageId]||(w[t.groupMessageId]=!0,A.push(t));break;case"OTHER":R[t.groupMessageId]||(R[t.groupMessageId]=!0,G.push(t))}}))}),[b,j]),Object(a.useEffect)((function(){r(Oe({groupId:n,batchSize:40,payloadType:{type:"MEDIA",payload:null}}))}),[]),Object(a.useEffect)((function(){r(Oe({groupId:n,batchSize:40,payloadType:{type:"FILE",payload:null}}))}),[]);var q=Object(a.useRef)(null),W=Object(a.useState)(null),J=Object(i.a)(W,2),Q=J[0],$=J[1],ee=Object(a.useRef)(null),te=Object(o.qb)(Jn,{src:function(){var e=new TextDecoder;return Q?e.decode(Q):""}(),prevPath:"/register",dismiss:function(){$(null),re()},onComplete:function(e){if(e){var t=new Blob([e],{type:"image/jpeg"});r(Ae({avatar:Object(v.b)(e),groupId:c.originalGroupId,groupRevisionId:c.originalGroupRevisionId})),ee.current.src=URL.createObjectURL(t)}},intl:e}),ne=Object(i.a)(te,2),ae=ne[0],re=ne[1],ce=function(){Array.from(q.current?q.current.files:new FileList).forEach((function(e){e.arrayBuffer().then((function(t){if(e.size<15728640){var n=new TextEncoder,a=new FileReader;a.readAsDataURL(e),a.onload=function(e){var t,a=n.encode(null===(t=e.target)||void 0===t?void 0:t.result);$(a)}}}))}))};Object(a.useEffect)((function(){Q&&ae({cssClass:"cropper ".concat(pa.a.modal)})}),[Q]);return Object(m.jsx)(m.Fragment,{children:c?Object(m.jsxs)(o.H,{children:[Object(m.jsxs)(o.q,{className:pa.a.header,children:[Object(m.jsxs)(o.fb,{children:[Object(m.jsx)(o.f,{children:Object(m.jsx)(o.e,{onClick:function(){t.goBack()},className:"ion-no-padding",children:Object(m.jsx)(o.r,{slot:"icon-only",icon:u.e})})}),Object(m.jsx)(Qn,{onClickEdit:function(){return x(!h),void S(!T)},onClickNotif:function(){},disabled:c.creator!==s.id})]}),c.creator===s.id?Object(m.jsxs)("div",{className:pa.a["avatar-container"],children:[Object(m.jsxs)("div",{className:pa.a["avatar-content"],children:[Object(m.jsxs)("div",{className:pa.a.avatar,children:[Object(m.jsx)("div",{className:pa.a["image-container"],children:c.avatar?Object(m.jsx)("img",{ref:ee,alt:c.name,src:Object(y.a)(c.avatar)}):Object(m.jsx)("img",{ref:ee,alt:c.name,src:u.N,className:pa.a.img})}),Object(m.jsx)("div",{onClick:function(){var e;return null===(e=q.current)||void 0===e?void 0:e.click()},className:pa.a.overlay,children:Object(m.jsx)(o.Z,{className:"ion-text-center",children:e.formatMessage({id:"app.group-chat.change-avatar"})})})]}),Object(m.jsx)("div",{className:pa.a["icon-overlay"],children:Object(m.jsx)(o.r,{size:"large",icon:u.G})})]}),Object(m.jsx)("input",{ref:q,type:"file",hidden:!0,accept:"image/png, image/jpeg",onChange:ce})]}):Object(m.jsx)("div",{className:pa.a["avatar-container"],children:Object(m.jsx)("div",{className:pa.a["avatar-content"],children:Object(m.jsx)("div",{className:pa.a.avatar,children:Object(m.jsx)("div",{className:pa.a["image-container"],children:c.avatar?Object(m.jsx)("img",{ref:ee,alt:c.name,src:Object(y.a)(c.avatar)}):Object(m.jsx)("img",{ref:ee,alt:c.name,src:u.N,className:pa.a.img})})})})}),Object(m.jsx)(o.cb,{className:pa.a.groupname,children:c.name}),Object(m.jsx)(la,{value:H,onSegmentChange:function(e){var t,n;switch(e){case"Info":default:n=0;break;case"Media":n=1;break;case"Files":n=2}null===(t=V.current)||void 0===t||t.slideTo(n)}})]}),Object(m.jsx)(o.k,{children:Object(m.jsxs)(o.T,{ref:V,className:"slides",pager:!1,options:{initialSlide:0,speed:400},onIonSlideDidChange:function(){var e,t=["Info","Media","Files"];null===(e=V.current)||void 0===e||e.getActiveIndex().then((function(e){return U(t[e])}))},children:[Object(m.jsx)(o.S,{children:Object(m.jsx)(ua,{groupId:n,groupRevisionId:c.originalGroupRevisionId})}),Object(m.jsx)(o.S,{children:Object(m.jsx)(On,{orderedMediaMessages:A,onDownload:function(e){return Y(e)},onScrollBottom:function(e,t){return K(e,t,{type:"MEDIA",payload:null})}})}),Object(m.jsx)(o.S,{children:Object(m.jsx)(gn,{orderedFileMessages:G,onDownload:function(e){return Y(e)},onScrollBottom:function(e,t){return K(e,t,{type:"FILE",payload:null})}})})]})}),Object(m.jsx)(o.F,{isOpen:T,cssClass:"my-custom-modal-css",children:Object(m.jsx)(ba,{setName:Z,name:B,onCancel:function(){return S(!1)},onSave:function(e){return function(e){r(Pe({name:e,groupId:c.originalGroupId,groupRevisionId:c.originalGroupRevisionId})).then((function(e){e&&(Z(""),S(!1))}))}(e)}})})]}):Object(m.jsx)(o.C,{isOpen:!0})})},ma=function(){var e=Object(M.h)().group,t=Object(l.a)(),n=Object(M.f)(),r=I(),c=Object(a.useState)(null),s=Object(i.a)(c,2),p=s[0],b=s[1],j=Object(d.c)((function(t){var n;return{conversation:t.groups.conversations[e],pinnedMesssages:null===(n=t.groups.conversations[e])||void 0===n?void 0:n.pinnedMessages}})),f=j.conversation,g=j.pinnedMesssages;return Object(a.useEffect)((function(){var t;r((t=e,function(){var e=Object(O.a)(h.a.mark((function e(n,a,r){var c,s,o,i,u,l;return h.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(c=r.callZome,r.getAgentId,!(s=a().groups.conversations[t])){e.next=17;break}if(!(o=s.pinnedMessages)||0!==o.filter((function(e){return void 0===a().groups.pinnedMessages[e]})).length){e.next=14;break}if(i=o.map((function(e){return a().groups.messages[e].author})),!(u=Object(v.a)(a().profile.id))){e.next=12;break}return e.next=10,U(a(),i,c,Object(v.b)(u));case 10:return l=e.sent,e.abrupt("return",o.map((function(e){var t=a().groups.pinnedMessages[e],n=l[t.author];return{id:t.groupMessageId,payload:t.payload,author:n?n.username:t.author,date:t.timestamp}})));case 12:e.next=15;break;case 14:n(An(t));case 15:e.next=18;break;case 17:n(fe(t));case 18:return e.abrupt("return",null);case 19:case"end":return e.stop()}}),e)})));return function(t,n,a){return e.apply(this,arguments)}}())).then((function(e){return b(e)}))}),[f,g]),Object(m.jsxs)(o.H,{children:[Object(m.jsx)(o.q,{children:Object(m.jsx)(o.fb,{children:Object(m.jsxs)(o.f,{children:[Object(m.jsx)(o.e,{onClick:function(){return n.push({pathname:"/g/".concat(e)})},className:"ion-no-padding",children:Object(m.jsx)(o.r,{slot:"icon-only",icon:u.e})}),Object(m.jsx)(o.cb,{children:t.formatMessage({id:"app.group-chat.pinned-message-title"})})]})})}),Object(m.jsx)(o.k,{children:p?Object(m.jsx)(kn,{type:"group",onMessageClick:function(e){},messages:p}):null})]})},fa=function(e,t){return function(){var n=Object(O.a)(h.a.mark((function n(a,r,c){var s;return h.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return s=c.callZome,n.next=3,U(r(),e,s,t);case 3:return n.abrupt("return",n.sent);case 4:case"end":return n.stop()}}),n)})));return function(e,t,a){return n.apply(this,arguments)}}()},Oa=function(){var e=Object(a.useState)(),t=Object(i.a)(e,2),n=t[0],r=t[1],c=Object(M.h)().group,s=Object(d.c)((function(e){return e.profile})).id,o=I();return Object(m.jsx)(Nn,{messages:n,onDateSelect:function(e){o(ge({groupId:c,date:e,payloadType:{type:"ALL",payload:null}})).then((function(e){var t=e.messagesByGroup[c].map((function(t){var n=e.groupMessagesContents[t];return{id:n.groupId,author:{id:n.author},timestamp:n.timestamp,payload:n.payload,readList:n.readList,replyTo:n.replyTo}}));o(fa(t.map((function(e){return e.author.id})),s)).then((function(e){r(t.map((function(t){return Object(p.a)(Object(p.a)({},t),{},{author:Object(p.a)({},e[t.author.id])})})))}))}))},prevHref:"/g/".concat(c),type:"group"})},ga=function(){return Object(m.jsxs)(M.d,{children:[Object(m.jsx)(M.b,{path:"/g/:group",exact:!0,children:Object(m.jsx)(Fn,{})}),Object(m.jsx)(M.b,{path:"/g/:group/details",exact:!0,children:Object(m.jsx)(ja,{})}),Object(m.jsx)(M.b,{path:"/g/:group/search",exact:!0,children:Object(m.jsx)(Oa,{})}),Object(m.jsx)(M.b,{path:"/g/:group/pinned",exact:!0,children:Object(m.jsx)(ma,{})})]})},ha=n(284),va=function(e){var t=e.onChange,n=e.noSearch,r=Object(a.useState)(!1),c=Object(i.a)(r,2),s=c[0],l=c[1];return Object(m.jsx)(o.q,{children:Object(m.jsx)(o.fb,{children:s?Object(m.jsx)(o.N,{onIonChange:function(e){return t(e)},showCancelButton:"always",debounce:500,onIonCancel:function(){return l(!1)}}):Object(m.jsxs)(m.Fragment,{children:[Object(m.jsx)(o.f,{slot:"start",children:Object(m.jsx)(o.E,{})}),n?null:Object(m.jsx)(o.f,{slot:"end",children:Object(m.jsx)(o.e,{onClick:function(){return l(!0)},children:Object(m.jsx)(o.r,{icon:u.bb,slot:"icon-only"})})})]})})})},ya=function(e){var t=e.onClick;return Object(m.jsx)(o.m,{vertical:"bottom",horizontal:"end",slot:"fixed",children:Object(m.jsx)(o.n,{onClick:t,children:Object(m.jsx)(o.r,{icon:u.a})})})},xa=n(169),_a=n.n(xa),Ea=function(e){var t=e.onChange,n=e.onCancel,a=Object(l.a)();return Object(m.jsx)(o.q,{children:Object(m.jsx)(o.fb,{children:Object(m.jsx)(o.N,{placeholder:a.formatMessage({id:"app.contacts.search"}),showCancelButton:"always",onIonChange:t,onIonCancel:n,debounce:700})})})},Ta=function(e){return function(){var t=Object(O.a)(h.a.mark((function t(n,a,r){var c,s;return h.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return c=r.callZome,s=a().contacts.contacts,t.prev=2,t.next=5,c({zomeName:x.c.CONTACTS,fnName:x.a[x.c.CONTACTS].ADD_CONTACTS,payload:[e.id]});case 5:return s[e.id]=e,n({type:G.b,contacts:s}),t.abrupt("return",!0);case 10:t.prev=10,t.t0=t.catch(2),t.t0.message.includes("agent already added")?n(Object(_.a)("TOAST",{},{id:"redux.err.contacts.add-contact.1",value:{username:e.username}})):t.t0.message.includes("agent is blocked")&&n(Object(_.a)("TOAST",{},{id:"redux.err.contacts.add-contact.2",value:{username:e.username}}));case 13:return t.abrupt("return",!1);case 14:case"end":return t.stop()}}),t,null,[[2,10]])})));return function(e,n,a){return t.apply(this,arguments)}}()},Sa=function(e){return function(){var t=Object(O.a)(h.a.mark((function t(n,a,r){var c,s,o,i,u,l,d;return h.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return c=r.callZome,s=a().contacts,o=s.contacts,i=s.blocked,t.prev=2,u=Object(p.a)(Object(A.a)({},e.id,e),i),t.next=6,c({zomeName:x.c.CONTACTS,fnName:x.a[x.c.CONTACTS].BLOCK_CONTACTS,payload:[e.id]});case 6:return l=e.id,o[l],d=Object(xe.a)(o,[l].map(_e.a)),n({type:G.a,blocked:u}),n({type:G.b,contacts:d}),t.abrupt("return",!0);case 12:t.prev=12,t.t0=t.catch(2),t.t0.message.includes("this agent is already blocked")&&n(Object(_.a)("TOAST",{},{id:"redux.err.contacts.block-contact.1",value:{username:e.username}}));case 15:return t.abrupt("return",!1);case 16:case"end":return t.stop()}}),t,null,[[2,12]])})));return function(e,n,a){return t.apply(this,arguments)}}()},Na=function(e){return function(){var t=Object(O.a)(h.a.mark((function t(n,a,r){var c,s,o,i;return h.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return c=r.callZome,s=a().contacts.contacts,t.prev=2,t.next=5,c({zomeName:x.c.CONTACTS,fnName:x.a[x.c.CONTACTS].REMOVE_CONTACTS,payload:[Object(v.a)(e.id)]});case 5:return o=e.id,s[o],i=Object(xe.a)(s,[o].map(_e.a)),n({type:G.b,contacts:i}),t.abrupt("return",!0);case 10:t.prev=10,t.t0=t.catch(2),n(Object(_.a)("TOAST",{},{id:"redux.err.generic"}));case 13:return t.abrupt("return",!1);case 14:case"end":return t.stop()}}),t,null,[[2,10]])})));return function(e,n,a){return t.apply(this,arguments)}}()},wa=function(e){return function(){var t=Object(O.a)(h.a.mark((function t(n,a,r){var c,s,o,i;return h.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return c=r.callZome,s=a().contacts.blocked,t.prev=2,t.next=5,c({zomeName:x.c.CONTACTS,fnName:x.a[x.c.CONTACTS].UNBLOCK_CONTACTS,payload:[Object(v.a)(e.id)]});case 5:return o=e.id,s[o],i=Object(xe.a)(s,[o].map(_e.a)),n({type:G.a,blocked:i}),t.abrupt("return",!0);case 10:t.prev=10,t.t0=t.catch(2),n(Object(_.a)("TOAST",{},{id:"redux.err.generic"}));case 13:return t.abrupt("return",!1);case 14:case"end":return t.stop()}}),t,null,[[2,10]])})));return function(e,n,a){return t.apply(this,arguments)}}()},Ia=function(e){var t=e.contact,n=e.onCompletion,r=Object(a.useState)(!1),c=Object(i.a)(r,2),s=c[0],l=c[1],d=I();return Object(m.jsxs)(o.w,{lines:"none",children:[Object(m.jsx)(X,{displayAvatar:!0,avatar:t.fields.avatar,nickname:t.username,id:t.id}),Object(m.jsx)(o.f,{slot:"end",children:s?Object(m.jsx)(o.U,{}):Object(m.jsx)(o.e,{onClick:function(){l(!0),d(Ta(t)).then((function(e){e?n(t):l(!1)}))},children:Object(m.jsx)(o.r,{icon:u.a})})})]})},Ma=function(e){var t=e.index,n=e.contacts,a=e.onCompletion;return Object(m.jsxs)(r.a.Fragment,{children:[Object(m.jsx)(o.x,{children:Object(m.jsx)(o.z,{children:t})}),n.map((function(e){return Object(m.jsx)(Ia,{contact:e,onCompletion:a},JSON.stringify(e.id))}))]})},ka=function(e){var t=e.isOpen,n=e.onCancel,r=Tt().showToast,c=Object(l.a)(),s=Object(d.c)((function(e){return e.contacts.contacts})),u=Object(a.useState)([]),b=Object(i.a)(u,2),j=b[0],f=b[1],O=I(),g=Object(y.d)(j),h=function(e){r({message:c.formatMessage({id:"app.contacts.add-message"},{name:e.username}),color:"light",duration:1e3}),O({type:G.b,contacts:Object(p.a)({},s)}),f((function(t){return t.filter((function(t){return t.id!==e.id}))}))};return Object(m.jsxs)(o.F,{isOpen:t,onDidDismiss:n,children:[Object(m.jsx)(Ea,{onChange:function(e){var t;(t=e.detail.value).length>=3?O(N(t)).then((function(e){if(e){var n=e.filter((function(e){return e.username.toLowerCase().includes(t.toLowerCase())}));f(n)}})):t.length>0&&t.length<3?setTimeout(r({color:"warning",message:c.formatMessage({id:"app.contacts.search-nickname-warning"})}),300):f([])},onCancel:n}),Object(m.jsx)(o.k,{children:Object(m.jsx)(o.A,{className:_a.a["contacts-list"],children:Object.keys(g).map((function(e){var t=g[e];return Object(m.jsx)(Ma,{onCompletion:h,index:e,contacts:t},e)}))})})]})},Ra=n(170),Pa=n.n(Ra),Aa=function(){var e=Object(l.a)();return Object(m.jsxs)("div",{className:Pa.a["empty-contacts"],children:[Object(m.jsx)(o.r,{icon:u.ab}),Object(m.jsx)(o.Z,{className:"ion-padding ion-margin-bottom",children:e.formatMessage({id:"app.contacts.empty-contact-list"})})]})},Ca=function(){var e=Object(a.useState)(!1),t=Object(i.a)(e,2),n=t[0],r=t[1],c=Object(a.useState)(""),s=Object(i.a)(c,2),u=s[0],l=s[1],p=Object(d.c)((function(e){return e.contacts.contacts})),b=Object(y.d)(Object.values(p).filter((function(e){return e.username.toLowerCase().includes(u.toLowerCase())})));return Object(m.jsxs)(o.H,{children:[Object(m.jsx)(va,{onChange:function(e){return l(e.detail.value)}}),Object(m.jsxs)(o.k,{children:[0!==Object.values(p).length?Object(m.jsx)(Q,{displayMsgBtn:!0,contacts:b||{}}):Object(m.jsx)(Aa,{}),Object(m.jsx)(ka,{contacts:p,isOpen:n,onCancel:function(){return r(!1)}}),Object(m.jsx)(ya,{onClick:function(){return r(!0)}})]})]})},Ga=n(136),La=n.n(Ga),Da=function(e){var t,n=e.conversation,a=e.myAgentId,r=e.onClick,c=Object(l.a)();return Object(m.jsxs)(o.w,{onClick:r,children:[Object(m.jsx)(o.b,{slot:"start",children:n.avatar?Object(m.jsx)("img",{src:n.avatar,alt:"avatar"}):Object(m.jsx)("img",{className:La.a.avatar,src:"group"===n.type?u.N:u.R,alt:"avatar"})}),Object(m.jsxs)(o.z,{children:["group"===n.type?Object(m.jsx)("h2",{children:n.conversationName}):Object(m.jsx)("div",{className:La.a.identifier,children:Object(m.jsx)(X,{noSpace:!0,nickname:n.conversationName,id:n.id,charToShow:10})}),n.latestMessage.sender?Object(m.jsx)("h3",{children:n.latestMessage.sender.username}):null,Object(m.jsx)("p",{children:"TEXT"===n.latestMessage.payloadType?n.latestMessage.textPayload:a===n.latestMessage.sender.id?(t=n.latestMessage,c.formatMessage({id:"components.conversation.me-file-string"},{fileName:t.fileName})):function(e){return c.formatMessage({id:"components.conversation.other-file-string"},{fileName:e.fileName,name:e.sender.username})}(n.latestMessage)})]}),n.badgeCount?n.badgeCount>20?Object(m.jsx)(o.d,{slot:"",children:"20+"}):n.badgeCount>0?Object(m.jsx)(o.d,{slot:"",children:n.badgeCount}):null:null]})},Ha=function(e){return function(t,n){var a=n().p2pmessages,r=a.conversations,c=a.messages,s=a.receipts,o=r[e].messages,i=0;return o.forEach((function(t){var n=c[t],a=n.receipts.map((function(e){return s[e]}));a.sort((function(e,t){var n=e.timestamp.getTime(),a=t.timestamp.getTime();return n>a?-1:n<a?1:0}));var r=a[0];r&&"read"!==r.status&&n.author.id===e&&(i+=1)})),i}},Ua=n(171),za=n.n(Ua),Fa=function(){var e=Object(l.a)();return Object(m.jsxs)("div",{className:za.a["empty-conversations"],children:[Object(m.jsx)(o.r,{icon:u.ab}),Object(m.jsx)(o.Z,{className:"ion-padding ion-margin-bottom",children:e.formatMessage({id:"app.conversations.empty-conversations"})})]})},Ba=n(172),Za=n.n(Ba),Va=function(){var e,t=Object(M.f)(),n=I(),a=Object(l.a)(),r=Object(d.c)((function(e){return e.contacts.contacts})),c=Object(d.c)((function(e){return e.profile})),s=Object(d.c)((function(e){return e.groups})),i=Object(d.c)((function(e){return e.p2pmessages}));return Object(m.jsxs)(o.H,{children:[Object(m.jsx)(va,{noSearch:!0,onChange:function(){}}),Object(m.jsxs)(o.k,{children:[(e=function(e,t){var s=[];if(Object.keys(t.conversations).length>0)for(var o in t.conversations)if(void 0!==r[o]){var i=r[o],u=t.conversations[o].messages[0],l=t.messages[u],d=void 0,b=null;if(l)d={id:l.p2pMessageEntryHash,sender:{id:l.author.id,username:l.author.id===c.id?"You":i.username,fields:l.author.id===c.id?c.fields:i.fields},payloadType:l.payload.type,textPayload:Object(L.d)(l.payload)?l.payload.payload.payload:void 0,fileName:Object(L.d)(l.payload)?void 0:l.payload.fileName,timestamp:l.timestamp},b={type:"p2p",id:o,avatar:i.fields.avatar?i.fields.avatar:void 0,conversationName:i.username,latestMessage:d,badgeCount:n(Ha(i.id))};else if(t.errMsgs[o][0]){var j=t.errMsgs[o][0];d={id:j.p2pMessageEntryHash,sender:{id:j.author.id,username:j.author.id===c.id?"You":i.username,fields:j.author.id===c.id?c.fields:i.fields},payloadType:j.payload.type,textPayload:Object(L.d)(j.payload)?j.payload.payload.payload:void 0,fileName:Object(L.d)(j.payload)?void 0:j.payload.fileName,timestamp:j.timestamp},b={type:"p2p",id:o,conversationName:i.username,latestMessage:d,badgeCount:n(Ha(i.id))}}b&&s.push(b)}if(Object.keys(e.conversations).length>0){var m=e.messages,f=e.members;Object.keys(e.conversations).forEach((function(t){var r,o=e.conversations[t].messages[0],i=m[o],u=null;if(i)r={id:i.groupMessageId,sender:f[i.author]?{id:f[i.author].id,username:f[i.author].username,fields:f[i.author].fields}:{id:c.id,username:c.username,fields:c.fields},payloadType:i.payload.type,timestamp:i.timestamp,textPayload:Object(L.d)(i.payload)?i.payload.payload.payload:void 0,fileName:Object(L.d)(i.payload)?void 0:i.payload.fileName},u=Object(p.a)(Object(p.a)({id:t,type:"group",conversationName:e.conversations[t].name},e.conversations[t].avatar?{avatar:e.conversations[t].avatar}:{}),{},{latestMessage:r,badgeCount:n(me(t))});else if(e.errMsgs[t]){var l=e.errMsgs[t][0];r={id:l.groupMessageId,sender:l.author,payloadType:l.payload.type,timestamp:l.timestamp,textPayload:Object(L.d)(l.payload)?l.payload.payload.payload:void 0,fileName:Object(L.d)(l.payload)?void 0:l.payload.fileName},u={id:t,type:"group",conversationName:e.conversations[t].name,latestMessage:r,badgeCount:n(me(t))}}else r={id:"no message",sender:void 0,payloadType:"TEXT",timestamp:new Date,textPayload:a.formatMessage({id:"app.conversations.no-group-messages"}),fileName:void 0},u={id:t,type:"group",conversationName:e.conversations[t].name,latestMessage:r,badgeCount:n(me(t))};u&&s.push(u)}))}return s.sort((function(e,t){return e.latestMessage.timestamp.valueOf()<t.latestMessage.timestamp.valueOf()?1:-1})),s}(s,i),Object.keys(e).length>0?Object(m.jsx)(o.A,{className:Za.a.conversation,children:e.map((function(e){return Object(m.jsx)(Da,{conversation:e,myAgentId:c.id,onClick:function(){return function(e){return"group"===e.type?t.push("/g/".concat(e.id)):t.push({pathname:"/u/".concat(e.id),state:{username:e.conversationName}})}(e)}},e.id)}))}):Object(m.jsx)(Fa,{})),Object(m.jsx)(o.m,{vertical:"bottom",horizontal:"end",slot:"fixed",children:Object(m.jsx)(o.n,{onClick:function(){t.push({pathname:"/compose",state:{contacts:Object(p.a)({},r)}})},children:Object(m.jsx)(o.r,{icon:u.M})})})]})]})},Ya=n(173),Xa=n.n(Ya),Ka=function(){return Object(m.jsxs)(o.Y,{children:[Object(m.jsxs)(o.L,{id:"home",children:[Object(m.jsx)(M.a,{exact:!0,path:"/home",to:"/home/messaging"}),Object(m.jsx)(M.b,{path:"/home/messaging",render:function(){return Object(m.jsx)(Va,{})},exact:!0}),Object(m.jsx)(M.b,{path:"/home/contacts",render:function(){return Object(m.jsx)(Ca,{})},exact:!0})]}),Object(m.jsxs)(o.W,{slot:"bottom",className:Xa.a["home-tab-bar"],children:[Object(m.jsxs)(o.X,{tab:"messaging",href:"/home/messaging",children:[Object(m.jsx)(o.r,{icon:u.k}),Object(m.jsx)(o.z,{children:Object(m.jsx)(ha.a,{id:"app.home.messaging-tab-bar"})})]}),Object(m.jsxs)(o.X,{tab:"contacts",href:"/home/contacts",children:[Object(m.jsx)(o.r,{icon:u.P}),Object(m.jsx)(o.z,{children:Object(m.jsx)(ha.a,{id:"app.home.contacts-tab-bar"})})]})]})]})},qa=n(81),Wa=n.n(qa),Ja=Object(a.createContext)([{},function(){},{},function(){}]),Qa=function(){var e=Object(a.useContext)(Ja);if(!e)throw Error("No context found");return e},$a=function(e){var t=e.contact,n=e.onClick;return Object(m.jsx)(o.w,{onClick:function(){return n(t)},children:Object(m.jsx)(X,{displayAvatar:!0,avatar:t.fields.avatar,nickname:t.username,id:t.id})})},er=function(e){var t=e.char,n=e.contacts,a=Qa()[1],c=Qa()[3],s=function(e){c((function(t){return t[e.id]=e,t})),a((function(t){var n=e.id;t[n];return Object(xe.a)(t,[n].map(_e.a))}))};return Object(m.jsxs)(r.a.Fragment,{children:[Object(m.jsx)(o.x,{children:Object(m.jsx)(o.z,{children:t})}),n.map((function(e){return Object(m.jsx)($a,{contact:e,onClick:s},JSON.stringify(e))}))]},t)},tr=function(e){var t=e.contacts,n=Object(y.d)(Object.values(t));return Object(m.jsx)(o.A,{className:Wa.a["contacts-list"],children:Object.keys(n).map((function(e){var t=n[e];return Object(m.jsx)(er,{char:e,contacts:t},e)}))})},nr=n(174),ar=n.n(nr),rr=function(){var e=Object(l.a)(),t=Object(M.f)();return Object(m.jsx)(o.q,{className:ar.a.header,children:Object(m.jsxs)(o.fb,{children:[Object(m.jsx)(o.f,{slot:"start",children:Object(m.jsx)(o.e,{onClick:function(){return t.push({pathname:"/home"})},className:"ion-no-padding",children:Object(m.jsx)(o.r,{slot:"icon-only",icon:u.e})})}),Object(m.jsx)(o.cb,{children:e.formatMessage({id:"app.new-conversation.header-title"})})]})})},cr=n(137),sr=n.n(cr),or=function(e){var t=e.contacts,n=e.onCloseButtonPress,r=e.onSearch,c=Object(a.useState)(""),s=Object(i.a)(c,2),d=s[0],p=s[1],b=Object(l.a)();return Object(a.useEffect)((function(){r(d)}),[d,r]),Object(m.jsxs)("div",{className:"".concat(sr.a.recipients," ion-padding"),children:[Object(m.jsxs)(o.z,{className:sr.a.to,children:[b.formatMessage({id:"app.new-conversation.to"}),":"]}),Object.values(t).map((function(e){return Object(m.jsxs)(o.i,{children:[Object(m.jsx)(o.z,{children:e.username}),Object(m.jsx)(o.r,{icon:u.s,onClick:function(){return n(e)}})]},JSON.stringify(e))})),Object(m.jsx)(o.v,{type:"text",placeholder:b.formatMessage({id:"app.new-conversation.search-placeholder"}),onIonChange:function(e){return p(e.detail.value)},value:d,debounce:500})]})},ir=function(){var e=I(),t=Object(l.a)(),n=Object(M.f)(),r=Object(M.g)(),c=Tt().showErrorToast,s=Object(a.useState)({}),d=Object(i.a)(s,2),b=d[0],j=d[1],f=Object(a.useState)({}),O=Object(i.a)(f,2),g=O[0],h=O[1],v=Object(a.useState)(""),y=Object(i.a)(v,2),x=y[0],_=y[1],E=Object(a.useState)(""),T=Object(i.a)(E,2),S=T[0],N=T[1],w=Object(a.useState)([]),k=Object(i.a)(w,2),R=k[0],P=k[1],A=Object(a.useState)(!1),C=Object(i.a)(A,2),G=C[0],L=C[1];Object(a.useEffect)((function(){_("")}),[b,g]),Object(a.useEffect)((function(){return void 0!==r.state&&j(r.state.contacts),function(){return j({})}}),[r.state]);return Object(m.jsx)(Ja.Provider,{value:[b,j,g,h],children:Object(m.jsxs)(o.H,{children:[Object(m.jsx)(o.C,{isOpen:G}),Object(m.jsx)(rr,{}),Object(m.jsxs)(o.k,{className:Wa.a.list,children:[Object(m.jsx)(or,{contacts:g,onCloseButtonPress:function(e){h((function(t){var n=e.id;t[n];return Object(xe.a)(t,[n].map(_e.a))})),j((function(t){return t[e.id]=e,Object(p.a)({},t)}))},onSearch:_}),Object(m.jsx)(tr,{contacts:Object.values(b).filter((function(e){return e.username.includes(x)}))})]}),1===Object.values(g).length?Object(m.jsxs)("div",{className:Wa.a.warning,children:[Object(m.jsx)(o.r,{icon:u.fb,color:"warning",className:Wa.a["warning-icon"]}),Object(m.jsx)(o.Z,{color:"warning",children:"Currently, p2p message only gets sent when the receiver is online"})]}):null,Object(m.jsx)(Vt,{onSend:function(a){var r=Object.values(g),s=Object(p.a)({},a).message;if(1===r.length)s&&""!==s&&(L(!0),e(Object(Qt.a)(r[0].id,s,"TEXT",void 0)).then((function(t){!t&&R.length<=0?(L(!1),e($t(r[0].id,S,"TEXT",void 0)),n.push({pathname:"/u/".concat(r[0].id),state:{username:r[0].username}})):t||e($t(r[0].id,S,"TEXT",void 0)),R.length<=0&&!0===t?(L(!1),n.push({pathname:"/u/".concat(r[0].id),state:{username:r[0].username}})):R.length&&R.forEach((function(t){e(Object(Qt.a)(r[0].id,S,"FILE",void 0,t)).then((function(a){!0===a?(L(!1),n.push({pathname:"/u/".concat(r[0].id),state:{username:r[0].username}})):(e($t(r[0].id,S,"FILE",void 0,t)),L(!1),n.push({pathname:"/u/".concat(r[0].id),state:{username:r[0].username}}))}))}))}))),""===S&&R.length&&R.forEach((function(t){L(!0),e(Object(Qt.a)(r[0].id,S,"FILE",void 0,t)).then((function(a){L(!1),!0===a||(e($t(r[0].id,S,"FILE",void 0,t)),L(!1)),n.push({pathname:"/u/".concat(r[0].id),state:{username:r[0].username}})}))}));else if(r.length>1){L(!0);var o=R.map((function(e){return{type:"FILE",payload:{metadata:{fileName:e.metadata.fileName,fileSize:e.metadata.fileSize,fileType:e.metadata.fileType},fileType:e.fileType,fileBytes:e.fileBytes}}}));e(Ie(r,s||S,o)).then((function(e){L(!1),!1!==e&&n.push("/g/".concat(e.groupResult.originalGroupId))}))}else c({message:t.formatMessage({id:"app.new-conversation.no-contacts-toast"})})},onChange:function(e){return N(e)},onFileSelect:function(e){return P(e)}})]})})},ur=function(e){return function(){var t=Object(O.a)(h.a.mark((function t(n,a,r){var c,s,o,i,u,l,d;return h.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return r.getAgentId,c=r.callZome,s=a().profile.id,o=a().profile,i=o.username,u=o.fields,l=Object(v.b)(e),d=Object(p.a)(Object(p.a)({},u),{},{avatar:l}),t.next=7,c({zomeName:x.c.PROFILES,fnName:x.a[x.c.PROFILES].UPDATE_PROFILE,payload:{nickname:i,fields:d}});case 7:n({type:E.a,id:s,nickname:i,fields:Object(p.a)(Object(p.a)({},d),{},{avatar:Object(y.a)(l)})});case 8:case"end":return t.stop()}}),t)})));return function(e,n,a){return t.apply(this,arguments)}}()},lr=n(175),dr=n.n(lr),pr=function(e){var t=e.popover,n=e.dismiss,r=e.profile,c=Object(a.useState)(!1),s=Object(i.a)(c,2),b=s[0],j=s[1],f=Object(a.useState)(!1),O=Object(i.a)(f,2),g=O[0],h=O[1],v=r.id,y=I(),x=Object(l.a)(),_=Object(d.c)((function(e){return e.profile.username})),E=Object(d.c)((function(e){return e.contacts})),T=E.contacts,S=E.blocked;Object(a.useEffect)((function(){j(v in T),h(v in S)}),[T,S,v]);return Object(m.jsx)(o.I,Object(p.a)(Object(p.a)({},t.event?{event:t.event}:{}),{},{isOpen:t.isVisible,onDidDismiss:n,children:Object(m.jsxs)(o.A,{className:"".concat(dr.a["popover-list"]),children:[!g&&b?Object(m.jsxs)(o.w,{onClick:function(){y(Na(r)).then((function(e){j(!e)}))},children:[Object(m.jsx)(o.r,{icon:u.S}),Object(m.jsx)(o.z,{className:"ion-padding-start",children:x.formatMessage({id:"app.contacts.remove"})})]}):Object(m.jsxs)(o.w,{disabled:g,onClick:function(){y(Ta(r)).then((function(e){j(e)}))},children:[Object(m.jsx)(o.r,{icon:u.Q}),Object(m.jsx)(o.z,{className:"ion-padding-start",children:x.formatMessage({id:"app.contacts.add"})})]}),_!==r.username?g?Object(m.jsxs)(o.w,{onClick:function(){y(wa(r)).then((function(e){h(!e)}))},children:[Object(m.jsx)(o.r,{icon:u.h}),Object(m.jsx)(o.z,{className:"ion-padding-start",children:x.formatMessage({id:"app.contacts.unblock"})})]}):Object(m.jsxs)(o.w,{onClick:function(){y(Sa(r)).then((function(e){h(e)}))},children:[Object(m.jsx)(o.r,{icon:u.h}),Object(m.jsx)(o.z,{className:"ion-padding-start",children:x.formatMessage({id:"app.contacts.block"})})]}):null]})}))},br=function(e){var t=e.profile,n=Object(a.useState)({isVisible:!1,event:void 0}),r=Object(i.a)(n,2),c=r[0],s=r[1];return Object(m.jsxs)(m.Fragment,{children:[Object(m.jsx)(o.f,{slot:"end",children:Object(m.jsx)(o.e,{onClick:function(e){e.persist(),s({isVisible:!0,event:e})},children:Object(m.jsx)(o.r,{icon:u.B})})}),Object(m.jsx)(pr,{profile:t,popover:c,dismiss:function(){return s({isVisible:!1,event:void 0})}})]})},jr=n(49),mr=n.n(jr),fr=function(){var e=Object(l.a)(),t=Object(a.useRef)(!0),n=Object(M.g)().state,r=Object(d.c)((function(e){return e.profile})),c=Object(M.f)(),s=Object(a.useState)(null),p=Object(i.a)(s,2),b=p[0],j=p[1],f=Object(a.useState)(null),O=Object(i.a)(f,2),g=O[0],h=O[1],v=I(),y=Object(o.qb)(Jn,{src:function(){var e=new TextDecoder;return g?e.decode(g):""}(),prevPath:"/",dismiss:function(){h(null),E()},onComplete:function(e){if(e){var t=new Blob([e],{type:"image/jpeg"});v(ur(e)),S.current.src=URL.createObjectURL(t)}},intl:e}),x=Object(i.a)(y,2),_=x[0],E=x[1];Object(a.useEffect)((function(){g&&_({cssClass:"cropper ".concat(mr.a.modal)})}),[g]),Object(a.useEffect)((function(){return t.current=!0,function(){t.current=!1}}),[]),Object(a.useEffect)((function(){null!==n&&void 0!==n&&n.profile&&j(null===n||void 0===n?void 0:n.profile)}),[null===n||void 0===n?void 0:n.profile]),Object(a.useEffect)((function(){r.id&&r.username&&r.id===n.profile.id&&j({id:r.id,username:r.username,fields:r.fields})}),[r,n.profile.id]);var T=Object(a.useRef)(null),S=Object(a.useRef)(null),N=function(){Array.from(T.current?T.current.files:new FileList).forEach((function(e){e.arrayBuffer().then((function(t){if(e.size<15728640){var n=new TextEncoder,a=new FileReader;a.readAsDataURL(e),a.onload=function(e){var t,a=n.encode(null===(t=e.target)||void 0===t?void 0:t.result);h(a)}}}))}))};return Object(m.jsxs)(o.H,{children:[Object(m.jsxs)(o.q,{className:mr.a.header,children:[Object(m.jsxs)(o.fb,{children:[Object(m.jsx)(o.f,{children:Object(m.jsx)(o.e,{onClick:function(){return c.push({pathname:null!==n&&void 0!==n&&n.prev?n.prev:"/home/contacts"})},className:"ion-no-padding",children:Object(m.jsx)(o.r,{slot:"icon-only",icon:u.e})})}),b?Object(m.jsx)(br,{profile:b}):null]}),Object(m.jsx)("div",{className:mr.a["profile-picture-toolbar"],children:Object(m.jsx)("div",{className:mr.a["toolbar-container"],children:b?b.id===r.id?Object(m.jsxs)("div",{className:mr.a["avatar-content"],children:[Object(m.jsxs)("div",{className:mr.a.avatar,children:[Object(m.jsxs)("div",{className:mr.a["image-container"],children:[Object(m.jsx)("img",{ref:S,alt:b.username,src:b.fields.avatar?b.fields.avatar:u.R,style:{display:b.fields.avatar?"block":"none"}}),b.fields.avatar?null:Object(m.jsx)(an,{size:100,hash:b.id})]}),Object(m.jsx)("div",{onClick:function(){var e;return null===(e=T.current)||void 0===e?void 0:e.click()},className:mr.a.overlay,children:Object(m.jsx)(o.Z,{className:"ion-text-center",children:e.formatMessage({id:"app.group-chat.change-avatar"})})})]}),Object(m.jsx)("div",{className:mr.a["icon-overlay"],children:Object(m.jsx)(o.r,{size:"large",icon:u.G})}),Object(m.jsx)("input",{ref:T,type:"file",hidden:!0,accept:"image/png, image/jpeg",onChange:N})]}):Object(m.jsx)("div",{className:mr.a["avatar-content"],children:Object(m.jsxs)("div",{className:mr.a["image-container"],children:[Object(m.jsx)("img",{ref:S,alt:b.username,src:b.fields.avatar?b.fields.avatar:u.R,style:{display:b.fields.avatar?"block":"none"}}),b.fields.avatar?null:Object(m.jsx)(o.b,{children:Object(m.jsx)("img",{src:"assets/icon/person-circle-outline.png",alt:"avatar"})})]})}):null})}),Object(m.jsx)(o.fb,{className:mr.a["profile-toolbar"],children:Object(m.jsx)(o.cb,{className:mr.a.nickname,children:b?b.username:""})})]}),Object(m.jsx)(yn,{id:n.profile.id,nickname:n.profile.username})]})},Or=n(106),gr=function(e){return function(t){t({type:Or.a,language:e})}},hr=[{language:"English",code:"en"},{language:"\u65e5\u672c\u8a9e",code:"jp"}],vr=function(){var e=Object(l.a)(),t=Object(d.c)((function(e){return e.language.language})),n=hr.find((function(e){return e.code===t})),a=I(),r=Object(M.f)();return Object(m.jsxs)(o.A,{children:[Object(m.jsx)(o.B,{children:e.formatMessage({id:"app.settings.language-label"})}),Object(m.jsx)(o.w,{children:Object(m.jsx)(o.Q,{onIonChange:function(e){a(gr(e.detail.value)),r.push("/")},slot:"end",value:n.code,children:hr.map((function(e){return Object(m.jsx)(o.R,{value:e.code,children:e.language},e.code)}))})})]})},yr=function(e){return function(){var t=Object(O.a)(h.a.mark((function t(n,a,r){var c,s,o;return h.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return c=r.callZome,s=Object.keys(e).map((function(t){return Object(A.a)({},t,e[t])})),t.next=4,c({zomeName:x.c.PREFERENCE,fnName:x.a[x.c.PREFERENCE].SET_PREFERENCE,payload:Object.assign.apply(Object,[{}].concat(Object(ae.a)(s)))});case 4:o=t.sent,n({type:Z.a,preference:{readReceipt:o.readReceipt,typingIndicator:o.typingIndicator}});case 6:case"end":return t.stop()}}),t)})));return function(e,n,a){return t.apply(this,arguments)}}()},xr=function(){var e=Object(d.c)((function(e){return e.preference})),t=e.typingIndicator,n=e.readReceipt,a=I(),r=Object(l.a)();return Object(m.jsxs)(o.A,{children:[Object(m.jsx)(o.B,{children:Object(m.jsx)(o.z,{children:Object(m.jsx)("h1",{children:r.formatMessage({id:"app.settings.preference-label"})})})}),Object(m.jsxs)(o.w,{children:[Object(m.jsx)(o.z,{children:r.formatMessage({id:"app.settings.typing-indicator-label"})}),Object(m.jsx)(o.eb,{checked:t,onIonChange:function(){return a(yr({typingIndicator:!t}))}})]}),Object(m.jsxs)(o.w,{children:[Object(m.jsx)(o.z,{children:r.formatMessage({id:"app.settings.read-receipt-label"})}),Object(m.jsx)(o.eb,{checked:n,onIonChange:function(){return a(yr({readReceipt:!n}))}})]})]})},_r=function(){var e=Object(M.f)();return Object(m.jsx)(o.q,{children:Object(m.jsx)(o.fb,{children:Object(m.jsx)(o.f,{slot:"start",children:Object(m.jsx)(o.e,{onClick:function(){return e.push({pathname:"/home"})},className:"ion-no-padding",children:Object(m.jsx)(o.r,{slot:"icon-only",icon:u.e})})})})})},Er=n(176),Tr=n.n(Er),Sr=function(){return Object(m.jsxs)(o.H,{children:[Object(m.jsx)(_r,{}),Object(m.jsxs)(o.k,{className:Tr.a["settings-list"],children:[Object(m.jsx)(xr,{}),Object(m.jsx)(vr,{})]})]})},Nr=function(){var e=Object(a.useState)(!0),t=Object(i.a)(e,2),n=t[0],r=t[1],c=I();return Object(a.useEffect)((function(){c(function(){var e=Object(O.a)(h.a.mark((function e(t,n,a){var r,c,s,o,i,u,l,d,b,j,m,f,O,g;return h.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=a.callZome,a.getAgentId,e.prev=1,e.next=4,r({zomeName:x.c.AGGREGATOR,fnName:x.a[x.c.AGGREGATOR].RETRIEVE_LATEST_DATA});case 4:return c=e.sent,console.log("latest data ",c),t({type:E.a,id:c.userInfo.agentPubKey,nickname:c.userInfo.profile.nickname,fields:c.userInfo.profile.fields.avatar?{avatar:Object(y.a)(c.userInfo.profile.fields.avatar)}:{}}),s={},o={},c.addedProfiles.forEach((function(e){var t=e.agentPubKey;s[t]={id:t,username:e.profile.nickname,fields:e.profile.fields.avatar?{avatar:Object(y.a)(e.profile.fields.avatar)}:{}}})),c.blockedProfiles&&c.blockedProfiles.forEach((function(e){var t=e.agentPubKey;o[t]={id:t,username:e.profile.nickname,fields:e.profile.fields.avatar?{avatar:Object(y.a)(e.profile.fields.avatar)}:{}}})),t({type:G.b,contacts:s}),t({type:G.a,blocked:o}),t({type:Z.a,preference:{readReceipt:c.globalPreference.readReceipt,typingIndicator:c.globalPreference.typingIndicator}}),i=D(c.latestGroupMessages),u=c.groups.map((function(e){return{originalGroupId:Object(v.b)(e.groupId),originalGroupRevisionId:Object(v.b)(e.groupRevisionId),name:e.latestName,members:e.members.map((function(e){return Object(v.b)(e)})),createdAt:Object(C.e)(e.created),creator:Object(v.b)(e.creator),messages:i.messagesByGroup[Object(v.b)(e.groupId)],pinnedMessages:[],avatar:e.avatar}})),l=c.memberProfiles.map((function(e){return{id:e.agentPubKey,username:e.profile.nickname,fields:e.profile.fields.avatar?{avatar:Object(y.a)(e.profile.fields.avatar)}:{}}})),d=n().groups.conversations,u.forEach((function(e){d[e.originalGroupId]=e})),b=n().groups.messages,b=Object(p.a)(Object(p.a)({},b),i.groupMessagesContents),j=n().groups.members,l.forEach((function(e){j[e.id]=e})),t({type:z.k,messages:b,conversations:d,members:j}),m=Object(p.a)({},n().contacts.contacts),f=Object(p.a)({},n().profile),O=Object(p.a)(Object(p.a)({},m),{},Object(A.a)({},f.id,{id:f.id,username:f.username,fields:f.fields})),g=Object(F.a)(c.latestP2pMessages,O),t(Object(B.a)(g)),e.abrupt("return",null);case 32:e.prev=32,e.t0=e.catch(1),console.log(e.t0),t(Object(_.a)("TOAST",{},{id:"redux.err.commons-get-latest-data"}));case 36:case"end":return e.stop()}}),e,null,[[1,32]])})));return function(t,n,a){return e.apply(this,arguments)}}()).then((function(e){return r(!1)}))}),[]),n?Object(m.jsx)(f,{}):Object(m.jsxs)(o.V,{contentId:"main",children:[Object(m.jsx)(P,{}),Object(m.jsx)(o.L,{id:"main",children:Object(m.jsxs)(M.d,{children:[Object(m.jsx)(M.b,{path:"/home",render:function(){return Object(m.jsx)(Ka,{})}}),Object(m.jsx)(M.b,{path:"/compose",exact:!0,component:ir}),Object(m.jsx)(M.b,{path:"/settings",exact:!0,component:Sr}),Object(m.jsx)(M.b,{path:"/g/:group",component:ga}),Object(m.jsx)(M.b,{path:"/u/:id",component:Pn}),Object(m.jsx)(M.b,{path:"/p/:id",exact:!0,component:fr}),Object(m.jsx)(M.b,{path:"/blocked",exact:!0,component:ne}),Object(m.jsx)(M.a,{from:"/",to:"/home"})]})})]})},wr=n(107),Ir=n(119),Mr=n.n(Ir),kr=function(){var e=Object(M.f)();return Object(m.jsx)(o.H,{children:Object(m.jsx)(o.k,{fullscreen:!0,children:Object(m.jsxs)("div",{className:Mr.a.landing,children:[Object(m.jsx)(o.s,{src:"assets/icon/kizuna_logo.png",className:Mr.a.logo}),Object(m.jsx)("div",{className:Mr.a.actions,children:Object(m.jsx)(o.K,{children:Object(m.jsx)(o.e,{onClick:function(){return e.push({pathname:"/register"})},className:"ion-margin-bottom",children:Object(m.jsx)(ha.a,{id:"app.landing.register"})})})})]})})})},Rr=n(99),Pr=n.n(Rr),Ar=function(){var e=Object(a.useState)(""),t=Object(i.a)(e,2),n=t[0],r=t[1],c=Object(l.a)(),s=Object(M.f)();return Object(m.jsxs)(o.H,{children:[Object(m.jsx)(o.q,{children:Object(m.jsx)(o.fb,{className:Pr.a.toolbar,children:Object(m.jsx)(o.f,{slot:"start",children:Object(m.jsx)(o.e,{onClick:function(){return s.push({pathname:"/"})},className:"ion-no-padding",children:Object(m.jsx)(o.r,{slot:"icon-only",icon:u.e})})})})}),Object(m.jsx)(o.k,{children:Object(m.jsxs)("div",{className:Pr.a.login,children:[Object(m.jsx)("div",{className:Pr.a.form,children:Object(m.jsxs)("div",{children:[Object(m.jsx)(o.z,{className:Pr.a.label,children:c.formatMessage({id:"app.login.username-label"})}),Object(m.jsx)(o.v,{value:n,onIonChange:function(e){return r(e.detail.value)},placeholder:c.formatMessage({id:"app.login.username-placeholder"})})]})}),Object(m.jsx)(o.e,{onClick:function(){},children:c.formatMessage({id:"app.login.login"})})]})}),Object(m.jsx)(o.C,{isOpen:!1})]})},Cr=n(100),Gr=n.n(Cr),Lr=["error","className"],Dr=function(e){var t=e.error,n=e.className,r=Object(xe.a)(e,Lr),c=Object(a.useState)(!1),s=Object(i.a)(c,2),u=s[0],l=s[1];return Object(a.useEffect)((function(){l(!!t)}),[t]),Object(m.jsxs)(o.y,{children:[Object(m.jsx)(o.v,Object(p.a)({className:"".concat(Gr.a.input," ").concat(u?Gr.a["error-input"]:""," ").concat(n)},r)),Object(m.jsx)("div",{className:Gr.a["error-container"],children:u?Object(m.jsx)(o.z,{color:"danger",className:"ion-text-wrap ".concat(Gr.a.error),children:t}):null})]})},Hr=n(64),Ur=n.n(Hr),zr=function(e){var t=e.onChange,n=e.imageRef,r=Object(l.a)(),c=Object(a.useState)(null),s=Object(i.a)(c,2),d=s[0],p=s[1],b=Object(a.useRef)(null);return Object(m.jsxs)("div",{className:Ur.a["profile-picture"],children:[Object(m.jsx)("input",{ref:b,accept:"image/png, image/jpeg",type:"file",hidden:!0,onChange:function(){Array.from(b.current?b.current.files:new FileList).forEach((function(e){e.arrayBuffer().then((function(n){var a=new FileReader,r=new TextEncoder;a.readAsDataURL(e),a.onload=function(e){var n,a=r.encode(null===(n=e.target)||void 0===n?void 0:n.result);p(a),t(a)}}))}))}}),Object(m.jsx)(o.z,{className:Ur.a.label,children:r.formatMessage({id:"app.register.avatar-label"})}),Object(m.jsxs)("div",{className:Ur.a["profile-picture-content"],children:[Object(m.jsx)("div",{className:Ur.a["avatar-container"],children:Object(m.jsx)("img",{alt:"avatar",ref:n,src:u.R,className:"".concat(Ur.a.avatar," ").concat(d?"":Ur.a.default)})}),Object(m.jsx)("div",{className:"ion-padding-start",children:Object(m.jsx)(o.f,{children:Object(m.jsx)(o.e,{onClick:function(){var e;b.current.value="",null===(e=b.current)||void 0===e||e.click()},fill:"solid",type:"button",color:"primary",className:Ur.a["avatar-button"],children:Object(m.jsx)(o.z,{className:Ur.a["button-label"],children:r.formatMessage({id:"app.register.button-avatar-label"})})})})})]})]})},Fr=function(e){return/^[a-zA-Z0-9_](?!.*?[._]{2})[a-zA-Z0-9_.]{2,15}$/.test(e)},Br=n(86),Zr=n.n(Br),Vr=function(){var e=Object(a.useState)(""),t=Object(i.a)(e,2),n=t[0],r=t[1],c=Object(a.useState)(null),s=Object(i.a)(c,2),u=s[0],d=s[1],p=Object(a.useState)(!0),b=Object(i.a)(p,2),j=b[0],f=b[1],O=Object(a.useState)(!1),g=Object(i.a)(O,2),h=g[0],v=g[1],y=I(),x=Object(a.useState)(null),_=Object(i.a)(x,2),E=_[0],S=_[1],N=Object(a.useRef)(null),w=Object(l.a)();Object(a.useEffect)((function(){u||0===n.length?f(!0):f(!1)}),[u,n,E]);var M=function(){v(!0),y(T(n,N.current.src.includes("svg")?null:E)).then((function(e){e||v(!1)}))};Object(a.useEffect)((function(){E&&P({cssClass:"cropper ".concat(Zr.a.modal)})}),[E]);var k=Object(o.qb)(Jn,{src:function(){var e=new TextDecoder;return E?e.decode(E):""}(),prevPath:"/register",dismiss:function(){A()},onComplete:function(e){if(e){var t=new Blob([e],{type:"image/jpeg"}),n=URL.createObjectURL(t);N.current.src=n,S(e)}},intl:w}),R=Object(i.a)(k,2),P=R[0],A=R[1];return Object(m.jsxs)(o.H,{children:[Object(m.jsx)(o.q,{children:Object(m.jsx)(o.fb,{className:Zr.a.toolbar,children:Object(m.jsx)(o.f,{slot:"start",children:Object(m.jsx)(o.c,{defaultHref:"/"})})})}),Object(m.jsxs)(o.k,{children:[Object(m.jsxs)("div",{className:Zr.a.register,children:[Object(m.jsxs)("div",{className:Zr.a.form,children:[Object(m.jsx)(zr,{imageRef:N,onChange:function(e){S(e)}}),Object(m.jsxs)("div",{children:[Object(m.jsx)(o.z,{className:Zr.a.label,children:w.formatMessage({id:"app.register.username-label"})}),Object(m.jsx)(Dr,{value:n,onIonChange:function(e){r(e.detail.value),d(e.detail.value.includes(" ")?w.formatMessage({id:"app.register.error-username-with-space"}):Fr(e.detail.value)&&e.detail.value.length>=3?null:w.formatMessage({id:"app.register.error-invalid-username"}))},onKeyPress:function(e){return function(e){return"Enter"!==e.key||e.shiftKey||u?null:M()}(e)},placeholder:w.formatMessage({id:"app.register.username-placeholder"}),error:u,debounce:600})]})]}),Object(m.jsx)(o.e,{onClick:M,disabled:j,children:w.formatMessage({id:"app.register.register"})})]}),Object(m.jsx)(o.C,{isOpen:h})]})]})},Yr=function(){return Object(m.jsxs)(wr.a,{children:[Object(m.jsx)(M.b,{path:"/",component:kr}),Object(m.jsx)(M.b,{path:"/register",component:Vr}),Object(m.jsx)(M.b,{path:"/login",component:Ar})]})},Xr=n(177),Kr=n.n(Xr),qr=function(){var e=Object(l.a)(),t=Object(d.c)((function(e){return e.profile})).username,n=Object(a.useState)(!0),r=Object(i.a)(n,2),c=r[0],s=r[1],p=Object(a.useState)(!1),b=Object(i.a)(p,2),j=b[0],O=b[1],g=I();Object(a.useEffect)((function(){g(S()).then((function(e){e||O(!0),s(!1)}))}),[g]);return c?Object(m.jsx)(f,{}):null!==t?Object(m.jsx)(Nr,{}):j?Object(m.jsxs)("div",{className:Kr.a.err,children:[Object(m.jsx)(o.r,{icon:u.ab}),Object(m.jsx)(o.Z,{children:e.formatMessage({id:"app.auth.err"})})]}):Object(m.jsx)(Yr,{})};Object(o.pb)({mode:"md"});var Wr=function(){return Object(m.jsx)(qr,{})},Jr=function(e){var t=e.children,n=Object(d.c)((function(e){return e.error.errors})),r=Tt().showErrorToast,c=I(),s=Object(l.a)();return Object(a.useEffect)((function(){if(n.length>0){var e=n[0],t=e.intl?{message:s.formatMessage({id:e.intl.id},e.intl.value)}:{};r(Object(p.a)(Object(p.a)({},e.options),t)),c(Object(_.b)())}}),[n,c,s,r]),Object(m.jsx)(m.Fragment,{children:t})},Qr=n(285),$r=n(75),ec=n.n($r),tc=function(){var e=Object(a.useState)(0),t=Object(i.a)(e,2),n=t[0],r=t[1],c=I(),s=[{language:"English",code:"en"},{language:"Japanese",code:"jp"}];return Object(m.jsx)(o.H,{children:Object(m.jsxs)("div",{className:ec.a.page,children:[Object(m.jsx)("div",{className:ec.a["language-container"],children:s.map((function(e,t){var a=e.language;return Object(m.jsx)(o.Z,{className:"".concat(ec.a.language).concat(n===t?" ".concat(ec.a.selected):""),onClick:function(){return r(t)},children:Object(m.jsx)("p",{children:a})},a)}))}),Object(m.jsx)("div",{className:ec.a["button-container"],children:Object(m.jsx)(o.e,{onClick:function(){c(gr(s[n].code))},className:"".concat(ec.a.button),children:"Select"})})]})})},nc={en:n(178),jp:n(179)},ac=function(e){var t=e.children,n=I(),a=Object(d.c)((function(e){var t=e.language.language;if(t)return t;var a=localStorage.getItem("language");return a&&n(gr(a)),null}));return a?Object(m.jsx)(Qr.a,{messages:nc[a],defaultLocale:"en",locale:"en",children:t}):Object(m.jsx)(tc,{})},rc=function(e){var t=e.children;return Object(m.jsx)(o.a,{children:t})},cc=n(83),sc=function(e){var t=e.children;return Object(m.jsx)(wr.a,{children:t})},oc=function(e){var t=e.children,n=Object(a.useState)(!1),r=Object(i.a)(n,2),c=r[0],s=r[1],u=Object(a.useState)(!1),l=Object(i.a)(u,2),b=l[0],j=l[1],f=Object(d.c)((function(e){return e.language.language})),O=Object(a.useState)({}),g=Object(i.a)(O,2),h=g[0],v=g[1];Object(a.useEffect)((function(){s(b)}),[b]);var y=function(){j(!1),s(!1)};function x(e){return void 0!==e.split}Object(a.useEffect)((function(){b||v({})}),[b]);return Object(m.jsxs)(Et.Provider,{value:{showToast:function(e){v(e),j(!0)},dismissToast:y,showErrorToast:function(e){if("en"===f){var t=null===e||void 0===e?void 0:e.message;if(t){var n=x(t)?160*t.split(" ").length:160*t.value.split(" ").length;v(Object(p.a)({color:"danger",duration:n},e))}}else if("jp"===f){var a=null===e||void 0===e?void 0:e.message;if(a){var r=x(a)?100*Object(ae.a)(a).length:100*Object(ae.a)(a.value).length;v(Object(p.a)({color:"danger",duration:r},e))}}else v(Object(p.a)({color:"danger"},e));j(!0)}},children:[Object(m.jsx)(o.db,Object(p.a)({isOpen:c,onDidDismiss:y,duration:1500},h)),t]})},ic=function(e){var t=e.children;return Object(m.jsx)(cc.a,{children:Object(m.jsx)(rc,{children:Object(m.jsx)(sc,{children:Object(m.jsx)(ac,{children:Object(m.jsx)(oc,{children:Object(m.jsx)(Jr,{children:t})})})})})})};n(234);s.a.render(Object(m.jsx)(ic,{children:Object(m.jsx)(Wr,{})}),document.getElementById("root"))}],[[235,3,4]]]);
//# sourceMappingURL=main.4d07cf84.chunk.js.map