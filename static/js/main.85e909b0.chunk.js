(this.webpackJsonpui=this.webpackJsonpui||[]).push([[1],[,,,,,,function(e,t,n){"use strict";n.d(t,"c",(function(){return s})),n.d(t,"b",(function(){return o})),n.d(t,"a",(function(){return i}));var a,r,c=n(11),s={USERNAME:"username",PROFILES:"profiles",PREFERENCE:"preference",P2PMESSAGE:"p2pmessage",CONTACTS:"contacts",GROUP:"group",AGGREGATOR:"aggregator"},o=(a={},Object(c.a)(a,s.GROUP,{ADDED_TO_GROUP:"ADDED_TO_GROUP",GROUP_MESSAGE_DATA:"GROUP_MESSAGE_DATA",GROUP_TYPING_DETAIL:"GROUP_TYPING_DETAIL",GROUP_MESSAGE_READ:"GROUP_MESSAGE_READ",PIN_MESSAGE_DATA:"PIN_MESSAGE_DATA"}),Object(c.a)(a,s.P2PMESSAGE,{RECEIVE_P2P_MESSAGE:"RECEIVE_P2P_MESSAGE",RECEIVE_P2P_RECEIPT:"RECEIVE_P2P_RECEIPT",SYNC_P2P_PINS:"SYNC_P2P_PINS",TYPING_P2P:"TYPING_P2P",POST_COMMIT_ERROR_COMMIT_MESSAGE:"POST_COMMIT_ERROR_COMMIT_MESSAGE",POST_COMMIT_ERROR_COMMIT_RECEIPT:"POST_COMMIT_ERROR_COMMIT_RECEIPT"}),a),i=(r={},Object(c.a)(r,s.USERNAME,{SET_USERNAME:"set_username",GET_USERNAMES:"get_usernames",GET_ALL_USERNAMES:"get_all_usernames",GET_AGENT_PUBKEY_FROM_USERNAME:"get_agent_pubkey_from_username",GET_MY_USERNAME:"get_my_username"}),Object(c.a)(r,s.PROFILES,{CREATE_PROFILE:"create_profile",SEARCH_PROFILES:"search_profiles",GET_AGENT_PROFILE:"get_agent_profile",GET_AGENTS_PROFILES:"get_agents_profile",GET_MY_PROFILE:"get_my_profile",GET_ALL_PROFILES:"get_all_profiles"}),Object(c.a)(r,s.CONTACTS,{ADD_CONTACTS:"add_contacts",REMOVE_CONTACTS:"remove_contacts",BLOCK_CONTACTS:"block_contacts",UNBLOCK_CONTACTS:"unblock_contacts",LIST_ADDED:"list_added",LIST_BLOCKED:"list_blocked",IN_CONTACTS:"in_contacts",IN_BLOCKED:"in_blocked"}),Object(c.a)(r,s.PREFERENCE,{GET_PREFERENCE:"get_preference",SET_PREFERENCE:"set_preference",SET_PER_AGENT_PREFERENCE:"set_per_agent_preference",GET_PER_AGENT_PREFERENCE:"get_per_agent_preference",SET_PER_GROUP_PREFERENCE:"set_per_group_preference",GET_PER_GROUP_PREFERENCE:"get_per_group_preference"}),Object(c.a)(r,s.GROUP,{CREATE_GROUP:"create_group",ADD_MEMBERS:"add_members",REMOVE_MEMBERS:"remove_members",UPDATE_GROUP_NAME:"update_group_name",SEND_MESSAGE:"send_message",GET_ALL_MY_GROUPS:"get_all_my_groups",GET_PREVIOUS_GROUP_MESSAGES:"get_previous_group_messages",GET_SUBSEQUENT_GROUP_MESSAGES:"get_subsequent_group_messages",GET_ADJACENT_GROUP_MESSAGES:"get_adjacent_group_messages",GET_MESSAGES_BY_GROUP_BY_TIMESTAMP:"get_messages_by_group_by_timestamp",GET_GROUP_LATEST_VERSION:"get_group_latest_version",INDICATE_GROUP_TYPING:"indicate_group_typing",READ_GROUP_MESSAGE:"read_group_message",GET_FILES_BYTES:"get_files_bytes",PIN_MESSAGE:"pin_message",UNPIN_MESSAGE:"unpin_message",FETCH_PINNED_MESSAGES:"get_pinned_messages"}),Object(c.a)(r,s.AGGREGATOR,{RETRIEVE_LATEST_DATA:"retrieve_latest_data"}),Object(c.a)(r,s.P2PMESSAGE,{SEND_MESSAGE:"send_message",SEND_MESSAGE_WITH_TIMESTAMP:"send_message_with_timestamp",COMMIT_MESSAGE_TO_RECEIVER:"commit_message_to_receiver_chain",GET_LATEST_MESSAGES:"get_latest_messages",GET_MESSAGES_BY_AGENT_BY_TIMESTAMP:"get_messages_by_agent_by_timestamp",GET_PREVIOUS_MESSAGES:"get_previous_messages",GET_ALL_MESSAGES:"get_all_messages",READ_MESSAGE:"read_message",GET_FILE_BYTES:"get_file_bytes",TYPING:"typing",PIN_MESSAGE:"pin_message",GET_PINNED_MESSAGES:"get_pinned_messages",GET_NEXT_MESSAGES:"get_next_messages",GET_ADJACENT_MESSAGES:"get_adjacent_messages"}),r)},,function(e,t,n){"use strict";(function(e){n.d(t,"i",(function(){return o})),n.d(t,"h",(function(){return i})),n.d(t,"c",(function(){return u})),n.d(t,"j",(function(){return l})),n.d(t,"f",(function(){return p})),n.d(t,"l",(function(){return d})),n.d(t,"e",(function(){return b})),n.d(t,"b",(function(){return j})),n.d(t,"k",(function(){return f})),n.d(t,"d",(function(){return m})),n.d(t,"g",(function(){return O})),n.d(t,"m",(function(){return g})),n.d(t,"a",(function(){return v}));var a=n(7),r=n(5),c=n(2),s=n(14),o=function(e,t,n){return Object.keys(e).reduce((function(a,r){var c;return n&&(c=n(r)),c?a[c]=t(e[r]):a[r]=t(e[r]),a}),{})},i=function(e,t){switch(e){case 0:return t.formatMessage({id:"app.group-chat.media.month.1"});case 1:return t.formatMessage({id:"app.group-chat.media.month.2"});case 2:return t.formatMessage({id:"app.group-chat.media.month.3"});case 3:return t.formatMessage({id:"app.group-chat.media.month.4"});case 4:return t.formatMessage({id:"app.group-chat.media.month.5"});case 5:return t.formatMessage({id:"app.group-chat.media.month.6"});case 6:return t.formatMessage({id:"app.group-chat.media.month.7"});case 7:return t.formatMessage({id:"app.group-chat.media.month.8"});case 8:return t.formatMessage({id:"app.group-chat.media.month.9"});case 9:return t.formatMessage({id:"app.group-chat.media.month.10"});case 10:return t.formatMessage({id:"app.group-chat.media.month.11"});case 11:return t.formatMessage({id:"app.group-chat.media.month.12"})}},u=function(e){var t=e.getUTCFullYear(),n=e.getMonth()+1,a=e.getDate(),r=n<10?"0".concat(n):n,c=a<10?"0".concat(a):a;return"".concat(t,"-").concat(r,"-").concat(c)},l=function(e){var t=e.split("-"),n=Object(a.a)(t,3),r=n[0],c=n[1],s=n[2],o=c,i=s;return"0"===c.charAt(0)&&(o=c.substring(1)),"0"===s.charAt(0)&&(i=s.substring(1)),new Date(Date.UTC(parseInt(r),parseInt(o)-1,parseInt(i)))},p=function(e){var t={},n=e.sort((function(e,t){return e.username.toLocaleLowerCase().localeCompare(t.username.toLocaleLowerCase())}));return n.length>0&&n.forEach((function(e){var n=e.username.charAt(0).toLocaleLowerCase(),a=t[n];void 0===a&&(t[n]=[],a=t[n]),a.push(e)})),t},d=function(){return Object(s.b)()},b=function(t){return e.from(Object(r.a)(t).buffer)},j=function(e){return e/1024/1024>=1?"".concat((e/1024/1024).toFixed(2),"mb"):"".concat((e/1024).toFixed(2),"kb")},f=function(e){return new Date(.001*e)},m=function(e){return 1e3*e.getTime()},O=function(e){return"TEXT"===e.type},g=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r=n.shouldPreventDefault,s=void 0===r||r,o=n.delay,i=void 0===o?300:o,u=Object(c.useState)(!1),l=Object(a.a)(u,2),p=l[0],d=l[1],b=Object(c.useRef)(),j=Object(c.useRef)(),f=Object(c.useCallback)((function(t){s&&t.target&&(t.target.addEventListener("touchend",h,{passive:!1}),j.current=t.target),t.persist(),b.current=setTimeout((function(){e(t),d(!0)}),i)}),[e,i,s]),m=Object(c.useCallback)((function(e){var n=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];b.current&&clearTimeout(b.current),n&&!p&&t(e),d(!1),s&&j.current&&j.current.removeEventListener("touchend",h)}),[s,t,p]);return{onMouseDown:function(e){return f(e)},onTouchStart:function(e){return f(e)},onMouseUp:function(e){return m(e)},onMouseLeave:function(e){return m(e,!1)},onTouchEnd:function(e){return m(e)}}},h=function(e){(function(e){return"touches"in e})(e)&&e.touches.length<2&&e.preventDefault&&e.preventDefault()},v=function(e){return URL.createObjectURL(new Blob([Object(r.a)(e)],{type:"image/jpeg"}))}}).call(this,n(50).Buffer)},,,,,function(e,t,n){"use strict";n.d(t,"a",(function(){return c})),n.d(t,"b",(function(){return s}));var a=n(17),r=n(72),c=function(e,t,n){return function(a){"TOAST"===e&&a({type:r.a,error:{type:"TOAST",options:t,intl:n}})}},s=function(){return function(e,t){var n=Object(a.a)(t().error.errors);n.length>0&&(n.shift(),e({type:r.b,errors:n}))}}},,,function(e,t,n){"use strict";n.d(t,"a",(function(){return a})),n.d(t,"m",(function(){return r})),n.d(t,"c",(function(){return c})),n.d(t,"b",(function(){return s})),n.d(t,"g",(function(){return o})),n.d(t,"h",(function(){return i})),n.d(t,"e",(function(){return u})),n.d(t,"k",(function(){return l})),n.d(t,"f",(function(){return p})),n.d(t,"j",(function(){return d})),n.d(t,"i",(function(){return b})),n.d(t,"l",(function(){return j})),n.d(t,"d",(function(){return f}));var a="ADD_GROUP",r="UPDATE_GROUP_NAME",c="REMOVE_MEMBERS",s="ADD_MEMBERS",o="SET_GROUP_MESSAGE",i="SET_GROUP_MESSAGES",u="SET_ERR_GROUP_MESSAGE",l="SET_LATEST_GROUP_STATE",p="SET_FILES_BYTES",d="SET_GROUP_TYPING_INDICATOR",b="SET_GROUP_READ_MESSAGE",j="SET_PINNNED_MESSAGES",f="SET_CONVERSATIONS"},,,,,,,,,function(e,t,n){"use strict";function a(e){return"TEXT"===e.type}function r(e){return"OTHER"===e.type}function c(e){return"IMAGE"===e.type}function s(e){return"VIDEO"===e.type}function o(e){return void 0!==e.p2pMessageEntryHash}n.d(t,"d",(function(){return a})),n.d(t,"b",(function(){return r})),n.d(t,"a",(function(){return c})),n.d(t,"e",(function(){return s})),n.d(t,"c",(function(){return o}))},,,,function(e,t,n){"use strict";n.d(t,"d",(function(){return a})),n.d(t,"f",(function(){return r})),n.d(t,"b",(function(){return c})),n.d(t,"c",(function(){return s})),n.d(t,"g",(function(){return o})),n.d(t,"a",(function(){return i})),n.d(t,"h",(function(){return u})),n.d(t,"e",(function(){return l}));var a="SET_MESSAGES",r="SET_RECEIPTS",c="SET_ERR_MESSAGE",s="SET_FILES",o="SET_TYPING",i="PIN_MESSAGE",u="UNPIN_MESSAGE",l="SET_PINNED"},,function(e,t,n){"use strict";n.d(t,"b",(function(){return a})),n.d(t,"a",(function(){return r}));var a="SET_CONTACTS",r="SET_BLOCKED"},,,function(e,t,n){e.exports={read:"style_read__3GeUO",bubble:"style_bubble__b3vlV",text:"style_text__3mW4k",file:"style_file__2E9_r",space:"style_space__1IgoE","author-name":"style_author-name__2wbPZ",picture:"style_picture__2lzdL","avatar-container":"style_avatar-container__3X-qJ","me-container":"style_me-container__1SA7U",me:"style_me__dv2Iw","max-file":"style_max-file__20l-d","others-container":"style_others-container__19SEV",others:"style_others__QcKpe",avatar:"style_avatar__3eiPZ","not-delivered":"style_not-delivered__3sCqu","not-delivered-container":"style_not-delivered-container__gnnKW"}},,,,,,,,function(e,t,n){e.exports={reply:"style_reply__1alfg",row:"style_row__2lZL5",column:"style_column__2fUOQ",author:"style_author__3RrBq",text:"style_text__-M__Q",thumbnail:"style_thumbnail__2NKmm"}},,,,,function(e,t,n){e.exports={mediarow:"style_mediarow__2Kl-B",month:"style_month__G0kAs",mediacard:"style_mediacard__tGTBA"}},,function(e,t,n){e.exports={"content-container":"style_content-container__1pYC1",header:"style_header__3oN7M",author:"style_author__1no5c",date:"style_date__3fX4m",thumbnail:"style_thumbnail__2jeYz",video:"style_video__2c8Ip",other:"style_other__3Q1FT","file-details":"style_file-details__14BgG","file-size":"style_file-size__2Qbcp"}},,,,function(e,t,n){"use strict";(function(e){n.d(t,"a",(function(){return j}));var a=n(9),r=n(11),c=n(3),s=n(7),o=n(4),i=n.n(o),u=n(5),l=n(6),p=n(8),d=n(89),b=function(e,t,n){var a,o=Object(s.a)(e,2),i=o[0],l=o[1],d=Object(u.b)(i);switch(l.payload.type){case"TEXT":a=l.payload;break;case"FILE":a={type:"FILE",fileName:l.payload.payload.metadata.fileName,fileSize:l.payload.payload.metadata.fileSize,fileType:l.payload.payload.fileType.type,fileHash:Object(u.b)(l.payload.payload.metadata.fileHash),thumbnail:"OTHER"!==l.payload.payload.fileType.type?l.payload.payload.fileType.payload.thumbnail:null}}var b=Object(c.a)(Object(c.a)({},t),{},Object(r.a)({},n.id,{id:n.id,username:n.username})),j=void 0,f=void 0;if(null!==l.replyTo){switch(l.replyTo.payload.type){case"TEXT":f=l.replyTo.payload;break;case"FILE":f={type:"FILE",fileName:l.replyTo.payload.payload.metadata.fileName,fileSize:l.replyTo.payload.payload.metadata.fileSize,fileType:l.replyTo.payload.payload.fileType.type,fileHash:Object(u.b)(l.replyTo.payload.payload.metadata.fileHash),thumbnail:"OTHER"!==l.replyTo.payload.payload.fileType.type?l.replyTo.payload.payload.fileType.payload.thumbnail:null}}j={p2pMessageEntryHash:Object(u.b)(l.replyTo.hash),author:b[Object(u.b)(l.replyTo.author)],receiver:b[Object(u.b)(l.replyTo.receiver)],payload:f||l.replyTo.payload,timestamp:Object(p.k)(l.replyTo.timeSent),receipts:[]}}return{message:{p2pMessageEntryHash:d,author:b[Object(u.b)(l.author)],receiver:b[Object(u.b)(l.receiver)],payload:a,timestamp:Object(p.k)(l.timeSent),replyTo:j||void 0,receipts:[]},receipt:void 0,file:void 0}},j=function(t,n,r,s,o){return function(){var p=Object(a.a)(i.a.mark((function a(p,j,f){var m,O,g,h,v,y,x,_,E,T,S,N,w,I,k,M,R;return i.a.wrap((function(a){for(;;)switch(a.prev=a.next){case 0:return m=f.callZome,O=f.retry,"TEXT"===r?(h={type:"TEXT",payload:{payload:n.trim()}},g=h):(v={type:o.fileType.type,payload:"OTHER"!==o.fileType.type?{thumbnail:o.fileType.payload.thumbnail}:null},y={type:"FILE",payload:{metadata:o.metadata,fileType:v,fileBytes:o.fileBytes}},g=y),x={receiver:e.from(Object(u.a)(t)),payload:g,reply_to:s?e.from(Object(u.a)(s)):void 0},a.prev=3,a.next=6,m({zomeName:l.c.P2PMESSAGE,fnName:l.a[l.c.P2PMESSAGE].SEND_MESSAGE,payload:x});case 6:if("error"===(null===(_=a.sent)||void 0===_?void 0:_.type)){a.next=15;break}return E=Object(c.a)({},j().contacts.contacts),T=Object(c.a)({},j().profile),S=b(_,E,T),N="FILE"===r?{fileHash:S.message.payload.fileHash,fileBytes:o.fileBytes}:void 0,S.file=N,p(Object(d.a)(S)),a.abrupt("return",!0);case 15:a.next=38;break;case 17:if(a.prev=17,a.t0=a.catch(3),a.prev=19,a.t0.message.includes("Timed out")){a.next=32;break}return a.next=23,O({zomeName:l.c.P2PMESSAGE,fnName:l.a[l.c.P2PMESSAGE].SEND_MESSAGE,payload:x});case 23:if("error"===(null===(w=a.sent)||void 0===w?void 0:w.type)){a.next=32;break}return I=Object(c.a)({},j().contacts.contacts),k=Object(c.a)({},j().profile),M=b(w,I,k),R="FILE"===r?{fileHash:M.message.payload.fileHash,fileBytes:o.fileBytes}:void 0,M.file=R,p(Object(d.a)(M)),a.abrupt("return",!0);case 32:return a.abrupt("return",!1);case 35:return a.prev=35,a.t1=a.catch(19),a.abrupt("return",!1);case 38:case"end":return a.stop()}}),a,null,[[3,17],[19,35]])})));return function(e,t,n){return p.apply(this,arguments)}}()}}).call(this,n(50).Buffer)},function(e,t,n){e.exports={keyboardcontainer:"style_keyboardcontainer__ZpjcC",header:"style_header__2EBYq",gifcontainer:"style_gifcontainer__2VZOA",gifcontainerexpanded:"style_gifcontainerexpanded__1GDDQ",categorypreview:"style_categorypreview__1XAxP",gifpreview:"style_gifpreview__1bGYg",textholder:"style_textholder__21szk",categorytext:"style_categorytext__2_4qV",images:"style_images__2xttS"}},function(e,t,n){"use strict";n.d(t,"b",(function(){return a})),n.d(t,"a",(function(){return r}));var a="SET_USERNAME",r="SET_PROFILE"},,,,function(e,t,n){"use strict";n.d(t,"a",(function(){return s}));var a=n(7),r=n(5),c=n(8),s=function(e,t){for(var n=Object.values(e),s=n[0],o=n[1],i=n[2],u={},l=0,p=Object.entries(s);l<p.length;l++){var d=Object(a.a)(p[l],2),b=d[0],j={messages:d[1],pinned:s[b]?s[b].pinned:[]};u[b]=j}for(var f={},m=0,O=Object.entries(o);m<O.length;m++){var g=Object(a.a)(O[m],2),h=g[0],v=g[1],y=Object(v),x=y[0],_=y[1],E=void 0;switch(x.payload.type){case"TEXT":E=x.payload;break;case"FILE":E={type:"FILE",fileName:x.payload.payload.metadata.fileName,fileSize:x.payload.payload.metadata.fileSize,fileType:x.payload.payload.fileType.type,fileHash:Object(r.b)(x.payload.payload.metadata.fileHash),thumbnail:"OTHER"!==x.payload.payload.fileType.type?x.payload.payload.fileType.payload.thumbnail:null}}var T=t[Object(r.b)(x.author)],S=void 0,N=void 0;if(null!==x.replyTo){switch(x.replyTo.payload.type){case"TEXT":S=x.replyTo.payload;break;case"FILE":S={type:"FILE",fileName:x.replyTo.payload.payload.metadata.fileName,fileSize:x.replyTo.payload.payload.metadata.fileSize,fileType:x.replyTo.payload.payload.fileType.type,fileHash:Object(r.b)(x.replyTo.payload.payload.metadata.fileHash),thumbnail:"OTHER"!==x.replyTo.payload.payload.fileType.type?x.replyTo.payload.payload.fileType.payload.thumbnail:null}}N={p2pMessageEntryHash:Object(r.b)(x.replyTo.hash),author:t[Object(r.b)(x.replyTo.author)],receiver:t[Object(r.b)(x.replyTo.receiver)],payload:S||x.replyTo.payload,timestamp:Object(c.k)(x.replyTo.timeSent),replyTo:x.replyTo,receipts:x.replyTo.receipts}}var w={p2pMessageEntryHash:h,author:T,receiver:t[Object(r.b)(x.receiver)],payload:E,timestamp:Object(c.k)(x.timeSent),replyTo:N||void 0,receipts:_};f[h]=w}for(var I={},k=0,M=Object.entries(i);k<M.length;k++){var R=Object(a.a)(M[k],2),P=R[0],C=R[1],A=Object(C),G=A.id,L=A.status,D=L.status,H=L.timestamp,z={p2pMessageReceiptEntryHash:P,p2pMessageEntryHashes:G,timestamp:Object(c.k)(H),status:D};I[P]=z}return{conversations:u,messages:f,receipts:I,files:{},typing:{},pinned:{},errMsgs:{}}}},function(e,t,n){"use strict";n.d(t,"a",(function(){return a}));var a="SET_PREFERENCE"},,,function(e,t,n){"use strict";n.d(t,"a",(function(){return a})),n.d(t,"b",(function(){return r})),n.d(t,"c",(function(){return c})),n.d(t,"d",(function(){return s}));var a="HOLO",r=function(){return"HC"===a||"HCDEV"===a?"kizuna":"HCC"===a?"uhCkkHSLbocQFSn5hKAVFc_L34ssLD52E37kq6Gw9O3vklQ3Jv7eL":void 0},c=function(){return"HC"===a?"ws://localhost:8888":"HCDEV"===a?"ws://127.0.0.1:8888/":"HCC"===a?"http://localhost:24273":"HOLO"===a?"https://devnet-chaperone.holo.host":null},s=function(){return"HCC"===a||"HOLO"===a}},,function(e,t,n){e.exports={"reply-to":"style_reply-to__1ZpXG","content-me":"style_content-me__14mTi","content-others":"style_content-others__2kxSL",thumbnail:"style_thumbnail__2u4oc","vertical-divider-me":"style_vertical-divider-me__3eT7d","vertical-divider-others":"style_vertical-divider-others__dj7Rl"}},function(e,t,n){e.exports={register:"style_register__1IRba",form:"style_form__2MPyA",label:"style_label__2XMD-",toolbar:"style_toolbar__jcPVP","profile-picture":"style_profile-picture__2iBAj",icon:"style_icon__ZLy0M",modal:"style_modal__1pMpC","modal-wrapper":"style_modal-wrapper__3BLWX"}},,function(e,t,n){e.exports={page:"style_page__22EBt","language-container":"style_language-container__2begU",language:"style_language__28kvF",selected:"style_selected__3wGAX"}},,,function(e,t,n){"use strict";n.d(t,"b",(function(){return a})),n.d(t,"a",(function(){return r}));var a="SET_GIFS",r="SET_CATEGORIES"},function(e,t,n){"use strict";n.d(t,"a",(function(){return a})),n.d(t,"b",(function(){return r}));var a="PUSH_ERROR",r="SHIFT_ERROR"},function(e,t,n){"use strict";(function(e){n.d(t,"a",(function(){return j}));var a=n(11),r=n(3),c=n(9),s=n(4),o=n.n(s),i=n(5),u=n(6),l=n(13),p=n(8),d=n(59),b=n(99),j=function(t,n,s,j,f){return function(){var m=Object(c.a)(o.a.mark((function c(m,O,g){var h,v,y,x,_,E,T;return o.a.wrap((function(c){for(;;)switch(c.prev=c.next){case 0:return h=g.callZome,v={conversant:e.from(Object(i.a)(t)),batch_size:n,payload_type:s,last_fetched_timestamp:j?Object(p.d)(j):void 0,last_fetched_message_id:f?e.from(Object(i.a)(f)):void 0},c.prev=2,c.next=5,h({zomeName:u.c.P2PMESSAGE,fnName:u.a[u.c.P2PMESSAGE].GET_PREVIOUS_MESSAGES,payload:v});case 5:if("error"===(null===(y=c.sent)||void 0===y?void 0:y.type)){c.next=13;break}return x=Object(r.a)({},O().contacts.contacts),_=Object(r.a)({},O().profile),E=Object(r.a)(Object(r.a)({},x),{},Object(a.a)({},_.id,{id:_.id,username:_.username,fields:_.fields})),T=Object(d.a)(y,E),Object.values(y[1]).length>0&&m(Object(b.a)(T)),c.abrupt("return",y);case 13:c.next=18;break;case 15:c.prev=15,c.t0=c.catch(2),m(Object(l.a)("TOAST",{},{id:"redux.err.generic"}));case 18:case"end":return c.stop()}}),c,null,[[2,15]])})));return function(e,t,n){return m.apply(this,arguments)}}()}}).call(this,n(50).Buffer)},function(e,t,n){e.exports={header:"style_header__3FlxA",groupname:"style_groupname__olSXj"}},function(e,t,n){e.exports={list:"style_list__N7t6V","contacts-list":"style_contacts-list__20Yc_",warning:"style_warning__3mGhB","warning-icon":"style_warning-icon__3lrr_"}},,function(e,t,n){"use strict";n.d(t,"b",(function(){return a}));n(2);var a,r=n(14),c=n(3),s=n(90),o=n(176),i=n(82),u=n(31),l={contacts:{},blocked:{}},p=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:l,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case u.b:return Object(c.a)(Object(c.a)({},e),{},{contacts:t.contacts});case u.a:return Object(c.a)(Object(c.a)({},e),{},{blocked:t.blocked});default:return e}},d=n(16),b={conversations:{},messages:{},groupFiles:{},members:{},typing:{},pinnedMessages:{},errMsgs:{}},j=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:b,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case d.a:case d.b:case d.c:return Object(c.a)(Object(c.a)({},e),{},{conversations:t.conversations,members:t.members});case d.m:return Object(c.a)(Object(c.a)({},e),{},{conversations:t.conversations});case d.g:return Object(c.a)(Object(c.a)({},e),{},{conversations:t.conversations,messages:t.messages,groupFiles:t.groupFiles});case d.e:return Object(c.a)(Object(c.a)({},e),{},{errMsgs:t.errMsgs});case d.f:return Object(c.a)(Object(c.a)({},e),{},{groupFiles:t.filesBytes});case d.h:return Object(c.a)(Object(c.a)({},e),{},{messages:t.messages,conversations:t.conversations});case d.k:return Object(c.a)(Object(c.a)({},e),{},{conversations:t.conversations,messages:t.messages,members:t.members});case d.j:return Object(c.a)(Object(c.a)({},e),{},{typing:t.typing});case d.i:return Object(c.a)(Object(c.a)({},e),{},{messages:Object(c.a)({},t.messages)});case d.l:var n=Object(c.a)({},t),a=n.conversations,r=n.pinnedMessages;return Object(c.a)(Object(c.a)({},e),{},{conversations:a,pinnedMessages:r});case d.d:var s=t.conversations;return Object(c.a)(Object(c.a)({},e),{},{conversations:s});default:return e}},f=n(60),m={readReceipt:!1,typingIndicator:!1,agentReadReceipt:{},agentTypingIndicator:{},groupReadReceipt:{},groupTypingIndicator:{}},O=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:m,t=arguments.length>1?arguments[1]:void 0;return t.type===f.a?Object(c.a)(Object(c.a)({},e),t.preference):e},g=n(55),h={id:null,username:null,fields:{}},v=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:h,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case g.b:return Object(c.a)(Object(c.a)({},e),{},{username:t.username,id:t.id});case g.a:return Object(c.a)(Object(c.a)({},e),{},{username:t.nickname,id:t.id,fields:t.fields});default:return e}},y=n(29),x={conversations:{},messages:{},receipts:{},files:{},typing:{},pinned:{},errMsgs:{}},_=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:x,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case y.d:return Object(c.a)(Object(c.a)({},e),{},{conversations:t.state.conversations,messages:t.state.messages,receipts:t.state.receipts});case y.b:return Object(c.a)(Object(c.a)({},e),{},{errMsgs:t.state.errMsgs});case y.f:return Object(c.a)(Object(c.a)({},e),{},{receipts:t.state});case y.c:return Object(c.a)(Object(c.a)({},e),{},{files:t.state});case y.g:return Object(c.a)(Object(c.a)({},e),{},{typing:t.state});case y.e:return Object(c.a)(Object(c.a)({},e),{},{conversations:t.state.conversations,pinned:t.state.pinned});default:return e}},E=n(102),T={language:null},S=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:T,t=arguments.length>1?arguments[1]:void 0;return t.type===E.a?(localStorage.setItem("language",t.language),Object(c.a)(Object(c.a)({},e),{},{language:t.language})):e},N=n(17),w=n(72),I={errors:[]},k=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:I,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case w.a:var n=[].concat(Object(N.a)(e.errors),[t.error]);return Object(c.a)(Object(c.a)({},e),{},{errors:n});case w.b:return Object(c.a)(Object(c.a)({},e),{},{errors:t.errors});default:return e}},M=n(71),R={gifs:{},categories:{}},P=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:R,t=arguments.length>1?arguments[1]:void 0;if(t.type===M.b){var n=e;return n.gifs=t.state,n}return e},C=Object(s.b)({profile:v,contacts:p,preference:O,groups:j,p2pmessages:_,language:S,error:k,gif:P}),A=function(e){var t=o.a.withExtraArgument(Object(c.a)({callZome:i.a,getAgentId:i.c,retry:i.e,client:i.b,init:i.d},e));return Object(s.c)(C,Object(s.a)(t))},G=n(0);a=A();t.a=function(e){var t=e.children;return Object(G.jsx)(r.a,{store:a,children:t})}},function(e,t,n){e.exports={controls:"style_controls__2gscS","play-pause":"style_play-pause__2Bgys","range-slider-expand":"style_range-slider-expand__1y37Y","range-slider":"style_range-slider__1leiI","slider-volume":"style_slider-volume__1u5c4"}},function(e,t,n){e.exports={content:"style_content__U_pdz","play-pause":"style_play-pause__1sBQt","modal-control":"style_modal-control__2LLvX","slider-volume":"style_slider-volume__37ujv",toolbar:"style_toolbar__3aY0h"}},function(e,t,n){e.exports={"member-page":"style_member-page__2gB0m",icon:"style_icon__7xzbp","member-title":"style_member-title__2-_Xp","member-name":"style_member-name__1hzQW"}},function(e,t,n){e.exports={header:"style_header__1GbNk","profile-picture":"style_profile-picture__Ylhcn","profile-picture-toolbar":"style_profile-picture-toolbar__2IRI-",nickname:"style_nickname__36IXj","profile-toolbar":"style_profile-toolbar__3bqXt","content-icon":"style_content-icon__2luvw",content:"style_content__2vCA9"}},function(e,t,n){"use strict";(function(e){n.d(t,"b",(function(){return d})),n.d(t,"d",(function(){return f})),n.d(t,"c",(function(){return m})),n.d(t,"e",(function(){return g})),n.d(t,"a",(function(){return h}));var a=n(3),r=n(9),c=n(4),s=n.n(c),o=n(117),i=n(104),u=n(77),l=n(177),p=n(63);e.COMB=void 0,window.COMB=n(226).COMB;var d=null,b=function(e){return null===u.b||void 0===u.b?void 0:u.b.dispatch(Object(l.a)(e.data.payload.name,e.data.payload.payload))},j=function(){var e=Object(r.a)(s.a.mark((function e(t){var n,a,r,c,u,l,d;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:e.t0=t,e.next="HOLO"===e.t0||"HCC"===e.t0?3:"HCDEV"===e.t0||"HC"===e.t0?22:30;break;case 3:return n={logo_url:"assets/icon/kizuna_logo.png",app_name:"Kizuna Messaging App",skip_registration:!0},a=new o.c(Object(p.c)(),n),console.log("client being returned from cell-client",a),e.next=8,a.connection.ready();case 8:return console.log("connection is ready"),e.next=11,a.connection.signIn();case 11:return console.log("signed in"),e.next=14,a.connection.appInfo(Object(p.b)());case 14:if(r=e.sent,console.log("app info: ",r),r.cell_data){e.next=18;break}throw new Error("Holo appInfo() failed: ".concat(JSON.stringify(r)));case 18:return c=r.cell_data[0],console.log("cell data: ",c),c.cell_id[0]instanceof Uint8Array||(c.cell_id=[new Uint8Array(c.cell_id[0].data),new Uint8Array(c.cell_id[1].data)]),e.abrupt("return",new o.a(a,c));case 22:return e.next=24,i.AppWebsocket.connect(Object(p.c)(),6e4,b);case 24:return u=e.sent,e.next=27,u.appInfo({installed_app_id:Object(p.b)()});case 27:return l=e.sent,d=l.cell_data[0],e.abrupt("return",new o.b(u,d));case 30:return e.abrupt("return",null);case 31:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),f=function(){var e=Object(r.a)(s.a.mark((function e(){return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!d){e.next=2;break}return e.abrupt("return",d);case 2:return e.prev=2,e.next=5,j(p.a);case 5:return d=e.sent,e.abrupt("return",d);case 9:throw e.prev=9,e.t0=e.catch(2),Object.values(e.t0).forEach((function(e){return console.error(e)})),console.error(e.t0),e.t0;case 14:case"end":return e.stop()}}),e,null,[[2,9]])})));return function(){return e.apply(this,arguments)}}(),m=function(){var e=Object(r.a)(s.a.mark((function e(){var t,n;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:e.next=2;break;case 2:return e.next=4,f();case 4:return e.prev=4,e.next=7,null===(t=d)||void 0===t?void 0:t.cellId[1];case 7:if(!(n=e.sent)){e.next=10;break}return e.abrupt("return",n);case 10:return e.abrupt("return",null);case 13:e.prev=13,e.t0=e.catch(4),console.warn(e.t0);case 16:return e.abrupt("return",null);case 17:case"end":return e.stop()}}),e,null,[[4,13]])})));return function(){return e.apply(this,arguments)}}(),O=function(e){var t=1e3*(Math.pow(2,e)+Math.random());return console.log("Retrying after ",t),new Promise((function(e){return setTimeout(e,t)}))},g=function(){var e=Object(r.a)(s.a.mark((function e(t){var n,r,c,o,i,u,l,p,b,j,m,g,h,v;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("entering backoff"),e.next=3,f();case 3:n=t.zomeName,r=t.fnName,c=t.payload,o=void 0===c?null:c,i=5,u=0,l=!0;case 7:if(!(l&&u<i)){e.next=55;break}return e.prev=8,e.next=11,null===(p=d)||void 0===p?void 0:p.callZome(n,r,o,void 0);case 11:return e.abrupt("return",e.sent);case 14:if(e.prev=14,e.t0=e.catch(8),console.warn(e.t0),b=Object(a.a)({},e.t0),j=b.type,m=void 0===j?null:j,g=b.data,h=void 0===g?null:g,"error"!==m){e.next=53;break}e.t1=null===h||void 0===h?void 0:h.type,e.next="ribosome_error"===e.t1?22:"internal_error"===e.t1?36:45;break;case 22:if(console.log("ribsosome error",e.t0),null===/Network error/.exec(h.data)){e.next=31;break}return e.next=28,O(u);case 28:u+=1,e.next=35;break;case 31:throw l=!1,v=/Guest\("([\s\S]*?)"\)/.exec(h.data),{type:"error",function:r,message:v?v[1]:"Something went wrong"};case 35:return e.abrupt("break",53);case 36:if(console.log("internal error",e.t0),!(u>i)){e.next=41;break}throw{type:"error",function:r,message:"An internal error occured. This is likely a bug in holochain."};case 41:return e.next=43,O(u);case 43:u+=1;case 44:return e.abrupt("break",53);case 45:if(console.log("default error",e.t0),!(u>i)){e.next=50;break}throw e.t0;case 50:return e.next=52,O(u);case 52:u+=1;case 53:e.next=7;break;case 55:case"end":return e.stop()}}),e,null,[[8,14]])})));return function(t){return e.apply(this,arguments)}}(),h=function(){var e=Object(r.a)(s.a.mark((function e(t){var n,r,c,o,i,u,l,p,b,j,m;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,f();case 2:return n=t.zomeName,r=t.fnName,c=t.payload,o=void 0===c?null:c,e.prev=3,e.next=6,null===(i=d)||void 0===i?void 0:i.callZome(n,r,o,void 0);case 6:return e.abrupt("return",e.sent);case 9:if(e.prev=9,e.t0=e.catch(3),console.log("zome call has failed in zome: ",n," with call ",r,". Error: ",e.t0),u=Object(a.a)({},e.t0),l=u.type,p=void 0===l?null:l,b=u.data,j=void 0===b?null:b,"error"!==p){e.next=22;break}e.t1=null===j||void 0===j?void 0:j.type,e.next="ribosome_error"===e.t1?17:"internal_error"===e.t1?20:21;break;case 17:throw m=/Guest\("([\s\S]*?)"\)/.exec(j.data),{type:"error",function:r,message:m?m[1]:"Something went wrong"};case 20:throw{type:"error",function:r,message:j.data};case 21:case 22:throw e.t0;case 23:case"end":return e.stop()}}),e,null,[[3,9]])})));return function(t){return e.apply(this,arguments)}}()}).call(this,n(85))},,,,,,function(e,t,n){"use strict";(function(e){n.d(t,"a",(function(){return j}));var a=n(7),r=n(11),c=n(3),s=n(9),o=n(4),i=n.n(o),u=n(5),l=n(6),p=n(13),d=n(29),b=n(59),j=function(t){return function(){var n=Object(s.a)(i.a.mark((function n(s,o,j){var f,m,O,g,h,v,y,x,_,E,T,S,N,w,I,k,M,R,P,C,A,G;return i.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return f=j.callZome,n.prev=1,n.next=4,f({zomeName:l.c.P2PMESSAGE,fnName:l.a[l.c.P2PMESSAGE].GET_PINNED_MESSAGES,payload:e.from(Object(u.a)(t))});case 4:if("error"===(null===(m=n.sent)||void 0===m?void 0:m.type)){n.next=57;break}if(O=Object(c.a)({},o().contacts.contacts),g=Object(c.a)({},o().profile),h=Object(c.a)(Object(c.a)({},O),{},Object(r.a)({},g.id,{id:g.id,username:g.username,fields:g.fields})),v=Object(b.a)(m,h),void 0!==(y=Object(c.a)({},o().p2pmessages)).conversations[t]){n.next=27;break}y.conversations[t]={messages:[],pinned:[]},x=0,_=Object.entries(v.messages);case 14:if(!(x<_.length)){n.next=25;break}if(E=Object(a.a)(_[x],2),T=E[0],S=E[1],y.conversations[t].pinned.includes(T)||y.conversations[t].pinned.push(T),void 0!==y.pinned[T]){n.next=21;break}y.pinned[T]=S,n.next=22;break;case 21:return n.abrupt("continue",22);case 22:x++,n.next=14;break;case 25:n.next=55;break;case 27:if(void 0!==y.conversations[t].pinned){n.next=43;break}y.conversations[t].pinned=[],N=0,w=Object.entries(v.messages);case 30:if(!(N<w.length)){n.next=41;break}if(I=Object(a.a)(w[N],2),k=I[0],M=I[1],y.conversations[t].pinned.includes(k)||y.conversations[t].pinned.push(k),void 0!==y.pinned[k]){n.next=37;break}y.pinned[k]=M,n.next=38;break;case 37:return n.abrupt("continue",38);case 38:N++,n.next=30;break;case 41:n.next=55;break;case 43:R=0,P=Object.entries(v.messages);case 44:if(!(R<P.length)){n.next=55;break}if(C=Object(a.a)(P[R],2),A=C[0],G=C[1],y.conversations[t].pinned.includes(A)||y.conversations[t].pinned.push(A),void 0!==y.pinned[A]){n.next=51;break}y.pinned[A]=G,n.next=52;break;case 51:return n.abrupt("continue",52);case 52:R++,n.next=44;break;case 55:return s({type:d.e,state:y}),n.abrupt("return",v);case 57:n.next=62;break;case 59:n.prev=59,n.t0=n.catch(1),s(Object(p.a)("TOAST",{},{id:"redux.err.generic"}));case 62:case"end":return n.stop()}}),n,null,[[1,59]])})));return function(e,t,a){return n.apply(this,arguments)}}()}}).call(this,n(50).Buffer)},function(e,t,n){"use strict";n.d(t,"a",(function(){return l}));var a=n(11),r=n(17),c=n(3),s=n(9),o=n(4),i=n.n(o),u=n(29),l=function(e){return function(){var t=Object(s.a)(i.a.mark((function t(n,s){var o,l,p,d;return i.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return o=Object(c.a)({},s().p2pmessages),l=e.key?e.key:e.message.receiver.id,p=e.message.p2pMessageEntryHash,d=e.receipt?e.receipt.p2pMessageReceiptEntryHash:void 0,o.conversations[l]?o.conversations[l]={pinned:Object(r.a)(o.conversations[l].pinned),messages:[p].concat(Object(r.a)(o.conversations[l].messages))}:o.conversations[l]={messages:[p],pinned:[]},e.file&&(o.files[e.file.fileHash]=e.file.fileBytes),o.messages=Object(c.a)(Object(c.a)({},o.messages),{},Object(a.a)({},p,e.message)),d&&(o.receipts[d]=e.receipt),n({type:u.d,state:o}),t.abrupt("return",!0);case 10:case"end":return t.stop()}}),t)})));return function(e,n){return t.apply(this,arguments)}}()}},,function(e,t,n){e.exports={file:"style_file__27RDJ","file-name":"style_file-name__3vGib","file-size":"style_file-size__2GKYG","file-icon-dark":"style_file-icon-dark__2I31W","file-icon-light":"style_file-icon-light__1U9Kf"}},function(e,t,n){e.exports={label:"style_label__2yePJ",avatar:"style_avatar__2AEM3",container:"style_container__3rZpB"}},function(e,t,n){e.exports={login:"style_login__1hf3N",form:"style_form__1gyhK",label:"style_label__1PI6L",toolbar:"style_toolbar__17MVN"}},function(e,t,n){e.exports={input:"style_input__2l0cM","error-input":"style_error-input__2EDgX","error-container":"style_error-container__2w9sT",error:"style_error__3-HlZ"}},,,,,function(e,t,n){"use strict";n.d(t,"a",(function(){return o}));var a=n(17),r=n(7),c=n(3),s=n(29),o=function(e){return function(t,n){for(var o=Object(c.a)({},n().p2pmessages),i=e.conversations,u=e.messages,l=e.receipts,p=0,d=Object.entries(i);p<d.length;p++){var b=Object(r.a)(d[p],2),j=b[0],f=b[1],m=o.conversations[j];o.conversations[j]=void 0===m?{messages:f.messages,pinned:[]}:{messages:Object(a.a)(new Set(m.messages.concat(f.messages))),pinned:[]}}return o.messages=Object(c.a)(Object(c.a)({},o.messages),u),o.receipts=Object(c.a)(Object(c.a)({},o.receipts),l),t({type:s.d,state:o}),!0}}},function(e,t,n){"use strict";n.d(t,"a",(function(){return u}));var a=n(11),r=n(3),c=n(9),s=n(4),o=n.n(s),i=n(29),u=function(e){return function(){var t=Object(c.a)(o.a.mark((function t(n,c){var s,u,l;return o.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return s=Object(r.a)({},c().p2pmessages),u=e,l=e.p2pMessageReceiptEntryHash,u.p2pMessageEntryHashes.forEach((function(e){void 0!==s.messages[e]&&s.messages[e].receipts.push(l)})),s.receipts=Object(r.a)(Object(r.a)({},s.receipts),{},Object(a.a)({},l,u)),n({type:i.f,state:s.receipts}),t.abrupt("return",!0);case 7:case"end":return t.stop()}}),t)})));return function(e,n){return t.apply(this,arguments)}}()}},function(e,t,n){"use strict";(function(e){var a=n(9),r=n(4),c=n.n(r),s=n(6),o=n(13),i=n(5);t.a=function(t){return function(){var n=Object(a.a)(c.a.mark((function n(a,r,u){var l,p;return c.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return l=u.callZome,p=t,n.prev=2,n.next=5,l({zomeName:s.c.P2PMESSAGE,fnName:s.a[s.c.P2PMESSAGE].COMMIT_MESSAGE_TO_RECEIVER,payload:e.from(Object(i.a)(p.p2pMessageEntryHash))});case 5:return n.abrupt("return",!0);case 8:n.prev=8,n.t0=n.catch(2),a(Object(o.a)("TOAST",{},{id:"redux.err.generic"}));case 11:case"end":return n.stop()}}),n,null,[[2,8]])})));return function(e,t,a){return n.apply(this,arguments)}}()}}).call(this,n(50).Buffer)},function(e,t,n){"use strict";n.d(t,"a",(function(){return a}));var a="SET_LANGUAGE"},,,,,,,function(e,t,n){e.exports={menu:"style_menu__C0WwI",container:"style_container__3CTeu",identicon:"style_identicon__1z4iW",avatar:"style_avatar__2ofpZ",version:"style_version__2tuEY"}},function(e,t,n){e.exports={toolbar:"style_toolbar__2dB4u",content:"style_content__1CXxF"}},function(e,t,n){e.exports={chat:"style_chat__3kLZ6","title-container":"style_title-container__E-R-r",avatar:"style_avatar__1SPMS",title:"style_title__1l1FZ"}},function(e,t,n){e.exports={chatdetails:"style_chatdetails__1PZL-",titlebar:"style_titlebar__3OOiT",title:"style_title__3P2qo",month:"style_month__1RYcT",mediarow:"style_mediarow__1VBzj",mediacard:"style_mediacard__3gdyr",mediadiv:"style_mediadiv__2fS_a",filelist:"style_filelist__1FxpQ",filecard:"style_filecard__29HIk"}},function(e,t,n){e.exports={title:"style_title__37T1W","title-container":"style_title-container__nJyXL",avatar:"style_avatar__I9T18"}},function(e,t,n){e.exports={contacts:"style_contacts__3Y8Wl","close-label":"style_close-label__1yiho","close-button":"style_close-button__3-eYH"}},function(e,t,n){e.exports={landing:"style_landing__1AJBK",logo:"style_logo__1i6xk",landingImage:"style_landingImage__3JKn5",actions:"style_actions__2DAvl","register-label":"style_register-label__3U74A"}},function(e,t,n){e.exports={content:"style_content__aLpb2","image-cropper":"style_image-cropper__3Bzfw",header:"style_header__2qiAP","react-crop":"style_react-crop__2ourV"}},,,,function(e,t,n){e.exports={icon:"style_icon__2nRa9",avatar:"style_avatar__3dQuS"}},,,function(e,t,n){e.exports={icon:"style_icon__-mJ3j"}},function(e,t,n){e.exports={"video-player":"style_video-player__pxhnt",video:"style_video__10sA-",content:"style_content__3iRlb","modal-control":"style_modal-control__1fdb7","slider-volume":"style_slider-volume__6jcJU"}},function(e,t,n){e.exports={video:"style_video__2ufHy"}},function(e,t,n){e.exports={typing:"style_typing__203NC",dot:"style_dot__1YRwn"}},function(e,t,n){e.exports={row:"style_row__RQQHj",chip:"style_chip__3-Ro1"}},function(e,t,n){e.exports={toolbar:"style_toolbar__3sSyu","file-view":"style_file-view__2lYJo",col:"style_col__3sOY-","close-button":"style_close-button__2AE8Y",textarea:"style_textarea___6FLN",card:"style_card__3Bl2A",blackborder:"style_blackborder__1GH8W"}},function(e,t,n){"use strict";(function(e){n.d(t,"a",(function(){return i}));var a=n(9),r=n(4),c=n.n(r),s=n(5),o=n(6),i=function(t,n){return function(){var r=Object(a.a)(c.a.mark((function a(r,i,u){var l,p;return c.a.wrap((function(a){for(;;)switch(a.prev=a.next){case 0:return l=u.callZome,p={agent:e.from(Object(s.a)(t)),isTyping:n},a.next=4,l({zomeName:o.c.P2PMESSAGE,fnName:o.a[o.c.P2PMESSAGE].TYPING,payload:p});case 4:return a.abrupt("return",null);case 5:case"end":return a.stop()}}),a)})));return function(e,t,n){return r.apply(this,arguments)}}()}}).call(this,n(50).Buffer)},function(e,t,n){"use strict";(function(e){n.d(t,"a",(function(){return p}));var a=n(3),r=n(9),c=n(4),s=n.n(c),o=n(5),i=n(6),u=n(8),l=n(29),p=function(t){return function(){var n=Object(r.a)(s.a.mark((function n(r,c,p){var d,b,j,f,m,O,g,h,v,y;return s.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return d=p.callZome,b=Object(u.d)(new Date),j=Object(a.a)({},c().p2pmessages),f=[],t.map((function(e){return f.push(Object(o.a)(e.p2pMessageEntryHash))})),m=[e.from(Object(o.a)(t[0].author.id)),e.from(Object(o.a)(t[0].receiver.id))],O={message_hashes:f,conversants:m,timestamp:b,status:j.pinned[t[0].p2pMessageEntryHash]?"Unpinned":"Pinned"},n.prev=7,n.next=10,d({zomeName:i.c.P2PMESSAGE,fnName:i.a[i.c.P2PMESSAGE].PIN_MESSAGE,payload:O});case 10:return g=n.sent,h=Object.values(g)[0],v=h.status,y=c().profile.id===h.conversants[0]?Object(o.b)(h.conversants[0]):Object(o.b)(h.conversants[1]),h.id.forEach((function(e){var t=Object(o.b)(e),n=j.messages[t];if(j.conversations[y]&&(j.conversations[y].pinned||(j.conversations[y].pinned=[]),"pinned"===v&&(j.conversations[y].pinned.includes(t)||j.conversations[y].pinned.push(t),j.pinned[t]||(j.pinned[t]=n)),"unpined"===v)){if(j.conversations[y].pinned.includes(t)){var a=j.conversations[y].pinned.indexOf(t);a>-1&&j.conversations[y].pinned.splice(a,1)}j.pinned[t]&&delete j.pinned[t]}})),r({type:l.e,state:j}),n.abrupt("return",!0);case 19:n.prev=19,n.t0=n.catch(7);case 21:return n.abrupt("return",!1);case 22:case"end":return n.stop()}}),n,null,[[7,19]])})));return function(e,t,a){return n.apply(this,arguments)}}()}}).call(this,n(50).Buffer)},function(e,t,n){e.exports={container:"style_container__3nacn"}},function(e,t,n){e.exports={search:"style_search__1P1Jo"}},function(e,t,n){e.exports={"contacts-list":"style_contacts-list__2633z","add-label":"style_add-label__3UjKf","my-custom-modal-css":"style_my-custom-modal-css__2_5sM","modal-wrapper":"style_modal-wrapper__1uXqE",modal:"style_modal__3XaVG"}},function(e,t,n){e.exports={avatar:"style_avatar__1CVEO",identifier:"style_identifier__3vwzh"}},function(e,t,n){e.exports={recipients:"style_recipients__3Tz9O",to:"style_to__3Gtm8"}},,,,,,,,,,,,,,,,function(e,t,n){e.exports={spinner:"style_spinner__1BA-o"}},,,,function(e,t,n){e.exports={chat:"style_chat__2rr5Z","item-inner":"style_item-inner__3Pzc7"}},function(e,t,n){e.exports={image:"style_image__1PE4_"}},function(e,t,n){e.exports={me:"style_me__3fhVY",others:"style_others__1jm3i"}},function(e,t,n){"use strict";(function(e){n.d(t,"a",(function(){return p}));var a=n(7),r=n(9),c=n(4),s=n.n(c),o=n(5),i=n(6),u=n(8),l=n(100),p=function(t){return function(){var n=Object(r.a)(s.a.mark((function n(r,c,p){var d,b,j,f,m,O,g,h,v,y,x,_;return s.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return d=p.callZome,b=new Date,j=Object(u.d)(b),f=[],t.map((function(e){return f.push(Object(o.a)(e.p2pMessageEntryHash))})),m=e.from(Object(o.a)(t[0].author.id)),O={message_hashes:f,sender:m,timestamp:j},n.next=9,d({zomeName:i.c.P2PMESSAGE,fnName:i.a[i.c.P2PMESSAGE].READ_MESSAGE,payload:O});case 9:if("error"===(null===(g=n.sent)||void 0===g?void 0:g.type)){n.next=17;break}return h=Object.keys(g),v=Object(a.a)(h,1),y=v[0],x=[],g[y].id.forEach((function(e){x.push(Object(o.b)(e))})),_={p2pMessageReceiptEntryHash:y,p2pMessageEntryHashes:x,timestamp:Object(u.k)(g[y].status.timestamp),status:g[y].status.status},r(Object(l.a)(_)),n.abrupt("return",!0);case 17:return n.abrupt("return",!1);case 18:case"end":return n.stop()}}),n)})));return function(e,t,a){return n.apply(this,arguments)}}()}}).call(this,n(50).Buffer)},function(e,t,n){e.exports={"contacts-list":"style_contacts-list__1o7GN"}},function(e,t,n){e.exports={"avatar-container":"style_avatar-container__2Qls7","contacts-list":"style_contacts-list__3gSNv"}},function(e,t,n){e.exports={"empty-contacts":"style_empty-contacts__JmFbZ"}},function(e,t,n){e.exports={"empty-conversations":"style_empty-conversations__2L30A"}},function(e,t,n){e.exports={conversation:"style_conversation__28KWI","empty-conversations":"style_empty-conversations__1_1Ss"}},function(e,t,n){e.exports={"home-tab-bar":"style_home-tab-bar__2vOP6"}},function(e,t,n){e.exports={header:"style_header__3PkRv"}},function(e,t,n){e.exports={"popover-list":"style_popover-list__14lHb"}},function(e,t,n){e.exports={"settings-list":"style_settings-list__i3vNl"}},,,function(e,t,n){e.exports={err:"style_err__1GKMd"}},function(e){e.exports=JSON.parse('{"app.auth.err":"We\'re sorry. We failed to get your profile. Please try restarting your Holochain Launcher, or access Kizuna from a new browser if you are in Holo hosting network.","app.chat.chat-details.files":"FILES","app.chat.chat-details.info":"INFO","app.chat.chat-details.media":"MEDIA","app.chat.header-details":"Details","app.chat.header-pinned-messages":"Pinned Messages","app.chat.header-search":"Search","app.chat.pinned-message-title":"Pinned Messages","app.contacts.add":"Add to contacts","app.contacts.add-message":"{name} has been added to your contacts","app.contacts.block":"Block profile","app.contacts.empty-contact-list":"Your contact list is empty as of the moment","app.contacts.remove":"Remove from contacts","app.contacts.search":"Search with minimum 3 characters...","app.contacts.search-nickname-warning":"The minimum length for search is 3 characters","app.contacts.unblock":"Unblock profile","app.conversations.empty-conversations":"You have no conversations yet...","app.conversations.no-group-messages":"No message has been sent yet...","app.group-chat.add-member":"Add","app.group-chat.add-member-close":"Close","app.group-chat.add-member-contacts":"Contacts","app.group-chat.add-members":"Add Members","app.group-chat.admin-role":"admin","app.group-chat.fetching":"Fetching...","app.group-chat.files.fetching":"Fetching files...","app.group-chat.files.no-files":"There is no file sent in the chat yet...","app.group-chat.header-details":"Details","app.group-chat.header-pinned-message":"Pinned Messages","app.group-chat.header-search":"Search","app.group-chat.label-files":"FILES","app.group-chat.label-info":"INFO","app.group-chat.label-media":"MEDIA","app.group-chat.media.fetching":"Fetching media...","app.group-chat.media.month.1":"January","app.group-chat.media.month.2":"February","app.group-chat.media.month.3":"March","app.group-chat.media.month.4":"April","app.group-chat.media.month.5":"May","app.group-chat.media.month.6":"June","app.group-chat.media.month.7":"July","app.group-chat.media.month.8":"August","app.group-chat.media.month.9":"Septmember","app.group-chat.media.month.10":"October","app.group-chat.media.month.11":"November","app.group-chat.media.month.12":"December","app.group-chat.media.no-media":"There is no media sent in the chat yet...","app.group-chat.member-role":"member","app.group-chat.members":"{length} members","app.group-chat.members-label":"Members","app.group-chat.minimum-member-required-reached":"The group must at leaset have 3 members","app.group-chat.no-member-to-add":"You have no one to add right now...","app.group-chat.oldest-message-fetched":"You have already fetched the oldest message","app.group-chat.pinned-message-title":"Pinned Messages","app.group-chat.remove-member":"REMOVE","app.group-chat.sending":"Sending...","app.group-chat.update-group-name-cancel":"Cancel","app.group-chat.update-group-name-placeholder":"Group Name","app.group-chat.update-group-name-save":"Save","app.group-chat.update-group-name-title":"Edit Group","app.home.contacts-tab-bar":"Contacts","app.home.messaging-tab-bar":"Messaging","app.landing.login":"Start Messaging","app.landing.register":"Register Nickname","app.login.login":"Login","app.login.username-label":"Username","app.login.username-placeholder":"Please enter your username...","app.menu.blocked-label":"Blocked","app.menu.logout-label":"Logout","app.menu.report-label":"Report an issue","app.menu.settings-label":"Settings","app.menu.version":"version","app.new-conversation.header-title":"New Message","app.new-conversation.message-placeholder":"Compose message...","app.new-conversation.no-contacts-toast":"Please select a contact...","app.new-conversation.problem-occured-toast":"A problem occurred...","app.new-conversation.search-placeholder":"Search contacts...","app.new-conversation.to":"To","app.profile.to-be-implemented":"Page under construction","app.profile.to-be-implemented-header":"Oops!","app.register.error-existing-username":"Sorry! That username is already taken","app.register.error-invalid-username":"Nickname must be at least 3 characters and contain 1 alphanumberic character","app.register.register":"Register nickname","app.register.username-label":"Nickname","app.register.username-placeholder":"Type your nickname here...","app.register.error-no-image":"No image selected","app.settings.language-label":"Language","app.settings.preference-label":"Preference","app.settings.read-receipt-label":"Read Receipt","app.settings.typing-indicator-label":"Typing Indicator","components.chat.chat-list.today":"Today","components.chat.chat-modal-delete":"Delete","components.chat.chat-modal-pin":"Pin","components.chat.chat-modal-reply":"Reply","components.chat.chat-modal-resend":"Resend","components.chat.chat-modal-unpin":"Unpin","components.chat.media-modal-download":"Download","components.conversation.me-file-string":"You sent {fileName}","components.conversation.other-file-string":"{name} has sent {fileName}","components.message-input.over-size-limit":"{fileName} exceeds the 15mb file limit","components.profile-info.id":"ID","components.profile-info.identicon":"Identicon","components.profile-info.nickname":"Nickname","components.typing.is-typing":"{user} is typing","redux.err.commons-get-latest-data":"Failed to get the latest data","redux.err.conductor-time-out":"Sorry, the conductor timed out","redux.err.contacts.add-contact.1":"{username} has already been added","redux.err.contacts.add-contact.2":"{username} is blocked","redux.err.contacts.block-contact.1":"{username} is already blocked","redux.err.contacts.fetch-blocked.1":"Unable to fetch username of this user","redux.err.contacts.fetch-blocked.2":"This user don\'t have a username","redux.err.contacts.fetch-my-contacts.1":"Unable to fetch username of this user","redux.err.generic":"Sorry, something went wrong...","redux.err.group.add-members.1":"Oops, you tried to add members without providing who should be added","redux.err.group.add-members.2":"Oops, you won\'t be able to add agents you blocked","redux.err.group.add-members.3":"Sorry, member/s were not added due to failure in getting group id","redux.err.group.add-members.4":"Oops, only admins can add members","redux.err.group.add-members.5":"Oops, you cannot add admins as a member","redux.err.group.create-group.1":"Oops, you cannot create a group with agents you blocked","redux.err.group.create-group.2":"Oops, groups cannot be created with less than 3 members","redux.err.group.create-group.3":"Oops, you cannot create groups including yourself as a member","redux.err.group.create-group.4":"Oops, group name must be at least more than 1 and less than 50 characters","redux.err.group.get-latest-group-version.1":"Sorry, failed to get the latest version of the group","redux.err.group.pin-message":"Sorry, failed to pin the message. Please try again shortly.","redux.err.group.remove-members.1":"Oops, you tried to remove members without providing who should be removed","redux.err.group.remove-members.2":"Sorry, member/s were not removed due to failure in getting group id","redux.err.group.remove-members.3":"Oops, a group must at leaset have 3 members","redux.err.group.remove-members.4":"Oops, only admins can remove members","redux.err.group.send-group-message.1":"Sorry, \\"{payload}\\" was not sent due to failure in getting group id","redux.err.group.send-group-message.2":"message being replied has not yet propagated in network. Please try again shortly.","redux.err.group.set-files-bytes.1":"Sorry, failed to get the file/media bytes","redux.err.group.update-group-name.1":"Oops, you can\'t update group name with same name","redux.err.group.update-group-name.2":"Sorry, failed updating the group name due to failure in getting group id","redux.err.group.update-group-name.3":"Oops, group name must be at least more than 1 and less than 50 characters","redux.err.group.update-group-name.4":"Oops, only the admin can update the group name","redux.err.profile.fetch-profile-from-username.1":"This username does not exist","redux.err.profile.set-username.1":"This username has already been taken","redux.err.profile.set-username.2":"You already have a username"}')},function(e){e.exports=JSON.parse('{"app.auth.err":"\u30d7\u30ed\u30d5\u30a3\u30fc\u30eb\u306e\u53d6\u5f97\u306b\u5931\u6557\u3057\u307e\u3057\u305f\u3002Holochain Launcher\u3092\u518d\u8d77\u52d5\u3057\u3066\u4e0b\u3055\u3044\u3002Holo\u30db\u30b9\u30c6\u30a3\u30f3\u30b0\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u4f7f\u7528\u306e\u5834\u5408\u306f\u3001\u65b0\u3057\u3044\u30d6\u30e9\u30a6\u30b6\u304b\u3089Kizuna\u3092\u30a2\u30af\u30bb\u30b9\u3057\u3066\u4e0b\u3055\u3044","app.chat.chat-details.files":"\u30d5\u30a1\u30a4\u30eb","app.chat.chat-details.info":"\u30c1\u30e3\u30c3\u30c8\u60c5\u5831","app.chat.chat-details.media":"\u30e1\u30c7\u30a3\u30a2","app.chat.header-details":"\u30c1\u30e3\u30c3\u30c8\u60c5\u5831","app.chat.header-pinned-messages":"\u63b2\u793a\u677f","app.chat.header-search":"\u691c\u7d22","app.chat.pinned-message-title":"\u63b2\u793a\u677f","app.contacts.add":"\u9023\u7d61\u5148\u306b\u8ffd\u52a0","app.contacts.add-message":"{name}\u304c\u9023\u7d61\u5148\u306b\u8ffd\u52a0\u3055\u308c\u307e\u3057\u305f","app.contacts.block":"\u9023\u7d61\u5148\u3092\u30d6\u30ed\u30c3\u30af","app.contacts.empty-contact-list":"\u9023\u7d61\u5148\u306f\u307e\u3060\u3042\u308a\u307e\u305b\u3093","app.contacts.remove":"\u9023\u7d61\u5148\u304b\u3089\u524a\u9664","app.contacts.search":"3\u6587\u5b57\u4ee5\u4e0a\u3067\u691c\u7d22","app.contacts.search-nickname-warning":"\u691c\u7d22\u306f\uff13\u6587\u5b57\u4ee5\u4e0a\u3067\u53ef\u80fd\u3067\u3059","app.contacts.unblock":"\u9023\u7d61\u5148\u306e\u30d6\u30ed\u30c3\u30af\u3092\u89e3\u9664","app.conversations.empty-conversations":"\u307e\u3060\u4f1a\u8a71\u304c\u306a\u3044\u3088\u3046\u3067\u3059...","app.conversations.no-group-messages":"\u307e\u3060\u30e1\u30c3\u30bb\u30fc\u30b8\u304c\u9001\u4fe1\u3055\u308c\u3066\u3044\u307e\u305b\u3093...","app.group-chat.add-member":"\u8ffd\u52a0","app.group-chat.add-member-close":"\u9589\u3058\u308b","app.group-chat.add-member-contacts":"\u9023\u7d61\u5148","app.group-chat.add-members":"\u30e1\u30f3\u30d0\u30fc\u8ffd\u52a0","app.group-chat.admin-role":"\u7ba1\u7406\u8005","app.group-chat.fetching":"\u53d6\u5f97\u4e2d...","app.group-chat.files.fetching":"\u30d5\u30a1\u30a4\u30eb\u53d6\u5f97\u4e2d...","app.group-chat.files.no-files":"\u30d5\u30a1\u30a4\u30eb\u306f\u3053\u306e\u30c1\u30e3\u30c3\u30c8\u3067\u306f\u307e\u3060\u5171\u6709\u3055\u308c\u3066\u3044\u307e\u305b\u3093","app.group-chat.header-details":"\u30c1\u30e3\u30c3\u30c8\u60c5\u5831","app.group-chat.header-pinned-message":"\u63b2\u793a\u677f","app.group-chat.header-search":"\u691c\u7d22","app.group-chat.label-files":"\u30d5\u30a1\u30a4\u30eb","app.group-chat.label-info":"\u30b0\u30eb\u30fc\u30d7\u60c5\u5831","app.group-chat.label-media":"\u30e1\u30c7\u30a3\u30a2","app.group-chat.media.fetching":"\u30e1\u30c7\u30a3\u30a2\u53d6\u5f97\u4e2d...","app.group-chat.media.month.1":"1\u6708","app.group-chat.media.month.2":"2\u6708","app.group-chat.media.month.3":"3\u6708","app.group-chat.media.month.4":"4\u6708","app.group-chat.media.month.5":"5\u6708","app.group-chat.media.month.6":"6\u6708","app.group-chat.media.month.7":"7\u6708","app.group-chat.media.month.8":"8\u6708","app.group-chat.media.month.9":"9\u6708","app.group-chat.media.month.10":"10\u6708","app.group-chat.media.month.11":"11\u6708","app.group-chat.media.month.12":"12\u6708","app.group-chat.media.no-media":"\u30e1\u30c7\u30a3\u30a2\u30d5\u30a1\u30a4\u30eb\u306f\u3053\u306e\u30c1\u30e3\u30c3\u30c8\u3067\u306f\u307e\u3060\u5171\u6709\u3055\u308c\u3066\u3044\u307e\u305b\u3093","app.group-chat.member-role":"\u30e1\u30f3\u30d0\u30fc","app.group-chat.members":"{length}\u4eba","app.group-chat.members-label":"\u30e1\u30f3\u30d0\u30fc","app.group-chat.minimum-member-required-reached":"\u30b0\u30eb\u30fc\u30d7\u306e\u30e1\u30f3\u30d0\u30fc\u306f\u6700\u4f4e\uff13\u540d\u3067\u3059","app.group-chat.no-member-to-add":"\u8ffd\u52a0\u3067\u304d\u308b\u30e6\u30fc\u30b6\u30fc\u304c\u3044\u307e\u305b\u3093","app.group-chat.oldest-message-fetched":"\u5168\u3066\u306e\u30e1\u30c3\u30bb\u30fc\u30b8\u3092\u53d6\u5f97\u3057\u307e\u3057\u305f","app.group-chat.pinned-message-title":"\u63b2\u793a\u677f","app.group-chat.remove-member":"\u30b0\u30eb\u30fc\u30d7\u9000\u4f1a","app.group-chat.sending":"\u9001\u4fe1\u4e2d...","app.group-chat.update-group-name-cancel":"\u30ad\u30e3\u30f3\u30bb\u30eb","app.group-chat.update-group-name-placeholder":"\u30b0\u30eb\u30fc\u30d7\u540d","app.group-chat.update-group-name-save":"\u4fdd\u5b58","app.group-chat.update-group-name-title":"\u30b0\u30eb\u30fc\u30d7\u540d\u5909\u66f4","app.home.contacts-tab-bar":"\u9023\u7d61\u5148","app.home.messaging-tab-bar":"\u30c1\u30e3\u30c3\u30c8","app.landing.login":"\u30c1\u30e3\u30c3\u30c8\u3092\u958b\u59cb\u3059\u308b","app.landing.register":"\u30cb\u30c3\u30af\u30cd\u30fc\u30e0\u3092\u767b\u9332","app.login.login":"\u30ed\u30b0\u30a4\u30f3","app.login.username-label":"\u30e6\u30fc\u30b6\u30fc\u540d","app.login.username-placeholder":"\u30e6\u30fc\u30b6\u30fc\u540d\u3092\u5165\u529b\u3057\u3066\u304f\u3060\u3055\u3044...","app.menu.blocked-label":"\u30d6\u30ed\u30c3\u30af","app.menu.logout-label":"\u30ed\u30b0\u30a2\u30a6\u30c8","app.menu.report-label":"\u554f\u984c\u3092\u5831\u544a\u3059\u308b","app.menu.settings-label":"\u8a2d\u5b9a","app.menu.version":"\u30d0\u30fc\u30b8\u30e7\u30f3","app.new-conversation.header-title":"\u65b0\u3057\u3044\u30e1\u30c3\u30bb\u30fc\u30b8","app.new-conversation.message-placeholder":"\u30e1\u30c3\u30bb\u30fc\u30b8\u3092\u5165\u529b\u3057\u3066\u304f\u3060\u3055\u3044...","app.new-conversation.no-contacts-toast":"\u9023\u7d61\u5148\u3092\u9078\u629e\u3057\u3066\u304f\u3060\u3055\u3044...","app.new-conversation.problem-occured-toast":"\u554f\u984c\u304c\u767a\u751f\u3057\u307e\u3057\u305f...","app.new-conversation.search-placeholder":"\u9023\u7d61\u5148\u304b\u3089\u9078\u3093\u3067\u304f\u3060\u3055\u3044","app.new-conversation.to":"\u53d7\u4fe1\u8005","app.profile.to-be-implemented":"\u5de5\u4e8b\u4e2d...","app.profile.to-be-implemented-header":"\u304a\u3063\u3068!","app.register.error-existing-username":"\u3053\u306e\u30e6\u30fc\u30b6\u30fc\u540d\u306f\u3059\u3067\u306b\u767b\u9332\u3055\u308c\u3066\u3044\u307e\u3059","app.register.error-invalid-username":"\u30cb\u30c3\u30af\u30cd\u30fc\u30e0\u306f3\u82f1\u6570\u5b57\u4ee5\u4e0a\u3067\u3001\u6700\u4f4e1\u82f1\u5b57\u3092\u542b\u3081\u308b\u5fc5\u8981\u304c\u3042\u308a\u307e\u3059","app.register.error-no-image":"\u753b\u50cf\u304c\u9078\u629e\u3055\u308c\u3066\u3044\u307e\u305b\u3093","app.register.register":"\u30cb\u30c3\u30af\u30cd\u30fc\u30e0\u3092\u767b\u9332\u3059\u308b","app.register.username-label":"\u30cb\u30c3\u30af\u30cd\u30fc\u30e0","app.register.username-placeholder":"\u30cb\u30c3\u30af\u30cd\u30fc\u30e0\u3092\u5165\u529b\u3057\u3066\u304f\u3060\u3055\u3044...","app.settings.language-label":"\u8a00\u8a9e","app.settings.preference-label":"\u74b0\u5883\u8a2d\u5b9a","app.settings.read-receipt-label":"\u65e2\u8aad\u901a\u77e5","app.settings.typing-indicator-label":"\u5165\u529b\u4e2d\u901a\u77e5","components.chat.chat-list.today":"\u4eca\u65e5","components.chat.chat-modal-delete":"\u524a\u9664","components.chat.chat-modal-pin":"\u30d4\u30f3\u7559\u3081","components.chat.chat-modal-reply":"\u8fd4\u4fe1","components.chat.chat-modal-resend":"\u518d\u9001\u4fe1","components.chat.chat-modal-unpin":"\u30d4\u30f3\u7559\u3081\u89e3\u9664","components.chat.media-modal-download":"\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9","components.conversation.me-file-string":"\u3042\u306a\u305f\u306f{fileName}\u3092\u9001\u308a\u307e\u3057\u305f","components.conversation.other-file-string":"{name}\u304c{fileName}\u3092\u9001\u4fe1\u3057\u307e\u3057\u305f","components.message-input.over-size-limit":"{fileName}\u306f15MB\u306e\u30d5\u30a1\u30a4\u30eb\u5236\u9650\u3092\u8d85\u3048\u3066\u3044\u307e\u3059","components.profile-info.id":"ID","components.profile-info.identicon":"\u30a2\u30a4\u30c7\u30f3\u30c6\u30a3\u30b3\u30f3","components.profile-info.nickname":"\u30cb\u30c3\u30af\u30cd\u30fc\u30e0","components.typing.is-typing":"{user}\u304c\u5165\u529b\u3057\u3066\u3044\u307e\u3059","redux.err.commons-get-latest-data":"\u6700\u65b0\u30c7\u30fc\u30bf\u306e\u53d6\u5f97\u306b\u5931\u6557\u3057\u307e\u3057\u305f","redux.err.conductor-time-out":"\u30bf\u30a4\u30e0\u30a2\u30a6\u30c8\u304c\u767a\u751f\u3057\u307e\u3057\u305f","redux.err.contacts.add-contact.1":"{username}\u306f\u3059\u3067\u306b\u9023\u7d61\u5148\u306b\u8ffd\u52a0\u3055\u308c\u3066\u3044\u307e\u3059","redux.err.contacts.add-contact.2":"{username}\u306f\u30d6\u30ed\u30c3\u30af\u3055\u308c\u3066\u3044\u307e\u3059","redux.err.contacts.block-contact.1":"{username}\u306f\u3059\u3067\u306b\u30d6\u30ed\u30c3\u30af\u3055\u308c\u3066\u3044\u307e\u3059","redux.err.contacts.fetch-blocked.1":"\u3053\u306e\u30e6\u30fc\u30b6\u30fc\u306e\u30e6\u30fc\u30b6\u30fc\u30cd\u30fc\u30e0\u306e\u53d6\u5f97\u306b\u5931\u6557\u3057\u307e\u3057\u305f","redux.err.contacts.fetch-blocked.2":"\u3053\u306e\u30e6\u30fc\u30b6\u30fc\u306f\u30e6\u30fc\u30b6\u30fc\u30cd\u30fc\u30e0\u304c\u3042\u308a\u307e\u305b\u3093","redux.err.contacts.fetch-my-contacts.1":"\u3053\u306e\u30e6\u30fc\u30b6\u30fc\u306e\u30e6\u30fc\u30b6\u30fc\u30cd\u30fc\u30e0\u306e\u53d6\u5f97\u306b\u5931\u6557\u3057\u307e\u3057\u305f","redux.err.generic":"\u30a8\u30e9\u30fc\u304c\u767a\u751f\u3057\u307e\u3057\u305f","redux.err.group.add-members.1":"\u304a\u3063\u3068, \u8ffd\u52a0\u3059\u308b\u30e1\u30f3\u30d0\u30fc\u3092\u6307\u5b9a\u305b\u305a\u306b\u30e1\u30f3\u30d0\u30fc\u3092\u8ffd\u52a0\u3057\u3088\u3046\u3068\u3057\u3066\u3044\u307e\u3059","redux.err.group.add-members.2":"\u304a\u3063\u3068, \u30d6\u30ed\u30c3\u30af\u3055\u308c\u305f\u30e6\u30fc\u30b6\u30fc\u306f\u30b0\u30eb\u30fc\u30d7\u306b\u8ffd\u52a0\u3067\u304d\u307e\u305b\u3093","redux.err.group.add-members.3":"\u30b0\u30eb\u30fc\u30d7ID\u306e\u53d6\u5f97\u306b\u5931\u6557\u3057\u305f\u305f\u3081\u3001\u30e1\u30f3\u30d0\u30fc\u306e\u8ffd\u52a0\u306b\u5931\u6557\u3057\u307e\u3057\u305f","redux.err.group.add-members.4":"\u30b0\u30eb\u30fc\u30d7\u7ba1\u7406\u8005\u306e\u307f\u30b0\u30eb\u30fc\u30d7\u30e1\u30f3\u30d0\u30fc\u3092\u8ffd\u52a0\u3067\u304d\u307e\u3059","redux.err.group.add-members.5":"\u30b0\u30eb\u30fc\u30d7\u7ba1\u7406\u8005\u3092\u30e1\u30f3\u30d0\u30fc\u3068\u3057\u3066\u306f\u8ffd\u52a0\u3067\u304d\u307e\u305b\u3093","redux.err.group.create-group.1":"\u30d6\u30ed\u30c3\u30af\u3055\u308c\u305f\u30e6\u30fc\u30b6\u30fc\u3068\u306f\u30b0\u30eb\u30fc\u30d7\u306f\u4f5c\u6210\u3067\u304d\u307e\u305b\u3093","redux.err.group.create-group.2":"\u30b0\u30eb\u30fc\u30d7\u306f\u6700\u4f4e3\u4eba\u3067\u30e1\u30f3\u30d0\u30fc\u304c\u5fc5\u8981\u3067\u3059","redux.err.group.create-group.3":"\u81ea\u5206\u3092\u30e1\u30f3\u30d0\u30fc\u306b\u52a0\u3048\u308b\u3053\u3068\u306f\u3067\u304d\u307e\u305b\u3093","redux.err.group.create-group.4":"\u30b0\u30eb\u30fc\u30d7\u540d\u306f\u6700\u4f4e\uff11\u6587\u5b57\u6700\u5927\uff15\uff10\u6587\u5b57\u3067\u3059","redux.err.group.get-latest-group-version.1":"\u30b0\u30eb\u30fc\u30d7\u306e\u6700\u65b0\u60c5\u5831\u306e\u53d6\u5f97\u306b\u5931\u6557\u3057\u307e\u3057\u305f","redux.err.group.pin-message":"\u30d4\u30f3\u7559\u3081\u306b\u5931\u6557\u3057\u307e\u3057\u305f\u3002\u518d\u5ea6\u304a\u8a66\u3057\u304f\u3060\u3055\u3044","redux.err.group.remove-members.1":"\u304a\u3063\u3068, \u524a\u9664\u3059\u308b\u30e1\u30f3\u30d0\u30fc\u3092\u6307\u5b9a\u305b\u305a\u306b\u30e1\u30f3\u30d0\u30fc\u524a\u9664\u3092\u3057\u3088\u3046\u3068\u3057\u3066\u3044\u307e\u3059","redux.err.group.remove-members.2":"\u30b0\u30eb\u30fc\u30d7ID\u306e\u53d6\u5f97\u306b\u5931\u6557\u3057\u305f\u305f\u3081\u3001\u30e1\u30f3\u30d0\u30fc\u306e\u524a\u9664\u306b\u5931\u6557\u3057\u307e\u3057\u305f","redux.err.group.remove-members.3":"\u30b0\u30eb\u30fc\u30d7\u30e1\u30f3\u30d0\u30fc\u306f\u6700\u4f4e3\u4eba\u5fc5\u8981\u3067\u3059","redux.err.group.remove-members.4":"\u30b0\u30eb\u30fc\u30d7\u7ba1\u7406\u8005\u306e\u307f\u30b0\u30eb\u30fc\u30d7\u30e1\u30f3\u30d0\u30fc\u306e\u5909\u66f4\u304c\u53ef\u80fd\u3067\u3059","redux.err.group.send-group-message.1":"\u30b0\u30eb\u30fc\u30d7ID\u306e\u53d6\u5f97\u306b\u5931\u6557\u3057\u305f\u305f\u3081\u3001\\"{payload}\\"\u306f\u9001\u4fe1\u3055\u308c\u307e\u305b\u3093\u3067\u3057\u305f","redux.err.group.send-group-message.2":"\u8fd4\u4fe1\u3057\u305f\u3044\u30e1\u30c3\u30bb\u30fc\u30b8\u306e\u53d6\u5f97\u306b\u5931\u6557\u3057\u305f\u305f\u3081\u3001\u30e1\u30c3\u30bb\u30fc\u30b8\u304c\u9001\u4fe1\u3055\u308c\u307e\u305b\u3093\u3067\u3057\u305f\u3002\u518d\u5ea6\u304a\u8a66\u3057\u304f\u3060\u3055\u3044","redux.err.group.set-files-bytes.1":"\u30d5\u30a1\u30a4\u30eb/\u30e1\u30c7\u30a3\u30a2\u306e\u53d6\u5f97\u306b\u5931\u6557\u3057\u307e\u3057\u305f","redux.err.group.update-group-name.1":"\u304a\u3063\u3068\u3001\u540c\u3058\u540d\u524d\u3067\u306f\u30b0\u30eb\u30fc\u30d7\u540d\u306f\u66f4\u65b0\u3067\u304d\u307e\u305b\u3093","redux.err.group.update-group-name.2":"\u30b0\u30eb\u30fc\u30d7ID\u306e\u53d6\u5f97\u306b\u5931\u6557\u3057\u305f\u305f\u3081\u3001\u30b0\u30eb\u30fc\u30d7\u540d\u306e\u66f4\u65b0\u306b\u5931\u6557\u3057\u307e\u3057\u305f","redux.err.group.update-group-name.3":"\u30b0\u30eb\u30fc\u30d7\u540d\u306f\u6700\u4f4e\uff11\u6587\u5b57\u6700\u5927\uff15\uff10\u6587\u5b57\u3067\u3059","redux.err.group.update-group-name.4":"\u30b0\u30eb\u30fc\u30d7\u7ba1\u7406\u8005\u306e\u307f\u30b0\u30eb\u30fc\u30d7\u540d\u3092\u66f4\u65b0\u3067\u304d\u307e\u3059","redux.err.profile.fetch-profile-from-username.1":"\u3053\u306e\u30e6\u30fc\u30b6\u30fc\u30cd\u30fc\u30e0\u306f\u5b58\u5728\u3057\u307e\u305b\u3093","redux.err.profile.set-username.1":"\u3053\u306e\u30e6\u30fc\u30b6\u30fc\u30cd\u30fc\u30e0\u306f\u3059\u3067\u306b\u4f7f\u7528\u3055\u308c\u3066\u3044\u307e\u3059","redux.err.profile.set-username.2":"\u3042\u306a\u305f\u306f\u3059\u3067\u306b\u30e6\u30fc\u30b6\u30fc\u30cd\u30fc\u30e0\u3092\u304a\u6301\u3061\u3067\u3059"}')},,,,,function(e,t,n){"use strict";n.d(t,"a",(function(){return k}));var a=n(9),r=n(4),c=n.n(r),s=n(6),o=n(3),i=n(11),u=n(17),l=n(5),p=n(8),d=n(16),b=function(e){return function(){var t=Object(a.a)(c.a.mark((function t(n,a,r){var b,j,f,m,O,g,h,v,y,x,_,E,T,S,N,w,I,k,M;return c.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return b=r.callZome,j=r.getAgentId,f=e.payload,m=a(),O=m.contacts.contacts,g=m.profile,h=g.username,v=g.fields,t.next=7,j();case 7:if(y=t.sent,x=Object(l.b)(y),_={originalGroupId:Object(l.b)(f.groupId),originalGroupRevisionId:Object(l.b)(f.groupRevisionId),name:f.latestName,members:f.members.map((function(e){return Object(l.b)(e)})),createdAt:Object(p.k)(f.created),creator:Object(l.b)(f.creator),messages:[],pinnedMessages:[]},E=[].concat(Object(u.a)(_.members),[_.creator]),T={},null===(S=E.reduce((function(e,t){var n=O[t]?O[t]:t===x?{id:x,username:h,fields:v}:null;if(n)T[t]=n;else{var a=Object(p.e)(t);e.push(a)}return e}),[]))||void 0===S||!S.length){t.next=19;break}return N=S.map((function(e){return Object(l.b)(e)})),t.next=17,b({zomeName:s.c.PROFILES,fnName:s.a[s.c.PROFILES].GET_AGENTS_PROFILES,payload:N});case 17:t.sent.forEach((function(e){var t=e.agent_pub_key;T[t]={id:t,username:e.profile.nickname,fields:e.profile.fields.avatar?{avatar:e.profile.fields.avatar}:{}}}));case 19:w=_.originalGroupId,I=Object(i.a)({},w,_),k=m.groups.conversations,k=Object(o.a)(Object(o.a)({},k),I),M=m.groups.members,M=Object(o.a)(Object(o.a)({},M),T),n({type:d.a,conversations:k,members:M});case 26:case"end":return t.stop()}}),t)})));return function(e,n,a){return t.apply(this,arguments)}}()},j=n(25),f=function(e){return Object(j.d)(e)?e:{type:"FILE",fileName:e.payload.metadata.fileName,fileSize:e.payload.metadata.fileSize,fileType:Object(j.b)(e.payload.fileType)?"OTHER":Object(j.a)(e.payload.fileType)?"IMAGE":"VIDEO",fileHash:Object(l.b)(e.payload.metadata.fileHash),thumbnail:Object(j.b)(e.payload.fileType)?void 0:e.payload.fileType.payload.thumbnail}},m=function(e){return function(){var t=Object(a.a)(c.a.mark((function t(n,a){var r,s,b,j,m,O,g,h,v,y,x,_;return c.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:r=e.payload,s=a(),b={groupMessageId:Object(l.b)(r.messageId),groupId:Object(l.b)(r.groupHash),author:Object(l.b)(r.sender),payload:f(r.payload),timestamp:Object(p.k)(r.created),replyTo:r.replyTo?{groupId:Object(l.b)(r.replyTo.content.groupHash),author:Object(l.b)(r.replyTo.content.sender),payload:f(r.replyTo.content.payload),timestamp:Object(p.k)(r.replyTo.content.created),replyTo:void 0,readList:{}}:void 0,readList:{}},j=b.groupId,m=b.groupMessageId,O=s.groups.conversations[j],g=O?O.messages:[],h=[b.groupMessageId].concat(Object(u.a)(g)),v=Object(i.a)({},m,b),y=s.groups.messages,y=Object(o.a)(Object(o.a)({},y),v),x=s.groups.groupFiles,_=Object(o.a)(Object(o.a)({},s.groups.conversations),{},Object(i.a)({},j,Object(o.a)(Object(o.a)({},O),{},{messages:h}))),n({type:d.g,conversations:_,messages:y,groupFiles:x});case 14:case"end":return t.stop()}}),t)})));return function(e,n){return t.apply(this,arguments)}}()},O=function(e){return function(){var t=Object(a.a)(c.a.mark((function t(n,a){var r,s,u,b,j,f;return c.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:r=e.payload,s=a(),u=r.messageIds.map((function(e){return Object(l.b)(e)})).filter((function(e){return s.groups.messages[e]})),b=Object(l.b)(r.reader),j=Object(p.k)(r.timestamp),f=Object(o.a)({},a().groups.messages),u.forEach((function(e){f[e].readList=Object(o.a)(Object(o.a)({},f[e].readList),{},Object(i.a)({},b,j))})),n({type:d.i,messages:f});case 8:case"end":return t.stop()}}),t)})));return function(e,n){return t.apply(this,arguments)}}()},g=function(){var e=Object(a.a)(c.a.mark((function e(t,n){var a,r;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,n({zomeName:s.c.PROFILES,fnName:s.a[s.c.PROFILES].GET_AGENT_PROFILE,payload:t});case 2:return a=e.sent,r=a.agent_pub_key,e.abrupt("return",{id:r,username:a.profile.nickname,fields:a.profile.fields.avatar?{avatar:a.profile.fields.avatar}:{}});case 5:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),h=function(e){return function(){var t=Object(a.a)(c.a.mark((function t(n,a,r){var s,u,p,b,j,f,m,O,h,v,y,x,_;return c.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(s=r.callZome,u=e.payload,p=Object(l.b)(u.groupId),b=a(),j=b.groups.typing[p]?b.groups.typing[p]:[],f=b.contacts.contacts,m=Object(l.b)(u.indicatedBy),O=j.map((function(e){return e.id})),!(u.isTyping&&!O.includes(m)||!u.isTyping&&O.includes(m))){t.next=24;break}if(!f[m]){t.next=13;break}t.t0=f[m],t.next=16;break;case 13:return t.next=15,g(m,s);case 15:t.t0=t.sent;case 16:h=t.t0,v={groupId:p,indicatedBy:h,isTyping:u.isTyping},y=b.groups.typing,x=y[v.groupId]?y[v.groupId]:[],_=x.map((function(e){return e.id})),v.isTyping?_.includes(v.indicatedBy.id)||x.push(v.indicatedBy):x=x.filter((function(e){return e.id!==v.indicatedBy.id})),y=Object(o.a)(Object(o.a)({},y),{},Object(i.a)({},v.groupId,x)),n({type:d.j,typing:y});case 24:case"end":return t.stop()}}),t)})));return function(e,n,a){return t.apply(this,arguments)}}()},v=n(7),y=n(89),x=function(e){return function(){var t=Object(a.a)(c.a.mark((function t(n,a,r){var s,u,d,b,j,f,m,O,g,h,x,_,E,T,S,N,w,I,k;return c.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(r.callZome,s=e.message,u=Object(o.a)({},a().contacts.contacts),d=Object(o.a)({},a().profile),b=Object(o.a)(Object(o.a)({},u),{},Object(i.a)({},d.id,{id:d.id,username:d.username,fields:d.fields})),j=Object(v.a)(s,2),f=j[0],m=j[1],O=Object(v.a)(f,2),g=O[0],h=O[1],x=m,_=Object(v.a)(x,2),E=_[0],T=_[1],Object.keys(u).includes(Object(l.b)(h.author))){t.next=10;break}return t.abrupt("return");case 10:t.t0=h.payload.type,t.next="TEXT"===t.t0?13:"FILE"===t.t0?15:17;break;case 13:return S=h.payload,t.abrupt("break",18);case 15:return S={type:"FILE",fileName:h.payload.payload.metadata.fileName,fileSize:h.payload.payload.metadata.fileSize,fileType:h.payload.payload.fileType.type,fileHash:Object(l.b)(h.payload.payload.metadata.fileHash),thumbnail:"OTHER"!==h.payload.payload.fileType.type?h.payload.payload.fileType.payload.thumbnail:null},t.abrupt("break",18);case 17:return t.abrupt("break",18);case 18:if(N=void 0,w=void 0,null===h.replyTo){t.next=30;break}t.t1=h.replyTo.payload.type,t.next="TEXT"===t.t1?24:"FILE"===t.t1?26:28;break;case 24:return w=h.replyTo.payload,t.abrupt("break",29);case 26:return w={type:"FILE",fileName:h.replyTo.payload.payload.metadata.fileName,fileSize:h.replyTo.payload.payload.metadata.fileSize,fileType:h.replyTo.payload.payload.fileType.type,fileHash:Object(l.b)(h.replyTo.payload.payload.metadata.fileHash),thumbnail:"OTHER"!==h.replyTo.payload.payload.fileType.type?h.replyTo.payload.payload.fileType.payload.thumbnail:null},t.abrupt("break",29);case 28:return t.abrupt("break",29);case 29:N={p2pMessageEntryHash:Object(l.b)(h.replyTo.hash),author:b[Object(l.b)(h.replyTo.author)],receiver:b[Object(l.b)(h.replyTo.receiver)],payload:w||h.replyTo.payload,timestamp:Object(p.k)(h.replyTo.timeSent),receipts:[]};case 30:I={p2pMessageEntryHash:Object(l.b)(g),author:b[Object(l.b)(h.author)],receiver:b[Object(l.b)(h.receiver)],payload:S,timestamp:Object(p.k)(h.timeSent),replyTo:N||void 0,receipts:[Object(l.b)(E)]},k={p2pMessageReceiptEntryHash:Object(l.b)(E),p2pMessageEntryHashes:[Object(l.b)(T.id[0])],timestamp:Object(p.k)(T.status.timestamp),status:T.status.status},n(Object(y.a)({message:I,receipt:k,key:I.author.id}));case 33:case"end":return t.stop()}}),t)})));return function(e,n,a){return t.apply(this,arguments)}}()},_=n(100),E=function(e){return function(){var t=Object(a.a)(c.a.mark((function t(n,a,r){var s,o,i;return c.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:r.callZome,s=Object.keys(e.receipt)[0],o=[],e.receipt[s].id.forEach((function(e){o.push(Object(l.b)(e))})),i={p2pMessageReceiptEntryHash:s,p2pMessageEntryHashes:o,timestamp:Object(p.k)(e.receipt[s].status.timestamp),status:e.receipt[s].status.status},n(Object(_.a)(i));case 6:case"end":return t.stop()}}),t)})));return function(e,n,a){return t.apply(this,arguments)}}()},T=n(29),S=function(e){return function(){var t=Object(a.a)(c.a.mark((function t(n,a,r){var s,o,i,u,p,d,b;return c.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:r.callZome,s=Object.keys(e.pin)[0],o=e.pin[s],i=o.status,u=o.conversants,p=a().p2pmessages.messages,d={},o.id.forEach((function(e){var t=Object(l.b)(e),n=p[t];d[t]=n})),b=a().profile.id,"pinned"===i.pinstatus?n({type:T.a,state:{conversant:Object(l.b)(u[0])===b?Object(l.b)(u[1]):Object(l.b)(u[0]),messages:d}}):n({type:T.h,state:{conversant:Object(l.b)(u[0])===b?Object(l.b)(u[1]):Object(l.b)(u[0]),messages:d}});case 10:case"end":return t.stop()}}),t)})));return function(e,n,a){return t.apply(this,arguments)}}()},N=function(e){return function(){var t=Object(a.a)(c.a.mark((function t(n,a){var r,s,i,u;return c.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(r=a().contacts.contacts,s=Object(l.b)(e.agent),!!!r[s]){t.next=9;break}return i=Object(o.a)({},a().p2pmessages.typing),u=r[s],!i[u.id]&&e.is_typing?i[u.id]=u:e.is_typing||delete i[u.id],n({type:T.g,state:i}),t.abrupt("return",!0);case 9:case"end":return t.stop()}}),t)})));return function(e,n){return t.apply(this,arguments)}}()},w=n(101),I=function(e){return function(){var t=Object(a.a)(c.a.mark((function t(n,a,r){var s,u,p,b,j,f,m,O;return c.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:r.callZome,r.getAgentId,s=e.payload,u=Object(l.b)(s.groupHash),p=Object(l.b)(s.groupMessageHash),b=Object(o.a)({},{pinnedMessages:a().groups.pinnedMessages,message:a().groups.messages[p],conversations:a().groups.conversations}),j=b.conversations,f=b.pinnedMessages,m=b.message,O=j[u],f[p]=m,O.pinnedMessages?O.pinnedMessages.push(p):O.pinnedMessages=[p],n({type:d.l,conversations:Object(o.a)(Object(o.a)({},j),{},Object(i.a)({},u,O)),pinnedMessages:Object(o.a)(Object(o.a)({},a().groups.pinnedMessages),f)});case 9:case"end":return t.stop()}}),t)})));return function(e,n,a){return t.apply(this,arguments)}}()},k=function(e,t){return function(){var n=Object(a.a)(c.a.mark((function n(a){return c.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:n.t0=e,n.next=n.t0===s.b[s.c.GROUP].ADDED_TO_GROUP?3:n.t0===s.b[s.c.GROUP].GROUP_MESSAGE_DATA?5:n.t0===s.b[s.c.GROUP].GROUP_TYPING_DETAIL?7:n.t0===s.b[s.c.GROUP].GROUP_MESSAGE_READ?9:n.t0===s.b[s.c.GROUP].PIN_MESSAGE_DATA?11:n.t0===s.b[s.c.P2PMESSAGE].RECEIVE_P2P_MESSAGE?13:n.t0===s.b[s.c.P2PMESSAGE].RECEIVE_P2P_RECEIPT?15:n.t0===s.b[s.c.P2PMESSAGE].TYPING_P2P?17:n.t0===s.b[s.c.P2PMESSAGE].SYNC_P2P_PINS?19:n.t0===s.b[s.c.P2PMESSAGE].POST_COMMIT_ERROR_COMMIT_MESSAGE?21:23;break;case 3:return a(b(t)),n.abrupt("break",23);case 5:return a(m(t)),n.abrupt("break",23);case 7:return a(h(t)),n.abrupt("break",23);case 9:return a(O(t)),n.abrupt("break",23);case 11:return a(I(t)),n.abrupt("break",23);case 13:return a(x(t)),n.abrupt("break",23);case 15:return a(E(t)),n.abrupt("break",23);case 17:return a(N(t)),n.abrupt("break",23);case 19:return a(S(t)),n.abrupt("break",23);case 21:return a(Object(w.a)(t)),n.abrupt("break",23);case 23:case"end":return n.stop()}}),n)})));return function(e){return n.apply(this,arguments)}}()}},,,,,,,,,,,function(e,t,n){var a={"./ion-action-sheet.entry.js":[233,5],"./ion-alert.entry.js":[234,6],"./ion-app_8.entry.js":[235,7],"./ion-avatar_3.entry.js":[236,17],"./ion-back-button.entry.js":[237,18],"./ion-backdrop.entry.js":[238,43],"./ion-button_2.entry.js":[239,19],"./ion-card_5.entry.js":[240,20],"./ion-checkbox.entry.js":[241,21],"./ion-chip.entry.js":[242,22],"./ion-col_3.entry.js":[243,44],"./ion-datetime_3.entry.js":[244,10],"./ion-fab_3.entry.js":[245,23],"./ion-img.entry.js":[246,45],"./ion-infinite-scroll_2.entry.js":[247,46],"./ion-input.entry.js":[248,24],"./ion-item-option_3.entry.js":[249,25],"./ion-item_8.entry.js":[250,26],"./ion-loading.entry.js":[251,27],"./ion-menu_3.entry.js":[252,28],"./ion-modal.entry.js":[253,8],"./ion-nav_2.entry.js":[254,14],"./ion-popover.entry.js":[255,9],"./ion-progress-bar.entry.js":[256,29],"./ion-radio_2.entry.js":[257,30],"./ion-range.entry.js":[258,31],"./ion-refresher_2.entry.js":[259,11],"./ion-reorder_2.entry.js":[260,16],"./ion-ripple-effect.entry.js":[261,47],"./ion-route_4.entry.js":[262,32],"./ion-searchbar.entry.js":[263,33],"./ion-segment_2.entry.js":[264,34],"./ion-select_3.entry.js":[265,35],"./ion-slide_2.entry.js":[266,48],"./ion-spinner.entry.js":[267,13],"./ion-split-pane.entry.js":[268,49],"./ion-tab-bar_2.entry.js":[269,36],"./ion-tab_2.entry.js":[270,15],"./ion-text.entry.js":[271,37],"./ion-textarea.entry.js":[272,38],"./ion-toast.entry.js":[273,39],"./ion-toggle.entry.js":[274,12],"./ion-virtual-scroll.entry.js":[275,50]};function r(e){if(!n.o(a,e))return Promise.resolve().then((function(){var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}));var t=a[e],r=t[0];return n.e(t[1]).then((function(){return n(r)}))}r.keys=function(){return Object.keys(a)},r.id=188,e.exports=r},,function(e,t,n){var a={"./ion-icon.entry.js":[276,57]};function r(e){if(!n.o(a,e))return Promise.resolve().then((function(){var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}));var t=a[e],r=t[0];return n.e(t[1]).then((function(){return n(r)}))}r.keys=function(){return Object.keys(a)},r.id=190,e.exports=r},,,,,,,,,,,function(e,t,n){},,,,,,,,,,,,,,,,,,,,,,,,,,,function(e,t,n){},function(e,t,n){"use strict";n.r(t);var a=n(2),r=n.n(a),c=n(58),s=n.n(c),o=n(1),i=(n(191),n(192),n(193),n(194),n(195),n(196),n(197),n(198),n(199),n(200),n(201),n(7)),u=n(10),l=n(154),p=n(14),d=n(3),b=n(151),j=n.n(b),f=n(0),m=function(e){return Object(f.jsx)("div",{className:j.a.spinner,children:Object(f.jsx)(o.U,Object(d.a)({},e))})},O=n(9),g=n(4),h=n.n(g),v=n(5),y=n(6),x=n(8),_=n(13),E=n(55),T=function(e,t){return function(){var n=Object(O.a)(h.a.mark((function n(a,r,c){var s,o,i,u,l,p;return h.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return s=c.callZome,o=c.getAgentId,n.prev=1,n.next=4,o();case 4:return i=n.sent,u=Object(v.b)(i),l=t?{nickname:e,fields:{avatar:Object(v.b)(t)}}:{nickname:e,fields:{}},n.next=9,s({zomeName:y.c.PROFILES,fnName:y.a[y.c.PROFILES].CREATE_PROFILE,payload:l});case 9:return p=n.sent,a({type:E.a,id:u,nickname:p.profile.nickname,fields:t?{avatar:Object(x.a)(Object(v.b)(t))}:{}}),n.abrupt("return",p);case 14:n.prev=14,n.t0=n.catch(1),a(Object(_.a)("TOAST",{},{id:"redux.err.generic"}));case 17:case"end":return n.stop()}}),n,null,[[1,14]])})));return function(e,t,a){return n.apply(this,arguments)}}()},S=function(){return function(){var e=Object(O.a)(h.a.mark((function e(t,n,a){var r,c,s,o,i;return h.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=a.callZome,c=a.getAgentId,e.prev=1,e.next=4,r({zomeName:y.c.PROFILES,fnName:y.a[y.c.PROFILES].GET_MY_PROFILE});case 4:return s=e.sent,console.warn("Agent's profile: ",s),e.next=8,c();case 8:return o=e.sent,i=Object(v.b)(o),s&&t({type:E.a,nickname:s.profile.nickname,id:i,fields:s.profile.fields.avatar?{avatar:Object(x.a)(s.profile.fields.avatar)}:{}}),e.abrupt("return",!0);case 14:e.prev=14,e.t0=e.catch(1);case 16:return e.abrupt("return",!1);case 17:case"end":return e.stop()}}),e,null,[[1,14]])})));return function(t,n,a){return e.apply(this,arguments)}}()},N=function(e){return function(){var t=Object(O.a)(h.a.mark((function t(n,a,r){var c,s,o,i,u,l,p;return h.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return c=r.callZome,s=a(),o=Object(d.a)({},s.contacts.contacts),i=s.profile.id,t.prev=4,t.next=7,c({zomeName:y.c.PROFILES,fnName:y.a[y.c.PROFILES].SEARCH_PROFILES,payload:{nickname_prefix:e}});case 7:return u=t.sent,console.log("searched profiles",u),l=u.map((function(e){return e.agent_pub_key})),p=u.filter((function(e){return!Object.keys(o).includes(e.agent_pub_key)&&e.agent_pub_key!==i})).filter((function(e,t){var n=e.agent_pub_key;return!l.includes(n,t+1)})).map((function(e){return{id:e.agent_pub_key,username:e.profile.nickname,fields:e.profile.fields.avatar?{avatar:Object(x.a)(e.profile.fields.avatar)}:{}}})),console.log(p),t.abrupt("return",p);case 15:t.prev=15,t.t0=t.catch(4);case 17:return t.abrupt("return",!1);case 18:case"end":return t.stop()}}),t,null,[[4,15]])})));return function(e,n,a){return t.apply(this,arguments)}}()},w=function(){return function(){var e=Object(O.a)(h.a.mark((function e(t,n,a){var r,c,s;return h.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=a.client,c=a.init,!r){e.next=5;break}e.t0=r,e.next=8;break;case 5:return e.next=7,c();case 7:e.t0=e.sent;case 8:return s=e.t0,e.next=11,s.connection.signOut();case 11:return e.next=13,s.connection.signIn();case 13:case"end":return e.stop()}}),e)})));return function(t,n,a){return e.apply(this,arguments)}}()},I=n(12),k=n(63),M=n(152),R=n(120),P=n.n(R),C=function(e){var t=e.hash,n=e.size,r=void 0===n?32:n,c=e.className,s=void 0===c?"":c,i=e.avatar,u=void 0===i?void 0:i,l=Object(a.useRef)(null),p={hash:Object(v.a)(t),size:r};return Object(a.useEffect)((function(){l.current&&Object(M.a)(p,l.current)})),Object(f.jsx)("div",{children:u?Object(f.jsx)(o.b,{className:P.a.avatar,children:Object(f.jsx)("img",{src:u,alt:"avatar"})}):Object(f.jsx)("canvas",{ref:l,className:"".concat(P.a.icon," ").concat(s),id:"identicon",width:r,height:r})})},A=n(109),G=n.n(A),L=function(){var e=Object(I.f)(),t=Object(p.c)((function(e){return Object(d.a)({},e.profile)})),n=t.username,r=t.id,c=t.fields,s=Object(l.a)(),i=Object(x.l)(),b=Object(a.useRef)(null),j=[{onClick:function(){e.push("/settings")},label:s.formatMessage({id:"app.menu.settings-label"}),icon:u.w},{onClick:function(){e.push("/blocked")},label:s.formatMessage({id:"app.menu.blocked-label"}),icon:u.h},{onClick:function(){return window.open("https://github.com/hc-institute-japan/kizuna/issues/new?assignees=&labels=bug&template=bug_report.md&title=")},label:s.formatMessage({id:"app.menu.report-label"}),icon:u.db},{onClick:function(){i(w())},label:s.formatMessage({id:"app.menu.logout-label"}),icon:u.G,disabled:!Object(k.d)()}];return Object(f.jsxs)(o.D,{ref:b,contentId:"main",type:"overlay",children:[Object(f.jsx)(o.k,{className:"".concat(G.a.menu," ion-padding-top"),children:Object(f.jsxs)(o.A,{id:"inbox-list",lines:"none",children:[Object(f.jsxs)(o.y,{className:"ion-no-margin",children:[Object(f.jsx)("div",{className:"".concat(G.a.container," ion-padding"),children:c.avatar?Object(f.jsx)(o.b,{children:Object(f.jsx)("img",{src:c.avatar,alt:"avatar"})}):Object(f.jsx)(C,{hash:r,size:60})}),Object(f.jsx)(o.w,{onClick:function(){var t;null===b||void 0===b||null===(t=b.current)||void 0===t||t.close(),e.push({pathname:"/p/".concat(r),state:{profile:{username:n,id:r,fields:c},prev:"/home"}})},lines:"none",children:Object(f.jsx)(o.z,{children:n})})]}),j.map((function(e){var t=e.onClick,n=e.label,a=e.icon,r=e.disabled,c=void 0!==r&&r;return Object(f.jsxs)(o.w,{onClick:function(e){function t(){return e.apply(this,arguments)}return t.toString=function(){return e.toString()},t}((function(){var e;null===b||void 0===b||null===(e=b.current)||void 0===e||e.close(),t()})),disabled:c,children:[Object(f.jsx)(o.r,{className:"ion-margin-end",icon:a}),Object(f.jsx)(o.z,{children:n})]},n)}))]})}),Object(f.jsx)(o.o,{className:"ion-no-border",children:Object(f.jsx)(o.fb,{children:Object(f.jsxs)(o.Z,{className:"ion-padding ".concat(G.a.version),children:[s.formatMessage({id:"app.menu.version"})," 0.2.0"]})})})]})},D=n(11),H=n(31),z=n(25),U=function(e){return{messagesByGroup:Object(x.i)(e.messagesByGroup,(function(e){return e.map((function(e){return Object(v.b)(e)}))})),groupMessagesContents:Object(x.i)(e.groupMessagesContents,(function(e){var t=Object(x.i)(e.readList,(function(e){return Object(x.k)(e)}));return{groupMessageId:Object(v.b)(e.groupMessageElement.signedHeader.header.content.entry_hash),groupId:Object(v.b)(e.groupMessageElement.entry.groupHash),author:Object(v.b)(e.groupMessageElement.entry.sender),payload:F(e.groupMessageElement.entry.payload),timestamp:Object(x.k)(e.groupMessageElement.entry.created),replyTo:e.groupMessageElement.entry.replyTo?{groupId:Object(v.b)(e.groupMessageElement.entry.replyTo.content.groupHash),author:Object(v.b)(e.groupMessageElement.entry.replyTo.content.sender),payload:F(e.groupMessageElement.entry.replyTo.content.payload),timestamp:Object(x.k)(e.groupMessageElement.entry.replyTo.content.created),replyTo:e.groupMessageElement.entry.replyTo?Object(v.b)(e.groupMessageElement.entry.replyTo):void 0,readList:{}}:void 0,readList:t}}))}},F=function(e){return Object(z.d)(e)?e:Object(z.b)(e.payload.fileType)?{type:"FILE",fileName:e.payload.metadata.fileName,fileSize:e.payload.metadata.fileSize,fileType:e.payload.metadata.fileType,fileHash:Object(v.b)(e.payload.metadata.fileHash)}:{type:"FILE",fileName:e.payload.metadata.fileName,fileSize:e.payload.metadata.fileSize,fileType:e.payload.metadata.fileType,fileHash:Object(v.b)(e.payload.metadata.fileHash),thumbnail:e.payload.fileType.payload.thumbnail}},B=function(){var e=Object(O.a)(h.a.mark((function e(t,n,a,r){var c,s,o,i,u;return h.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(c=t.contacts.contacts,s=t.profile,o=[],i={},n.forEach((function(e){c[e]?i[e]=c[e]:e===r?i[r]={id:r,username:s.username,fields:s.fields}:o.push(Object(x.e)(e))})),null===o||void 0===o||!o.length){e.next=11;break}return u=o.map((function(e){return Object(v.b)(e)})),e.next=9,a({zomeName:y.c.PROFILES,fnName:y.a[y.c.PROFILES].GET_AGENTS_PROFILES,payload:u});case 9:e.sent.forEach((function(e){var t=e.agent_pub_key;i[t]={id:t,username:e.profile.nickname,fields:e.profile.fields.avatar?{avatar:e.profile.fields.avatar}:{}}}));case 11:return e.abrupt("return",i);case 12:case"end":return e.stop()}}),e)})));return function(t,n,a,r){return e.apply(this,arguments)}}(),Z=n(16),V=n(59),Y=n(99),X=n(60),J=function(){var e=Object(I.f)(),t=Object(p.c)((function(e){return Object.values(e.contacts.blocked)}));return Object(f.jsxs)(o.H,{children:[Object(f.jsx)(o.q,{children:Object(f.jsx)(o.fb,{children:Object(f.jsx)(o.f,{slot:"start",children:Object(f.jsx)(o.e,{onClick:function(){return e.push({pathname:"/home"})},className:"ion-no-padding",children:Object(f.jsx)(o.r,{slot:"icon-only",icon:u.e})})})})}),Object(f.jsx)(o.k,{children:t.map((function(t){return Object(f.jsx)(o.w,{button:!0,onClick:function(){return n=t,e.push({pathname:"/p/".concat(n.id),state:{profile:n,prev:"/blocked"}});var n},children:Object(f.jsx)(o.z,{children:t.username})},t.username)}))})]})},q=n(17),K=n(155),W=n.n(K),Q=function(e,t){var n=e.children,c=e.type,s=void 0===c?"p2p":c,i=e.onScrollTop,u=e.disabled,p=e.onScrollBottom,d=r.a.Children.toArray(n),b=Object(l.a)(),j=Object(a.useRef)(null),m=Object(a.useRef)(null),O=Object(a.useRef)(null),g=r.a.Children.map(d,(function(e,t){if(r.a.isValidElement(e)){var n=function(e,t,n){var a,r,c,o=!1,i=!1,u=!1,l=0===n,p=0!==(null===(a=Object.values(null===(r=t[n])||void 0===r||null===(c=r.props)||void 0===c?void 0:c.readList))||void 0===a?void 0:a.length);0===n&&(o=!0);var d=t[n-1],b=null===e||void 0===e?void 0:e.props,j=null===d||void 0===d?void 0:d.props;(null===b||void 0===b?void 0:b.profile.id)!==(null===j||void 0===j?void 0:j.profile.id)&&(o=!0,i=!0);var f=null===b||void 0===b?void 0:b.timestamp,m=null===j||void 0===j?void 0:j.timestamp;return f&&m&&(l=!(f.getDate()===m.getDate()&&f.getMonth()===m.getMonth()&&f.getFullYear()===m.getFullYear()))&&(o=!0),"group"===s&&(u=o),{showProfilePicture:o,space:i,showName:u,showDate:l,hasRead:p}}(e,d,t),c=n.showProfilePicture,i=n.showName,u=n.showDate,l=n.hasRead;return Object(f.jsxs)(a.Fragment,{children:[u?Object(f.jsx)(o.Z,{className:"ion-text-center",children:e.props.timestamp.toDateString()===(new Date).toDateString()?b.formatMessage({id:"components.chat.chat-list.today"}):b.formatDate(e.props.timestamp,{year:"numeric",month:"numeric",day:"numeric"})}):null,r.a.cloneElement(e,{isSeen:l,type:s,showProfilePicture:c,showName:i})]},t)}return e}));Object(a.useEffect)((function(){j.current&&setTimeout((function(){var e;null===(e=j.current)||void 0===e||e.scrollIntoView({behavior:"smooth"})}),500)}),[j]);var h=function(){var e;return null===(e=m.current)||void 0===e?void 0:e.complete()},v=function(){var e;return null===(e=O.current)||void 0===e?void 0:e.complete()};Object(a.useImperativeHandle)(t,(function(){return{scrollToBottom:function(){setTimeout((function(){var e;return null===(e=j.current)||void 0===e?void 0:e.scrollIntoView({behavior:"smooth"})}),500)}}}));var y=Object(a.useRef)(null);return Object(a.useEffect)((function(){setTimeout((function(){y.current&&y.current.getBoundingClientRect().height<=y.current.parentNode.getBoundingClientRect().height&&i&&i(h,{})}),500)}),[n]),Object(f.jsxs)(o.A,{ref:y,className:"".concat(W.a.chat," chat-list"),children:[i?Object(f.jsx)(o.t,{disabled:!!u,threshold:"0",ref:m,position:"top",onIonInfinite:function(e){return setTimeout((function(){return i(h,e)}),1e3)},children:Object(f.jsx)(o.u,{loadingSpinner:"crescent"})}):null,g,Object(f.jsx)("div",{ref:j}),p?Object(f.jsx)(o.t,{disabled:!!u,threshold:"0px",ref:O,position:"bottom",onIonInfinite:function(e){return setTimeout((function(){return p(v,e)}),1e3)},children:Object(f.jsx)(o.u,{loadingSpinner:"crescent"})}):null]})},$=Object(a.forwardRef)(Q),ee=n(123),te=n.n(ee),ne=function(e){var t=e.onPin,n=e.onReply,a=e.onDelete,r=e.isPinned,c=e.intl,s=e.onRetry,i=e.onHide;return e.err?Object(f.jsxs)(o.A,{children:[Object(f.jsxs)(o.w,{button:!0,lines:"none",onClick:function(){s(),i()},children:[Object(f.jsx)(o.z,{children:c.formatMessage({id:"components.chat.chat-modal-resend"})}),Object(f.jsx)(o.r,{icon:u.D,className:te.a.icon})]}),Object(f.jsxs)(o.w,{onClick:function(){a(),i()},button:!0,lines:"none",children:[Object(f.jsx)(o.z,{children:c.formatMessage({id:"components.chat.chat-modal-delete"})}),Object(f.jsx)(o.r,{icon:u.u,slot:"end"})]})]}):Object(f.jsxs)(o.A,{children:[Object(f.jsxs)(o.w,{button:!0,lines:"none",onClick:function(){n(),i()},children:[Object(f.jsx)(o.z,{children:c.formatMessage({id:"components.chat.chat-modal-reply"})}),Object(f.jsx)(o.r,{icon:u.f,className:te.a.icon})]}),Object(f.jsxs)(o.w,{onClick:function(){t(),i()},button:!0,lines:"none",children:[Object(f.jsx)(o.z,{children:r?c.formatMessage({id:"components.chat.chat-modal-unpin"}):c.formatMessage({id:"components.chat.chat-modal-pin"})}),Object(f.jsx)(o.r,{icon:u.R,slot:"end"})]})]})},ae=function(e){return function(){var t=Object(O.a)(h.a.mark((function t(n,a,r){var c,s,o,i,u,l,p,b,j,f,m,O,g;return h.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return c=r.callZome,s=r.getAgentId,o=a(),t.next=4,s();case 4:return i=t.sent,u={members:e.members.filter((function(t,n){return e.members.indexOf(t)===n})).map((function(e){return Object(x.e)(e)})),groupId:Object(v.a)(e.groupId),groupRevisionId:Object(v.a)(e.groupRevisionId)},t.prev=6,t.next=9,c({zomeName:y.c.GROUP,fnName:y.a[y.c.GROUP].ADD_MEMBERS,payload:u});case 9:return l=t.sent,p=l.members.map((function(e){return Object(v.b)(e)})),b={members:p,groupId:Object(v.b)(l.groupId),groupRevisionId:Object(v.b)(l.groupRevisionId)},t.next=14,B(o,p,c,Object(v.b)(i));case 14:return j=t.sent,f=b.groupId,(m=o.groups.conversations[f]).members=m.members.concat(b.members),O=o.groups.conversations,O=Object(d.a)(Object(d.a)({},O),{},Object(D.a)({},f,m)),g=o.groups.members,g=Object(d.a)(Object(d.a)({},g),j),n({type:Z.b,conversations:O,members:g}),t.abrupt("return",e);case 26:t.prev=26,t.t0=t.catch(6),t.t1=!0,t.next=t.t1===t.t0.message.includes("members field is empty")?31:t.t1===t.t0.message.includes("cannot create group with blocked agents")?33:t.t1===t.t0.message.includes("failed to get the given group id")?35:t.t1===t.t0.message.includes("cannot update a group entry if you are not the group creator (admin)")?37:t.t1===t.t0.message.includes("creator AgentPubKey cannot be included in the group members list")?39:41;break;case 31:return n(Object(_.a)("TOAST",{},{id:"redux.err.group.add-members.1"})),t.abrupt("return",!1);case 33:return n(Object(_.a)("TOAST",{},{id:"redux.err.group.add-members.2"})),t.abrupt("return",!1);case 35:return n(Object(_.a)("TOAST",{},{id:"redux.err.group.add-members.3"})),t.abrupt("return",!1);case 37:return n(Object(_.a)("TOAST",{},{id:"redux.err.group.add-members.4"})),t.abrupt("return",!1);case 39:return n(Object(_.a)("TOAST",{},{id:"redux.err.group.add-members.5"})),t.abrupt("return",!1);case 41:return n(Object(_.a)("TOAST",{},{id:"redux.err.generic"})),t.abrupt("return",!1);case 43:case"end":return t.stop()}}),t,null,[[6,26]])})));return function(e,n,a){return t.apply(this,arguments)}}()},re=function(e){return function(){var t=Object(O.a)(h.a.mark((function t(n,a,r){var c,s,o,i,u,l,p,b,j,f,m,O,g;return h.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return c=r.callZome,s=r.getAgentId,o=a(),t.next=4,s();case 4:return i=t.sent,u={name:e.name,members:e.members.map((function(e){return Object(x.e)(e)}))},t.prev=6,t.next=9,c({zomeName:y.c.GROUP,fnName:y.a[y.c.GROUP].CREATE_GROUP,payload:u});case 9:return l=t.sent,p={originalGroupId:Object(v.b)(l.groupId),originalGroupRevisionId:Object(v.b)(l.groupRevisionId),name:l.content.name,members:l.content.members.map((function(e){return Object(v.b)(e)})),createdAt:l.content.created,creator:Object(v.b)(l.content.creator),messages:[],pinnedMessages:[]},b=[].concat(Object(q.a)(p.members),[p.creator]),t.next=14,B(o,b,c,Object(v.b)(i));case 14:return j=t.sent,f=p.originalGroupId,m=Object(D.a)({},f,p),O=o.groups.conversations,O=Object(d.a)(Object(d.a)({},O),m),g=o.groups.members,g=Object(d.a)(Object(d.a)({},g),j),n({type:Z.a,conversations:O,members:g}),t.abrupt("return",p);case 25:throw t.prev=25,t.t0=t.catch(6),t.t0;case 28:case"end":return t.stop()}}),t,null,[[6,25]])})));return function(e,n,a){return t.apply(this,arguments)}}()},ce=function(e){return function(t,n){var a=n(),r=a.profile.id,c=a.groups.conversations[e],s=a.groups.messages;return c.messages.filter((function(e){return s[e].author!==r})).map((function(e){return s[e].readList})).filter((function(e){return void 0===e[r]})).length}},se=function(e){return function(){var t=Object(O.a)(h.a.mark((function t(n,a,r){var c,s,o,i,u,l,p,b,j,f,m,O,g,E,T;return h.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return c=r.callZome,s=r.getAgentId,t.next=3,s();case 3:return o=t.sent,i=a(),t.prev=5,t.next=8,c({zomeName:y.c.GROUP,fnName:y.a[y.c.GROUP].GET_GROUP_LATEST_VERSION,payload:Object(v.a)(e)});case 8:return u=t.sent,l={groupId:Object(v.a)(e),batchSize:10,payloadType:{type:"ALL",payload:null}},t.next=12,c({zomeName:y.c.GROUP,fnName:y.a[y.c.GROUP].GET_PREVIOUS_GROUP_MESSAGES,payload:l});case 12:return p=t.sent,t.next=15,c({zomeName:y.c.GROUP,fnName:y.a[y.c.GROUP].FETCH_PINNED_MESSAGES,payload:e});case 15:return b=t.sent,j=U(p),f={originalGroupId:Object(v.b)(u.groupId),originalGroupRevisionId:Object(v.b)(u.groupRevisionId),name:u.latestName,members:u.members.map((function(e){return Object(v.b)(e)})),createdAt:Object(x.k)(u.created),creator:Object(v.b)(u.creator),messages:j.messagesByGroup[Object(v.b)(u.groupId)],pinnedMessages:Object.values(b).map((function(e){return Object(v.b)(e.entry.messageId)}))},t.next=20,B(a(),f.members,c,Object(v.b)(o));case 20:return m=t.sent,O=i.groups.conversations,O=Object(d.a)(Object(d.a)({},O),{},Object(D.a)({},f.originalGroupId,f)),g=i.groups.messages,g=Object(d.a)(Object(d.a)({},g),j.groupMessagesContents),E=i.groups.members,Object.keys(m).forEach((function(e){E[e]=m[e]})),n({type:Z.k,conversations:O,messages:g,members:E}),t.abrupt("return",f);case 31:if(t.prev=31,t.t0=t.catch(5),null===t.t0||void 0===t.t0||null===(T=t.t0.message)||void 0===T||!T.includes("failed to get the given group id")){t.next=37;break}return t.abrupt("return",n(Object(_.a)("TOAST",{},{id:"redux.err.group.get-latest-group-version.1"})));case 37:return t.abrupt("return",n(Object(_.a)("TOAST",{},{id:"redux.err.generic"})));case 38:case"end":return t.stop()}}),t,null,[[5,31]])})));return function(e,n,a){return t.apply(this,arguments)}}()},oe=function(e){return function(){var t=Object(O.a)(h.a.mark((function t(n,a,r){var c,s,o,i,u,l,p,b,j,f;return h.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return c=r.callZome,s=a(),o={groupId:Object(v.a)(e.groupId),lastFetched:e.lastFetched?Object(v.a)(e.lastFetched):void 0,lastMessageTimestamp:e.lastMessageTimestamp?Object(x.d)(e.lastMessageTimestamp):void 0,batchSize:e.batchSize,payloadType:e.payloadType},t.prev=3,t.next=6,c({zomeName:y.c.GROUP,fnName:y.a[y.c.GROUP].GET_PREVIOUS_GROUP_MESSAGES,payload:o});case 6:return i=t.sent,u=U(i),l=s.groups.conversations,(p=l[e.groupId])&&(b=p.messages?Array.from(new Set(p.messages.concat(u.messagesByGroup[e.groupId]))):u.messagesByGroup[e.groupId],l=Object(d.a)(Object(d.a)({},l),{},Object(D.a)({},e.groupId,p)),j=s.groups.messages,j=Object(d.a)(Object(d.a)({},j),u.groupMessagesContents),f=Object(d.a)(Object(d.a)({},l),{},Object(D.a)({},e.groupId,Object(d.a)(Object(d.a)({},p),{},{messages:b}))),n({type:Z.h,conversations:f,messages:j})),t.abrupt("return",u);case 14:return t.prev=14,t.t0=t.catch(3),t.abrupt("return",n(Object(_.a)("TOAST",{},{id:"redux.err.generic"})));case 17:case"end":return t.stop()}}),t,null,[[3,14]])})));return function(e,n,a){return t.apply(this,arguments)}}()},ie=function(e){return function(){var t=Object(O.a)(h.a.mark((function t(n,a,r){var c,s,o,i,u,l,p,b,j,f;return h.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return c=r.callZome,s=a(),o={groupId:Object(v.a)(e.groupId),date:Object(x.d)(e.date),payloadType:e.payloadType},t.next=5,c({zomeName:y.c.GROUP,fnName:y.a[y.c.GROUP].GET_MESSAGES_BY_GROUP_BY_TIMESTAMP,payload:o});case 5:return i=t.sent,u=U(i),l=s.groups.conversations,(p=l[e.groupId])&&(b=p.messages?Array.from(new Set(p.messages.concat(u.messagesByGroup[e.groupId]))):l[e.groupId].messages,l=Object(d.a)(Object(d.a)({},l),{},Object(D.a)({},e.groupId,p)),j=s.groups.messages,j=Object(d.a)(Object(d.a)({},j),u.groupMessagesContents),f=Object(d.a)(Object(d.a)({},l),{},Object(D.a)({},e.groupId,Object(d.a)(Object(d.a)({},p),{},{messages:b}))),n({type:Z.h,conversations:f,messages:j})),t.abrupt("return",u);case 11:case"end":return t.stop()}}),t)})));return function(e,n,a){return t.apply(this,arguments)}}()},ue=function(e,t){return function(n,a){var r=a().groups,c=r.messages,s=r.members,o=r.errMsgs,i=a().profile,u=e.map((function(e){var t=c[e],n=s[t.author];return Object(d.a)(Object(d.a)({},t),{},{author:n||{username:i.username,id:t.author,fields:i.fields}})}));return o[t]&&(u=u.concat(o[t])),u.sort((function(e,t){return e.timestamp.getTime()-t.timestamp.getTime()})),u}},le=function(e){return function(){var t=Object(O.a)(h.a.mark((function t(n,a,r){var c,s;return h.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return c=r.callZome,s={groupId:Object(v.a)(e.groupId),indicatedBy:Object(x.e)(e.indicatedBy),members:e.members.map((function(e){return Object(x.e)(e)})),isTyping:e.isTyping},t.next=4,c({zomeName:y.c.GROUP,fnName:y.a[y.c.GROUP].INDICATE_GROUP_TYPING,payload:s});case 4:return t.abrupt("return",null);case 5:case"end":return t.stop()}}),t)})));return function(e,n,a){return t.apply(this,arguments)}}()},pe=function(e){return function(){var t=Object(O.a)(h.a.mark((function t(n,a,r){var c,s;return h.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return c=r.callZome,s={groupId:Object(v.a)(e.groupId),messageIds:e.messageIds.map((function(e){return Object(v.a)(e)})),reader:e.reader,timestamp:Object(x.d)(e.timestamp),members:e.members},t.prev=2,t.next=5,c({zomeName:y.c.GROUP,fnName:y.a[y.c.GROUP].READ_GROUP_MESSAGE,payload:s});case 5:t.next=9;break;case 7:t.prev=7,t.t0=t.catch(2);case 9:return t.abrupt("return",null);case 10:case"end":return t.stop()}}),t,null,[[2,7]])})));return function(e,n,a){return t.apply(this,arguments)}}()},de=function(e){return function(){var t=Object(O.a)(h.a.mark((function t(n,a,r){var c,s,o,i,u,l,p,b,j,f;return h.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return c=r.callZome,s={members:e.members.map((function(e){return Object(x.e)(e)})),groupId:Object(v.a)(e.groupId),groupRevisionId:Object(v.a)(e.groupRevisionId)},o=a(),t.prev=3,t.next=6,c({zomeName:y.c.GROUP,fnName:y.a[y.c.GROUP].REMOVE_MEMBERS,payload:s});case 6:return i=t.sent,u={members:i.members.map((function(e){return Object(v.b)(e)})),groupId:Object(v.b)(i.groupId),groupRevisionId:Object(v.b)(i.groupRevisionId)},l=u.groupId,p=u.members,(b=o.groups.conversations[l]).members=b.members.filter((function(e){return!p.includes(e)})),j=o.groups.conversations,j=Object(d.a)(Object(d.a)({},j),{},Object(D.a)({},l,b)),f=o.groups.members,p.forEach((function(e){delete f[e]})),n({type:Z.c,conversations:j,members:f}),t.abrupt("return",e);case 20:t.prev=20,t.t0=t.catch(3),t.t1=!0,t.next=t.t1===t.t0.message.includes("members field is empty")?25:t.t1===t.t0.message.includes("failed to get the given group id")?27:t.t1===t.t0.message.includes("groups cannot be created with less than 3 members")?29:t.t1===t.t0.message.includes("cannot update a group entry if you are not the group creator (admin)")?31:33;break;case 25:return n(Object(_.a)("TOAST",{},{id:"redux.err.group.remove-members.1"})),t.abrupt("return",!1);case 27:return n(Object(_.a)("TOAST",{},{id:"redux.err.group.remove-members.2"})),t.abrupt("return",!1);case 29:return n(Object(_.a)("TOAST",{},{id:"redux.err.group.remove-members.3"})),t.abrupt("return",!1);case 31:return n(Object(_.a)("TOAST",{},{id:"redux.err.group.remove-members.4"})),t.abrupt("return",!1);case 33:return n(Object(_.a)("TOAST",{},{id:"redux.err.generic"})),t.abrupt("return",!1);case 35:case"end":return t.stop()}}),t,null,[[3,20]])})));return function(e,n,a){return t.apply(this,arguments)}}()},be=function(){var e=Object(O.a)(h.a.mark((function e(t,n,a,r,c){var s,o,i,u,l,p,b,j,f,m,O,g,_,E,T,S,N;return h.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!Object(z.d)(n.payloadInput)){e.next=4;break}s=t.content.payload,e.next=14;break;case 4:if(i=t.content.payload.payload.fileType,u=Object(z.b)(i)?void 0:Object(z.a)(i)||Object(z.e)(i)?i.payload.thumbnail:void 0,o=n.payloadInput.payload.fileBytes,"VIDEO"!==i.type){e.next=12;break}return e.next=10,a({zomeName:y.c.GROUP,fnName:y.a[y.c.GROUP].GET_FILES_BYTES,payload:[t.content.payload.payload.metadata.fileHash]});case 10:"error"!==(null===(l=e.sent)||void 0===l?void 0:l.type)&&c(ve(Object(d.a)({},l)));case 12:p={type:"FILE",fileName:t.content.payload.payload.metadata.fileName,fileSize:t.content.payload.payload.metadata.fileSize,fileType:t.content.payload.payload.metadata.fileType,fileHash:Object(v.b)(t.content.payload.payload.metadata.fileHash),thumbnail:u},s=p;case 14:return b=t.content.replyTo?r().groups.messages[Object(v.b)(t.content.replyTo)]:null,j={groupMessageId:Object(v.b)(t.id),groupId:Object(v.b)(t.content.groupHash),author:Object(v.b)(t.content.sender),payload:s,timestamp:Object(x.k)(t.content.created),replyTo:b?{groupId:b.groupId,author:b.author,payload:b.payload,timestamp:b.timestamp,replyTo:void 0,readList:{}}:void 0,readList:{}},f=j.groupId,m=j.groupMessageId,O=r().groups.conversations[f],g=[j.groupMessageId].concat(Object(q.a)(O.messages)),_=Object(D.a)({},m,j),E=r().groups.messages,E=Object(d.a)(Object(d.a)({},E),_),T=r().groups.groupFiles,Object(z.d)(j.payload)||(S=Object(D.a)({},j.payload.fileHash,o),T=Object(d.a)(Object(d.a)({},T),S)),N=Object(d.a)(Object(d.a)({},r().groups.conversations),{},Object(D.a)({},f,Object(d.a)(Object(d.a)({},O),{},{messages:g}))),c({type:Z.g,conversations:N,messages:E,groupFiles:T}),e.abrupt("return",j);case 28:case"end":return e.stop()}}),e)})));return function(t,n,a,r,c){return e.apply(this,arguments)}}(),je=function(e,t,n){switch(!0){case e.message.includes("failed to get the given group id"):t(Object(_.a)("TOAST",{},{id:"redux.err.group.send-group-message.1",value:{payload:Object(z.d)(n.payloadInput)?n.payloadInput.payload:n.payloadInput.payload.metadata.fileName}}));break;case e.message.includes("failed to get the replied message from DHT"):t(Object(_.a)("TOAST",{},{id:"redux.err.group.send-group-message.2"}))}},fe=function(e){return function(){var t=Object(O.a)(h.a.mark((function t(n,a,r){var c,s,o,i,u,l;return h.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return c=r.callZome,s=r.retry,Object(z.d)(e.payloadInput)&&(o=e.payloadInput.payload.payload,e.payloadInput.payload={payload:o.trim()}),i={groupHash:Object(v.a)(e.groupId),payloadInput:e.payloadInput,sender:Object(v.a)(e.sender),replyTo:e.replyTo?Object(v.a)(e.replyTo):void 0},t.prev=3,t.next=6,c({zomeName:y.c.GROUP,fnName:y.a[y.c.GROUP].SEND_MESSAGE,payload:i});case 6:return u=t.sent,t.next=9,be(u,e,c,a,n);case 9:case 19:return t.abrupt("return",t.sent);case 12:if(t.prev=12,t.t0=t.catch(3),t.prev=14,t.t0.message.includes("Timed out")){t.next=22;break}return l=s({zomeName:y.c.GROUP,fnName:y.a[y.c.GROUP].SEND_MESSAGE,payload:i}),t.next=19,be(l,e,c,a,n);case 22:return t.abrupt("return",n(Object(_.a)("TOAST",{},{id:"redux.err.conductor-time-out"})));case 23:t.next=30;break;case 25:return t.prev=25,t.t1=t.catch(14),je(t.t1,n,e),console.log("sending of group message has failed",t.t1),t.abrupt("return",!1);case 30:case"end":return t.stop()}}),t,null,[[3,12],[14,25]])})));return function(e,n,a){return t.apply(this,arguments)}}()},me=function(e){return function(){var t=Object(O.a)(h.a.mark((function t(n,a){var r,c,s,o,i,u,l,p,b,j;return h.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:r=a().profile,c=r.id,s=r.username,o=r.fields,i=a().groups,u=Object(z.d)(e.payloadInput)?{type:"TEXT",payload:{payload:e.payloadInput.payload.payload}}:{type:"FILE",fileName:e.payloadInput.payload.metadata.fileName,fileSize:e.payloadInput.payload.metadata.fileSize,fileType:e.payloadInput.payload.fileType.type,fileBytes:e.payloadInput.payload.fileBytes,thumbnail:null===(l=e.payloadInput.payload.fileType.payload)||void 0===l?void 0:l.thumbnail},p={groupMessageId:"error message",groupId:e.groupId,author:{username:s,id:c,fields:o},payload:u,timestamp:new Date,replyTo:e.replyTo&&i.messages[e.replyTo]?{groupId:i.messages[e.replyTo].groupId,author:i.messages[e.replyTo].author,payload:i.messages[e.replyTo].payload,timestamp:i.messages[e.replyTo].timestamp,replyTo:void 0,readList:i.messages[e.replyTo].readList}:void 0,replyToId:e.replyTo?e.replyTo:void 0,readList:{},err:!0},b=i.errMsgs,j=b[p.groupId]?i.errMsgs[p.groupId]:[],b=Object(d.a)(Object(d.a)({},b),{},Object(D.a)({},p.groupId,[p].concat(Object(q.a)(j)))),n({type:Z.e,errMsgs:b});case 8:case"end":return t.stop()}}),t)})));return function(e,n){return t.apply(this,arguments)}}()},Oe=function(e,t,n){return function(){var a=Object(O.a)(h.a.mark((function a(r,c){var s,o,i,u;return h.a.wrap((function(a){for(;;)switch(a.prev=a.next){case 0:return(s=e.map((function(e){return e.username}))).push(c().profile.username),a.prev=2,a.next=5,r(re({name:s.join(","),members:e.map((function(e){return e.id}))}));case 5:return o=a.sent,i=[],n.forEach((function(e){var t={type:"FILE",payload:{metadata:{fileName:e.payload.metadata.fileName,fileSize:e.payload.metadata.fileSize,fileType:e.payload.metadata.fileType},fileType:e.payload.fileType,fileBytes:e.payload.fileBytes}},n={groupId:o.originalGroupId,payloadInput:t,sender:o.creator,replyTo:void 0};i.push(n)})),t.length&&i.push({groupId:o.originalGroupId,payloadInput:{type:"TEXT",payload:{payload:t}},sender:o.creator,replyTo:void 0}),u=[],i.forEach(function(){var e=Object(O.a)(h.a.mark((function e(t){return h.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,r(fe(t)).then((function(e){!1===e?r(me(t)):u.push(e)}));case 2:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),a.abrupt("return",{groupResult:o,messageResults:u});case 14:a.prev=14,a.t0=a.catch(2),a.t1=!0,a.next=a.t1===a.t0.message.includes("cannot create group with blocked agents")?19:a.t1===a.t0.message.includes("groups cannot be created with less than 3 members")?21:a.t1===a.t0.message.includes("creator AgentPubKey cannot be included in the group members list")?23:a.t1===a.t0.message.includes("the group name must at least contain 1 character and maximun 50 characters")?25:28;break;case 19:return r(Object(_.a)("TOAST",{},{id:"redux.err.group.create-group.1"})),a.abrupt("break",30);case 21:return r(Object(_.a)("TOAST",{},{id:"redux.err.group.create-group.2"})),a.abrupt("break",30);case 23:return r(Object(_.a)("TOAST",{},{id:"redux.err.group.create-group.3"})),a.abrupt("break",30);case 25:return console.log(a.t0),r(Object(_.a)("TOAST",{},{id:"redux.err.group.create-group.4"})),a.abrupt("break",30);case 28:return r(Object(_.a)("TOAST",{},{id:"redux.err.generic"})),a.abrupt("return",!1);case 30:return a.abrupt("return",!1);case 31:case"end":return a.stop()}}),a,null,[[2,14]])})));return function(e,t){return a.apply(this,arguments)}}()},ge=function(e){return function(){var t=Object(O.a)(h.a.mark((function t(n,a){var r,c,s,o;return h.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:e.err&&(r=a().groups,c=r.errMsgs[e.groupId]?r.errMsgs[e.groupId]:[],s=c.map((function(e){return JSON.stringify(e)})),(o=s.indexOf(JSON.stringify(e)))>-1&&c.splice(o,1),n({type:Z.e,errMsgs:Object(d.a)(Object(d.a)({},r.errMsgs),{},Object(D.a)({},e.groupId,c))}));case 1:case"end":return t.stop()}}),t)})));return function(e,n){return t.apply(this,arguments)}}()},he=function(e){return function(){var t=Object(O.a)(h.a.mark((function t(n,a,r){var c,s,o,i;return h.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return c=r.callZome,s=e.map((function(e){return Object(v.a)(e)})),t.prev=2,t.next=5,c({zomeName:y.c.GROUP,fnName:y.a[y.c.GROUP].GET_FILES_BYTES,payload:s});case 5:return o=t.sent,i=a().groups.groupFiles,n(ve(Object(d.a)(Object(d.a)({},i),o))),t.abrupt("return",o);case 11:if(t.prev=11,t.t0=t.catch(2),!t.t0.message.includes("The file bytes were not found")){t.next=17;break}return t.abrupt("return",n(Object(_.a)("TOAST",{},{id:"redux.err.group.set-files-bytes.1"})));case 17:return t.abrupt("return",n(Object(_.a)("TOAST",{},{id:"redux.err.generic"})));case 18:case"end":return t.stop()}}),t,null,[[2,11]])})));return function(e,n,a){return t.apply(this,arguments)}}()},ve=function(e){return function(){var t=Object(O.a)(h.a.mark((function t(n,a){var r;return h.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:r=a().groups.groupFiles,n({type:Z.f,filesBytes:Object(d.a)(Object(d.a)({},r),e)});case 2:case"end":return t.stop()}}),t)})));return function(e,n){return t.apply(this,arguments)}}()},ye=function(e){return function(){var t=Object(O.a)(h.a.mark((function t(n,a,r){var c,s,o,i,u,l,p,b;return h.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(c=r.callZome,s=a(),s.groups.conversations[e.groupId].name!==e.name){t.next=5;break}return t.abrupt("return",n(Object(_.a)("TOAST",{},{id:"redux.err.group.update-group-name.1"})));case 5:return o={name:e.name,groupId:Object(v.a)(e.groupId),groupRevisionId:Object(v.a)(e.groupRevisionId)},t.prev=6,t.next=9,c({zomeName:y.c.GROUP,fnName:y.a[y.c.GROUP].UPDATE_GROUP_NAME,payload:o});case 9:return i=t.sent,u={name:i.name,groupId:Object(v.b)(i.groupId),groupRevisionId:Object(v.b)(i.groupRevisionId)},l=u.groupId,(p=s.groups.conversations[l]).name=u.name,b=s.groups.conversations,b=Object(d.a)(Object(d.a)({},b),{},Object(D.a)({},l,p)),n({type:Z.m,conversations:b}),t.abrupt("return",e);case 20:t.prev=20,t.t0=t.catch(6),t.t1=!0,t.next=t.t1===t.t0.message.includes("failed to get the given group id")?25:t.t1===t.t0.message.includes("the group name must be 1 to 50 characters length")?26:t.t1===t.t0.message.includes("cannot update a group entry if you are not the group creator (admin)")?27:28;break;case 25:return t.abrupt("return",n(Object(_.a)("TOAST",{},{id:"redux.err.group.update-group-name.2"})));case 26:return t.abrupt("return",n(Object(_.a)("TOAST",{},{id:"redux.err.group.update-group-name.3"})));case 27:return t.abrupt("return",n(Object(_.a)("TOAST",{},{id:"redux.err.group.update-group-name.4"})));case 28:return t.abrupt("return",n(Object(_.a)("TOAST",{},{id:"redux.err.generic"})));case 29:case"end":return t.stop()}}),t,null,[[6,20]])})));return function(e,n,a){return t.apply(this,arguments)}}()},xe=n(29),_e=function(e){return function(){var t=Object(O.a)(h.a.mark((function t(n,a,r){var c,s,o,i;return h.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return c=r.callZome,s=e.map((function(e){return Object(v.a)(e)})),t.prev=2,t.next=5,c({zomeName:y.c.P2PMESSAGE,fnName:y.a[y.c.P2PMESSAGE].GET_FILE_BYTES,payload:s});case 5:if(o=t.sent,i={},"error"===(null===o||void 0===o?void 0:o.type)){t.next=11;break}return Object.keys(o).forEach((function(e){i[e]=o[e]})),Object.entries(i).length>0&&n({type:xe.c,state:i}),t.abrupt("return",i);case 11:t.next=16;break;case 13:t.prev=13,t.t0=t.catch(2),n(Object(_.a)("TOAST",{},{id:"redux.err.generic"}));case 16:case"end":return t.stop()}}),t,null,[[2,13]])})));return function(e,n,a){return t.apply(this,arguments)}}()},Ee=n(91),Te=n.n(Ee),Se=function(e){var t=e.file,n=e.onDownload,a=e.darken,r=void 0!==a&&a,c=e.err,s=t.fileName,i=t.fileSize,l=Object(p.c)((function(e){return Object.assign({},e.groups.groupFiles,e.p2pmessages.files)[t.fileHash]}));return Object(f.jsx)(o.p,{children:Object(f.jsxs)(o.M,{onClick:c?function(){return null}:n?function(){return n(t)}:function(){if(l){var e=new Blob([l]),n=document.createElement("a");n.href=window.URL.createObjectURL(e),n.download=t.fileName,n.click()}},className:"ion-align-items-center ".concat(Te.a.file),children:[Object(f.jsx)("div",{className:"ion-padding-end",children:Object(f.jsx)(o.r,{className:Te.a[r?"file-icon-dark":"file-icon-light"],size:"small",icon:u.x})}),Object(f.jsxs)("div",{className:"ion-align-items-center",children:[Object(f.jsx)(o.M,{children:Object(f.jsx)(o.z,{className:"".concat(Te.a["file-name"]),children:Object(f.jsx)("p",{className:"ion-no-margin ion-text-wrap",children:s})})}),Object(f.jsx)(o.M,{children:Object(f.jsx)(o.Z,{className:Te.a["file-size"],children:Object(f.jsx)("span",{children:Object(x.b)(i)})})})]})]})})},Ne=n(110),we=n.n(Ne),Ie=function(e){var t=e.state,n=e.src,r=e.file,c=e.onDownload,s=Object(l.a)(),d=Object(i.a)(t,2),b=d[0],j=d[1],m=Object(a.useRef)(null),O=Object(a.useRef)(null),g=Object(a.useState)("0px"),h=Object(i.a)(g,2),v=h[0],y=h[1],x=Object(a.useState)({isOpen:!1,event:void 0}),_=Object(i.a)(x,2),E=_[0],T=_[1],S=Object(p.c)((function(e){return Object.assign({},e.groups.groupFiles,e.p2pmessages.files)[r.fileHash]}));Object(a.useEffect)((function(){b&&y(m.current&&O.current?"calc(100vh - ".concat(m.current.getBoundingClientRect().height,"px - ").concat(O.current.getBoundingClientRect().height,"px)"):"0px")}),[b]);return Object(f.jsx)(o.F,{isOpen:b,cssClass:"fullscreen",children:Object(f.jsxs)(o.H,{children:[Object(f.jsx)(o.q,{children:Object(f.jsxs)(o.fb,{className:we.a.toolbar,ref:O,children:[Object(f.jsx)(o.f,{children:Object(f.jsx)(o.e,{onClick:function(){return j(!1)},children:Object(f.jsx)(o.r,{icon:u.c})})}),Object(f.jsx)(o.f,{slot:"end",children:Object(f.jsx)(o.e,{onClick:function(e){e.persist(),T({isOpen:!0,event:e})},children:Object(f.jsx)(o.r,{icon:u.B})})})]})}),Object(f.jsx)("div",{className:we.a.content,style:{height:v},children:Object(f.jsx)("img",{style:Object(D.a)({},window.innerWidth>window.innerHeight?"height":"width","100%"),alt:"Message content",src:n})}),Object(f.jsx)(o.I,{event:E.event,isOpen:E.isOpen,onDidDismiss:function(){return T({isOpen:!1,event:void 0})},children:Object(f.jsx)(o.A,{children:Object(f.jsx)(o.w,{lines:"none",button:!0,onClick:c?function(){return c(r)}:function(){if(S){var e=new Blob([S]),t=document.createElement("a");t.href=window.URL.createObjectURL(e),t.download=r.fileName,t.click(),T({isOpen:!1,event:void 0})}},children:Object(f.jsx)(o.z,{children:s.formatMessage({id:"components.chat.media-modal-download"})})})})}),Object(f.jsx)(o.o,{children:Object(f.jsx)(o.fb,{className:we.a.toolbar,ref:m})})]})})},ke=n(156),Me=n.n(ke),Re=function(e){var t=e.src,n=e.file,r=e.className,c=e.onDownload,s=e.err,u=Object(a.useState)(!1),l=Object(i.a)(u,2),p=l[0],d=l[1],b=Object(a.useRef)(null),j=Object(a.useState)("auto"),m=Object(i.a)(j,2),O=m[0],g=m[1];return Object(f.jsxs)(f.Fragment,{children:[Object(f.jsx)(Ie,{onDownload:c,state:[p,d],src:t,file:n}),Object(f.jsx)("div",{ref:b,className:"".concat(Me.a.image," ").concat(r||""),style:{maxHeight:O},children:Object(f.jsx)(o.s,{onIonImgDidLoad:function(){return g("".concat(1.25*b.current.getBoundingClientRect().width,"px"))},onClick:function(){s||d(!0)},src:t})})]})},Pe=n(26),Ce=n(78),Ae=n.n(Ce),Ge=function(e){var t=e.video,n=e.isPlaying,r=e.duration,c=e.modal,s=e.hasError,l=e.onPlayPauseErrorHandler,p=Object(a.useState)(Object(Pe.e)("mobile")),d=Object(i.a)(p,2),b=d[0],j=d[1],m=Object(i.a)(c,2),O=m[0],g=m[1],h=Object(a.useRef)(),v=Object(a.useState)(!1),y=Object(i.a)(v,2),x=y[0],_=y[1];Object(a.useEffect)((function(){s||_(!1)}),[s]);var E=function(){h.current&&clearTimeout(h.current),h.current=setTimeout((function(){j(!1)}),1e3)},T=function(){g(!O)},S=function(){var e,a;s?(_(!0),l&&l()):n?null===(a=t.current)||void 0===a||a.pause():null===(e=t.current)||void 0===e||e.play()};return Object(f.jsxs)("div",{onMouseEnter:function(){j(!0),h.current&&clearTimeout(h.current)},onMouseLeave:E,onClick:function(){j(!0),E()},onDoubleClick:T,className:Ae.a.controls,style:{opacity:b?1:0},children:[Object(f.jsx)("div",{className:Ae.a["play-pause"],onClick:S,onTouchEnd:S,children:x?Object(f.jsx)(o.U,{}):Object(f.jsx)(o.r,{icon:s?n?u.J:u.z:n?u.J:u.T})}),Object(f.jsxs)("div",{className:Ae.a["range-slider-expand"],children:[Object(f.jsx)("div",{className:Ae.a["range-slider"],children:Object(f.jsx)("input",{type:"range",onChange:function(){},value:100*r,min:0,max:100})}),Object(f.jsx)("div",{className:Ae.a.expand,children:Object(f.jsx)(o.r,{onClick:T,onTouchEnd:T,icon:u.C})})]})]})},Le=n(124),De=n.n(Le),He=n(79),ze=n.n(He),Ue=function(e){var t=e.open,n=e.src,r=e.download,c=e.onPlayPauseErrorHandler,s=Object(l.a)(),p=Object(i.a)(t,2),d=p[0],b=p[1],j=Object(a.useState)({isOpen:!1,event:void 0}),m=Object(i.a)(j,2),O=m[0],g=m[1],h=Object(a.useRef)(null),v=Object(a.useRef)(null),y=Object(a.useState)("0px"),x=Object(i.a)(y,2),_=x[0],E=x[1],T=Object(a.useState)(0),S=Object(i.a)(T,2),N=S[0],w=S[1],I=Object(a.useState)(!1),k=Object(i.a)(I,2),M=k[0],R=k[1],P=Object(a.useState)(!1),C=Object(i.a)(P,2),A=C[0],G=C[1],L=Object(a.useRef)(),H=Object(a.useState)(!1),z=Object(i.a)(H,2),U=z[0],F=z[1],B=Object(a.useRef)(null),Z=Object(a.useState)(!1),V=Object(i.a)(Z,2),Y=V[0],X=V[1];Object(a.useEffect)((function(){d&&E(h.current&&v.current?"calc(100vh - ".concat(h.current.getBoundingClientRect().height,"px - ").concat(v.current.getBoundingClientRect().height,"px)"):"0px")}),[d]),Object(a.useEffect)((function(){U||X(!1)}),[U]);var J=function(){c&&c(F)};return Object(f.jsx)(o.F,{isOpen:d,cssClass:"fullscreen",children:Object(f.jsxs)(o.H,{children:[Object(f.jsx)(o.q,{children:Object(f.jsxs)(o.fb,{ref:v,className:ze.a.toolbar,children:[Object(f.jsx)(o.f,{children:Object(f.jsx)(o.e,{onTouchEnd:function(){G(!1),b(!1)},onClick:function(){G(!1),b(!1)},children:Object(f.jsx)(o.r,{icon:u.c})})}),Object(f.jsx)(o.f,{slot:"end",children:Object(f.jsx)(o.e,{onTouchEnd:function(e){e.persist(),g({isOpen:!0,event:e})},onClick:function(e){e.persist(),g({isOpen:!0,event:e})},children:Object(f.jsx)(o.r,{icon:u.B})})})]})}),Object(f.jsxs)("div",{className:ze.a.content,style:{height:_},onClick:function(){R(!0),L.current&&clearTimeout(L.current),L.current=setTimeout((function(){R(!1)}),3e3)},children:[Object(f.jsx)("video",{ref:B,style:Object(D.a)({},window.innerWidth>window.innerHeight?"height":"width","100%"),onError:function(){F(!0)},autoPlay:!1,controls:!1,onTimeUpdate:function(){return w(B.current.currentTime/B.current.duration)},onPlay:function(){G(!0)},onPause:function(){G(!1)},loop:!1,src:n}),B.current?Object(f.jsx)("div",{style:{opacity:M?1:0},className:ze.a["modal-control"],children:Y?Object(f.jsx)(o.U,{}):Object(f.jsx)("div",{className:ze.a["play-pause"],onClick:function(){var e,t;U?(X(!0),c&&J()):A?null===(t=B.current)||void 0===t||t.pause():null===(e=B.current)||void 0===e||e.play()},children:Object(f.jsx)(o.r,{icon:A?u.J:u.T})})}):null]}),Object(f.jsx)(o.o,{children:Object(f.jsx)(o.fb,{ref:h,children:Object(f.jsx)("div",{className:ze.a["slider-volume"],children:Object(f.jsx)("input",{step:100*N,value:100*N,min:0,max:100,type:"range"})})})}),Object(f.jsx)(o.I,{event:O.event,isOpen:O.isOpen,onDidDismiss:function(){return g({isOpen:!1,event:void 0})},children:Object(f.jsx)(o.A,{children:r?Object(f.jsx)(o.w,{lines:"none",button:!0,onClick:function(){r(),g({isOpen:!1,event:void 0})},children:Object(f.jsx)(o.z,{children:s.formatMessage({id:"components.chat.media-modal-download"})})}):null})})]})})},Fe=function(e){var t=e.src,n=e.className,r=e.thumbnail,c=e.download,s=e.onPlayPauseErrorHandler,o=e.err,u=[De.a["video-player"]];n&&u.push(n);var l=Object(a.useRef)(null),p=Object(a.useState)(!1),d=Object(i.a)(p,2),b=d[0],j=d[1],m=Object(a.useState)(0),O=Object(i.a)(m,2),g=O[0],h=O[1],v=Object(a.useState)(!1),y=Object(i.a)(v,2),x=y[0],_=y[1],E=Object(a.useState)(!1),T=Object(i.a)(E,2),S=T[0],N=T[1],w=Object(a.useRef)(null);return Object(f.jsxs)("div",{ref:w,className:u.join(" "),onDoubleClick:function(){j(!1),_(!0)},children:[Object(f.jsx)("video",{className:De.a.video,onTimeUpdate:function(){return h(isNaN(l.current.currentTime/l.current.duration)?0:l.current.currentTime/l.current.duration)},poster:r,onPlay:function(){j(!0)},onPause:function(){j(!1)},ref:l,controls:!1,loop:!1,autoPlay:!1,src:t,onError:function(e){return N(!0)}}),o?null:Object(f.jsx)(Ge,{isPlaying:b,hasError:S,onPlayPauseErrorHandler:function(){s&&s(N)},duration:g,video:l,modal:[x,_]}),Object(f.jsx)(Ue,{download:c,onPlayPauseErrorHandler:s,src:t,open:[x,_]})]})},Be=n(125),Ze=n.n(Be),Ve=function(e){var t=e.file,n=e.onDownload,r=e.onPlayPauseErrorHandler,c=e.err,s=Object(p.c)((function(e){return Object.assign({},e.groups.groupFiles,e.p2pmessages.files)[t.fileHash]})),o=function(){if(s){var e=new Blob([s]),n=document.createElement("a");n.href=window.URL.createObjectURL(e),n.download=t.fileName,n.click()}},i=Object(a.useMemo)((function(){return Object(f.jsx)(Fe,{download:c?function(){return null}:n?function(){return n(t)}:o,src:URL.createObjectURL(new Blob([s],{type:"video/mp4"})),className:Ze.a.video,thumbnail:URL.createObjectURL(new Blob([t.thumbnail],{type:"image/jpeg"})),onPlayPauseErrorHandler:r,err:c})}),[s]);return Object(f.jsx)("div",{className:Ze.a.video,children:i})},Ye=function(e){e.timestamp;var t=e.file,n=(e.type,e.onDownload),a=e.chatType,r=e.err,c=new TextDecoder("utf-8"),s=Object(x.l)();return function(){switch(null===t||void 0===t?void 0:t.fileType){case"IMAGE":return Object(f.jsx)(Re,{onDownload:n,file:t,src:c.decode(t.thumbnail),err:r});case"OTHER":return Object(f.jsx)(Se,{onDownload:n,file:t,err:r});case"VIDEO":return Object(f.jsx)(Ve,{onDownload:n,file:t,onPlayPauseErrorHandler:function(e){"p2p"===a?s(_e([t.fileHash])).then((function(t){t&&e(!1)})):s(he([t.fileHash])).then((function(t){t&&e(!1)}))},err:r});default:return null}}()},Xe=n(65),Je=n.n(Xe),qe=function(e){var t,n,a,r,c,s,i,l=e.me,p=e.message,d=Object(x.g)(null===p||void 0===p?void 0:p.payload),b=new TextDecoder,j=["".concat(Je.a["reply-to"])];return Object(f.jsxs)("div",{className:j.join(" "),children:[Object(f.jsx)("div",{className:"".concat(l?Je.a["vertical-divider-me"]:Je.a["vertical-divider-others"]," ion-margin-end")}),d?null:"OTHER"===(null===(t=p.payload)||void 0===t?void 0:t.fileType)?Object(f.jsx)(o.r,{className:"ion-margin-end",icon:u.x}):Object(f.jsx)(o.bb,{className:"".concat(Je.a.thumbnail," ion-margin-end"),children:Object(f.jsx)("img",{alt:"Thumbnail",src:"VIDEO"===(null===p||void 0===p||null===(n=p.payload)||void 0===n?void 0:n.fileType)?URL.createObjectURL(new Blob([null===(a=p.payload)||void 0===a?void 0:a.thumbnail])):b.decode(null===p||void 0===p||null===(r=p.payload)||void 0===r?void 0:r.thumbnail)})}),Object(f.jsxs)("div",{className:"".concat(l?Je.a["content-me"]:Je.a["content-others"]),children:[Object(f.jsx)(o.z,{children:null===p||void 0===p?void 0:p.author.username}),Object(f.jsx)("p",{className:Je.a["sub-label"],children:d?null===p||void 0===p||null===(c=p.payload)||void 0===c||null===(s=c.payload)||void 0===s?void 0:s.payload:null===p||void 0===p||null===(i=p.payload)||void 0===i?void 0:i.fileName})]})]})},Ke=n(34),We=n.n(Ke),Qe=n(157),$e=n.n(Qe),et=function(e){var t=e.message,n=e.type;return new RegExp("https://media.tenor.com/images/.*/tenor.gif").test(t.payload.payload)?Object(f.jsx)(o.s,{src:t.payload.payload}):Object(f.jsx)(o.Z,{className:$e.a["me"===n?"me":"others"],children:t.payload.payload})},tt=function(e){var t=e.id,n=e.profile,r=e.payload,c=e.timestamp,s=e.replyTo,p=e.onReply,b=e.onDelete,j=e.onPinMessage,O=e.isPinned,g=e.type,h=e.showProfilePicture,v=e.isSeen,y=void 0!==v&&v,_=e.onDownload,E=e.onRetry,T=e.err,S=Object(l.a)(),N=Object(a.useState)(!1),w=Object(i.a)(N,2),I=w[0],k=w[1],M=function(e){return A({event:e.nativeEvent})},R=Object(o.rb)(ne,{onHide:function(){return G()},onPin:j,onReply:function(){p&&p({author:n.username,payload:r,id:t})},onDelete:function(){b&&b()},onRetry:function(){E&&E(k)},isPinned:O,intl:S,err:T}),P=Object(i.a)(R,2),A=P[0],G=P[1],L=Object(x.m)(M,(function(){})),D=Object(z.d)(r),H="p2p"===g,U=D?"":Object(o.ob)("desktop")?We.a["max-file"]:"";return Object(f.jsxs)(f.Fragment,{children:[Object(f.jsxs)(o.w,Object(d.a)(Object(d.a)({lines:"none",className:"".concat(We.a["me-container"]," ").concat(U),onClick:function(e){return T?M(e):null}},L),{},{children:[Object(f.jsxs)("div",{className:"".concat(We.a.me," ").concat(We.a[D?"text":"file"]," ").concat(We.a.bubble),children:[s?Object(f.jsx)(qe,{me:!0,message:s}):null,D?Object(f.jsx)(et,{type:"me",message:r}):Object(f.jsx)(Ye,{chatType:H?"p2p":"group",onDownload:_,type:"me",timestamp:c,file:r,err:T}),Object(f.jsx)(o.Z,{children:Object(f.jsxs)("h6",{className:"ion-no-margin ion-text-end",children:[S.formatTime(c),Object(f.jsx)(o.r,{size:"medium",icon:y?u.m:T&&"error message"!==t?u.U:u.l})]})})]}),T&&"error message"===t?I?Object(f.jsx)("div",{className:We.a.picture,children:Object(f.jsx)(m,{})}):Object(f.jsx)(o.r,{color:"danger",className:We.a.picture,style:{marginLeft:"0.5rem"},icon:u.b}):H?null:Object(f.jsx)("div",{className:We.a.picture,style:{marginLeft:"0.5rem"},children:h?n.fields.avatar?Object(f.jsx)(o.b,{className:We.a["avatar-container"],children:Object(f.jsx)("img",{src:n.fields.avatar,alt:"avatar"})}):Object(f.jsx)(C,{hash:n.id,size:35}):null})]})),T&&"error message"===t?I?null:Object(f.jsx)(o.w,{lines:"none",className:We.a["not-delivered-container"],children:Object(f.jsx)(o.Z,{className:We.a["not-delivered"],color:"danger",children:"Not delivered"})}):null]})},nt=function(e){var t=e.timestamp,n=e.onSeen,r=Object(l.a)(),c=Object(a.useRef)(),s=Object(a.useRef)(null),u={root:document.querySelector(".chat-list"),rootMargin:"0px",threshold:1},p=Object(a.useState)(!1),d=Object(i.a)(p,2),b=d[0],j=d[1];Object(a.useEffect)((function(){var e,t;null===(e=c.current)||void 0===e||e.disconnect(),c.current=new IntersectionObserver((function(){n&&(b||(j(!0),n(m)))}),u),s.current&&(null===(t=c.current)||void 0===t||t.observe(s.current))}),[b,s.current]);var m=function(){b&&j(!1)};return Object(f.jsx)(o.Z,{ref:s,children:Object(f.jsx)("h6",{className:"ion-no-margin ion-text-end",children:r.formatTime(t)})})},at=function(e){var t=e.id,n=e.profile,a=e.type,r=e.timestamp,c=e.payload,s=(e.readList,e.onSeen),u=e.showProfilePicture,p=e.showName,b=e.onReply,j=e.isPinned,m=e.onPinMessage,O=e.replyTo,g=(e.isSeen,e.onDownload),h=Object(l.a)(),v=Object(o.rb)(ne,{onHide:function(){return E()},onPin:m,onReply:function(){b&&b({author:n.username,payload:c,id:t})},isPinned:j,intl:h}),y=Object(i.a)(v,2),_=y[0],E=y[1],T=Object(x.m)((function(e){_({event:e.nativeEvent})}),(function(){})),S=Object(z.d)(c),N="p2p"===a,w=S?"":Object(o.ob)("desktop")?We.a["max-file"]:"";return Object(f.jsxs)(f.Fragment,{children:[N?null:p?Object(f.jsx)(o.w,{lines:"none",className:"".concat(We.a["author-name"]),children:Object(f.jsx)(o.Z,{color:"medium",children:n.username})}):null,Object(f.jsxs)(o.w,Object(d.a)(Object(d.a)({lines:"none",className:"".concat(We.a["others-container"]," ").concat(w)},T),{},{children:[N?null:Object(f.jsx)("div",{className:We.a.picture,style:{marginRight:"0.5rem"},children:u?n.fields.avatar?Object(f.jsx)(o.b,{className:We.a["avatar-container"],children:Object(f.jsx)("img",{src:n.fields.avatar,alt:"avatar"})}):Object(f.jsx)(C,{hash:n.id,size:35}):null}),Object(f.jsxs)("div",{className:"".concat(We.a.others," ").concat(We.a[S?"text":"file"]," ").concat(We.a.bubble),children:[O?Object(f.jsx)(qe,{me:!1,message:O}):null,S?Object(f.jsx)(et,{type:"others",message:c}):Object(f.jsx)(Ye,{chatType:N?"p2p":"group",onDownload:g,type:"others",file:c,timestamp:r}),Object(f.jsx)(nt,{onSeen:s,timestamp:r})]})]}))]})},rt={ChatList:$,Me:tt,Others:at},ct=rt,st=n(126),ot=n.n(st),it=function(e){var t=e.profiles,n=(e.disabled,Object(l.a)()),a=function(e){switch(e.length){case 0:return null;case 1:return", ".concat(e[0].username);default:return Object(f.jsxs)("span",{children:[", ",e.length," others "]})}};return t.length>0?Object(f.jsxs)("div",{className:"".concat(ot.a.typing," ion-padding-start"),children:[function(e){if(1===e.length)return Object(f.jsx)("span",{children:n.formatMessage({id:"components.typing.is-typing"},{user:e[0].username})});var t="".concat(e.slice(0,2).map((function(e){return e.username})).join(", ")),r=e.slice(2,e.length);return Object(f.jsxs)("span",{children:[t,a(r)," are typing"]})}(t),[".",".","."].map((function(e,t){return Object(f.jsx)("span",{style:{animationDelay:"".concat(.3*t,"s")},className:ot.a.dot,children:e},t)}))]}):null},ut=Object(a.createContext)({showToast:function(){},dismissToast:function(){},showErrorToast:function(){}}),lt=function(){var e=Object(a.useContext)(ut);if(!e)throw new Error("Cannot get toast context :(");return e},pt=function(e){var t=e.message,n=e.files,a=e.onSend,r=e.loading;return Object(f.jsx)(o.f,{slot:"end",children:Object(f.jsx)(o.e,{type:"submit",onClick:a,disabled:0===t.length&&0===n.length,children:r?Object(f.jsx)(m,{}):Object(f.jsx)(o.r,{color:"medium",icon:u.cb})})})},dt=n(127),bt=n.n(dt),jt=function(e){var t=e.file,n=e.files,r=e.setFiles,c=function(e){t.value="",r((function(t){return t.splice(e,1),Object(q.a)(t)}))},s=new TextDecoder;return Object(f.jsx)(o.M,{className:bt.a.row,children:n.map((function(e,t){return Object(a.createElement)(o.i,Object(d.a)(Object(d.a)({},"IMAGE"===e.fileType.type||"VIDEO"===e.fileType.type?{style:{backgroundImage:"url(".concat((n=e.fileType.type,r=e.fileType.payload.thumbnail,"IMAGE"===n?s.decode(r):URL.createObjectURL(new Blob([r],{type:"image/jpeg"}))),")"),backgroundRepeat:"no-repeat",backgroundPosition:"center",backgroundSize:"cover"}}:{}),{},{className:bt.a.chip,key:t}),"IMAGE"===e.fileType.type||"VIDEO"===e.fileType.type?null:Object(f.jsx)(o.z,{children:e.metadata.fileName}),Object(f.jsx)(o.r,{icon:u.t,onClick:function(){return c(t)}}));var n,r}))})},ft=n(42),mt=n.n(ft),Ot=function(e){var t=e.messageState,n=Object(i.a)(t,2),a=n[0],r=n[1];return Object(f.jsxs)("div",{className:"ion-padding-start ion-padding-end ".concat(mt.a.row," ").concat(mt.a.reply),children:[Object(f.jsx)(o.r,{icon:u.u,onClick:function(){r(null)}}),function(){if("TEXT"===a.payload.type)return Object(f.jsxs)("div",{className:"".concat(mt.a.column," ion-padding-start"),children:[Object(f.jsx)("span",{className:mt.a.author,children:a.author}),Object(f.jsx)("span",{className:mt.a.text,children:a.payload.payload.payload})]});switch(a.payload.fileType){case"OTHER":return Object(f.jsxs)("div",{className:"".concat(mt.a.row," ion-padding-start"),children:[Object(f.jsx)(o.r,{icon:u.y}),Object(f.jsxs)("div",{className:"".concat(mt.a.column," ion-padding-start"),children:[Object(f.jsx)("span",{className:mt.a.author,children:a.author}),Object(f.jsx)("span",{className:mt.a.text,children:a.payload.fileName})]})]});case"IMAGE":case"VIDEO":var e,t=new TextDecoder;return Object(f.jsx)("div",{children:Object(f.jsxs)("div",{className:"".concat(mt.a.row," ion-padding-start"),children:[Object(f.jsx)(o.bb,{className:mt.a.thumbnail,children:Object(f.jsx)("img",{alt:"Thumbnail",src:"VIDEO"===(null===(e=a.payload)||void 0===e?void 0:e.fileType)?URL.createObjectURL(new Blob([a.payload.thumbnail])):t.decode(a.payload.thumbnail)})}),Object(f.jsxs)("div",{className:"".concat(mt.a.column," ion-padding-start"),children:[Object(f.jsx)("span",{className:mt.a.author,children:a.author}),Object(f.jsx)("span",{className:mt.a.text,children:a.payload.fileName})]})]})});default:return null}}()]})},gt=n(71),ht=function(e,t){return function(n,a){var r="en"===a().language.language?"en_US":"ja_JP";return new Promise((function(a,c){var s="https://g.tenor.com/v1"+(void 0===e?"/trending?":"/search?q="+e+"&")+"key=9QL1R5ZGUNGM&locale="+r+"&limit=20";t&&(s=s+"&pos="+t);var o=new XMLHttpRequest;o.open("GET",s,!0),o.onload=function(){if(4===o.readyState&&200===o.status){var e=JSON.parse(o.responseText),t=e.results,r={gifs:t,next:e.next};n((s=t,function(){var e=Object(O.a)(h.a.mark((function e(t,n){return h.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t({type:gt.b,state:s}),e.abrupt("return");case 2:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}())),a(r)}else c({});var s},o.onerror=function(){c({})},o.send(null)}))}},vt=function(){return function(e,t){var n="en"===t().language.language?"en_US":"ja_JP";return new Promise((function(t,a){var r="https://g.tenor.com/v1/categories?key=9QL1R5ZGUNGM&locale="+n,c=new XMLHttpRequest;c.open("GET",r,!0),c.onload=function(){if(4===c.readyState&&200===c.status){var n=JSON.parse(c.responseText).tags,r={top:n};e((s=n,function(){var e=Object(O.a)(h.a.mark((function e(t,n){return h.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t({type:gt.a,state:s}),e.abrupt("return");case 2:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}())),t(r)}else a({});var s},c.onerror=function(){a({})},c.send(null)}))}},yt=n(54),xt=n.n(yt),_t=function(e){e.onSend,e.onChange;var t=e.onSelect,n=Object(x.l)(),r=Object(a.useState)(""),c=Object(i.a)(r,2),s=c[0],l=c[1],p=Object(a.useState)(""),b=Object(i.a)(p,2),j=b[0],g=b[1],v=Object(a.useState)([]),y=Object(i.a)(v,2),_=y[0],E=y[1],T=Object(a.useState)(!0),S=Object(i.a)(T,2),N=S[0],w=S[1],I=Object(a.useState)([]),k=Object(i.a)(I,2),M=k[0],R=k[1],P=Object(a.useState)(void 0),C=Object(i.a)(P,2),A=C[0],G=C[1],L=Object(a.useState)(!1),D=Object(i.a)(L,2),H=D[0],z=D[1],U=function(){return l("")},F=Object(a.useCallback)((function(){t&&t(j)}),[j]);Object(a.useEffect)((function(){n(vt()).then((function(e){E(e.top)})),n(ht(s)).then((function(e){R(e.gifs),G(e.next)})),n(function(){var e=Object(O.a)(h.a.mark((function e(t,n){var a;return h.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=Object(d.a)({},n().gif.gifs),e.abrupt("return",a);case 2:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}()).then((function(e){return R(e)}))}),[s]),Object(a.useEffect)((function(){return F()}),[j,F]);var B=Object(a.useRef)(null),Z=function(){var e;return null===(e=B.current)||void 0===e?void 0:e.complete()};return Object(f.jsxs)(o.g,{className:xt.a.keyboardcontainer,children:[Object(f.jsxs)(o.h,{className:xt.a.header,children:[N?null:Object(f.jsx)(o.e,{onClick:function(){w(!0),U()},fill:"clear",children:Object(f.jsx)(o.r,{icon:u.c})}),Object(f.jsx)(o.N,{value:s,onIonChange:function(e){return l(e.detail.value)},debounce:2e3}),Object(f.jsx)(o.e,{onClick:function(){z(!H)},fill:"clear",children:Object(f.jsx)(o.r,{icon:H?u.p:u.r})})]}),Object(f.jsx)(o.k,{className:H?xt.a.gifcontainerexpanded:xt.a.gifcontainer,children:M&&Object.values(M).length>0?Object(f.jsxs)("div",{className:xt.a.images,children:[N&&""===s?Object.values(_).map((function(e){return Object(f.jsxs)("div",{children:[Object(f.jsx)("div",{className:xt.a.textholder,onClick:function(){return t=e.searchterm,l(t),n(ht(s)).then((function(e){R(e.gifs),G(e.next)})),void w(!1);var t},children:Object(f.jsx)(o.Z,{className:xt.a.categorytext,children:e.name.replace("#","").toUpperCase()})}),Object(f.jsx)("img",{className:xt.a.categorypreview,src:e.image})]},e.name)})):Object.values(M).map((function(e){return Object(f.jsx)("div",{children:Object(f.jsx)("img",{className:xt.a.gifpreview,onClick:function(){return t=e.media[0].gif.url,g(t),void U();var t},alt:e.title,src:e.media[0].tinygif.preview?e.media[0].nanogif.url:e.media[0].gif.preview})},e.media[0].nanogif.url)})),Object(f.jsx)(o.t,{ref:B,position:"bottom",threshold:"0px",onIonInfinite:function(e){return function(e){n(ht(s,A)).then((function(e){R(M?[].concat(Object(q.a)(M),Object(q.a)(e.gifs)):e.gifs),G(e.next)})),e()}(Z)},children:Object(f.jsx)(o.u,{loadingSpinner:"circles"})})]}):Object(f.jsx)(m,{})})]})},Et=n(128),Tt=n.n(Et),St=function(e,t){var n=e.onChange,r=e.onSend,c=e.onFileSelect,s=Object(a.useState)(""),p=Object(i.a)(s,2),d=p[0],b=p[1],j=Object(l.a)(),m=Object(a.useState)(void 0),O=Object(i.a)(m,2),g=O[0],h=O[1],v=Object(a.useState)(!1),y=Object(i.a)(v,2),x=y[0],_=y[1],E=Object(a.useRef)(null),T=Object(a.useState)([]),S=Object(i.a)(T,2),N=S[0],w=S[1],I=Object(a.useState)(""),k=Object(i.a)(I,2),M=k[0],R=k[1],P=Object(a.useState)(!1),C=Object(i.a)(P,2),A=C[0],G=C[1],L=Object(a.useCallback)((function(){c&&c(N)}),[N]);Object(a.useImperativeHandle)(t,(function(){return{reply:function(e){h(e)}}}));var D=Object(a.useCallback)((function(){n&&n(d)}),[d]),H=Object(a.useCallback)((function(){r&&""!==M&&(r({message:M,setIsLoading:_}),G(!A),z())}),[M]),z=function(){h(void 0),b(""),w([]),E.current&&(E.current.value="")},U=function(e){r&&"Enter"===e.key&&!e.shiftKey&&(0!==d.trim().length||N.length>0)&&(r({files:N,message:d,reply:null===g||void 0===g?void 0:g.id,setIsLoading:_}),z())};Object(a.useEffect)((function(){return document.addEventListener("keydown",U),function(){document.removeEventListener("keydown",U)}}),[r,z]),Object(a.useEffect)((function(){return L()}),[N,L]),Object(a.useEffect)((function(){return D()}),[d,D]),Object(a.useEffect)((function(){return H()}),[M,H]);var F=lt().showToast,B=Object(a.useMemo)((function(){return N.length>0?Object(f.jsx)(jt,{file:E.current,files:N,setFiles:w}):null}),[N]);return Object(f.jsxs)(f.Fragment,{children:[Object(f.jsxs)(o.o,{children:[A?Object(f.jsx)(_t,{onSelect:function(e){R(e)}}):null,g?Object(f.jsx)(Ot,{messageState:[g,h]}):null,B,Object(f.jsxs)(o.fb,{className:Tt.a.toolbar,children:[Object(f.jsxs)(o.f,{slot:"start",children:[N.length>0?null:Object(f.jsx)(o.e,{onClick:function(){var e;return null===E||void 0===E||null===(e=E.current)||void 0===e?void 0:e.click()},children:Object(f.jsx)(o.r,{color:"medium",icon:u.g})}),Object(f.jsx)(o.e,{onClick:function(){G(!A)},children:Object(f.jsx)(o.r,{color:"medium",icon:"assets/icon/gif.svg"})})]}),Object(f.jsx)(o.ab,{value:d,onKeyDown:function(e){if("Enter"===e.key&&!e.shiftKey)return e.preventDefault(),!1},className:Tt.a.textarea,onIonChange:function(e){return b(e.detail.value)},autoGrow:!0,placeholder:j.formatMessage({id:"app.new-conversation.message-placeholder"})}),Object(f.jsx)(pt,{files:N,onSend:function(){r&&r({files:N,message:d,reply:null===g||void 0===g?void 0:g.id,setIsLoading:_}),z()},message:d,loading:x})]})]}),Object(f.jsx)("input",{ref:E,type:"file",hidden:!0,onChange:function(){Array.from(E.current?E.current.files:new FileList).forEach((function(e){e.arrayBuffer().then((function(t){var n=e.size,a=e.name;if(n<15728640){var r=new Uint8Array(t),c=function(e){switch(e){case"video/mpeg":case"video/mp4":return"VIDEO";case"image/png":case"image/jpeg":return"IMAGE";default:return"OTHER"}}(e.type);if("IMAGE"===c){var s=new TextEncoder,o=new FileReader;o.readAsDataURL(e),o.onload=function(e){var t,o=s.encode(null===(t=e.target)||void 0===t?void 0:t.result),i={metadata:{fileName:a,fileType:c,fileSize:n},fileType:{type:c,payload:{thumbnail:o}},fileBytes:r};w((function(e){return e.push(i),Object(q.a)(e)}))}}else if("VIDEO"===c){var i=document.createElement("video"),u=URL.createObjectURL(new Blob([r],{type:"video/mp4"})),l=";base64,",p=function(){var e,t=document.createElement("canvas");t.width=i.videoWidth,t.height=i.videoHeight,null===(e=t.getContext("2d"))||void 0===e||e.drawImage(i,0,0,t.width,t.height);var s=t.toDataURL("image/jpeg"),o=s.length>10;if(o){var p,d=document.createElement("img");if(document.getElementsByTagName("div")[0].appendChild(d),URL.revokeObjectURL(u),null===(p=s.split(l)[1])||void 0===p?void 0:p.trim()){for(var b,j=window.atob(null===(b=s.split(l)[1])||void 0===b?void 0:b.trim()),f=new Array(j.length),m=0;m<j.length;m++)f[m]=j.charCodeAt(m);var O=new Uint8Array(f),g={metadata:{fileName:a,fileType:c,fileSize:n},fileType:{type:c,payload:{thumbnail:O}},fileBytes:r};w((function(e){return e.push(g),Object(q.a)(e)}))}}return o};i.src=u,i.addEventListener("timeupdate",(function e(){p()&&(i.removeEventListener("timeupdate",e),i.pause())})),i.preload="metadata",i.muted=!0,i.play()}else{var d={metadata:{fileName:a,fileType:c,fileSize:n},fileType:{type:c},fileBytes:r};w((function(e){return e.push(d),Object(q.a)(e)}))}}else F({message:j.formatMessage({id:"components.message-input.over-size-limit"},{fileName:a}),color:"danger",duration:2500})}))}))}})]})},Nt=Object(a.forwardRef)(St),wt=function(e){return function(){var t=Object(O.a)(h.a.mark((function t(n,a,r){var c,s;return h.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return c=r.callZome,s=a().contacts.contacts,t.prev=2,t.next=5,c({zomeName:y.c.CONTACTS,fnName:y.a[y.c.CONTACTS].ADD_CONTACTS,payload:[Object(v.a)(e.id)]});case 5:return s[e.id]=e,n({type:H.b,contacts:s}),t.abrupt("return",!0);case 10:t.prev=10,t.t0=t.catch(2),t.t0.message.includes("agent already added")?n(Object(_.a)("TOAST",{},{id:"redux.err.contacts.add-contact.1",value:{username:e.username}})):t.t0.message.includes("agent is blocked")&&n(Object(_.a)("TOAST",{},{id:"redux.err.contacts.add-contact.2",value:{username:e.username}}));case 13:return t.abrupt("return",!1);case 14:case"end":return t.stop()}}),t,null,[[2,10]])})));return function(e,n,a){return t.apply(this,arguments)}}()},It=function(e){return function(){var t=Object(O.a)(h.a.mark((function t(n,a,r){var c,s,o,i;return h.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return c=r.callZome,s=a().contacts,o=s.contacts,i=s.blocked,t.prev=2,i[e.id]=e,t.next=6,c({zomeName:y.c.CONTACTS,fnName:y.a[y.c.CONTACTS].BLOCK_CONTACTS,payload:[Object(v.a)(e.id)]});case 6:return delete o[e.id],n({type:H.a,blocked:i}),n({type:H.b,contacts:o}),t.abrupt("return",!0);case 12:t.prev=12,t.t0=t.catch(2),t.t0.message.includes("this agent is already blocked")&&n(Object(_.a)("TOAST",{},{id:"redux.err.contacts.block-contact.1",value:{username:e.username}}));case 15:return t.abrupt("return",!1);case 16:case"end":return t.stop()}}),t,null,[[2,12]])})));return function(e,n,a){return t.apply(this,arguments)}}()},kt=function(){return function(){var e=Object(O.a)(h.a.mark((function e(t,n,a){var r,c,s,o;return h.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=a.callZome,e.prev=1,e.next=4,r({zomeName:y.c.CONTACTS,fnName:y.a[y.c.CONTACTS].LIST_ADDED});case 4:return c=e.sent,s=c.map((function(e){return Object(v.b)(e)})),o={},e.prev=7,e.next=10,r({zomeName:y.c.PROFILES,fnName:y.a[y.c.PROFILES].GET_AGENTS_PROFILES,payload:s});case 10:return e.sent.forEach((function(e){var t=e.agent_pub_key;o[t]={id:t,username:e.profile.nickname,fields:e.profile.fields.avatar?{avatar:Object(x.a)(e.profile.fields.avatar)}:{}}})),t({type:H.b,contacts:o}),e.abrupt("return",o);case 16:e.prev=16,e.t0=e.catch(7),t(Object(_.a)("TOAST",{},{id:"redux.err.contacts.fetch-my-contacts.1"}));case 19:e.next=24;break;case 21:e.prev=21,e.t1=e.catch(1),t(Object(_.a)("TOAST",{},{id:"redux.err.generic"}));case 24:return e.abrupt("return",null);case 25:case"end":return e.stop()}}),e,null,[[1,21],[7,16]])})));return function(t,n,a){return e.apply(this,arguments)}}()},Mt=function(e){return function(){var t=Object(O.a)(h.a.mark((function t(n,a,r){var c,s;return h.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return c=r.callZome,s=a().contacts.contacts,t.prev=2,t.next=5,c({zomeName:y.c.CONTACTS,fnName:y.a[y.c.CONTACTS].REMOVE_CONTACTS,payload:[Object(v.a)(e.id)]});case 5:return delete s[e.id],n({type:H.b,contacts:s}),t.abrupt("return",!0);case 10:t.prev=10,t.t0=t.catch(2),n(Object(_.a)("TOAST",{},{id:"redux.err.generic"}));case 13:return t.abrupt("return",!1);case 14:case"end":return t.stop()}}),t,null,[[2,10]])})));return function(e,n,a){return t.apply(this,arguments)}}()},Rt=function(e){return function(){var t=Object(O.a)(h.a.mark((function t(n,a,r){var c,s;return h.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return c=r.callZome,s=a().contacts.blocked,t.prev=2,t.next=5,c({zomeName:y.c.CONTACTS,fnName:y.a[y.c.CONTACTS].UNBLOCK_CONTACTS,payload:[Object(v.a)(e.id)]});case 5:return delete s[e.id],n({type:H.a,blocked:s}),t.abrupt("return",!0);case 10:t.prev=10,t.t0=t.catch(2),n(Object(_.a)("TOAST",{},{id:"redux.err.generic"}));case 13:return t.abrupt("return",!1);case 14:case"end":return t.stop()}}),t,null,[[2,10]])})));return function(e,n,a){return t.apply(this,arguments)}}()},Pt=n(73),Ct=n(88),At=n(129),Gt=n(130),Lt=n(158),Dt=function(e){return function(){var t=Object(O.a)(h.a.mark((function t(n,a){var r,c,s,o;return h.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:e.err&&(r=a().p2pmessages.errMsgs,c=r[e.receiver.id]?r[e.receiver.id]:[],s=c.map((function(e){return JSON.stringify(e)})),(o=s.indexOf(JSON.stringify(e)))>-1&&c.splice(o,1),n({type:xe.b,state:{errMsgs:Object(d.a)(Object(d.a)({},r),{},Object(D.a)({},e.receiver.id,c))}}));case 1:case"end":return t.stop()}}),t)})));return function(e,n){return t.apply(this,arguments)}}()},Ht=n(53),zt=function(e,t,n,a,r){return function(c,s){var o,i,u=s().profile,l=u.id,p=u.username,b=u.fields,j=s().contacts.contacts,f=s().p2pmessages.messages;"TEXT"===n?o={type:"TEXT",payload:{payload:t.trim()}}:o={type:"FILE",fileName:r.metadata.fileName,fileSize:r.metadata.fileSize,fileType:r.fileType.type,fileBytes:r.fileBytes,thumbnail:null===(i=r.fileType.payload)||void 0===i?void 0:i.thumbnail};var m={p2pMessageEntryHash:"error message",author:{id:l,username:p,fields:b},receiver:{id:e,username:j[e].username,fields:j[e].fields},payload:o,timestamp:new Date,replyTo:a&&f[a]?{p2pMessageEntryHash:f[a].p2pMessageEntryHash,author:f[a].author,receiver:f[a].receiver,payload:f[a].payload,timestamp:f[a].timestamp,replyTo:void 0,receipts:[]}:void 0,receipts:[],replyToId:a,err:!0},O=s().p2pmessages.errMsgs,g=s().p2pmessages.errMsgs[e]?s().p2pmessages.errMsgs[e]:[];return O=Object(d.a)(Object(d.a)({},O),{},Object(D.a)({},e,[m].concat(Object(q.a)(g)))),c({type:xe.b,state:{errMsgs:O}}),!0}},Ut=n(92),Ft=n.n(Ut),Bt=function(e){var t=e.nickname,n=e.id,a=e.charToShow,r=e.avatar,c=void 0===r?void 0:r,s=e.displayId,o=void 0===s||s,i=e.displayAvatar,u=void 0!==i&&i,l=e.displayNickname,p=void 0===l||l,d=e.noSpace,b=void 0!==d&&d,j=n.slice(5);return Object(f.jsxs)("div",{className:b?Ft.a[""]:Ft.a.container,children:[u?function(e){return Object(f.jsx)("div",{className:Ft.a.avatar,children:Object(f.jsx)(C,{hash:e,avatar:c,size:50})})}(n):null,p?t:null,o?function(e,t){return Object(f.jsx)("span",{className:Ft.a.label,children:t?e.slice(0,t).concat("..."):e})}(j,a):null]})},Zt=n(111),Vt=n.n(Zt),Yt=function(e){var t=e.history,n=e.conversant,a=e.onHide,r=e.pathname,c=e.intl;return Object(f.jsxs)(o.A,{children:[Object(f.jsxs)(o.w,{button:!0,onClick:function(){a(),t.push({pathname:"".concat(r,"/details"),state:{conversant:n}})},children:[Object(f.jsx)(o.r,{slot:"start",icon:u.F}),Object(f.jsx)(o.z,{children:c.formatMessage({id:"app.chat.header-details"})})]}),Object(f.jsxs)(o.w,{button:!0,onClick:function(){t.push({pathname:"/u/".concat(n.id,"/search")}),a()},children:[Object(f.jsx)(o.r,{slot:"start",icon:u.Z}),Object(f.jsx)(o.z,{children:c.formatMessage({id:"app.chat.header-search"})})]}),Object(f.jsxs)(o.w,{button:!0,onClick:function(){t.push({pathname:"/u/".concat(n.id,"/pinned")}),a()},children:[Object(f.jsx)(o.r,{slot:"start",icon:u.R}),Object(f.jsx)(o.z,{children:c.formatMessage({id:"app.chat.header-pinned-messages"})})]})]})},Xt=function(e){var t=e.id,n=e.username,a=e.pathname,r=e.conversant,c=Object(I.f)(),s=Object(l.a)(),p=Object(o.rb)(Yt,{onHide:function(){return j()},history:c,conversant:r,pathname:a,intl:s}),d=Object(i.a)(p,2),b=d[0],j=d[1];return Object(f.jsx)(o.q,{children:Object(f.jsxs)(o.fb,{children:[Object(f.jsx)(o.f,{slot:"start",children:Object(f.jsx)(o.e,{onClick:function(){return c.push({pathname:"/home"})},className:"ion-no-padding",children:Object(f.jsx)(o.r,{slot:"icon-only",icon:u.e})})}),Object(f.jsxs)("div",{className:Vt.a["title-container"],children:[Object(f.jsx)(o.b,{className:"".concat(Vt.a.avatar," ion-padding"),children:Object(f.jsx)(C,{hash:t,avatar:r.fields.avatar,size:50})}),Object(f.jsx)(o.cb,{className:Vt.a.title,onClick:function(){return c.push({pathname:"/p/".concat(t),state:{profile:{username:n,id:t},prev:"/u/".concat(t)}})},children:Object(f.jsx)(Bt,{nickname:n,id:t})})]}),Object(f.jsx)(o.f,{slot:"end",children:Object(f.jsx)(o.e,{onClick:function(e){return b({event:e.nativeEvent})},children:Object(f.jsx)(o.r,{icon:u.B})})})]})})},Jt=n(101),qt=function(){var e=Object(x.l)(),t=Object(I.h)().id,n=Object(a.useState)(""),r=Object(i.a)(n,2),c=r[0],s=r[1],u=Object(a.useState)([]),l=Object(i.a)(u,2),b=l[0],j=l[1],m=Object(a.useState)(""),g=Object(i.a)(m,2),v=g[0],y=g[1],_=Object(a.useState)([]),E=Object(i.a)(_,2),T=E[0],S=E[1],N=Object(a.useState)([]),w=Object(i.a)(N,2),k=w[0],M=w[1],R=Object(a.useState)(!1),P=Object(i.a)(R,2),C=P[0],A=P[1],G=Object(p.c)((function(e){return e.p2pmessages})),L=G.conversations,D=G.messages,H=G.receipts,z=G.errMsgs,U=G.files,F=G.pinned,B=Object(p.c)((function(e){var n=e.p2pmessages.typing;return Object.values(n).filter((function(e){return e.id===t}))})),Z=Object(p.c)((function(e){var n=e.contacts.contacts;return Object.values(n).filter((function(e){return e.id===t}))[0]})),V=Object(p.c)((function(e){return e.preference})),Y=V.readReceipt,X=V.typingIndicator,J=Object(I.g)(),K=J.pathname,W=J.state,Q=Object(p.c)((function(e){var n,a,r,c;return null!==W&&void 0!==W&&W.username?null===W||void 0===W?void 0:W.username:null!==(n=e.contacts)&&void 0!==n&&null!==(a=n.contacts[t])&&void 0!==a&&a.username?null===(r=e.contacts)||void 0===r||null===(c=r.contacts[t])||void 0===c?void 0:c.username:(kt(),"")})),ee=Object(a.useRef)(null),te=Object(a.useRef)(!1),ne=Object(a.useRef)(),ae=Object(a.useRef)(),re=Object(a.useRef)(null);Object(a.useEffect)((function(){ee.current.scrollToBottom()}),[]),Object(a.useEffect)((function(){ee.current.scrollToBottom()}),[Z]),Object(a.useEffect)((function(){void 0!==Z&&e(function(e){return function(){var t=Object(O.a)(h.a.mark((function t(n,a){var r,c,s,o;return h.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return r=Object(d.a)({},a().p2pmessages),c=r.conversations[e.id],s=r.errMsgs[e.id]?r.errMsgs[e.id]:[],o=c?c.messages.map((function(e){var t=r.messages[e];if(t.receipts.length>0){var n=t.receipts.map((function(e){return r.receipts[e]}));return n.sort((function(e,t){var n=e.timestamp.getTime(),a=t.timestamp.getTime();return n>a?-1:n<a?1:0})),t.err=!1,{message:t,receipt:n[0]}}return t.err=!0,{message:t,receipt:void 0}})):[],s.forEach((function(e){var t={message:e};o.push(t)})),o.sort((function(e,t){return e.message.timestamp.getTime()-t.message.timestamp.getTime()})),t.abrupt("return",o);case 7:case"end":return t.stop()}}),t)})));return function(e,n){return t.apply(this,arguments)}}()}(Z)).then((function(e){return S(e)}))}),[L,D,H,Z,z]),Object(a.useEffect)((function(){e(Object(Ct.a)(t))}),[]),Object(a.useEffect)((function(){k.length>0&&(ne.current&&clearTimeout(ne.current),ne.current=setTimeout((function(){e(Object(Lt.a)(k)),M([])}),1e3))}),[k]);var ce=function(t){void 0!==U[t.fileHash]?se(U[t.fileHash],t.fileName):e(_e([t.fileHash])).then((function(e){e&&Object.keys(e).length>0&&se(e[t.fileHash],t.fileName)}))},se=function(e,t){var n=new Blob([e]),a=document.createElement("a");a.href=window.URL.createObjectURL(n),a.download=t,a.click()},oe=function(t){var n=t.message.p2pMessageEntryHash,a=t.message.author,r=t.message.payload,c=t.message.replyTo?{payload:t.message.replyTo.payload,author:t.message.replyTo.author,id:t.message.replyTo.p2pMessageEntryHash}:null,s=void 0===t.message.err&&t.receipt?t.receipt.timestamp:t.message.timestamp,o=t.message.err?void 0:t.receipt&&"read"===t.receipt.status?{key:s}:void 0;return"FILE"===r.type&&"VIDEO"===r.fileType&&void 0===U[r.fileHash]&&void 0===t.message.err&&e(_e([r.fileHash])),Z.id!==a.id?Object(f.jsx)(tt,{id:t.message.p2pMessageEntryHash,profile:t.message.author,type:"p2p",timestamp:s,onRetry:function(n){return function(t,n){if(t(!0),"error message"===n.p2pMessageEntryHash)if("TEXT"===n.payload.type)e(Object(Ht.a)(Z.id,n.payload.payload.payload,"TEXT",n.replyToId)).then((function(a){if(t(!1),!a)return null;e(Dt(n))}));else{var a={metadata:{fileName:n.payload.fileName,fileType:n.payload.fileType,fileSize:n.payload.fileSize},fileType:{type:n.payload.fileType,payload:"OTHER"===n.payload.fileType?void 0:{thumbnail:n.payload.thumbnail}},fileBytes:n.payload.fileBytes};e(Object(Ht.a)(Z.id,"","FILE",""!==v?v:void 0,a)).then((function(a){if(t(!1),!a)return null;e(Dt(n))}))}else e(Object(Jt.a)(n)).then((function(e){return t(!1)}))}(n,t.message)},onDelete:function(){return e(Dt(t.message))},payload:r,readList:o||{},showProfilePicture:!0,showName:!0,onDownload:function(e){return ce(e)},replyTo:c||void 0,onReply:function(e){var t;re.current&&(null===re||void 0===re||null===(t=re.current)||void 0===t||t.reply(e)),y(e.id)},onPinMessage:function(){e(Object(Gt.a)([t.message]))},isPinned:!!F[t.message.p2pMessageEntryHash],err:t.message.err},n):Object(f.jsx)(at,{id:t.message.p2pMessageEntryHash,profile:t.message.author,type:"p2p",timestamp:s,payload:r,readList:o||{},showProfilePicture:!0,onPinMessage:function(){return e(Object(Gt.a)([t.message]))},showName:!0,onSeen:function(e){return function(e){"read"!==e.receipt.status&&Y&&M((function(t){return[].concat(Object(q.a)(t),[e.message])}))}(t)},onDownload:function(e){return ce(e)},replyTo:c||void 0,onReply:function(e){var t;re.current&&(null===re||void 0===re||null===(t=re.current)||void 0===t||t.reply(e)),y(e.id)},isPinned:!!F[t.message.p2pMessageEntryHash]},n)};return Object(f.jsxs)(o.H,{children:[Object(f.jsx)(Xt,{id:t,pathname:K,conversant:Z,username:Q}),Object(f.jsx)(o.k,{children:Object(f.jsx)($,{type:"p2p",onScrollTop:function(t){return function(t){if(!1===C){var n=T[0]?T[0].message:null;n&&!n.err&&e(Object(Pt.a)(Z.id,5,"All",n.timestamp,n.p2pMessageEntryHash)).then((function(e){return e&&Object.values(e)[0][Z.id].length<=0&&A(!0),t()}))}return t()}(t)},ref:ee,disabled:C,children:T.map((function(e){return oe(e)}))})}),Object(f.jsx)(it,{profiles:Object.values(B)}),Object(f.jsx)(Nt,{ref:re,onSend:function(t){var n=Object(d.a)({},t),a=n.message,r=n.setIsLoading;r(!0),a&&""!==a&&e(Object(Ht.a)(Z.id,a,"TEXT",""!==v?v:void 0)).then((function(t){return t||e(zt(Z.id,c,"TEXT",""!==v?v:void 0)),b.length?b.forEach((function(t){return e(Object(Ht.a)(Z.id,c,"FILE",""!==v?v:void 0,t)).then((function(n){n||e(zt(Z.id,c,"FILE",""!==v?v:void 0,t)),r(!1)}))})):r(!1)})),""===a&&b.length&&b.forEach((function(t){return e(Object(Ht.a)(Z.id,c,"FILE",""!==v?v:void 0,t)).then((function(n){n||e(zt(Z.id,c,"FILE",""!==v?v:void 0,t)),r(!1)}))})),ee.current.scrollToBottom(),y("")},onChange:function(t){return function(t,n){!0===te.current?(X&&(e(Object(At.a)(n.id,!(!t||0===t.length))),ae.current&&clearTimeout(ae.current),ae.current=setTimeout((function(){return e(Object(At.a)(n.id,!1))}),500)),s(t)):te.current=!0}(t,Z)},onFileSelect:function(e){return j(e)}})]})},Kt=n(112),Wt=n.n(Kt),Qt=function(e){var t=e.profile,n=Object(I.f)();return Object(f.jsxs)("div",{children:[Object(f.jsx)(o.fb,{className:Wt.a.controls,children:Object(f.jsx)("span",{children:Object(f.jsx)(o.f,{slot:"start",children:Object(f.jsx)(o.e,{onClick:function(){return n.push({pathname:"/u/".concat(t.id)})},className:"ion-no-padding",children:Object(f.jsx)(o.r,{slot:"icon-only",icon:u.e})})})})}),Object(f.jsx)("div",{className:Wt.a.titlebar,children:Object(f.jsx)("p",{className:Wt.a.title,children:Object(f.jsx)(Bt,{displayId:!1,nickname:t.username,id:t.id})})})]})},$t=function(e){var t=e.onSegmentChange,n=e.value,a=Object(l.a)();return Object(f.jsx)(o.fb,{children:Object(f.jsxs)(o.O,{value:n,onIonChange:function(e){return t(e.detail.value)},children:[Object(f.jsx)(o.P,{value:"Info",children:Object(f.jsx)(o.z,{children:a.formatMessage({id:"app.chat.chat-details.info"})})}),Object(f.jsx)(o.P,{value:"Media",children:Object(f.jsx)(o.z,{children:a.formatMessage({id:"app.chat.chat-details.media"})})}),Object(f.jsx)(o.P,{value:"Files",children:Object(f.jsx)(o.z,{children:a.formatMessage({id:"app.chat.chat-details.files"})})})]})})},en=n(47),tn=n.n(en),nn=function(e){var t=e.orderedMediaMessages,n=e.onDownload,c=e.onScrollBottom,s=Object(x.l)(),i=Object(p.c)((function(e){return Object.assign({},e.groups.groupFiles,e.p2pmessages.files)})),u=Object(l.a)(),d=Object(a.useRef)(null),b=function(){var e;return null===(e=d.current)||void 0===e?void 0:e.complete()},j=new TextDecoder,m=-1,O=function(e){return e!==m?(m=e,Object(f.jsx)(o.j,{size:"12",children:Object(f.jsx)("h2",{className:tn.a.month,children:Object(x.h)(e,u)})})):null},g=function(e){return"VIDEO"===e.payload.fileType?Object(f.jsx)("div",{className:tn.a.mediadiv,children:Object(f.jsx)(Fe,{download:function(){return n(e.payload)},src:URL.createObjectURL(new Blob([i[e.payload.fileHash]],{type:"video/mp4"})),className:tn.a.video,thumbnail:URL.createObjectURL(new Blob([e.payload.thumbnail],{type:"image/jpeg"})),onPlayPauseErrorHandler:function(t){Object(z.c)(e)?s(_e([e.payload.fileHash])).then((function(e){e&&t(!1)})):s(he([e.payload.fileHash])).then((function(e){e&&t(!1)}))}})}):Object(f.jsx)("div",{className:tn.a.mediadiv,children:Object(f.jsx)(Re,{file:e.payload,src:j.decode(e.payload.thumbnail),onDownload:n})})};return Object(f.jsx)(o.S,{children:Object(f.jsxs)(o.p,{children:[Object(f.jsx)(o.M,{className:tn.a.mediarow,children:t.map((function(e,t){var n=e.timestamp.getMonth();return Object(f.jsxs)(r.a.Fragment,{children:[O(n),Object(f.jsx)(o.j,{size:"3",children:Object(f.jsx)(o.g,{className:tn.a.mediacard,children:g(e)})})]},t)}))}),Object(f.jsx)(o.M,{children:Object(f.jsx)(o.t,{ref:d,position:"bottom",onIonInfinite:function(e){return c(b,t[t.length-1])},children:Object(f.jsx)(o.u,{})})})]})})},an=function(e){var t=e.orderedFileMessages,n=e.onDownload,c=e.onScrollBottom,s=Object(l.a)(),i=Object(a.useRef)(null),u=function(){var e;return null===(e=i.current)||void 0===e?void 0:e.complete()},p=-1,d=function(e){return e!==p?(p=e,Object(f.jsx)(o.j,{size:"12",children:Object(f.jsx)("h2",{className:tn.a.month,children:Object(x.h)(e,s)})})):null};return Object(f.jsx)(o.S,{children:Object(f.jsxs)(o.p,{children:[Object(f.jsx)(o.M,{className:tn.a.mediarow,children:t.map((function(e){var t=e.timestamp.getMonth();return Object(f.jsxs)(r.a.Fragment,{children:[d(t),Object(f.jsx)(o.j,{size:"12",children:Object(f.jsx)(o.g,{className:tn.a.mediacard,children:Object(f.jsx)(Se,{file:e.payload,onDownload:n,darken:!0})})})]})}))}),Object(f.jsx)(o.M,{children:Object(f.jsx)(o.t,{ref:i,position:"bottom",onIonInfinite:function(e){return c(u,t[t.length-1])},children:Object(f.jsx)(o.u,{})})})]})})},rn=n(131),cn=n.n(rn),sn=function(e){var t=e.nickname,n=e.id,a=Object(l.a)(),r=n.slice(5);return Object(f.jsx)(f.Fragment,{children:Object(f.jsxs)(o.y,{className:cn.a.container,children:[Object(f.jsx)(o.w,{lines:"none",children:Object(f.jsx)("h3",{children:a.formatMessage({id:"components.profile-info.nickname"})})}),Object(f.jsx)(o.w,{lines:"none",children:Object(f.jsx)(o.Z,{children:t})}),Object(f.jsx)(o.w,{lines:"none",children:Object(f.jsx)("h3",{children:a.formatMessage({id:"components.profile-info.id"})})}),Object(f.jsx)(o.w,{lines:"none",children:Object(f.jsx)(o.Z,{children:r})}),Object(f.jsx)(o.w,{lines:"none",children:Object(f.jsx)("h3",{children:a.formatMessage({id:"components.profile-info.identicon"})})}),Object(f.jsx)(o.w,{className:cn.a.avatar,lines:"none",children:Object(f.jsx)(C,{hash:n,size:40})})]})})},on=function(e){var t=e.location,n=Object(d.a)({},t).state,r=Object(p.c)((function(e){return e.p2pmessages})),c=r.conversations,s=r.messages,u=Object(p.c)((function(e){return e.p2pmessages.files})),l=Object(a.useState)(!1),b=Object(i.a)(l,2),j=b[0],m=b[1],O=Object(a.useState)([]),g=Object(i.a)(O,1)[0],h=Object(a.useState)([]),v=Object(i.a)(h,1)[0],y=Object(a.useState)({}),_=Object(i.a)(y,1)[0],E=Object(a.useState)("Info"),T=Object(i.a)(E,2),S=T[0],N=T[1],w=Object(x.l)(),I=Object(a.useRef)(null);Object(a.useEffect)((function(){w(Object(Pt.a)(n.conversant.id,40,"Other",void 0,void 0)),w(Object(Pt.a)(n.conversant.id,40,"Media",void 0,void 0))}),[]),Object(a.useEffect)((function(){void 0!==n.conversant&&void 0!==c[n.conversant.id]&&c[n.conversant.id].messages.forEach((function(e){var t=s[e];if("FILE"===t.payload.type){var n=t.payload.fileType;if(!_[e])switch(n){case"IMAGE":case"VIDEO":g.push(t),_[e]=!0;break;case"OTHER":v.push(t),_[e]=!0}}}))}),[c,s]);var k=function(e){void 0!==u[e.fileHash]?M(u[e.fileHash],e.fileName):w(_e([e.fileHash])).then((function(t){t&&Object.keys(t).length>0&&M(t[e.fileHash],e.fileName)}))},M=function(e,t){var n=new Blob([e]),a=document.createElement("a");a.href=window.URL.createObjectURL(n),a.download=t,a.click()},R=function(e,t){if(!j){var a=t;void 0!==a&&w(Object(Pt.a)(n.conversant.id,10,"IMAGE"===a.payload.fileType||"VIDEO"===a.payload.fileType?"Media":"Other",void 0!==a?a.timestamp:void 0,void 0!==a?a.p2pMessageEntryHash:void 0)).then((function(t){Object.values(t)[0][n.conversant.id].length<=0&&m(!0),e()}))}e()};return Object(f.jsxs)(o.H,{children:[Object(f.jsxs)(o.q,{children:[Object(f.jsx)(Qt,{profile:n.conversant}),Object(f.jsx)($t,{value:S,onSegmentChange:function(e){var t;null===(t=I.current)||void 0===t||t.slideTo(["Info","Media","Files"].indexOf(e))}})]}),Object(f.jsx)(o.k,{children:Object(f.jsxs)(o.T,{ref:I,className:"slides",pager:!1,options:{initialSlide:0,speed:400},onIonSlideDidChange:function(){var e,t=["Info","Media","Files"];null===(e=I.current)||void 0===e||e.getActiveIndex().then((function(e){return N(t[e])}))},children:[Object(f.jsx)(o.S,{children:Object(f.jsx)(sn,{nickname:n.conversant.username,id:n.conversant.id})}),Object(f.jsx)(nn,{orderedMediaMessages:g,onDownload:function(e){return k(e)},onScrollBottom:function(e,t){return R(e,t)}}),Object(f.jsx)(an,{orderedFileMessages:v,onDownload:function(e){return k(e)},onScrollBottom:function(e,t){return R(e,t)}})]})})]})},un=function(e,t){var n=e.isVisible,r=void 0===n||n,c=e.onChange,s=Object(a.useState)(new Date((new Date).setDate((new Date).getDate()+1))),u=Object(i.a)(s,2),l=u[0],p=u[1],d=Object(a.useRef)(null);return Object(a.useImperativeHandle)(t,(function(){return{open:function(){var e;null===d||void 0===d||null===(e=d.current)||void 0===e||e.open()}}})),Object(f.jsx)(o.l,{ref:d,value:Object(x.c)(l),style:{display:r?"block":"none"},max:Object(x.c)(new Date((new Date).setDate((new Date).getDate()))),onIonChange:function(e){if(e.detail.value){var t=Object(x.j)(e.detail.value);p(t),c&&c(t)}}})},ln=Object(a.forwardRef)(un),pn=n(132),dn=n.n(pn),bn=function(e){var t=e.type,n=e.prevHref,r=e.onDateSelect,c=e.messages,s=Object(a.useRef)(null),l=Object(a.useState)(null),d=Object(i.a)(l,2),b=d[0],j=d[1],m=Object(I.f)();Object(a.useEffect)((function(){c&&j(c)}),[c]);var O=Object(p.c)((function(e){return e.profile})),g=function(){var e;null===(e=s.current)||void 0===e||e.open()},h=function(){};return Object(f.jsx)(o.H,{children:b?Object(f.jsxs)(f.Fragment,{children:[Object(f.jsx)(o.q,{children:Object(f.jsx)(o.fb,{children:Object(f.jsx)(o.f,{children:Object(f.jsx)(o.e,{onClick:function(){return j(null)},children:Object(f.jsx)(o.r,{icon:u.d})})})})}),Object(f.jsx)(o.k,{children:b?Object(f.jsx)($,{type:t,children:b.map((function(e,t){return e.author.id===O.id?Object(f.jsx)(tt,{id:e.id,onDownload:h,profile:e.author,timestamp:e.timestamp,payload:e.payload,readList:e.readList,replyTo:e.replyTo,type:"group",isPinned:!1,showName:!0,showProfilePicture:!0},t):Object(f.jsx)(at,{id:e.id,onDownload:h,profile:e.author,timestamp:e.timestamp,isPinned:!1,payload:e.payload,readList:e.readList,replyTo:e.replyTo,type:"group",showName:!0,showProfilePicture:!0},t)}))}):Object(f.jsxs)(o.A,{className:dn.a.search,children:[Object(f.jsxs)(o.w,{lines:"full",button:!0,onClick:g,children:[Object(f.jsx)(o.r,{slot:"start",icon:u.i}),Object(f.jsx)(o.z,{children:"Search by date"})]}),Object(f.jsx)(ln,{ref:s,isVisible:!1,onChange:r})]})})]}):Object(f.jsxs)(f.Fragment,{children:[Object(f.jsx)(o.q,{children:Object(f.jsx)(o.fb,{children:Object(f.jsx)(o.f,{children:Object(f.jsx)(o.e,{onClick:function(){return m.push({pathname:n})},className:"ion-no-padding",children:Object(f.jsx)(o.r,{slot:"icon-only",icon:u.e})})})})}),Object(f.jsx)(o.k,{children:Object(f.jsxs)(o.A,{className:dn.a.search,children:[Object(f.jsxs)(o.w,{lines:"full",button:!0,onClick:g,children:[Object(f.jsx)(o.r,{slot:"start",icon:u.i}),Object(f.jsx)(o.z,{children:"Search by date"})]}),Object(f.jsx)(ln,{ref:s,isVisible:!1,onChange:function(e){r&&r(e)}})]})})]})})},jn=function(){var e=Object(a.useState)(),t=Object(i.a)(e,2),n=t[0],r=t[1],c=Object(I.h)().id,s=Object(x.l)();return Object(f.jsx)(bn,{type:"p2p",messages:n,onDateSelect:function(e){s(function(e,t,n){return function(){var a=Object(O.a)(h.a.mark((function a(r,c,s){var o,i,u,l,p,b,j;return h.a.wrap((function(a){for(;;)switch(a.prev=a.next){case 0:return o=s.callZome,i={conversant:Object(v.a)(e),date:Object(x.d)(t),payload_type:n},a.prev=2,a.next=5,o({zomeName:y.c.P2PMESSAGE,fnName:y.a[y.c.P2PMESSAGE].GET_MESSAGES_BY_AGENT_BY_TIMESTAMP,payload:i});case 5:if("error"===(null===(u=a.sent)||void 0===u?void 0:u.type)){a.next=12;break}return l=Object(d.a)({},c().contacts.contacts),p=Object(d.a)({},c().profile),b=Object(d.a)(Object(d.a)({},l),{},Object(D.a)({},p.id,{id:p.id,username:p.username,fields:p.fields})),j=Object(V.a)(u,b),a.abrupt("return",j);case 12:a.next=17;break;case 14:a.prev=14,a.t0=a.catch(2),r(Object(_.a)("TOAST",{},{id:"redux.err.generic"}));case 17:case"end":return a.stop()}}),a,null,[[2,14]])})));return function(e,t,n){return a.apply(this,arguments)}}()}(c,e,"All")).then((function(e){var t=Object.values(e.messages).map((function(t){var n=t.receipts.map((function(t){return e.receipts[t]}));n.sort((function(e,t){var n=e.timestamp.getTime(),a=t.timestamp.getTime();return n>a?-1:n<a?1:0}));var a=n[0],r="read"===a.status?{key:a.timestamp}:{};return{id:t.p2pMessageEntryHash,author:t.author,payload:t.payload,timestamp:t.timestamp,readList:r}}));r(t.reverse())}))},prevHref:"/u/".concat(c)})},fn=n(49),mn=n.n(fn),On=function(e){var t=e.messages,n=e.onMessageClick,a=e.type,r=void 0===a?"group":a,c=new TextDecoder,s=Object(x.l)(),i=Object(p.c)((function(e){return Object.assign({},e.groups.groupFiles,e.p2pmessages.files)})),l=function(e){switch(e.fileType){case"OTHER":return Object(f.jsxs)("div",{className:"".concat(mn.a.other," ion-padding"),children:[Object(f.jsx)(o.r,{className:"ion-margin-end",icon:u.x}),Object(f.jsxs)("div",{className:mn.a["file-details"],children:[Object(f.jsx)(o.Z,{className:mn.a["file-name"],children:e.fileName}),Object(f.jsx)(o.Z,{className:mn.a["file-size"],children:Object(x.b)(e.fileSize)})]})]});case"IMAGE":return Object(f.jsx)(o.s,{className:"".concat(mn.a.thumbnail," ion-margin-end"),src:c.decode(null===e||void 0===e?void 0:e.thumbnail)});case"VIDEO":var t=i[e.fileHash];return Object(f.jsx)(Fe,{className:mn.a.video,thumbnail:URL.createObjectURL(new Blob([e.thumbnail],{type:"image/jpeg"})),onPlayPauseErrorHandler:function(t){"p2p"===r?s(_e([e.fileHash])).then((function(e){e&&t(!1)})):s(he([e.fileHash])).then((function(e){e&&t(!1)}))},src:URL.createObjectURL(new Blob([t],{type:"video/mp4"})),download:function(){if(t){var n=new Blob([t]),a=document.createElement("a");a.href=window.URL.createObjectURL(n),a.download=e.fileName,a.click()}}})}};return Object(f.jsx)(o.A,{children:t.sort((function(e,t){return e.date>t.date?-1:1})).map((function(e,t){var a=Object(x.g)(e.payload);return Object(f.jsx)(o.w,{button:!0,onClick:function(){n&&n(e)},children:Object(f.jsxs)("div",{className:mn.a["content-container"],children:[Object(f.jsxs)("div",{className:mn.a.header,children:[Object(f.jsx)(o.z,{className:mn.a.author,children:e.author}),Object(f.jsx)(o.G,{className:"".concat(mn.a.date," ion-padding-start"),children:e.date.toDateString()})]}),a?Object(f.jsx)(o.Z,{children:e.payload.payload.payload}):l(e.payload)]})},t)}))})},gn=function(){var e=Object(I.h)().id,t=Object(l.a)(),n=Object(I.f)(),r=Object(x.l)();Object(a.useEffect)((function(){r(Object(Ct.a)(e))}),[]);var c=Object(p.c)((function(t){var n=t.p2pmessages.conversations[e];if(n){if(n.pinned&&!(n.pinned.filter((function(e){return!t.p2pmessages.pinned})).length>0))return n.pinned.map((function(e){var n=t.p2pmessages.pinned[e];return{id:n.p2pMessageEntryHash,payload:n.payload,author:n.author.username,date:n.timestamp}}));r(Object(Ct.a)(e))}return[]}));return Object(f.jsxs)(o.H,{children:[Object(f.jsx)(o.q,{children:Object(f.jsx)(o.fb,{children:Object(f.jsxs)(o.f,{children:[Object(f.jsx)(o.e,{onClick:function(){return n.push({pathname:"/u/".concat(e)})},className:"ion-no-padding",children:Object(f.jsx)(o.r,{slot:"icon-only",icon:u.e})}),Object(f.jsx)(o.cb,{children:t.formatMessage({id:"app.chat.pinned-message-title"})})]})})}),Object(f.jsx)(o.k,{children:Object(f.jsx)(On,{onMessageClick:function(e){},messages:Object.values(c)})})]})},hn=function(){return Object(f.jsxs)(I.d,{children:[Object(f.jsx)(I.b,{path:"/u/:id",exact:!0,children:Object(f.jsx)(qt,{})}),Object(f.jsx)(I.b,{path:"/u/:id/details",exact:!0,component:on}),Object(f.jsx)(I.b,{path:"/u/:id/search",exact:!0,component:jn}),Object(f.jsx)(I.b,{path:"/u/:id/pinned",exact:!0,component:gn})]})},vn=function(e){return function(){var t=Object(O.a)(h.a.mark((function t(n,a,r){var c,s,o,i,u,l,p,b;return h.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return c=r.callZome,s=r.getAgentId,t.prev=1,t.next=4,c({zomeName:y.c.GROUP,fnName:y.a[y.c.GROUP].FETCH_PINNED_MESSAGES,payload:e});case 4:if(o=t.sent,i=a().groups.conversations[e]){t.next=10;break}n(se(e)),t.next=19;break;case 10:return u=Object.values(o),l={},t.next=14,s();case 14:return p=t.sent,b=u.map(function(){var t=Object(O.a)(h.a.mark((function t(n){var r,s,o,i,u,d;return h.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return s=n.entry,o=Object(v.b)(s.messageId),t.t0=Object,t.next=5,B(a(),[Object(v.b)(s.sender)],c,Object(v.b)(p));case 5:return t.t1=t.sent,i=t.t0.values.call(t.t0,t.t1)[0].username,u="TEXT"===s.payload.type?s.payload:{type:"FILE",fileType:s.payload.payload.fileType.type,fileHash:Object(v.b)(s.payload.payload.metadata.fileHash),fileName:s.payload.payload.metadata.fileName,fileSize:s.payload.payload.metadata.fileSize,thumbnail:null===(r=s.payload.payload.fileType.payload)||void 0===r?void 0:r.thumbnail},d={groupId:e,groupMessageId:o,author:i,payload:u,timestamp:Object(x.k)(s.created),readList:{}},l[o]=d,t.abrupt("return",o);case 11:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()),t.next=18,Promise.all(b).then((function(e){return i.pinnedMessages=e}));case 18:n({type:Z.l,pinnedMessages:Object(d.a)(Object(d.a)({},a().groups.pinnedMessages),l),conversations:Object(d.a)(Object(d.a)({},a().groups.conversations),{},Object(D.a)({},e,i))});case 19:t.next=24;break;case 21:return t.prev=21,t.t0=t.catch(1),t.abrupt("return",n(Object(_.a)("TOAST",{},{id:"redux.err.generic"})));case 24:case"end":return t.stop()}}),t,null,[[1,21]])})));return function(e,n,a){return t.apply(this,arguments)}}()},yn=function(e,t){return function(){var n=Object(O.a)(h.a.mark((function n(a,r,c){var s,o,i,u,l,p;return h.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return s=c.callZome,n.prev=1,n.next=4,s({zomeName:y.c.GROUP,fnName:y.a[y.c.GROUP].PIN_MESSAGE,payload:{groupHash:e,groupMessageHash:t}});case 4:o=Object(d.a)({},{pinnedMessages:r().groups.pinnedMessages,message:r().groups.messages[t],conversations:r().groups.conversations}),i=o.conversations,u=o.pinnedMessages,l=o.message,p=i[e],u[t]=l,p.pinnedMessages?p.pinnedMessages.push(t):p.pinnedMessages=[t],a({type:Z.l,conversations:Object(d.a)(Object(d.a)({},i),{},Object(D.a)({},e,p)),pinnedMessages:Object(d.a)(Object(d.a)({},r().groups.pinnedMessages),u)}),n.next=18;break;case 11:if(n.prev=11,n.t0=n.catch(1),!n.t0.message.includes("failed to get the message being pinned")){n.next=17;break}a(Object(_.a)("TOAST",{},{id:"redux.err.group.pin-message"})),n.next=18;break;case 17:return n.abrupt("return",a(Object(_.a)("TOAST",{},{id:"redux.err.generic"})));case 18:case"end":return n.stop()}}),n,null,[[1,11]])})));return function(e,t,a){return n.apply(this,arguments)}}()},xn=function(e,t){return function(){var n=Object(O.a)(h.a.mark((function n(a,r,c){var s,o,i,u,l;return h.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return s=c.callZome,n.prev=1,n.next=4,s({zomeName:y.c.GROUP,fnName:y.a[y.c.GROUP].UNPIN_MESSAGE,payload:{groupHash:e,groupMessageHash:t}});case 4:o=Object(d.a)({},{conversations:r().groups.conversations,pinnedMessages:r().groups.pinnedMessages}),i=o.conversations,u=o.pinnedMessages,l=i[e],delete u[t],l.pinnedMessages=l.pinnedMessages?l.pinnedMessages.filter((function(e){return e!==t})):[],a({type:Z.l,conversations:Object(d.a)(Object(d.a)({},i),{},Object(D.a)({},e,l)),pinnedMessages:u}),n.next=14;break;case 11:return n.prev=11,n.t0=n.catch(1),n.abrupt("return",a(Object(_.a)("TOAST",{},{id:"redux.err.generic"})));case 14:case"end":return n.stop()}}),n,null,[[1,11]])})));return function(e,t,a){return n.apply(this,arguments)}}()},_n=function(e){var t=e.messageIds,n=e.members,r=e.onReply,c=e.chatList,s=e.groupId,o=e.readReceipt,u=Object(x.l)(),l=Object(p.c)((function(e){return e.groups.groupFiles})),b=Object(p.c)((function(e){return e.groups})),j=b.messages,m=b.errMsgs,O=b.pinnedMessages,g=Object(p.c)((function(e){return e.groups.members})),h=Object(p.c)((function(e){return e.profile})),v=Object(a.useState)([]),y=Object(i.a)(v,2),_=y[0],E=y[1],T=Object(a.useState)([]),S=Object(i.a)(T,2),N=S[0],w=S[1],I=Object(a.useState)(!1),k=Object(i.a)(I,2),M=k[0],R=k[1],P=Object(a.useRef)(),C=function(e){var t=l[e.fileHash];if(t){var n=new Blob([t]),a=document.createElement("a");a.href=window.URL.createObjectURL(n),a.download=e.fileName,a.click()}else u(he([e.fileHash])).then((function(t){if(t&&Object.keys(t).length>0){var n=t[e.fileHash],a=new Blob([n]),r=document.createElement("a");r.href=window.URL.createObjectURL(a),r.download=e.fileName,r.click()}}))},A=Object(a.useState)([]),G=Object(i.a)(A,2),L=G[0],D=G[1];Object(a.useEffect)((function(){L.length>0&&(P.current&&clearTimeout(P.current),P.current=setTimeout((function(){var e=L[0],t=Object(d.a)(Object(d.a)({},e),{},{messageIds:L.map((function(e){return e.messageIds})).flat()});u(pe(t)),D([])}),1500))}),[L]);return Object(a.useEffect)((function(){var e=u(ue(t,s));e.sort((function(e,t){return e.timestamp.getTime()-t.timestamp.getTime()})),E(e)}),[t,j,m]),Object(a.useEffect)((function(){N.length>0&&(P.current&&clearTimeout(P.current),P.current=setTimeout((function(){var e={groupId:s,messageIds:N,reader:h.id,timestamp:new Date,members:n};u(pe(e)).then((function(e){w([])}))}),1e3))}),[N]),Object(f.jsx)(f.Fragment,{children:Object(f.jsx)(ct.ChatList,{disabled:M,onScrollTop:function(e){return function(e){var t=_[0];M||!t||t.err||u(oe({groupId:s,lastFetched:t.groupMessageId,lastMessageTimestamp:t.timestamp,batchSize:10,payloadType:{type:"ALL",payload:null}})).then((function(t){t&&Object.keys(t.groupMessagesContents).length<=0&&R(!0),e()})),e()}(e)},ref:c,type:"group",children:_.map((function(e,t){return e.author.id===h.id?Object(f.jsx)(ct.Me,{id:e.groupMessageId,profile:e.author,onDownload:C,onDelete:function(){return u(ge(e))},onRetry:function(t){return function(e,t){var n={groupId:t.groupId,payloadInput:Object(z.d)(t.payload)?{type:"TEXT",payload:{payload:t.payload.payload.payload}}:{type:"FILE",payload:{metadata:{fileName:t.payload.fileName,fileSize:t.payload.fileSize,fileType:t.payload.fileType},fileType:"IMAGE"===t.payload.fileType?{type:"IMAGE",payload:{thumbnail:t.payload.thumbnail}}:"VIDEO"===t.payload.fileType?{type:"VIDEO",payload:{thumbnail:t.payload.thumbnail}}:{type:"OTHER"},fileBytes:t.payload.fileBytes}},sender:t.author.id,replyTo:t.replyToId};e(!0),u(fe(n)).then((function(n){if(e(!1),!n)return null;u(ge(t))}))}(t,e)},isPinned:!!O[e.groupMessageId],timestamp:e.timestamp,payload:e.payload,readList:e.readList,onPinMessage:function(){O[e.groupMessageId]?u(xn(s,e.groupMessageId)):u(yn(s,e.groupMessageId))},replyTo:e.replyTo?{payload:e.replyTo.payload,author:{id:g[e.replyTo.author].id,username:g[e.replyTo.author].username,fields:g[e.replyTo.author].fields},id:"".concat(t)}:void 0,type:"group",showName:!0,showProfilePicture:!0,onReply:function(e){function t(t){return e.apply(this,arguments)}return t.toString=function(){return e.toString()},t}((function(e){return r(e)})),err:e.err},t):Object(f.jsx)(ct.Others,{id:e.groupMessageId,profile:e.author,onDownload:C,isPinned:!!O[e.groupMessageId],onPinMessage:function(){O[e.groupMessageId]?u(xn(s,e.groupMessageId)):u(yn(s,e.groupMessageId))},timestamp:e.timestamp,payload:e.payload,readList:e.readList,type:"group",replyTo:e.replyTo?{payload:e.replyTo.payload,author:{id:g[e.replyTo.author].id,username:g[e.replyTo.author].username,fields:g[e.replyTo.author].fields},id:"".concat(t)}:void 0,showName:!0,onSeen:function(t){return function(e,t){if(o&&!Object.keys(t.readList).includes(h.id)){var a={groupId:s,messageIds:[t.groupMessageId],reader:h.id,timestamp:t.timestamp,members:n};D((function(e){return[].concat(Object(q.a)(e),[a])})),e()}}(t,e)},onReply:function(e){function t(t){return e.apply(this,arguments)}return t.toString=function(){return e.toString()},t}((function(e){return r(e)})),showProfilePicture:!0},t)}))})})},En=n(113),Tn=n.n(En),Sn=function(e){var t=e.groupData,n=e.history,a=e.onHide,r=e.intl;return Object(f.jsxs)(o.A,{children:[Object(f.jsxs)(o.w,{button:!0,onClick:function(){a(),n.push("/g/".concat(t.originalGroupId,"/details"))},children:[Object(f.jsx)(o.r,{slot:"start",icon:u.F}),Object(f.jsx)(o.z,{children:r.formatMessage({id:"app.group-chat.header-details"})})]}),Object(f.jsxs)(o.w,{onClick:function(){n.push({pathname:"/g/".concat(t.originalGroupId,"/search")}),a()},button:!0,children:[Object(f.jsx)(o.r,{slot:"start",icon:u.Z}),Object(f.jsx)(o.z,{children:r.formatMessage({id:"app.group-chat.header-search"})})]}),Object(f.jsxs)(o.w,{onClick:function(){n.push({pathname:"/g/".concat(t.originalGroupId,"/pinned")}),a()},button:!0,children:[Object(f.jsx)(o.r,{slot:"start",icon:u.S}),Object(f.jsx)(o.z,{children:r.formatMessage({id:"app.group-chat.header-pinned-message"})})]})]})},Nn=function(e){var t=e.groupData,n=Object(I.f)(),a=Object(l.a)(),r=Object(o.rb)(Sn,{onHide:function(){return p()},groupData:t,history:n,intl:a}),c=Object(i.a)(r,2),s=c[0],p=c[1];return Object(f.jsx)(o.q,{children:Object(f.jsxs)(o.fb,{children:[Object(f.jsx)(o.f,{slot:"start",children:Object(f.jsx)(o.e,{onClick:function(){return n.push({pathname:"/home"})},className:"ion-no-padding",children:Object(f.jsx)(o.r,{slot:"icon-only",icon:u.e})})}),Object(f.jsxs)("div",{className:Tn.a["title-container"],children:[Object(f.jsx)(o.b,{className:"ion-padding",children:Object(f.jsx)("img",{className:Tn.a.avatar,src:u.L,alt:t.name})}),Object(f.jsx)(o.cb,{className:Tn.a.title,children:t.name})]}),Object(f.jsx)(o.f,{slot:"end",children:Object(f.jsx)(o.e,{onClick:function(e){return s({event:e.nativeEvent})},children:Object(f.jsx)(o.r,{icon:u.B})})})]})})},wn=function(){var e=Object(x.l)(),t=Object(I.h)().group,n=Object(a.useState)([]),r=Object(i.a)(n,2),c=r[0],s=r[1],u=Object(a.useState)(""),l=Object(i.a)(u,2),b=(l[0],l[1]),j=Object(a.useRef)(null),m=Object(a.useRef)(),O=Object(a.useRef)(null),g=Object(p.c)((function(e){return e.groups.conversations[t]})),h=Object(p.c)((function(e){return e.profile})),v=Object(p.c)((function(e){return e.groups.typing})),y=Object(p.c)((function(e){return e.preference})),_=y.readReceipt,E=y.typingIndicator;Object(a.useEffect)((function(){g&&e(vn(null===g||void 0===g?void 0:g.originalGroupId))}),[g,e]);return g?Object(f.jsxs)(o.H,{children:[Object(f.jsx)(Nn,{groupData:g}),Object(f.jsx)(o.k,{children:Object(f.jsx)(_n,{onReply:function(e){var t;O.current&&(null===O||void 0===O||null===(t=O.current)||void 0===t||t.reply(e))},groupId:g.originalGroupId,members:[].concat(Object(q.a)(g.members),[g.creator]),messageIds:g.messages,chatList:j,readReceipt:_})}),Object(f.jsx)(it,{profiles:v[g.originalGroupId]?v[g.originalGroupId]:[]}),Object(f.jsx)(Nt,{ref:O,onSend:function(t){var n=Object(d.a)({},t),a=n.message,r=n.reply,s=n.setIsLoading,o=null,i=null;if(s(!0),a.length&&(o={groupId:g.originalGroupId,payloadInput:{type:"TEXT",payload:{payload:a}},sender:h.id,replyTo:r}),c.length){var u=c[0],l={type:"FILE",payload:{metadata:{fileName:u.metadata.fileName,fileSize:u.metadata.fileSize,fileType:u.metadata.fileType},fileType:u.fileType,fileBytes:u.fileBytes}};i={groupId:g.originalGroupId,payloadInput:l,sender:h.id,replyTo:r}}o?e(fe(o)).then((function(t){!1===t&&e(me(o)),i&&e(fe(i)).then((function(t){t||e(me(i)),s(!1),j.current.scrollToBottom()})),s(!1),j.current.scrollToBottom()})):i&&e(fe(i)).then((function(t){t||e(me(i)),s(!1),j.current.scrollToBottom()}))},onChange:function(t){return function(t,n){if(E){var a=[].concat(Object(q.a)(n.members),[n.creator]).filter((function(e){return e!==h.id}));e(le({groupId:n.originalGroupId,indicatedBy:h.id,members:a,isTyping:0!==t.length})),m.current&&clearTimeout(m.current),m.current=setTimeout((function(){return e(le({groupId:n.originalGroupId,indicatedBy:h.id,members:a,isTyping:!1}))}),500)}return b(t)}(t,g)},onFileSelect:function(e){return s(e)}})]}):null},In=function(e){var t=e.onClickEdit,n=(e.onClickNotif,e.disabled);return Object(f.jsx)(o.f,{slot:"end",children:Object(f.jsx)(f.Fragment,{children:Object(f.jsx)(o.e,{onClick:t,disabled:!!n,children:Object(f.jsx)(o.r,{color:"medium",icon:u.K})})})})},kn=function(e){var t=e.onSegmentChange,n=e.value,a=Object(l.a)();return Object(f.jsx)(o.fb,{children:Object(f.jsxs)(o.O,{value:n,onIonChange:function(e){return t(e.detail.value)},children:[Object(f.jsx)(o.P,{value:"Info",children:Object(f.jsx)(o.z,{children:a.formatMessage({id:"app.group-chat.label-info"})})}),Object(f.jsx)(o.P,{value:"Media",children:Object(f.jsx)(o.z,{children:a.formatMessage({id:"app.group-chat.label-media"})})}),Object(f.jsx)(o.P,{value:"Files",children:Object(f.jsx)(o.z,{children:a.formatMessage({id:"app.group-chat.label-files"})})})]})})},Mn=n(74),Rn=n.n(Mn),Pn=n(114),Cn=n.n(Pn),An=function(e){var t=e.onChange,n=e.onCancel,a=Object(l.a)();return Object(f.jsxs)(o.q,{children:[Object(f.jsx)(o.fb,{children:Object(f.jsxs)(o.f,{children:[Object(f.jsx)(o.cb,{className:Cn.a.contacts,children:a.formatMessage({id:"app.group-chat.add-member-contacts"})}),Object(f.jsx)(o.e,{className:Cn.a["close-button"],onClick:n,slot:"end",children:Object(f.jsx)(o.z,{className:Cn.a["close-label"],children:a.formatMessage({id:"app.group-chat.add-member-close"})})})]})}),Object(f.jsx)(o.fb,{children:Object(f.jsx)(o.N,{onIonChange:t})})]})},Gn=function(e){var t=e.contact,n=e.selected,a=e.onSelected;return Object(f.jsx)(o.w,{button:!0,onClick:function(){return a(t)},lines:"none",color:n?"primary":"",children:Object(f.jsx)(Bt,{nickname:t.username,id:t.id})},JSON.stringify(t.id))},Ln=function(e){var t=e.index,n=e.contacts,a=e.onSelected,c=e.selected;return Object(f.jsxs)(r.a.Fragment,{children:[Object(f.jsx)(o.x,{children:Object(f.jsx)(o.z,{children:t})}),n.map((function(e){return Object(f.jsx)(Gn,{onSelected:a,selected:!!c.includes(e),contact:e},JSON.stringify(e.id))}))]},t)},Dn=n(133),Hn=n.n(Dn),zn=function(e){var t=e.isOpen,n=e.onCancel,r=e.contacts,c=e.groupId,s=e.groupRevisionId,u=e.setLoading,p=e.members,d=e.setMembers,b=Object(l.a)(),j=Object(x.l)(),m=Object(a.useState)(""),O=Object(i.a)(m,2),g=O[0],h=O[1],v=Object(a.useState)([]),y=Object(i.a)(v,2),_=y[0],E=y[1],T=Object(x.f)(function(e){return Object.keys(e).filter((function(e){return-1===p.map((function(e){return e.id})).indexOf(e)}))}(r).map((function(e){return r[e]})).filter((function(e){return e.username.toLowerCase().includes(g.toLowerCase())}))),S=function(e){return E([].concat(Object(q.a)(_),[e]))};return Object(f.jsxs)(o.F,{isOpen:t,children:[Object(f.jsx)(An,{onChange:function(e){return h(e.detail.value)},onCancel:n}),Object(f.jsxs)(o.k,{children:[Object(f.jsx)(o.A,{className:Hn.a["contacts-list"],children:Object.keys(T).map((function(e){var t=T[e];return Object(f.jsx)(Ln,{onSelected:S,index:e,contacts:t,selected:_},e)}))}),Object(f.jsx)(o.fb,{children:Object(f.jsx)(o.f,{slot:"end",children:Object(f.jsx)(o.e,{disabled:0===_.length,onClick:function(){u(!0);var e={members:_.map((function(e){return e.id})),groupId:c,groupRevisionId:s};j(ae(e)).then((function(e){if(!1!==e){var t=p.concat(_);d(t),E([]),u(!1)}else E([]),u(!1)}))},children:Object(f.jsx)(o.z,{className:Hn.a["add-label"],children:b.formatMessage({id:"app.group-chat.add-member"})})})})})]})]})},Un=n(80),Fn=n.n(Un),Bn=function(e){var t=e.groupId,n=e.groupRevisionId,r=Object(x.l)(),c=Object(l.a)(),s=lt().showErrorToast,d=Object(a.useState)(!1),b=Object(i.a)(d,2),j=b[0],m=b[1],O=Object(a.useState)(!0),g=Object(i.a)(O,2),h=g[0],v=g[1],y=Object(a.useState)([]),_=Object(i.a)(y,2),E=_[0],T=_[1],S=Object(p.c)((function(e){return e.contacts.contacts})),N=Object(p.c)((function(e){return e.profile})),w=Object(p.c)((function(e){return e.groups.members})),I=Object(p.c)((function(e){return e.groups.conversations[t]}));Object(a.useEffect)((function(){var e=[];[].concat(Object(q.a)(I.members),[I.creator]).forEach((function(t){w[t]&&e.push(w[t])})),T(e),v(!1)}),[I,w]);var k=function(e){return N.id===I.creator&&e.id!==I.creator?Object(f.jsx)(o.w,{lines:"none",slot:"end",button:!0,onClick:function(){return function(e){if(v(!0),I.members.length<=2)return v(!1),s({message:c.formatMessage({id:"app.group-chat.minimum-member-required-reached"})}),null;var t={members:[e.id],groupId:I.originalGroupId,groupRevisionId:I.originalGroupRevisionId};r(de(t)).then((function(e){if(!1!==e){var t=E.filter((function(t){return!e.members.includes(t.id)}));T(t)}v(!1)}))}(e)},children:Object(f.jsx)(o.r,{color:"danger",icon:u.V})}):null};return Object(f.jsxs)(f.Fragment,{children:[h?Object(f.jsx)(o.C,{isOpen:h}):Object(f.jsx)(f.Fragment,{children:Object(f.jsxs)(o.y,{className:Fn.a["member-page"],children:[Object(f.jsxs)(o.w,{lines:"none",children:[Object(f.jsx)(o.r,{className:Fn.a.icon,icon:u.M}),Object(f.jsx)(o.z,{children:c.formatMessage({id:"app.group-chat.members"},{length:E.length})})]}),function(e){return N.id===e.creator?Object(f.jsxs)(o.w,{lines:"none",button:!0,onClick:function(){return m(!0)},children:[Object(f.jsx)(o.r,{className:Fn.a.icon,icon:u.O}),Object(f.jsx)(o.z,{children:c.formatMessage({id:"app.group-chat.add-members"})})]}):null}(I),Object(f.jsx)(o.w,{lines:"none",className:Fn.a["member-title"],children:Object(f.jsx)("h3",{children:c.formatMessage({id:"app.group-chat.members-label"})})}),function(e){return e.map((function(e){var t=e.id===I.creator;return Object(f.jsxs)(o.w,{lines:"none",children:[Object(f.jsxs)(o.z,{className:Fn.a["member-name"],children:[e.username,Object(f.jsx)("br",{}),t?c.formatMessage({id:"app.group-chat.admin-role"}):c.formatMessage({id:"app.group-chat.member-role"})]}),k(e)]},e.id)}))}(E)]})}),Object(f.jsx)(zn,{contacts:S,members:E,setMembers:T,isOpen:j,onCancel:function(){return m(!1)},groupId:t,groupRevisionId:n,setLoading:v})]})},Zn=function(e){var t=e.onCancel,n=e.onSave,a=e.setName,r=e.name,c=Object(l.a)();return Object(f.jsxs)("div",{className:Rn.a.modal,children:[Object(f.jsx)(o.fb,{children:Object(f.jsx)(o.cb,{children:c.formatMessage({id:"app.group-chat.update-group-name-title"})})}),Object(f.jsxs)(o.w,{className:"input",children:[Object(f.jsx)(o.z,{color:"medium",position:"floating",children:c.formatMessage({id:"app.group-chat.update-group-name-placeholder"})}),Object(f.jsx)(o.v,{clearInput:!0,className:Rn.a["ion-input"],value:r,onIonChange:function(e){return a(e.detail.value)}})]}),Object(f.jsxs)(o.f,{slot:"end",className:"input",children:[Object(f.jsx)(o.e,{slot:"end",onClick:t,children:Object(f.jsx)(o.z,{children:c.formatMessage({id:"app.group-chat.update-group-name-cancel"})})}),Object(f.jsx)(o.e,{disabled:!r.length,slot:"end",onClick:function(){n(r)},children:Object(f.jsx)(o.z,{children:c.formatMessage({id:"app.group-chat.update-group-name-save"})})})]})]})},Vn=function(){var e=Object(I.f)(),t=Object(I.h)().group,n=Object(x.l)(),r=Object(p.c)((function(e){return e.groups.conversations[t]})),c=Object(p.c)((function(e){return e.profile})),s=Object(p.c)((function(e){return e.groups})),l=s.conversations,d=s.messages,b=Object(p.c)((function(e){return e.groups.groupFiles})),j=Object(a.useState)(!1),m=Object(i.a)(j,2),O=m[0],g=m[1],h=Object(a.useState)(!1),v=Object(i.a)(h,2),y=v[0],_=v[1],E=Object(a.useState)({}),T=Object(i.a)(E,1)[0],S=Object(a.useState)({}),N=Object(i.a)(S,1)[0],w=Object(a.useState)([]),k=Object(i.a)(w,1)[0],M=Object(a.useState)([]),R=Object(i.a)(M,1)[0],P=Object(a.useState)("Info"),C=Object(i.a)(P,2),A=C[0],G=C[1],L=Object(a.useState)(""),D=Object(i.a)(L,2),H=D[0],z=D[1],U=Object(a.useRef)(null),F=function(e){void 0!==b[e.fileHash]?B(b[e.fileHash],e.fileName):n(he([e.fileHash])).then((function(t){t&&Object.keys(t).length>0&&B(t[e.fileHash],e.fileName)}))},B=function(e,t){var n=new Blob([e]),a=document.createElement("a");a.href=window.URL.createObjectURL(n),a.download=t,a.click()},Z=function(e,a,r){var c=a;void 0!==c&&n(oe({groupId:t,lastFetched:c.groupMessageId,lastMessageTimestamp:c.timestamp,batchSize:5,payloadType:r})).then((function(t){e()}))};return Object(a.useEffect)((function(){void 0!==l[t]&&l[t].messages.forEach((function(e){var t=d[e];if(t&&"FILE"===t.payload.type)switch(t.payload.fileType){case"IMAGE":case"VIDEO":T[t.groupMessageId]||(T[t.groupMessageId]=!0,k.push(t));break;case"OTHER":N[t.groupMessageId]||(N[t.groupMessageId]=!0,R.push(t))}}))}),[l,d]),Object(a.useEffect)((function(){n(oe({groupId:t,batchSize:40,payloadType:{type:"MEDIA",payload:null}}))}),[]),Object(a.useEffect)((function(){n(oe({groupId:t,batchSize:40,payloadType:{type:"FILE",payload:null}}))}),[]),Object(f.jsx)(f.Fragment,{children:r?Object(f.jsxs)(o.H,{children:[Object(f.jsxs)(o.q,{className:Rn.a.header,children:[Object(f.jsxs)(o.fb,{children:[Object(f.jsx)(o.f,{children:Object(f.jsx)(o.e,{onClick:function(){e.goBack()},className:"ion-no-padding",children:Object(f.jsx)(o.r,{slot:"icon-only",icon:u.e})})}),Object(f.jsx)(In,{onClickEdit:function(){return g(!O),void _(!y)},onClickNotif:function(){},disabled:r.creator!==c.id})]}),Object(f.jsx)(o.cb,{className:Rn.a.groupname,children:r.name}),Object(f.jsx)(kn,{value:A,onSegmentChange:function(e){var t,n;switch(e){case"Info":default:n=0;break;case"Media":n=1;break;case"Files":n=2}null===(t=U.current)||void 0===t||t.slideTo(n)}})]}),Object(f.jsx)(o.k,{children:Object(f.jsxs)(o.T,{ref:U,className:"slides",pager:!1,options:{initialSlide:0,speed:400},onIonSlideDidChange:function(){var e,t=["Info","Media","Files"];null===(e=U.current)||void 0===e||e.getActiveIndex().then((function(e){return G(t[e])}))},children:[Object(f.jsx)(o.S,{children:Object(f.jsx)(Bn,{groupId:t,groupRevisionId:r.originalGroupRevisionId})}),Object(f.jsx)(o.S,{children:Object(f.jsx)(nn,{orderedMediaMessages:k,onDownload:function(e){return F(e)},onScrollBottom:function(e,t){return Z(e,t,{type:"MEDIA",payload:null})}})}),Object(f.jsx)(o.S,{children:Object(f.jsx)(an,{orderedFileMessages:R,onDownload:function(e){return F(e)},onScrollBottom:function(e,t){return Z(e,t,{type:"FILE",payload:null})}})})]})}),Object(f.jsx)(o.F,{isOpen:y,cssClass:"my-custom-modal-css",children:Object(f.jsx)(Zn,{setName:z,name:H,onCancel:function(){return _(!1)},onSave:function(e){return function(e){n(ye({name:e,groupId:r.originalGroupId,groupRevisionId:r.originalGroupRevisionId})).then((function(e){e&&(z(""),_(!1))}))}(e)}})})]}):Object(f.jsx)(o.C,{isOpen:!0})})},Yn=function(){var e=Object(I.h)().group,t=Object(l.a)(),n=Object(I.f)(),r=Object(x.l)(),c=Object(a.useState)(null),s=Object(i.a)(c,2),d=s[0],b=s[1],j=Object(p.c)((function(t){var n;return{conversation:t.groups.conversations[e],pinnedMesssages:null===(n=t.groups.conversations[e])||void 0===n?void 0:n.pinnedMessages}})),m=j.conversation,g=j.pinnedMesssages;return Object(a.useEffect)((function(){var t;r((t=e,function(){var e=Object(O.a)(h.a.mark((function e(n,a,r){var c,s,o,i,u,l,p;return h.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(c=r.callZome,s=r.getAgentId,!(o=a().groups.conversations[t])){e.next=19;break}if(!(i=o.pinnedMessages)||0!==i.filter((function(e){return void 0===a().groups.pinnedMessages[e]})).length){e.next=16;break}return u=i.map((function(e){return a().groups.messages[e].author})),e.next=8,s();case 8:if(!(l=e.sent)){e.next=14;break}return e.next=12,B(a(),u,c,Object(v.b)(l));case 12:return p=e.sent,e.abrupt("return",i.map((function(e){var t=a().groups.pinnedMessages[e],n=p[t.author];return{id:t.groupMessageId,payload:t.payload,author:n?n.username:t.author,date:t.timestamp}})));case 14:e.next=17;break;case 16:n(vn(t));case 17:e.next=20;break;case 19:n(se(t));case 20:return e.abrupt("return",null);case 21:case"end":return e.stop()}}),e)})));return function(t,n,a){return e.apply(this,arguments)}}())).then((function(e){return b(e)}))}),[m,g]),Object(f.jsxs)(o.H,{children:[Object(f.jsx)(o.q,{children:Object(f.jsx)(o.fb,{children:Object(f.jsxs)(o.f,{children:[Object(f.jsx)(o.e,{onClick:function(){return n.push({pathname:"/g/".concat(e)})},className:"ion-no-padding",children:Object(f.jsx)(o.r,{slot:"icon-only",icon:u.e})}),Object(f.jsx)(o.cb,{children:t.formatMessage({id:"app.group-chat.pinned-message-title"})})]})})}),Object(f.jsx)(o.k,{children:d?Object(f.jsx)(On,{type:"group",onMessageClick:function(e){},messages:d}):null})]})},Xn=function(e,t){return function(){var n=Object(O.a)(h.a.mark((function n(a,r,c){var s;return h.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return s=c.callZome,n.next=3,B(r(),e,s,t);case 3:return n.abrupt("return",n.sent);case 4:case"end":return n.stop()}}),n)})));return function(e,t,a){return n.apply(this,arguments)}}()},Jn=function(){var e=Object(a.useState)(),t=Object(i.a)(e,2),n=t[0],r=t[1],c=Object(I.h)().group,s=Object(p.c)((function(e){return e.profile})).id,o=Object(x.l)();return Object(f.jsx)(bn,{messages:n,onDateSelect:function(e){o(ie({groupId:c,date:e,payloadType:{type:"ALL",payload:null}})).then((function(e){var t=e.messagesByGroup[c].map((function(t){var n=e.groupMessagesContents[t];return{id:n.groupId,author:{id:n.author},timestamp:n.timestamp,payload:n.payload,readList:n.readList,replyTo:n.replyTo}}));o(Xn(t.map((function(e){return e.author.id})),s)).then((function(e){r(t.map((function(t){return Object(d.a)(Object(d.a)({},t),{},{author:Object(d.a)({},e[t.author.id])})})))}))}))},prevHref:"/g/".concat(c),type:"group"})},qn=function(){return Object(f.jsxs)(I.d,{children:[Object(f.jsx)(I.b,{path:"/g/:group",exact:!0,children:Object(f.jsx)(wn,{})}),Object(f.jsx)(I.b,{path:"/g/:group/details",exact:!0,children:Object(f.jsx)(Vn,{})}),Object(f.jsx)(I.b,{path:"/g/:group/search",exact:!0,children:Object(f.jsx)(Jn,{})}),Object(f.jsx)(I.b,{path:"/g/:group/pinned",exact:!0,children:Object(f.jsx)(Yn,{})})]})},Kn=n(278),Wn=function(e){var t=e.contact,n=Object(I.f)();return Object(f.jsx)(o.w,{onClick:function(){return n.push({pathname:"/p/".concat(t.id),state:{profile:t}})},children:Object(f.jsx)(Bt,{displayAvatar:!0,avatar:t.fields.avatar,nickname:t.username,id:t.id})},JSON.stringify(t))},Qn=function(e){var t=e.char,n=e.contacts;return Object(f.jsxs)(r.a.Fragment,{children:[Object(f.jsx)(o.x,{children:Object(f.jsx)(o.z,{children:t})}),n.map((function(e){return Object(f.jsx)(Wn,{contact:e},JSON.stringify(e))}))]},t)},$n=n(159),ea=n.n($n),ta=function(e){var t=e.contacts;return Object(f.jsx)(o.A,{className:ea.a["contacts-list"],children:Object.keys(t).map((function(e){var n=t[e];return Object(f.jsx)(Qn,{char:e,contacts:n},e)}))})},na=function(e){var t=e.onChange,n=e.noSearch,r=Object(a.useState)(!1),c=Object(i.a)(r,2),s=c[0],l=c[1];return Object(f.jsx)(o.q,{children:Object(f.jsx)(o.fb,{children:s?Object(f.jsx)(o.N,{onIonChange:function(e){return t(e)},showCancelButton:"always",debounce:500,onIonCancel:function(){return l(!1)}}):Object(f.jsxs)(f.Fragment,{children:[Object(f.jsx)(o.f,{slot:"start",children:Object(f.jsx)(o.E,{})}),n?null:Object(f.jsx)(o.f,{slot:"end",children:Object(f.jsx)(o.e,{onClick:function(){return l(!0)},children:Object(f.jsx)(o.r,{icon:u.Z,slot:"icon-only"})})})]})})})},aa=function(e){var t=e.onClick;return Object(f.jsx)(o.m,{vertical:"bottom",horizontal:"end",slot:"fixed",children:Object(f.jsx)(o.n,{onClick:t,children:Object(f.jsx)(o.r,{icon:u.a})})})},ra=n(160),ca=n.n(ra),sa=function(e){var t=e.onChange,n=e.onCancel,a=Object(l.a)();return Object(f.jsx)(o.q,{children:Object(f.jsx)(o.fb,{children:Object(f.jsx)(o.N,{placeholder:a.formatMessage({id:"app.contacts.search"}),showCancelButton:"always",onIonChange:t,onIonCancel:n,debounce:700})})})},oa=function(e){var t=e.contact,n=e.onCompletion,r=Object(a.useState)(!1),c=Object(i.a)(r,2),s=c[0],l=c[1],p=Object(x.l)();return Object(f.jsxs)(o.w,{lines:"none",children:[Object(f.jsx)(Bt,{displayAvatar:!0,avatar:t.fields.avatar,nickname:t.username,id:t.id}),Object(f.jsx)(o.f,{slot:"end",children:s?Object(f.jsx)(o.U,{}):Object(f.jsx)(o.e,{onClick:function(){l(!0),p(wt(t)).then((function(e){e?n(t):l(!1)}))},children:Object(f.jsx)(o.r,{icon:u.a})})})]})},ia=function(e){var t=e.index,n=e.contacts,a=e.onCompletion;return Object(f.jsxs)(r.a.Fragment,{children:[Object(f.jsx)(o.x,{children:Object(f.jsx)(o.z,{children:t})}),n.map((function(e){return Object(f.jsx)(oa,{contact:e,onCompletion:a},JSON.stringify(e.id))}))]})},ua=function(e){var t=e.isOpen,n=e.onCancel,r=lt().showToast,c=Object(l.a)(),s=Object(p.c)((function(e){return e.contacts.contacts})),u=Object(a.useState)([]),b=Object(i.a)(u,2),j=b[0],m=b[1],O=Object(x.l)(),g=Object(x.f)(j),h=function(e){r({message:c.formatMessage({id:"app.contacts.add-message"},{name:e.username}),color:"light",duration:1e3}),O({type:H.b,contacts:Object(d.a)({},s)}),m((function(t){return t.filter((function(t){return t.id!==e.id}))}))};return Object(f.jsxs)(o.F,{isOpen:t,onDidDismiss:n,children:[Object(f.jsx)(sa,{onChange:function(e){var t;(t=e.detail.value).length>=3?O(N(t)).then((function(e){if(e){var n=e.filter((function(e){return e.username.toLowerCase().includes(t.toLowerCase())}));m(n)}})):t.length>0&&t.length<3?setTimeout(r({color:"warning",message:c.formatMessage({id:"app.contacts.search-nickname-warning"})}),300):m([])},onCancel:n}),Object(f.jsx)(o.k,{children:Object(f.jsx)(o.A,{className:ca.a["contacts-list"],children:Object.keys(g).map((function(e){var t=g[e];return Object(f.jsx)(ia,{onCompletion:h,index:e,contacts:t},e)}))})})]})},la=n(161),pa=n.n(la),da=function(){var e=Object(l.a)();return Object(f.jsxs)("div",{className:pa.a["empty-contacts"],children:[Object(f.jsx)(o.r,{icon:u.Y}),Object(f.jsx)(o.Z,{className:"ion-padding ion-margin-bottom",children:e.formatMessage({id:"app.contacts.empty-contact-list"})})]})},ba=function(){var e=Object(a.useState)(!1),t=Object(i.a)(e,2),n=t[0],r=t[1],c=Object(a.useState)(""),s=Object(i.a)(c,2),u=s[0],l=s[1],d=Object(a.useState)(),b=Object(i.a)(d,2),j=b[0],O=b[1],g=Object(x.l)(),h=Object(p.c)((function(e){return e.contacts.contacts}));Object(a.useEffect)((function(){O(!0),g(kt()).then((function(e){O(!1)}))}),[g]);var v=Object(x.f)(Object.values(h).filter((function(e){return e.username.toLowerCase().includes(u.toLowerCase())})));return Object(f.jsxs)(o.H,{children:[Object(f.jsx)(na,{onChange:function(e){return l(e.detail.value)}}),Object(f.jsxs)(o.k,{children:[j?Object(f.jsx)(m,{name:"crescent"}):0!==Object.values(h).length?Object(f.jsx)(ta,{contacts:v||{}}):Object(f.jsx)(da,{}),Object(f.jsx)(ua,{contacts:h,isOpen:n,onCancel:function(){return r(!1)}}),Object(f.jsx)(aa,{onClick:function(){return r(!0)}})]})]})},ja=n(134),fa=n.n(ja),ma=function(e){var t,n=e.conversation,a=e.myAgentId,r=e.onClick,c=Object(l.a)();return Object(f.jsxs)(o.w,{onClick:r,children:[Object(f.jsx)(o.b,{slot:"start",children:Object(f.jsx)("img",{className:fa.a.avatar,src:"group"===n.type?u.L:n.avatar?n.avatar:u.P,alt:"avatar"})}),Object(f.jsxs)(o.z,{children:["group"===n.type?Object(f.jsx)("h2",{children:n.conversationName}):Object(f.jsx)("div",{className:fa.a.identifier,children:Object(f.jsx)(Bt,{noSpace:!0,nickname:n.conversationName,id:n.id,charToShow:10})}),n.latestMessage.sender?Object(f.jsx)("h3",{children:n.latestMessage.sender.username}):null,Object(f.jsx)("p",{children:"TEXT"===n.latestMessage.payloadType?n.latestMessage.textPayload:a===n.latestMessage.sender.id?(t=n.latestMessage,c.formatMessage({id:"components.conversation.me-file-string"},{fileName:t.fileName})):function(e){return c.formatMessage({id:"components.conversation.other-file-string"},{fileName:e.fileName,name:e.sender.username})}(n.latestMessage)})]}),n.badgeCount?n.badgeCount>20?Object(f.jsx)(o.d,{slot:"",children:"20+"}):n.badgeCount>0?Object(f.jsx)(o.d,{slot:"",children:n.badgeCount}):null:null]})},Oa=function(e){return function(t,n){var a=n().p2pmessages,r=a.conversations,c=a.messages,s=a.receipts,o=r[e].messages,i=0;return o.forEach((function(t){var n=c[t],a=n.receipts.map((function(e){return s[e]}));a.sort((function(e,t){var n=e.timestamp.getTime(),a=t.timestamp.getTime();return n>a?-1:n<a?1:0}));var r=a[0];r&&"read"!==r.status&&n.author.id===e&&(i+=1)})),i}},ga=n(162),ha=n.n(ga),va=function(){var e=Object(l.a)();return Object(f.jsxs)("div",{className:ha.a["empty-conversations"],children:[Object(f.jsx)(o.r,{icon:u.Y}),Object(f.jsx)(o.Z,{className:"ion-padding ion-margin-bottom",children:e.formatMessage({id:"app.conversations.empty-conversations"})})]})},ya=n(163),xa=n.n(ya),_a=function(){var e,t=Object(I.f)(),n=Object(x.l)(),a=Object(l.a)(),r=Object(p.c)((function(e){return e.contacts.contacts})),c=Object(p.c)((function(e){return e.profile})),s=Object(p.c)((function(e){return e.groups})),i=Object(p.c)((function(e){return e.p2pmessages}));return Object(f.jsxs)(o.H,{children:[Object(f.jsx)(na,{noSearch:!0,onChange:function(){}}),Object(f.jsxs)(o.k,{children:[(e=function(e,t){var s=[];if(Object.keys(t.conversations).length>0)for(var o in t.conversations)if(void 0!==r[o]){var i=r[o],u=t.conversations[o].messages[0],l=t.messages[u],p=void 0,d=null;if(l)p={id:l.p2pMessageEntryHash,sender:{id:l.author.id,username:l.author.id===c.id?"You":i.username,fields:l.author.id===c.id?c.fields:i.fields},payloadType:l.payload.type,textPayload:Object(z.d)(l.payload)?l.payload.payload.payload:void 0,fileName:Object(z.d)(l.payload)?void 0:l.payload.fileName,timestamp:l.timestamp},d={type:"p2p",id:o,avatar:i.fields.avatar?i.fields.avatar:void 0,conversationName:i.username,latestMessage:p,badgeCount:n(Oa(i.id))};else if(t.errMsgs[o][0]){var b=t.errMsgs[o][0];p={id:b.p2pMessageEntryHash,sender:{id:b.author.id,username:b.author.id===c.id?"You":i.username,fields:b.author.id===c.id?c.fields:i.fields},payloadType:b.payload.type,textPayload:Object(z.d)(b.payload)?b.payload.payload.payload:void 0,fileName:Object(z.d)(b.payload)?void 0:b.payload.fileName,timestamp:b.timestamp},d={type:"p2p",id:o,conversationName:i.username,latestMessage:p,badgeCount:n(Oa(i.id))}}d&&s.push(d)}if(Object.keys(e.conversations).length>0){var j=e.messages,f=e.members;Object.keys(e.conversations).forEach((function(t){var r,o=e.conversations[t].messages[0],i=j[o],u=null;if(i)r={id:i.groupMessageId,sender:f[i.author]?{id:f[i.author].id,username:f[i.author].username,fields:f[i.author].fields}:{id:c.id,username:c.username,fields:c.fields},payloadType:i.payload.type,timestamp:i.timestamp,textPayload:Object(z.d)(i.payload)?i.payload.payload.payload:void 0,fileName:Object(z.d)(i.payload)?void 0:i.payload.fileName},u={id:t,type:"group",conversationName:e.conversations[t].name,latestMessage:r,badgeCount:n(ce(t))};else if(e.errMsgs[t]){var l=e.errMsgs[t][0];r={id:l.groupMessageId,sender:l.author,payloadType:l.payload.type,timestamp:l.timestamp,textPayload:Object(z.d)(l.payload)?l.payload.payload.payload:void 0,fileName:Object(z.d)(l.payload)?void 0:l.payload.fileName},u={id:t,type:"group",conversationName:e.conversations[t].name,latestMessage:r,badgeCount:n(ce(t))}}else r={id:"no message",sender:void 0,payloadType:"TEXT",timestamp:new Date,textPayload:a.formatMessage({id:"app.conversations.no-group-messages"}),fileName:void 0},u={id:t,type:"group",conversationName:e.conversations[t].name,latestMessage:r,badgeCount:n(ce(t))};u&&s.push(u)}))}return s.sort((function(e,t){return e.latestMessage.timestamp.valueOf()<t.latestMessage.timestamp.valueOf()?1:-1})),s}(s,i),Object.keys(e).length>0?Object(f.jsx)(o.A,{className:xa.a.conversation,children:e.map((function(e){return Object(f.jsx)(ma,{conversation:e,myAgentId:c.id,onClick:function(){return function(e){return"group"===e.type?t.push("/g/".concat(e.id)):t.push({pathname:"/u/".concat(e.id),state:{username:e.conversationName}})}(e)}},e.id)}))}):Object(f.jsx)(va,{})),Object(f.jsx)(o.m,{vertical:"bottom",horizontal:"end",slot:"fixed",children:Object(f.jsx)(o.n,{onClick:function(){t.push({pathname:"/compose",state:{contacts:Object(d.a)({},r)}})},children:Object(f.jsx)(o.r,{icon:u.K})})})]})]})},Ea=n(164),Ta=n.n(Ea),Sa=function(){return Object(f.jsxs)(o.Y,{children:[Object(f.jsxs)(o.L,{id:"home",children:[Object(f.jsx)(I.a,{exact:!0,path:"/home",to:"/home/messaging"}),Object(f.jsx)(I.b,{path:"/home/messaging",render:function(){return Object(f.jsx)(_a,{})},exact:!0}),Object(f.jsx)(I.b,{path:"/home/contacts",render:function(){return Object(f.jsx)(ba,{})},exact:!0})]}),Object(f.jsxs)(o.W,{slot:"bottom",className:Ta.a["home-tab-bar"],children:[Object(f.jsxs)(o.X,{tab:"messaging",href:"/home/messaging",children:[Object(f.jsx)(o.r,{icon:u.k}),Object(f.jsx)(o.z,{children:Object(f.jsx)(Kn.a,{id:"app.home.messaging-tab-bar"})})]}),Object(f.jsxs)(o.X,{tab:"contacts",href:"/home/contacts",children:[Object(f.jsx)(o.r,{icon:u.N}),Object(f.jsx)(o.z,{children:Object(f.jsx)(Kn.a,{id:"app.home.contacts-tab-bar"})})]})]})]})},Na=n(75),wa=n.n(Na),Ia=Object(a.createContext)([{},function(){},{},function(){}]),ka=function(){var e=Object(a.useContext)(Ia);if(!e)throw Error("No context found");return e},Ma=function(e){var t=e.contact,n=e.onClick;return Object(f.jsx)(o.w,{onClick:function(){return n(t)},children:Object(f.jsx)(Bt,{displayAvatar:!0,avatar:t.fields.avatar,nickname:t.username,id:t.id})})},Ra=function(e){var t=e.char,n=e.contacts,a=ka()[1],c=ka()[3],s=function(e){c((function(t){return t[e.id]=e,t})),a((function(t){var n=Object(d.a)({},t);return delete n[e.id],n}))};return Object(f.jsxs)(r.a.Fragment,{children:[Object(f.jsx)(o.x,{children:Object(f.jsx)(o.z,{children:t})}),n.map((function(e){return Object(f.jsx)(Ma,{contact:e,onClick:s},JSON.stringify(e))}))]},t)},Pa=function(e){var t=e.contacts,n=Object(x.f)(Object.values(t));return Object(f.jsx)(o.A,{className:wa.a["contacts-list"],children:Object.keys(n).map((function(e){var t=n[e];return Object(f.jsx)(Ra,{char:e,contacts:t},e)}))})},Ca=n(165),Aa=n.n(Ca),Ga=function(){var e=Object(l.a)(),t=Object(I.f)();return Object(f.jsx)(o.q,{className:Aa.a.header,children:Object(f.jsxs)(o.fb,{children:[Object(f.jsx)(o.f,{slot:"start",children:Object(f.jsx)(o.e,{onClick:function(){return t.push({pathname:"/home"})},className:"ion-no-padding",children:Object(f.jsx)(o.r,{slot:"icon-only",icon:u.e})})}),Object(f.jsx)(o.cb,{children:e.formatMessage({id:"app.new-conversation.header-title"})})]})})},La=n(135),Da=n.n(La),Ha=function(e){var t=e.contacts,n=e.onCloseButtonPress,r=e.onSearch,c=Object(a.useState)(""),s=Object(i.a)(c,2),p=s[0],d=s[1],b=Object(l.a)();return Object(a.useEffect)((function(){r(p)}),[p,r]),Object(f.jsxs)("div",{className:"".concat(Da.a.recipients," ion-padding"),children:[Object(f.jsxs)(o.z,{className:Da.a.to,children:[b.formatMessage({id:"app.new-conversation.to"}),":"]}),Object.values(t).map((function(e){return Object(f.jsxs)(o.i,{children:[Object(f.jsx)(o.z,{children:e.username}),Object(f.jsx)(o.r,{icon:u.s,onClick:function(){return n(e)}})]},JSON.stringify(e))})),Object(f.jsx)(o.v,{type:"text",placeholder:b.formatMessage({id:"app.new-conversation.search-placeholder"}),onIonChange:function(e){return d(e.detail.value)},value:p,debounce:500})]})},za=function(){var e=Object(x.l)(),t=Object(l.a)(),n=Object(I.f)(),r=Object(I.g)(),c=lt().showErrorToast,s=Object(a.useState)({}),p=Object(i.a)(s,2),b=p[0],j=p[1],m=Object(a.useState)({}),O=Object(i.a)(m,2),g=O[0],h=O[1],v=Object(a.useState)(""),y=Object(i.a)(v,2),_=y[0],E=y[1],T=Object(a.useState)(""),S=Object(i.a)(T,2),N=S[0],w=S[1],k=Object(a.useState)([]),M=Object(i.a)(k,2),R=M[0],P=M[1],C=Object(a.useState)(!1),A=Object(i.a)(C,2),G=A[0],L=A[1];Object(a.useEffect)((function(){E("")}),[b,g]),Object(a.useEffect)((function(){return void 0!==r.state&&j(r.state.contacts),function(){return j({})}}),[r.state]);return Object(f.jsx)(Ia.Provider,{value:[b,j,g,h],children:Object(f.jsxs)(o.H,{children:[Object(f.jsx)(o.C,{isOpen:G}),Object(f.jsx)(Ga,{}),Object(f.jsxs)(o.k,{className:wa.a.list,children:[Object(f.jsx)(Ha,{contacts:g,onCloseButtonPress:function(e){h((function(t){return delete t[e.id],Object(d.a)({},t)})),j((function(t){return t[e.id]=e,Object(d.a)({},t)}))},onSearch:E}),Object(f.jsx)(Pa,{contacts:Object.values(b).filter((function(e){return e.username.includes(_)}))})]}),1===Object.values(g).length?Object(f.jsxs)("div",{className:wa.a.warning,children:[Object(f.jsx)(o.r,{icon:u.db,color:"warning",className:wa.a["warning-icon"]}),Object(f.jsx)(o.Z,{color:"warning",children:"Currently, p2p message only gets sent when the receiver is online"})]}):null,Object(f.jsx)(Nt,{onSend:function(a){var r=Object.values(g),s=Object(d.a)({},a).message;if(1===r.length)s&&""!==s&&(L(!0),e(Object(Ht.a)(r[0].id,s,"TEXT",void 0)).then((function(t){!t&&R.length<=0?(L(!1),e(zt(r[0].id,N,"TEXT",void 0)),n.push({pathname:"/u/".concat(r[0].id),state:{username:r[0].username}})):t||e(zt(r[0].id,N,"TEXT",void 0)),R.length<=0&&!0===t?(L(!1),n.push({pathname:"/u/".concat(r[0].id),state:{username:r[0].username}})):R.length&&R.forEach((function(t){e(Object(Ht.a)(r[0].id,N,"FILE",void 0,t)).then((function(a){!0===a?(L(!1),n.push({pathname:"/u/".concat(r[0].id),state:{username:r[0].username}})):(e(zt(r[0].id,N,"FILE",void 0,t)),L(!1),n.push({pathname:"/u/".concat(r[0].id),state:{username:r[0].username}}))}))}))}))),""===N&&R.length&&R.forEach((function(t){L(!0),e(Object(Ht.a)(r[0].id,N,"FILE",void 0,t)).then((function(a){L(!1),!0===a||(e(zt(r[0].id,N,"FILE",void 0,t)),L(!1)),n.push({pathname:"/u/".concat(r[0].id),state:{username:r[0].username}})}))}));else if(r.length>1){L(!0);var o=R.map((function(e){return{type:"FILE",payload:{metadata:{fileName:e.metadata.fileName,fileSize:e.metadata.fileSize,fileType:e.metadata.fileType},fileType:e.fileType,fileBytes:e.fileBytes}}}));e(Oe(r,s||N,o)).then((function(e){L(!1),!1!==e&&n.push("/g/".concat(e.groupResult.originalGroupId))}))}else c({message:t.formatMessage({id:"app.new-conversation.no-contacts-toast"})})},onChange:function(e){return w(e)},onFileSelect:function(e){return P(e)}})]})})},Ua=n(166),Fa=n.n(Ua),Ba=function(e){var t=e.popover,n=e.dismiss,r=e.profile,c=Object(a.useState)(!1),s=Object(i.a)(c,2),b=s[0],j=s[1],m=Object(a.useState)(!1),O=Object(i.a)(m,2),g=O[0],h=O[1],v=r.id,y=Object(x.l)(),_=Object(l.a)(),E=Object(p.c)((function(e){return e.profile.username})),T=Object(p.c)((function(e){return e.contacts})),S=T.contacts,N=T.blocked;Object(a.useEffect)((function(){j(v in S),h(v in N)}),[S,N,v]);return Object(f.jsx)(o.I,Object(d.a)(Object(d.a)({},t.event?{event:t.event}:{}),{},{isOpen:t.isVisible,onDidDismiss:n,children:Object(f.jsxs)(o.A,{className:"".concat(Fa.a["popover-list"]),children:[!g&&b?Object(f.jsxs)(o.w,{onClick:function(){y(Mt(r)).then((function(e){j(!e)}))},children:[Object(f.jsx)(o.r,{icon:u.Q}),Object(f.jsx)(o.z,{className:"ion-padding-start",children:_.formatMessage({id:"app.contacts.remove"})})]}):Object(f.jsxs)(o.w,{disabled:g,onClick:function(){y(wt(r)).then((function(e){j(e)}))},children:[Object(f.jsx)(o.r,{icon:u.O}),Object(f.jsx)(o.z,{className:"ion-padding-start",children:_.formatMessage({id:"app.contacts.add"})})]}),E!==r.username?g?Object(f.jsxs)(o.w,{onClick:function(){y(Rt(r)).then((function(e){h(!e)}))},children:[Object(f.jsx)(o.r,{icon:u.h}),Object(f.jsx)(o.z,{className:"ion-padding-start",children:_.formatMessage({id:"app.contacts.unblock"})})]}):Object(f.jsxs)(o.w,{onClick:function(){y(It(r)).then((function(e){h(e)}))},children:[Object(f.jsx)(o.r,{icon:u.h}),Object(f.jsx)(o.z,{className:"ion-padding-start",children:_.formatMessage({id:"app.contacts.block"})})]}):null]})}))},Za=function(e){var t=e.profile,n=Object(a.useState)({isVisible:!1,event:void 0}),r=Object(i.a)(n,2),c=r[0],s=r[1];return Object(f.jsxs)(f.Fragment,{children:[Object(f.jsx)(o.f,{slot:"end",children:Object(f.jsx)(o.e,{onClick:function(e){e.persist(),s({isVisible:!0,event:e})},children:Object(f.jsx)(o.r,{icon:u.A})})}),Object(f.jsx)(Ba,{profile:t,popover:c,dismiss:function(){return s({isVisible:!1,event:void 0})}})]})},Va=n(81),Ya=n.n(Va),Xa=function(){var e=Object(a.useRef)(!0),t=Object(I.g)().state,n=Object(I.f)(),r=Object(a.useState)(null),c=Object(i.a)(r,2),s=c[0],l=c[1];return Object(a.useEffect)((function(){return e.current=!0,function(){e.current=!1}}),[]),Object(a.useEffect)((function(){l(t.profile)}),[null===t||void 0===t?void 0:t.profile]),Object(f.jsxs)(o.H,{children:[Object(f.jsxs)(o.q,{className:Ya.a.header,children:[Object(f.jsxs)(o.fb,{children:[Object(f.jsx)(o.f,{children:Object(f.jsx)(o.e,{onClick:function(){return n.push({pathname:null!==t&&void 0!==t&&t.prev?t.prev:"/home/contacts"})},className:"ion-no-padding",children:Object(f.jsx)(o.r,{slot:"icon-only",icon:u.e})})}),s?Object(f.jsx)(Za,{profile:s}):null]}),Object(f.jsx)(o.fb,{className:Ya.a["profile-picture-toolbar"],children:s&&s.fields.avatar?Object(f.jsx)(o.b,{className:Ya.a["profile-picture"],children:Object(f.jsx)("img",{src:s.fields.avatar,alt:"avatar"})}):null}),Object(f.jsx)(o.fb,{className:Ya.a["profile-toolbar"],children:Object(f.jsx)(o.cb,{className:Ya.a.nickname,children:s?s.username:""})})]}),Object(f.jsx)(sn,{id:t.profile.id,nickname:t.profile.username})]})},Ja=n(102),qa=function(e){return function(t){t({type:Ja.a,language:e})}},Ka=[{language:"English",code:"en"},{language:"\u65e5\u672c\u8a9e",code:"jp"}],Wa=function(){var e=Object(l.a)(),t=Object(p.c)((function(e){return e.language.language})),n=Ka.find((function(e){return e.code===t})),a=Object(x.l)(),r=Object(I.f)();return Object(f.jsxs)(o.A,{children:[Object(f.jsx)(o.B,{children:e.formatMessage({id:"app.settings.language-label"})}),Object(f.jsx)(o.w,{children:Object(f.jsx)(o.Q,{onIonChange:function(e){a(qa(e.detail.value)),r.push("/")},slot:"end",value:n.code,children:Ka.map((function(e){return Object(f.jsx)(o.R,{value:e.code,children:e.language},e.code)}))})})]})},Qa=function(e){return function(){var t=Object(O.a)(h.a.mark((function t(n,a,r){var c,s,o;return h.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return c=r.callZome,s=Object.keys(e).map((function(t){return Object(D.a)({},t,e[t])})),t.next=4,c({zomeName:y.c.PREFERENCE,fnName:y.a[y.c.PREFERENCE].SET_PREFERENCE,payload:Object.assign.apply(Object,[{}].concat(Object(q.a)(s)))});case 4:o=t.sent,n({type:X.a,preference:{readReceipt:o.readReceipt,typingIndicator:o.typingIndicator}});case 6:case"end":return t.stop()}}),t)})));return function(e,n,a){return t.apply(this,arguments)}}()},$a=function(){var e=Object(p.c)((function(e){return e.preference})),t=e.typingIndicator,n=e.readReceipt,a=Object(x.l)(),r=Object(l.a)();return Object(f.jsxs)(o.A,{children:[Object(f.jsx)(o.B,{children:Object(f.jsx)(o.z,{children:Object(f.jsx)("h1",{children:r.formatMessage({id:"app.settings.preference-label"})})})}),Object(f.jsxs)(o.w,{children:[Object(f.jsx)(o.z,{children:r.formatMessage({id:"app.settings.typing-indicator-label"})}),Object(f.jsx)(o.eb,{checked:t,onIonChange:function(){return a(Qa({typingIndicator:!t}))}})]}),Object(f.jsxs)(o.w,{children:[Object(f.jsx)(o.z,{children:r.formatMessage({id:"app.settings.read-receipt-label"})}),Object(f.jsx)(o.eb,{checked:n,onIonChange:function(){return a(Qa({readReceipt:!n}))}})]})]})},er=function(){var e=Object(I.f)();return Object(f.jsx)(o.q,{children:Object(f.jsx)(o.fb,{children:Object(f.jsx)(o.f,{slot:"start",children:Object(f.jsx)(o.e,{onClick:function(){return e.push({pathname:"/home"})},className:"ion-no-padding",children:Object(f.jsx)(o.r,{slot:"icon-only",icon:u.e})})})})})},tr=n(167),nr=n.n(tr),ar=function(){return Object(f.jsxs)(o.H,{children:[Object(f.jsx)(er,{}),Object(f.jsxs)(o.k,{className:nr.a["settings-list"],children:[Object(f.jsx)($a,{}),Object(f.jsx)(Wa,{})]})]})},rr=function(){var e=Object(a.useState)(!0),t=Object(i.a)(e,2),n=t[0],r=t[1],c=Object(x.l)();return Object(a.useEffect)((function(){c(function(){var e=Object(O.a)(h.a.mark((function e(t,n,a){var r,c,s,o,i,u,l,p,b,j,f,m,O,g,T,S,N;return h.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=a.callZome,c=a.getAgentId,e.prev=1,e.next=4,r({zomeName:y.c.AGGREGATOR,fnName:y.a[y.c.AGGREGATOR].RETRIEVE_LATEST_DATA});case 4:return s=e.sent,e.next=7,c();case 7:return o=e.sent,i=Object(v.b)(o),t({type:E.a,id:i,nickname:s.userInfo.profile.nickname,fields:s.userInfo.profile.fields.avatar?{avatar:Object(x.a)(s.userInfo.profile.fields.avatar)}:{}}),u={},l={},s.addedContacts.forEach((function(e){var t=Object(v.b)(e.agentPubKey);u[t]={id:t,username:e.profile.nickname,fields:e.profile.fields.avatar?{avatar:Object(x.a)(e.profile.fields.avatar)}:{}}})),s.blockedContacts&&s.blockedContacts.forEach((function(e){var t=Object(v.b)(e.agentPubKey);l[t]={id:t,username:e.profile.nickname,fields:e.profile.fields.avatar?{avatar:Object(x.a)(e.profile.fields.avatar)}:{}}})),t({type:H.b,contacts:u}),t({type:H.a,blocked:l}),t({type:X.a,preference:{readReceipt:s.globalPreference.readReceipt,typingIndicator:s.globalPreference.typingIndicator}}),p=U(s.latestGroupMessages),b=s.groups.map((function(e){return{originalGroupId:Object(v.b)(e.groupId),originalGroupRevisionId:Object(v.b)(e.groupRevisionId),name:e.latestName,members:e.members.map((function(e){return Object(v.b)(e)})),createdAt:Object(x.k)(e.created),creator:Object(v.b)(e.creator),messages:p.messagesByGroup[Object(v.b)(e.groupId)],pinnedMessages:[]}})),j=s.memberProfiles.map((function(e){return{id:Object(v.b)(e.agentPubKey),username:e.profile.nickname,fields:e.profile.fields.avatar?{avatar:Object(x.a)(e.profile.fields.avatar)}:{}}})),console.log("latest groups",b),console.log("latest group messages",p),console.log("latest group members",j),f=n().groups.conversations,b.forEach((function(e){f[e.originalGroupId]=e})),m=n().groups.messages,m=Object(d.a)(Object(d.a)({},m),p.groupMessagesContents),O=n().groups.members,j.forEach((function(e){O[e.id]=e})),t({type:Z.k,messages:m,conversations:f,members:O}),g=Object(d.a)({},n().contacts.contacts),T=Object(d.a)({},n().profile),S=Object(d.a)(Object(d.a)({},g),{},Object(D.a)({},T.id,{id:T.id,username:T.username,fields:T.fields})),N=Object(V.a)(s.latestP2pMessages,S),console.log("latest p2p messages",N),t(Object(Y.a)(N)),e.abrupt("return",null);case 39:e.prev=39,e.t0=e.catch(1),t(Object(_.a)("TOAST",{},{id:"redux.err.commons-get-latest-data"}));case 42:case"end":return e.stop()}}),e,null,[[1,39]])})));return function(t,n,a){return e.apply(this,arguments)}}()).then((function(e){return r(!1)}))}),[]),n?Object(f.jsx)(m,{}):Object(f.jsxs)(o.V,{contentId:"main",children:[Object(f.jsx)(L,{}),Object(f.jsx)(o.L,{id:"main",children:Object(f.jsxs)(I.d,{children:[Object(f.jsx)(I.b,{path:"/home",render:function(){return Object(f.jsx)(Sa,{})}}),Object(f.jsx)(I.b,{path:"/compose",exact:!0,component:za}),Object(f.jsx)(I.b,{path:"/settings",exact:!0,component:ar}),Object(f.jsx)(I.b,{path:"/g/:group",component:qn}),Object(f.jsx)(I.b,{path:"/u/:id",component:hn}),Object(f.jsx)(I.b,{path:"/p/:id",exact:!0,component:Xa}),Object(f.jsx)(I.b,{path:"/blocked",exact:!0,component:J}),Object(f.jsx)(I.a,{from:"/",to:"/home"})]})})]})},cr=n(103),sr=n(115),or=n.n(sr),ir=function(){var e=Object(I.f)();return Object(f.jsx)(o.H,{children:Object(f.jsx)(o.k,{fullscreen:!0,children:Object(f.jsxs)("div",{className:or.a.landing,children:[Object(f.jsx)(o.s,{src:"assets/icon/kizuna_logo.png",className:or.a.logo}),Object(f.jsx)("div",{className:or.a.actions,children:Object(f.jsx)(o.K,{children:Object(f.jsx)(o.e,{onClick:function(){return e.push({pathname:"/register"})},className:"ion-margin-bottom",children:Object(f.jsx)(Kn.a,{id:"app.landing.register"})})})})]})})})},ur=n(93),lr=n.n(ur),pr=function(){var e=Object(a.useState)(""),t=Object(i.a)(e,2),n=t[0],r=t[1],c=Object(l.a)(),s=Object(I.f)();return Object(f.jsxs)(o.H,{children:[Object(f.jsx)(o.q,{children:Object(f.jsx)(o.fb,{className:lr.a.toolbar,children:Object(f.jsx)(o.f,{slot:"start",children:Object(f.jsx)(o.e,{onClick:function(){return s.push({pathname:"/"})},className:"ion-no-padding",children:Object(f.jsx)(o.r,{slot:"icon-only",icon:u.e})})})})}),Object(f.jsx)(o.k,{children:Object(f.jsxs)("div",{className:lr.a.login,children:[Object(f.jsx)("div",{className:lr.a.form,children:Object(f.jsxs)("div",{children:[Object(f.jsx)(o.z,{className:lr.a.label,children:c.formatMessage({id:"app.login.username-label"})}),Object(f.jsx)(o.v,{value:n,onIonChange:function(e){return r(e.detail.value)},placeholder:c.formatMessage({id:"app.login.username-placeholder"})})]})}),Object(f.jsx)(o.e,{onClick:function(){},children:c.formatMessage({id:"app.login.login"})})]})}),Object(f.jsx)(o.C,{isOpen:!1})]})},dr=n(168),br=n(94),jr=n.n(br),fr=["error","className"],mr=function(e){var t=e.error,n=e.className,r=Object(dr.a)(e,fr),c=Object(a.useState)(!1),s=Object(i.a)(c,2),u=s[0],l=s[1];return Object(a.useEffect)((function(){l(!!t)}),[t]),Object(f.jsxs)(o.y,{children:[Object(f.jsx)(o.v,Object(d.a)({className:"".concat(jr.a.input," ").concat(u?jr.a["error-input"]:""," ").concat(n)},r)),Object(f.jsx)("div",{className:jr.a["error-container"],children:u?Object(f.jsx)(o.z,{color:"danger",className:"ion-text-wrap ".concat(jr.a.error),children:t}):null})]})},Or=function(e){return/^[a-zA-Z0-9_](?!.*?[._]{2})[a-zA-Z0-9_.]{2,15}$/.test(e)},gr=n(66),hr=n.n(gr),vr=n(169),yr=n.n(vr),xr=(n(225),[{label:"Original",value:0},{label:"Square",value:1},{label:"16 / 9",value:16/9}]),_r=function(e){var t=e.label,n=e.value,a=e.onChange,r=e.dismiss;return Object(f.jsx)(o.w,{onClick:function(){a(n),r()},children:Object(f.jsx)(o.z,{children:t})})},Er=function(e){var t=e.onChange,n=e.dismiss;return Object(f.jsx)(o.A,{children:xr.map((function(e){return Object(f.jsx)(_r,{onChange:t,label:e.label,value:e.value,dismiss:n},e.label)}))})},Tr=n(116),Sr=n.n(Tr),Nr=function(e){var t=e.src,n=e.prevPath,r=e.dismiss,c=e.onComplete,s=Object(a.useState)({x:0,y:0,aspect:1}),l=Object(i.a)(s,2),p=l[0],b=l[1],j=Object(a.useState)(null),m=Object(i.a)(j,2),O=m[0],g=m[1],h=Object(a.useRef)(null),v=Object(a.useState)({}),y=Object(i.a)(v,2),x=y[0],_=y[1];Object(a.useEffect)((function(){var e=new Image;e.onload=function(){setTimeout((function(){if(window.innerHeight>=window.innerWidth){var t=h.current.getBoundingClientRect().width/e.naturalWidth;e.naturalHeight*t<=h.current.getBoundingClientRect().height?_({width:"100vw"}):_({height:"100vh",width:h.current.getBoundingClientRect().height/e.naturalHeight*e.naturalWidth})}else{var n=h.current.getBoundingClientRect().height/e.naturalHeight;e.naturalWidth*n<=h.current.getBoundingClientRect().width?_({height:"100vh"}):_({width:"100vw",height:h.current.getBoundingClientRect().width/e.naturalWidth*e.naturalHeight})}}),500)},e.src=t}),[]);var E=Object(a.useRef)(null),T=Object(o.rb)(Er,{onChange:function(e){b((function(t){var n=Object(d.a)({},t);return 0===e?delete n.aspect:n.aspect=e,n}))},dismiss:function(){return N()}}),S=Object(i.a)(T,2),N=(S[0],S[1]);Object(a.useEffect)((function(){O&&(c(O),g(null))}),[O]);var w=Object(a.useRef)(null);return Object(f.jsx)(o.H,{children:Object(f.jsxs)("div",{className:Sr.a.content,children:[Object(f.jsxs)("div",{className:Sr.a.header,ref:E,children:[Object(f.jsx)(o.e,{fill:"clear",href:n,children:Object(f.jsx)(o.r,{icon:u.c})}),Object(f.jsx)(o.e,{fill:"clear",onClick:function(){!function(){var e,t,n=document.createElement("canvas"),a=null===w||void 0===w||null===(e=w.current)||void 0===e||null===(t=e.imageRef)||void 0===t?void 0:t.current,r=a?a.naturalWidth/a.width:0,c=a?a.naturalHeight/a.height:0;n.width=p.width,n.height=p.height;var s=n.getContext("2d"),o=window.devicePixelRatio;n.width=p.width*o,n.height=p.height*o,s.setTransform(o,0,0,o,0,0),s.imageSmoothingQuality="high",a&&s.drawImage(a,p.x*r,p.y*c,p.width*r,p.height*c,0,0,p.width,p.height),n.toBlob((function(e){null===e||void 0===e||e.arrayBuffer().then((function(e){var t=new Uint8Array(e);g(t)}))}),"image/jpeg",1)}(),r()},children:Object(f.jsx)(o.r,{icon:u.n})})]}),Object(f.jsx)("div",{className:Sr.a["image-cropper"],ref:h,children:Object.keys(x).length>0?Object(f.jsx)(yr.a,{circularCrop:!0,ref:w,imageStyle:Object(d.a)(Object(d.a)({},x),{},{objectFit:"contain"}),src:t,onChange:function(e){return b(e)},keepSelection:!0,crop:p}):Object(f.jsx)(o.U,{})})]})})},wr=function(){var e=Object(a.useState)(""),t=Object(i.a)(e,2),n=t[0],r=t[1],c=Object(a.useState)(null),s=Object(i.a)(c,2),p=s[0],d=s[1],b=Object(a.useState)(!1),j=Object(i.a)(b,2),m=j[0],O=j[1],g=Object(x.l)(),h=Object(a.useRef)(null),v=Object(a.useState)(null),y=Object(i.a)(v,2),_=y[0],E=y[1],S=Object(a.useRef)(null),N=Object(l.a)();Object(a.useEffect)((function(){d(Or(n)&&n.length>=3?null:N.formatMessage({id:"app.register.error-invalid-username"}))}),[]);var w=function(){O(!0),g(T(n,S.current.src.includes("svg")?null:_)).then((function(e){e||O(!1)}))};Object(a.useEffect)((function(){_&&M({cssClass:"cropper ".concat(hr.a.modal)})}),[_]);var I=Object(o.qb)(Nr,{src:function(){var e=new TextDecoder;return _?e.decode(_):""}(),prevPath:"/register",dismiss:function(){R()},onComplete:function(e){if(e){var t=new Blob([e],{type:"image/jpeg"});S.current.src=URL.createObjectURL(t),E(e)}}}),k=Object(i.a)(I,2),M=k[0],R=k[1];return Object(f.jsxs)(o.H,{children:[Object(f.jsx)(o.q,{children:Object(f.jsx)(o.fb,{className:hr.a.toolbar,children:Object(f.jsx)(o.f,{slot:"start",children:Object(f.jsx)(o.c,{defaultHref:"/"})})})}),Object(f.jsxs)(o.k,{children:[Object(f.jsxs)("div",{className:hr.a.register,children:[Object(f.jsxs)("div",{className:hr.a.form,children:[Object(f.jsxs)("div",{className:hr.a["profile-picture"],onClick:function(){var e;_?(h.current.value="",E(null),S.current.src=u.P):null===h||void 0===h||null===(e=h.current)||void 0===e||e.click()},children:[Object(f.jsx)("img",{alt:"avatar",ref:S,src:u.P}),Object(f.jsx)("div",{className:hr.a.icon,children:null===_?Object(f.jsx)(o.r,{size:"large",icon:u.E}):Object(f.jsx)(o.r,{size:"large",icon:u.s})})]}),Object(f.jsxs)("div",{children:[Object(f.jsx)(o.z,{className:hr.a.label,children:N.formatMessage({id:"app.register.username-label"})}),Object(f.jsx)("input",{ref:h,accept:"image/png, image/jpeg",type:"file",hidden:!0,onChange:function(){Array.from(h.current?h.current.files:new FileList).forEach((function(e){e.arrayBuffer().then((function(t){var n=new FileReader,a=new TextEncoder;n.readAsDataURL(e),n.onload=function(e){var t,n=a.encode(null===(t=e.target)||void 0===t?void 0:t.result);E(n)}}))}))}}),Object(f.jsx)(mr,{value:n,onIonChange:function(e){r(e.detail.value),d(Or(e.detail.value)&&e.detail.value.length>=3?null:N.formatMessage({id:"app.register.error-invalid-username"}))},onKeyPress:function(e){return function(e){return"Enter"!==e.key||e.shiftKey||p?null:w()}(e)},placeholder:N.formatMessage({id:"app.register.username-placeholder"}),error:p,debounce:600})]})]}),Object(f.jsx)(o.e,{onClick:w,disabled:!!p,children:N.formatMessage({id:"app.register.register"})})]}),Object(f.jsx)(o.C,{isOpen:m})]})]})},Ir=function(){return Object(f.jsxs)(cr.a,{children:[Object(f.jsx)(I.b,{path:"/",component:ir}),Object(f.jsx)(I.b,{path:"/register",component:wr}),Object(f.jsx)(I.b,{path:"/login",component:pr})]})},kr=n(170),Mr=n.n(kr),Rr=function(){var e=Object(l.a)(),t=Object(p.c)((function(e){return e.profile})).username,n=Object(a.useState)(!0),r=Object(i.a)(n,2),c=r[0],s=r[1],d=Object(a.useState)(!1),b=Object(i.a)(d,2),j=b[0],O=b[1],g=Object(x.l)();Object(a.useEffect)((function(){g(S()).then((function(e){e||O(!0),s(!1)}))}),[g]);return c?Object(f.jsx)(m,{}):null!==t?Object(f.jsx)(rr,{}):j?Object(f.jsxs)("div",{className:Mr.a.err,children:[Object(f.jsx)(o.r,{icon:u.Y}),Object(f.jsx)(o.Z,{children:e.formatMessage({id:"app.auth.err"})})]}):Object(f.jsx)(Ir,{})};Object(o.pb)({mode:"md"});var Pr=function(){return Object(f.jsx)(Rr,{})},Cr=function(e){var t=e.children,n=Object(p.c)((function(e){return e.error.errors})),r=lt().showErrorToast,c=Object(x.l)(),s=Object(l.a)();return Object(a.useEffect)((function(){if(n.length>0){var e=n[0],t=e.intl?{message:s.formatMessage({id:e.intl.id},e.intl.value)}:{};r(Object(d.a)(Object(d.a)({},e.options),t)),c(Object(_.b)())}}),[n,c,s,r]),Object(f.jsx)(f.Fragment,{children:t})},Ar=n(279),Gr=n(68),Lr=n.n(Gr),Dr=function(){var e=Object(a.useState)(0),t=Object(i.a)(e,2),n=t[0],r=t[1],c=Object(x.l)(),s=[{language:"English",code:"en"},{language:"Japanese",code:"jp"}];return Object(f.jsx)(o.H,{children:Object(f.jsxs)("div",{className:Lr.a.page,children:[Object(f.jsx)("div",{className:Lr.a["language-container"],children:s.map((function(e,t){var a=e.language;return Object(f.jsx)(o.Z,{className:"".concat(Lr.a.language).concat(n===t?" ".concat(Lr.a.selected):""),onClick:function(){return r(t)},children:Object(f.jsx)("p",{children:a})},a)}))}),Object(f.jsx)("div",{className:Lr.a["button-container"],children:Object(f.jsx)(o.e,{onClick:function(){c(qa(s[n].code))},className:"".concat(Lr.a.button),children:"Select"})})]})})},Hr={en:n(171),jp:n(172)},zr=function(e){var t=e.children,n=Object(x.l)(),a=Object(p.c)((function(e){var t=e.language.language;if(t)return t;var a=localStorage.getItem("language");return a&&n(qa(a)),null}));return a?Object(f.jsx)(Ar.a,{messages:Hr[a],defaultLocale:"en",locale:"en",children:t}):Object(f.jsx)(Dr,{})},Ur=function(e){var t=e.children;return Object(f.jsx)(o.a,{children:t})},Fr=n(77),Br=function(e){var t=e.children;return Object(f.jsx)(cr.a,{children:t})},Zr=function(e){var t=e.children,n=Object(a.useState)(!1),r=Object(i.a)(n,2),c=r[0],s=r[1],u=Object(a.useState)(!1),l=Object(i.a)(u,2),b=l[0],j=l[1],m=Object(p.c)((function(e){return e.language.language})),O=Object(a.useState)({}),g=Object(i.a)(O,2),h=g[0],v=g[1];Object(a.useEffect)((function(){s(b)}),[b]);var y=function(){j(!1),s(!1)};function x(e){return void 0!==e.split}Object(a.useEffect)((function(){b||v({})}),[b]);return Object(f.jsxs)(ut.Provider,{value:{showToast:function(e){v(e),j(!0)},dismissToast:y,showErrorToast:function(e){if("en"===m){var t=null===e||void 0===e?void 0:e.message;if(t){var n=x(t)?160*t.split(" ").length:160*t.value.split(" ").length;v(Object(d.a)({color:"danger",duration:n},e))}}else if("jp"===m){var a=null===e||void 0===e?void 0:e.message;if(a){var r=x(a)?100*Object(q.a)(a).length:100*Object(q.a)(a.value).length;v(Object(d.a)({color:"danger",duration:r},e))}}else v(Object(d.a)({color:"danger"},e));j(!0)}},children:[Object(f.jsx)(o.db,Object(d.a)({isOpen:c,onDidDismiss:y,duration:1500},h)),t]})},Vr=function(e){var t=e.children;return Object(f.jsx)(Fr.a,{children:Object(f.jsx)(Ur,{children:Object(f.jsx)(Br,{children:Object(f.jsx)(zr,{children:Object(f.jsx)(Zr,{children:Object(f.jsx)(Cr,{children:t})})})})})})};n(228);s.a.render(Object(f.jsx)(Vr,{children:Object(f.jsx)(Pr,{})}),document.getElementById("root"))}],[[229,3,4]]]);
//# sourceMappingURL=main.85e909b0.chunk.js.map